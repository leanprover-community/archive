[
    {
        "content": "<p>I noticed <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.prod_range_add_one_eq_factorial#doc\">docs#Finset.prod_range_add_one_eq_factorial</a> is at <code>Algebra.BigOperators.Intervals</code> and not next to its factorial friends like <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.ascFactorial_eq_prod_range#doc\">docs#Nat.ascFactorial_eq_prod_range</a> at <code>Data.Nat.Factorial.BigOperators</code>.<br>\nPR: <a href=\"https://github.com/leanprover-community/mathlib4/pull/30183/files\">https://github.com/leanprover-community/mathlib4/pull/30183/files</a><br>\nBut moving seems to trigger <a href=\"https://github.com/leanprover-community/mathlib4/blob/0607ff2a96e2cf339095543dc6d03a64a55dc01b/Mathlib/Algebra/Ring/GeomSum.lean#L21\"><code>assert_not_exists</code> statements</a> and cause heartbeat timeouts:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Ring</span><span class=\"bp\">/</span><span class=\"n\">GeomSum</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">21</span><span class=\"o\">:</span><span class=\"mi\">18</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Declaration</span><span class=\"w\"> </span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">allowed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n<span class=\"n\">It</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Field</span><span class=\"bp\">.</span><span class=\"n\">Defs</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">NormNum</span><span class=\"bp\">.</span><span class=\"n\">Result</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">NormNum</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Positivity</span><span class=\"bp\">.</span><span class=\"n\">Core</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">AbsoluteValue</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Factorial</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"bp\">.</span><span class=\"n\">Intervals</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n\n<span class=\"n\">Error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Ring</span><span class=\"bp\">/</span><span class=\"n\">GeomSum</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">21</span><span class=\"o\">:</span><span class=\"mi\">24</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Declaration</span><span class=\"w\"> </span><span class=\"n\">IsOrderedRing</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">allowed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n<span class=\"n\">It</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Defs</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Abs</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">AbsoluteValue</span><span class=\"bp\">.</span><span class=\"n\">Basic</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"bp\">.</span><span class=\"n\">Ring</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Factorial</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">BigOperators</span><span class=\"bp\">.</span><span class=\"n\">Intervals</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/18235379718/job/51927995297?pr=30183\">CI</a></p>\n<p>Thoughts? Should I leave it as it is right now, or maybe shuffle things around to solve this, or even go the other way and move all of <code>Data.Nat.Factorial.BigOperators</code> into <code>Algebra.BigOperators.Intervals</code> since it imports stuff from <code>Algebra</code> anyways.</p>",
        "id": 543051037,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1759543809
    },
    {
        "content": "<p>Does prod_range_add_one_eq_factorial need to be in BigOperators.Intervals?</p>",
        "id": 543063142,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759558549
    },
    {
        "content": "<p>And why are you introducing an essentially duplicate theorem? I'm a bit confused what the goal is here</p>",
        "id": 543063216,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759558663
    },
    {
        "content": "<p>The goal is to have a theorem about factorial in terms of a product in <code>Data.Nat.Factorial.BigOperators</code>, but that theorem already exists in a weird place.<br>\nRemoving it doesn't some like an option, and neither does making it an alias.</p>",
        "id": 543124889,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1759622444
    },
    {
        "content": "<p>What's the issue with moving it?</p>",
        "id": 543139708,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759643743
    },
    {
        "content": "<p>That'll mean that during the deprecation period the theorem will be duplicated, and neither will be an alias of the other</p>",
        "id": 543141269,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1759645896
    },
    {
        "content": "<p>What deprecation period?</p>",
        "id": 543141599,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1759646307
    },
    {
        "content": "<p>if you <em>move</em> a theorem you don't need to deprecate-alias</p>",
        "id": 543153434,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759660681
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2330183.20move.20factorial.20theorem/near/543153434\">said</a>:</p>\n<blockquote>\n<p>if you <em>move</em> a theorem you don't need to deprecate-alias</p>\n</blockquote>\n<p>Since the current location of the theorem can't import the target location of the theorem, moving it means current users of the theorem will get an error unless they change their imports. That's the problem I created the thread for.<br>\nDoes your statement still apply in this case?</p>",
        "id": 543195011,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1759700830
    },
    {
        "content": "<p>I think so, but I'm not a maintainer</p>",
        "id": 543195034,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1759700862
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2330183.20move.20factorial.20theorem/near/543195034\">said</a>:</p>\n<blockquote>\n<p>I think so, but I'm not a maintainer</p>\n</blockquote>\n<p>Huh, then I guess I'll try it and see what the reviews say, thanks!</p>\n<p>btw I thought you were an official reviewer, strange, but in any case I really appreciate your reviews on my PRs! Without you taking the time to explain some things I still wouldn't know what \"squeezing non-terminal simp\" means</p>",
        "id": 543195922,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1759702027
    }
]