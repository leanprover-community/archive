[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/29422\">#29422</a> by <span class=\"user-mention\" data-user-id=\"266253\">@Joseph Myers</span> creates a new idiom <code>[LinearOrder α] [DecidableEq α]</code> (which apparently is already used <a href=\"https://loogle.lean-lang.org/?q=LinearOrder+%3Fa+%E2%86%92+DecidableEq+%3Fa+%E2%86%92+_\">22 times</a>) because this is syntactically more general (i.e. the DecidableEq instance from LinearOrder might not be defeq with another instance). Is this a good idea?</p>",
        "id": 558684078,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1763737993
    },
    {
        "content": "<p>No, it doesn't look like a good idea: normally, the decidable instance coming from the linear order should be the right one (if we've designed the library correctly), so the other one can only create diamonds. If this DecidableEq is useful at some point, it's probably a hint that there is something fishy elsewhere, and we should fix that instead.</p>",
        "id": 558686912,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1763738614
    },
    {
        "content": "<p>that's also a good point</p>",
        "id": 558687123,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1763738662
    },
    {
        "content": "<p>One should never have two non-defeq data-bearing typeclasses of the same type.</p>",
        "id": 558687930,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1763738824
    },
    {
        "content": "<p>should we get rid of those 22 instances as well?</p>",
        "id": 558688087,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1763738858
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2329422.20.5BLinearOrder.20.CE.B1.5D.20.5BDecidableEq.20.CE.B1.5D/near/558686912\">said</a>:</p>\n<blockquote>\n<p>so the other one can only create diamonds</p>\n</blockquote>\n<p>Note that adding <code>[LinearOrder α] [DecidableEq α]</code> to <em>theorems</em> will not create diamonds, and if anything will make the theorem more permissive of diamonds existing elsewhere; but indeed the diamond should never exist in the first place.</p>",
        "id": 558688109,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1763738863
    },
    {
        "content": "<p>I think we've had a similar discussion in the past about whether to assume <code>[Fintype (α × β)]</code> or <code>[Fintype α]</code> <code>[Fintype β]</code>, though I guess there is a genuine difference there when one type is infinite and the other is empty</p>",
        "id": 558688414,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1763738944
    },
    {
        "content": "<p>I meant diamonds inside the proof of the theorem itself.</p>",
        "id": 558689607,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1763739259
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2329422.20.5BLinearOrder.20.CE.B1.5D.20.5BDecidableEq.20.CE.B1.5D/near/558688109\">said</a>:</p>\n<blockquote>\n<p>Note that adding <code>[LinearOrder α] [DecidableEq α]</code> to <em>theorems</em> will not create diamonds, and if anything will make the theorem more permissive of diamonds existing elsewhere; but indeed the diamond should never exist in the first place.</p>\n</blockquote>\n<p>I think this is not quite true. Of course, it's true in the sense that it won't create a new diamond on any concrete type. However, it possible (though I suspect unlikely) that Lean could elaborate part of the statement with the DecEq instance given, and another part with the DecEq instance coming from LinearOrder. This might make the statement seemingly inexplicably hard to prove (unless something like <code>congr!</code> or <code>convert</code> uses subsingleton elimination behind the scenes for you). So, the problem is only local to the proof of this theorem.</p>",
        "id": 558690819,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1763739570
    },
    {
        "content": "<p>Oh I suppose this is what <span class=\"user-mention silent\" data-user-id=\"110050\">Sébastien Gouëzel</span> is saying.</p>",
        "id": 558690907,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1763739596
    },
    {
        "content": "<p>Oooh, I'm only seeing this discussion now... I just kicked it on the queue. Will take it off now.</p>",
        "id": 558694318,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1763740441
    },
    {
        "content": "<p>My apologies, I'll link here next time</p>",
        "id": 558694480,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1763740488
    },
    {
        "content": "<p>Could our DecidableEq linter catch this <span class=\"user-mention\" data-user-id=\"548935\">@Thomas Murrills</span> ?</p>",
        "id": 558694539,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1763740501
    },
    {
        "content": "<p>I actually checked that with Thomas, and these decls pass the linter.</p>",
        "id": 558694726,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1763740546
    },
    {
        "content": "<p>So maybe we actually want to make the linter more strict.</p>",
        "id": 558694756,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1763740555
    },
    {
        "content": "<p>what is that linter?</p>",
        "id": 558694801,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1763740567
    },
    {
        "content": "<p><a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Unused.20Decidable.20Instances.20linter/with/558344425\">#mathlib4 &gt; Unused Decidable Instances linter</a></p>",
        "id": 558694967,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1763740613
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/31142\">#31142</a></p>",
        "id": 558694979,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1763740616
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2329422.20.5BLinearOrder.20.CE.B1.5D.20.5BDecidableEq.20.CE.B1.5D/near/558694756\">said</a>:</p>\n<blockquote>\n<p>So maybe we actually want to make the linter more strict.</p>\n</blockquote>\n<p>Hmm, what would this look like? The DecidableEq instance <em>is</em> used in the remainder of the type, after all—what would a stricter version be checking for?</p>",
        "id": 558695306,
        "sender_full_name": "Thomas Murrills",
        "timestamp": 1763740700
    },
    {
        "content": "<p>Somehow that there aren't two non-defeq ways to synth <code>DecidableEq</code>...</p>",
        "id": 558695580,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1763740758
    },
    {
        "content": "<p>What do you mean by that?</p>",
        "id": 558695720,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1763740790
    },
    {
        "content": "<p>8 messages were moved from this topic to <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/diamond.20linter/with/558797066\">#mathlib4 &gt; diamond linter</a> by <span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span>.</p>",
        "id": 558797067,
        "sender_full_name": "Notification Bot",
        "timestamp": 1763799841
    },
    {
        "content": "<p>Maybe the confusion stems from the fact that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrder#doc\">docs#LinearOrder</a> is lil bit confusing?</p>",
        "id": 558798211,
        "sender_full_name": "Martin Dvořák",
        "timestamp": 1763801041
    },
    {
        "content": "<p>Can someone remind me why we have all this decidable nonsense in <code>LinearOrder</code> rather than just ripping it out and having it as separate assumptions?</p>",
        "id": 558856178,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1763862072
    },
    {
        "content": "<p>Because it has always been so. (Let's do it!)</p>",
        "id": 558858964,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763865125
    },
    {
        "content": "<p>You and I are old enough to remember when fields had some kind of decidability assumption in them to deal with the fact that one of the axioms mentioned <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo mathvariant=\"normal\">≠</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">x\\ne0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>, and we seemed to be able to get rid of that one with no problem</p>",
        "id": 558859407,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1763865595
    },
    {
        "content": "<p>Previous discussion on that here: <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/remove.20decidable.20fields.20from.20LinearOrder.3F/with/505866222\">#mathlib4 &gt; remove decidable fields from LinearOrder?</a> And of course, don't forget that we previously had <code>linear_order</code> and <code>decidable_linear_order</code>, and decided to merge them, and thus add the <code>decidable</code> assumption into what's now <code>LinearOrder</code></p>",
        "id": 558864329,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1763872116
    },
    {
        "content": "<p>Should decidability be thought of as a \"hierarchy\" like the algebra hierarchy, order hierarchy etc, topology etc? Because I thought there was a move towards separating these out. I'm not sure whether to have the discussion here or in the old thread (which contains useful points).</p>",
        "id": 558893164,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1763903102
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2329422.20.5BLinearOrder.20.CE.B1.5D.20.5BDecidableEq.20.CE.B1.5D/near/558856178\">said</a>:</p>\n<blockquote>\n<p>Can someone remind me why we have all this decidable nonsense in <code>LinearOrder</code> rather than just ripping it out and having it as separate assumptions?</p>\n</blockquote>\n<p>If I remember correctly the old Lean 3 times, it's because many many theorems on LinearOrders require the decidability (if you want to case on whether <code>x &lt; y</code> or <code>y \\le x</code>, you need the decidability). To the point that LinearOrders without decidability were essentially useless. So we got rid of them, and included the decidability in the typeclass just to have something usable all the time. </p>\n<p>We could indeed remove the decidability from the typeclass, and use it as a separate assumption. But it would be there in most theorems, so it would make things more noisy and less readable. To be honest, I don't really see what we would gain from this move.</p>",
        "id": 558895169,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1763905051
    },
    {
        "content": "<p>Shouldn't these theorems (not definitions) just do classical for these? That feels like the stance of mathlib nowadays</p>",
        "id": 558897949,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1763907739
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2329422.20.5BLinearOrder.20.CE.B1.5D.20.5BDecidableEq.20.CE.B1.5D/near/558858964\">said</a>:</p>\n<blockquote>\n<p>Because it has always been so. (Let's do it!)</p>\n</blockquote>\n<p>This would be brilliant.</p>",
        "id": 559106394,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764004601
    },
    {
        "content": "<p>(As in, it would be brilliant to change this definition.)</p>",
        "id": 560106887,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1764063706
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2329422.20.5BLinearOrder.20.CE.B1.5D.20.5BDecidableEq.20.CE.B1.5D/near/558897949\">said</a>:</p>\n<blockquote>\n<p>Shouldn't these theorems (not definitions) just do classical for these? That feels like the stance of mathlib nowadays</p>\n</blockquote>\n<p>I think it would be good to experiment what percentage of theorems is affected. I agree it seems like a good move, but I don't know for sure.</p>",
        "id": 562384022,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1765166798
    }
]