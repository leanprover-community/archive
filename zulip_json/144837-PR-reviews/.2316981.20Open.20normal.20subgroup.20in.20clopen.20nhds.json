[
    {
        "content": "<p>In this PR, I proved that in a compact topological group, for any clopen neighborhood of <code>1</code>, there is always an open normal subgroup contained in it. <br>\nThis PR depends on : <a href=\"https://github.com/leanprover-community/mathlib4/pull/16977\">#16977</a> define closed subgroup and <a href=\"https://github.com/leanprover-community/mathlib4/pull/16980\">#16980</a> Open normal subgroup<br>\nBTW : when totally diconnected, clopen nhds form neighborhood basis, and thus open normal subgroup form neighborhood basis, and this would be updated in PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/16992\">#16992</a>.</p>",
        "id": 472036277,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1727001189
    },
    {
        "content": "<p>I have a question here : what can be the reason causing the add of the label <code>large-import</code> after merging the latest <code>master</code> into it? This label has never been added before this.<br>\nThank you.</p>",
        "id": 474825890,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1728049209
    },
    {
        "content": "<p>It's a new label to flag to reviewers that you're adding imports; they'll consider whether any action is needed from you</p>",
        "id": 474826306,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1728049320
    },
    {
        "content": "<p>Having had a look, I think this label is correctly indicating that the new material should be moved to a new file, rather than increasing the imports of the current file.</p>",
        "id": 476678790,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1728882657
    },
    {
        "content": "<p>(This may not be apparent to new contributors, but every time we add imports to an existing file, we further tighten the knot of Mathlib's current import graph.)</p>",
        "id": 476678821,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1728882685
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2316981.20Open.20normal.20subgroup.20in.20clopen.20nhds/near/476678790\">said</a>:</p>\n<blockquote>\n<p>Having had a look, I think this label is correctly indicating that the new material should be moved to a new file, rather than increasing the imports of the current file.</p>\n</blockquote>\n<p>Thank for the suggestion. Actually there is only two theorems using the newly added import, should I make a new file or just put it before where it is usd? Thank you.</p>",
        "id": 476706753,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1728892047
    },
    {
        "content": "<p>\"just put it before where it is usd\" is fine <em>if</em>â€¯that is a natural location for the lemma.<br>\nOtherwise, please make a new file.</p>",
        "id": 476759875,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1728905976
    },
    {
        "content": "<p>I think it should be put in a new file (currently named <code>ClopenNhdofOne.lean</code> in <code>Topology.Algebra</code>), it is more closely related to the clopen neighborhoods, any suggestions about how to arrange them with the now  existing 'OpenSubgroup'? (Or should I move all the things in this PR into the new file?)</p>",
        "id": 476764127,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1728907084
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/UwHjM4OBtAm_27uJvKM4h0-3/.png\">å›¾ç‰‡.png</a><br>\nDo any one know why the to_additive failed here but when <code>private</code> is deleted it would work?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/UwHjM4OBtAm_27uJvKM4h0-3/.png\" title=\"å›¾ç‰‡.png\"><img data-original-dimensions=\"2275x247\" src=\"/user_uploads/thumbnail/3121/UwHjM4OBtAm_27uJvKM4h0-3/.png/840x560.webp\"></a></div>",
        "id": 477435204,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1729169297
    },
    {
        "content": "<p>I can't quite see enough information in your screenshot. What happens if you type <code>whatsnew in</code> before the definition in both the private and non private cases?</p>",
        "id": 477527051,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729200593
    },
    {
        "content": "<p>Thank you, I'll try.</p>",
        "id": 477571616,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1729227221
    },
    {
        "content": "<p>I think I found a bit difference: <br>\n<a href=\"/user_uploads/3121/Z8Cji4N__ukVQj8kMYZSNMIr/.png\">å›¾ç‰‡.png</a><br>\n<a href=\"/user_uploads/3121/ik-RjqSPXJ2R5vIHu3UkANxc/.png\">å›¾ç‰‡.png</a><br>\nthe definition and proof somehow swaped, is this the problem?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/Z8Cji4N__ukVQj8kMYZSNMIr/.png\" title=\"å›¾ç‰‡.png\"><img data-original-dimensions=\"2375x1309\" src=\"/user_uploads/thumbnail/3121/Z8Cji4N__ukVQj8kMYZSNMIr/.png/840x560.webp\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ik-RjqSPXJ2R5vIHu3UkANxc/.png\" title=\"å›¾ç‰‡.png\"><img data-original-dimensions=\"2430x1432\" src=\"/user_uploads/thumbnail/3121/ik-RjqSPXJ2R5vIHu3UkANxc/.png/840x560.webp\"></a></div>",
        "id": 477573048,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1729228077
    },
    {
        "content": "<p>Do you have this on some PR or git branch?</p>",
        "id": 477584921,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1729234122
    },
    {
        "content": "<p>Currently, I pushed them onto <a href=\"https://github.com/leanprover-community/mathlib4/pull/16981\">#16981</a> without marking private to make the <code>@[to_additive]</code> work.<br>\nAlso I am not very sure wether these theorems should be marked as private.</p>",
        "id": 477587556,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1729235036
    },
    {
        "content": "<p>What does whatsnew think when to_additive is present? I'm just wondering if it's something to do with additivising the declaration name not resulting in a change to the name</p>",
        "id": 477595916,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729237617
    },
    {
        "content": "<p>PS I misclicked on mobile and resolved this thread (when trying to find out what its name was); I then unresolved it and I note that all messages in it are marked as edited less than a minute ago. The reason I wanted to know the name of the thread is that I'm concerned that the people who know the details of how to_additive works are not reading. IMO you should minimise to mathlib master instead of talking about some random PR and then ask about this issue in <a class=\"stream\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4\">#mathlib4</a></p>",
        "id": 477596309,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1729237748
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"749361\">@Nailin Guan</span> , thanks for your contribution! I have very good news for you: you can do all this in a much less painful way. There is a lot of benefit you can get from refining your proof before formalizing it. On paper itâ€™s enough to have an idea and force your way through it (or convince yourself it works on paper and then force it through Lean). But in order to be a happy formalizer, you need to be more careful, and then you can enjoy both a nice formalization and some improved understanding.</p>",
        "id": 479367242,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153386
    },
    {
        "content": "<p>I didnâ€™t know how to prove the result you were aiming for: in a compact topological group <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">G</span></span></span></span>, any clopen neighborhood of one contains an open subgroup. I tried following your Lean files in order but quickly gave up and started to read from the end. At this point it was clear that the key claim is: given a clopen neighborhood of one, there is a some <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>âŠ†</mo><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">T âŠ† G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">âŠ†</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">G</span></span></span></span> such that:</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>âˆˆ</mo><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">1 âˆˆ T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6835em;vertical-align:-0.0391em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">âˆˆ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>T</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>=</mo><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">Tâ»Â¹ = T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">âˆ’</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span> is open</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi><mi>T</mi><mo>âŠ†</mo><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">WT âŠ† W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">âŠ†</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span><br>\nThis understanding comes from your proof of the final statement and the lemmas it quotes. But it is not explained in the file, as far as I can see.  So letâ€™s try to state this.</li>\n</ul>",
        "id": 479367290,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153403
    },
    {
        "content": "<p>A Lean tip: having nested conjunctions is a nightmare, as can be seen from your <code>(Classical.choose_spec &lt;| Classical.choose_spec &lt;| isOpen_prod_iff.mp\n(mulClosurePairs_open WOpen) w 1 (mem_mulClosurePairs einW w)).2.2.2.2</code></p>",
        "id": 479367325,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153417
    },
    {
        "content": "<p>So we can use an ad-hoc structure (to be severely namedspaced, or even made <code>private</code>).</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">niceNhd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nhd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">  </span><span class=\"n\">isOpen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsOpen</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">  </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">exists_niceNhd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsClopen</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">niceNhd</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 479367365,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153439
    },
    {
        "content": "<p>Looking at the conditions in <code>niceNhd</code>, we see that conditions <code>inv</code> and <code>isOpen</code> can be enforced after the fact. So we state:</p>",
        "id": 479367442,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153492
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsClopen</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>",
        "id": 479367460,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153503
    },
    {
        "content": "<p>And then you can state and prove</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">exists_niceNhd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsClopen</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">niceNhd</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">T'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hT'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">WT'</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 479367557,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153561
    },
    {
        "content": "<p>The proof of that last lemma will involve <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=nhds_basis_opens#doc\">docs#nhds_basis_opens</a> and the idea of intersecting a neighborhood with its image under inversion (but there is no need for intermediate definitions for that).</p>",
        "id": 479367628,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153626
    },
    {
        "content": "<p>Now, let us focus on the proof core, ie. lemma <code>key</code>.  Here, you need to use compactness of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">G</span></span></span></span> and the fact that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span> is clopen. When using compactness, we have all been trained to go back to the Borel-Lebesgue property, aka <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCompact.elim_finite_subcover#doc\">docs#IsCompact.elim_finite_subcover</a>. But there is often a better way which is to argue by compact induction on sets, aka <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCompact.induction_on#doc\">docs#IsCompact.induction_on</a> (<span class=\"user-mention\" data-user-id=\"466290\">@Luigi Massacci</span> notice this nice example). The corresponding proof start is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Group</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">TopologicalGroup</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">CompactSpace</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">Filter</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsClopen</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">WClopen</span><span class=\"bp\">.</span><span class=\"n\">isClosed</span><span class=\"bp\">.</span><span class=\"n\">isCompact</span><span class=\"bp\">.</span><span class=\"n\">induction_on</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 479368210,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730153945
    },
    {
        "content": "<p>After that <code>apply</code>, you will get four goals</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">âŠ¢</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âˆ…</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span>\n\n<span class=\"bp\">âŠ¢</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">â¦ƒ</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">â¦„,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span>\n\n<span class=\"bp\">âŠ¢</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">â¦ƒ</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">â¦„,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â†’</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">âˆª</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span>\n\n<span class=\"bp\">âŠ¢</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"o\">[</span><span class=\"n\">W</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span>\n</code></pre></div>",
        "id": 479368559,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730154083
    },
    {
        "content": "<p>As usual when applying this induction principle, the first two goals are trivial. The last goal is needed also when applying the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCompact.elim_finite_subcover#doc\">docs#IsCompact.elim_finite_subcover</a>. And the really nice point if that the third goal is a simplified version of what you need to do with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsCompact.elim_finite_subcover#doc\">docs#IsCompact.elim_finite_subcover</a>, involving two sets instead of a finite collection of sets.</p>",
        "id": 479368903,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730154208
    },
    {
        "content": "<p>The full proof of <code>key</code> that Iâ€™m looking at is 23 lines long, without using anything not in Mathlib master. I can paste it here, but I think it makes a great exercise if you have enough time for this.</p>",
        "id": 479369582,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730154431
    },
    {
        "content": "<p>Note also that <code>exists_niceNhd</code> is 9 lines long, still using only Mathlib master and the definition of <code>niceNhd</code> pasted above.</p>",
        "id": 479369731,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730154496
    },
    {
        "content": "<p>Donâ€™t hesitate to ask questions here.</p>",
        "id": 479369936,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730154569
    },
    {
        "content": "<p>Thank you, I'll try to refine it following your suggestions. Actually the original formalization is not done by me, they (the two authors mentioned in the PR)copied most of this proof from GTM 186 in an even more straightforward way but every thing piled together,  so maybe I just got into decomposing the proofs instead of redesigning ......</p>",
        "id": 479388344,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1730167487
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">exist_mul_closure_nhd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsClopen</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">WClopen</span><span class=\"bp\">.</span><span class=\"n\">isClosed</span><span class=\"bp\">.</span><span class=\"n\">isCompact</span><span class=\"bp\">.</span><span class=\"n\">induction_on</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">âŸ¨</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"o\">,</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">univ_mem</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">empty_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">empty_subset</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_self</span><span class=\"o\">]</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">huv</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hT</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">hT</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mul_subset_mul_right</span><span class=\"w\"> </span><span class=\"n\">huv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">mem</span><span class=\"bp\">âŸ©âŸ©</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">Tâ‚</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hTâ‚</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem1</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">Tâ‚‚</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hTâ‚‚</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem2</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">Tâ‚</span><span class=\"w\"> </span><span class=\"bp\">âˆ©</span><span class=\"w\"> </span><span class=\"n\">Tâ‚‚</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">inter_mem</span><span class=\"w\"> </span><span class=\"n\">hTâ‚</span><span class=\"w\"> </span><span class=\"n\">hTâ‚‚</span><span class=\"o\">,</span>\n<span class=\"w\">      </span><span class=\"n\">mul_subset_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">memU</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">memV</span>\n<span class=\"w\">      </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">mem1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mul_mem_mul</span><span class=\"w\"> </span><span class=\"n\">memU</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">mem2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mul_mem_mul</span><span class=\"w\"> </span><span class=\"n\">memV</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">)</span><span class=\"bp\">âŸ©âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">memW</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">â»Â¹'</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_preimage</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">memW</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">isOpen_prod_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">continuous_mul</span><span class=\"bp\">.</span><span class=\"n\">isOpen_preimage</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">WClopen</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">âŸ¨</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h5</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h6</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mul_subset_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">h5</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mk_mem_prod</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">âˆ©</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨âŸ¨</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">IsOpen</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">W</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">âŸ©âŸ©âŸ©âŸ©</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">âŸ¨</span><span class=\"n\">V</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">IsOpen</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"n\">h4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">h6</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">mul_subset_mul_right</span><span class=\"w\"> </span><span class=\"n\">inter_subset_left</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">âŸ©âŸ©âŸ©âŸ©</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">mulInvClosureNhd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nhd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">  </span><span class=\"n\">isOpen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsOpen</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">  </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">exists_mulInvClosureNhd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsClopen</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mulInvClosureNhd</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">exist_mul_closure_nhd</span><span class=\"w\"> </span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hS</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">mem_nhds_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hS</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"bp\">âˆ©</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">â»Â¹</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsOpen</span><span class=\"bp\">.</span><span class=\"n\">inter</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsOpen</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">IsOpen</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_inter_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_self</span><span class=\"o\">])</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">ext</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_inter_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">inter_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_comm</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mul_subset_mul_left</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mul_subset_mul_left</span><span class=\"w\"> </span><span class=\"n\">inter_subset_left</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>Proven, but how to make the proof better? Thank you.</p>",
        "id": 479396879,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1730174370
    },
    {
        "content": "<p>One micro optimization is that you can use dot-notation: Instead of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsOpen</span><span class=\"bp\">.</span><span class=\"n\">inter</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">IsOpen</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>you can write</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"bp\">.</span><span class=\"n\">inter</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"bp\">.</span><span class=\"n\">inv</span>\n</code></pre></div>\n<p>and at that point it is probably short enough that you can just inline the proof where you need it.</p>",
        "id": 479400428,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730177021
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2316981.20Open.20normal.20subgroup.20in.20clopen.20nhds/near/479400428\">said</a>:</p>\n<blockquote>\n<p><code>h2.inter h2.inv</code></p>\n</blockquote>\n<p>Thank you, but still not short enough to make the line not exceeding 100 characters <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 479400915,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1730177378
    },
    {
        "content": "<p>Note that <code>IsOpen.mem_nhds this</code> can also become <code>this.mem_nhds</code>. I would probably go with</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h2</span><span class=\"bp\">.</span><span class=\"n\">inter</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"bp\">.</span><span class=\"n\">inv</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_inter_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_inv</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inv_one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_self</span><span class=\"o\">])</span>\n</code></pre></div>",
        "id": 479409592,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1730183625
    },
    {
        "content": "<p>The proofs I wrote yesterday were:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsClopen</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">WClopen</span><span class=\"bp\">.</span><span class=\"n\">isClosed</span><span class=\"bp\">.</span><span class=\"n\">isCompact</span><span class=\"bp\">.</span><span class=\"n\">induction_on</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">suffices</span><span class=\"w\"> </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\">  </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">univ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">S'</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hT</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hST</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hT</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mul_subset_mul_right</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hST</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">S'</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hT</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hST</span><span class=\"bp\">âŸ©</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">T'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hT'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hS'T'</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆ©</span><span class=\"w\"> </span><span class=\"n\">T'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">inter_mem</span><span class=\"w\"> </span><span class=\"n\">hT</span><span class=\"w\"> </span><span class=\"n\">hT'</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">union_mul</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">union_subset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mul_subset_mul_left</span><span class=\"w\"> </span><span class=\"n\">inter_subset_left</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hST</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">mul_subset_mul_left</span><span class=\"w\"> </span><span class=\"n\">inter_subset_right</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">hS'T'</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">xW</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">WClopen</span><span class=\"bp\">.</span><span class=\"n\">isOpen</span><span class=\"bp\">.</span><span class=\"n\">nhdsWithin_eq</span><span class=\"w\"> </span><span class=\"n\">xW</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Tendsto</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">Ã—</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">â†¦</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">Ã—Ë¢</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"n\">nhds_prod_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">*</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">tendsto_mul</span>\n<span class=\"w\">    </span><span class=\"n\">specialize</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"bp\">.</span><span class=\"n\">isOpen</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds</span><span class=\"w\"> </span><span class=\"n\">xW</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mem_map</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_prod_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">    </span><span class=\"n\">peel</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">hS</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">hT</span><span class=\"w\"> </span><span class=\"n\">hST</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">mul_subset_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">hy</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">â†</span><span class=\"w\"> </span><span class=\"n\">image_subset_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hST</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">hST</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">mk_mem_prod</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"bp\">âŸ©</span>\n\n<span class=\"kn\">structure</span><span class=\"w\"> </span><span class=\"n\">niceNhd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">nhd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âˆˆ</span><span class=\"w\"> </span><span class=\"n\">ğ“</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"n\">inv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"bp\">â»Â¹</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">  </span><span class=\"n\">isOpen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsOpen</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">  </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">âŠ†</span><span class=\"w\"> </span><span class=\"n\">W</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">exists_niceNhd</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">IsClopen</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">âˆƒ</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">niceNhd</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\"> </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">key</span><span class=\"w\"> </span><span class=\"n\">WClopen</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">T'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hT'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">WT'</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\"> </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nhds_basis_opens</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mem_iff</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hT'</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">T''</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">âŸ¨</span><span class=\"n\">one_T''</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">T''_op</span><span class=\"bp\">âŸ©</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">T''T'</span><span class=\"bp\">âŸ©</span>\n<span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">T''_mem</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">T''_op</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds</span><span class=\"w\"> </span><span class=\"n\">one_T''</span>\n<span class=\"w\"> </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">T''</span><span class=\"w\"> </span><span class=\"bp\">âˆ©</span><span class=\"w\"> </span><span class=\"n\">T''</span><span class=\"bp\">â»Â¹</span>\n<span class=\"w\"> </span><span class=\"n\">constructor</span>\n<span class=\"w\"> </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">inter_mem</span><span class=\"w\"> </span><span class=\"n\">T''_mem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inv_mem_nhds_one</span><span class=\"w\"> </span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">T''_mem</span><span class=\"o\">)</span>\n<span class=\"w\"> </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inter_comm</span><span class=\"o\">]</span>\n<span class=\"w\"> </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">T''_op</span><span class=\"bp\">.</span><span class=\"n\">inter</span><span class=\"w\"> </span><span class=\"n\">T''_op</span><span class=\"bp\">.</span><span class=\"n\">inv</span>\n<span class=\"w\"> </span><span class=\"bp\">Â·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">mul_subset_mul_left</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inter_subset_left</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">T''T'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">WT'</span>\n</code></pre></div>",
        "id": 479425368,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730190755
    },
    {
        "content": "<p>So I didnâ€™t compress anything really. Note that almost everything I wrote yesterday applies to the proof on paper, very little is about Lean technicalities.</p>",
        "id": 479425492,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730190805
    },
    {
        "content": "<p>I donâ€™t know this GTM 186, but Iâ€™m not impressed if they indeed have all this story of sides of rectangles (but itâ€™s only one proof, maybe written in a hurry because it wasnâ€™t an important part of the book).</p>",
        "id": 479425867,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730190940
    },
    {
        "content": "<p>Anyway, could you please update the PR with this streamlined approach? Restarting from scratch may be easier since you can get rid of almost everything.</p>",
        "id": 479426399,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730191108
    },
    {
        "content": "<p>And please donâ€™t get discouraged by the amount of work that turns out to disappear in the end. This is a normal part of the process of becoming valuable Mathlib contributors and is not wasted.</p>",
        "id": 479428410,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730191786
    },
    {
        "content": "<p>The same main result is moved to <a href=\"https://github.com/leanprover-community/mathlib4/pull/18377\">#18377</a> now, and this PR is closed and deprecated.</p>",
        "id": 479433665,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1730193650
    },
    {
        "content": "<p>This PR is now merged!</p>",
        "id": 479762982,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1730321670
    }
]