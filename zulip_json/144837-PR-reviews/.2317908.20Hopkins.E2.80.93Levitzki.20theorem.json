[
    {
        "content": "<p>We develop the theory of the Jacobson radical of a module, and show that over a semiprimary (possibly noncommutative) ring (R/J(R) is semisimple and J(R) is nilpotent), Noetherianity is equivalent to Artinianity. We also show that Artinian rings are semiprimary. As a consequence, an Artinian ring is Noetherian. There are three unmerged dependencies, two of them are large refactors:</p>\n<ul>\n<li>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/17557\">#17557</a> (+95 -21) shows that for a semisimple R-module M, <code>Module.Finite R M ↔ IsNoetherian R M ↔ IsArtinian R M ↔ IsFiniteLength R M ↔</code> direct sum decomposition into finitely many simple modules.</p>\n</li>\n<li>\n<p><img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"> <a href=\"https://github.com/leanprover-community/mathlib4/pull/17708\">#17708</a> (+494 -431) generalizes Mul of Submodule and SMul of Ideal on Submodule to the noncommutative setting.</p>\n</li>\n<li>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17930\">#17930</a> (+437 -272) introduce the <code>Ideal.IsTwoSided</code> typeclass: discusssed <a href=\"#narrow/channel/287929-mathlib4/topic/Bases.20of.20topologies/near/423923141\">here</a> on Zulip, see also my response to the non-unital issue <a href=\"#narrow/channel/287929-mathlib4/topic/Noncommutative.20ring.20things/near/424161623\">here</a>.</p>\n</li>\n</ul>\n<p>The main PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/17908\">#17908</a> (~ +490 -81 over the dependencies) now builds, but there are merge conflicts which will be fixed by the merging of the dependencies.</p>",
        "id": 477788638,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1729328301
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17708\">#17708</a> has been stuck for a week, although its <a href=\"https://github.com/leanprover-community/mathlib4/pull/17708#issuecomment-2409193521\">current content</a> is merely moving things around (separated into a commutative and a noncommutative section), fixing proofs, and adding lemmas to convert between the old and new definitions of (S)Mul (<code>(s)mul_eq_map₂</code>) and to deal with the fact that <code>1 : Submodule R A</code> is not a right identity for A noncommutative (<code>npowRec_add/succ</code>, <code>pow_eq_npowRec/one/succ/zero</code>). <br>\n<a href=\"https://github.com/leanprover-community/mathlib4/pull/18419\">#18419</a> reduces some repetitions in the proofs, but is completely optional (and <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> worries that it may create diamonds).</p>",
        "id": 481339563,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731080543
    },
    {
        "content": "<p>Thanks for the ping, I've kicked <a href=\"https://github.com/leanprover-community/mathlib4/pull/17708\">#17708</a> on the queue</p>",
        "id": 481340114,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1731080702
    },
    {
        "content": "<p>Thank you!</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/17930\">#17930</a> currently stands at +437 -272. That might seem a large diff but most of it is changing <code>CommRing</code> to <code>Ring</code> and adding <code>IsTwoSided</code> assumptions appropriately (most importantly allowing a quotient by a two-sided ideal to be a (noncommutative) ring). According to the <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2423320872\">declaration diff</a>, the following declarations are added:</p>\n<ul>\n<li><code>Ideal.IsTwoSided</code> typeclass and instances for <code>I.map f</code>, <code>I ^ n</code>, <code>annihilator</code>, <code>colon</code>, <code>RingHom.ker</code>, <code>CommSemiring</code>, <code>⊤</code>, <code>⊥</code>, <code>I.pi ι</code>, <code>I * J</code>, <code>K.comap f</code>, and <code>⨅ i, I i</code>.</li>\n<li><code>Ideal.Quotient.(division)ring</code> (previously there're only <code>commRing</code> and <code>field</code>) and lemma <code>exists_right_inv_of_exists_left_inv</code>used to fix the proof of <code>exists_inv</code>.</li>\n<li>Four lemmas about <code>IsTorsionBy(Set)</code>.</li>\n<li>Small lemmas <code>Submodule.pow_succ'/pow_add/subsingleton_iff</code>, <code>Ideal.IsTwoSided.pow_succ/pow_add/mul_one</code>, <code>Ideal.mul_smul</code>, and <code>RingHom.coe_toSemilinearMap</code>.</li>\n</ul>",
        "id": 481460482,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731158568
    },
    {
        "content": "<p>The current issue is that this PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2466011308\">slows down</a> Mathlib by ~1%, and some files that only uses commutative rings get up to 200% slower (at one occasion I have to bump the <code>maxHeartBeats</code> by 25%). I've tried to make the instance from <code>CommSemiring</code> to <code>IsTwoSided</code> high priority, but the result is similar, even <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2466028660\">slightly worse</a>. I also tried to lower the priority of <code>Ideal.Quotient.ring</code> (but not the <code>commRing</code> instance) but the 1% slowdown is still there. (The slowdown becomes slightly better when priority is set to 500, but almost there's little effect from lowering it further to 100 (\"low\" priority).)</p>\n<p>My next idea is to make copies of every <code>simp</code> lemma that assumes <code>IsTwoSided</code> to assume commutativity instead, and only keep the <code>simp</code> attribute on the commutative version. I'd append a <code>'</code> at the end of the names of the copies. I estimate there are ~30 of lemmas that assumes <code>IsTwoSided</code> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930\">#17930</a>. Before I do that, I'd like to hear your opinions: should I try to implement this, or should we accept a 1% slowdown?</p>",
        "id": 481460495,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731158577
    },
    {
        "content": "<p>Hmm, 1% over mathlib is quite a lot. I'm not going to be the person making the call, but if I was, I'd love to know whether your simp idea works. Then we can make a more informed decision</p>",
        "id": 481474016,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731169537
    },
    {
        "content": "<p>Upgrading Mathlib to understand two-sided ideals is sufficiently important, and long over-due, that we should accept some slow-down to just get it done. It would be good to know, though, if there is more slow-down to come, or if this 1% really is \"the budget\".</p>",
        "id": 481488654,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731181367
    },
    {
        "content": "<p>That's a good point! Currently the following files have been thoroughly generalized:</p>\n<blockquote>\n<p>RingTheory/Ideal/Quotient/Basic<br>\nRingTheory/Ideal/Quotient/Defs<br>\nRingTheory/Ideal/Quotient/Operations<br>\nAlgebra/Module/Torsion<br>\nRingTheory/Ideal/Colon</p>\n</blockquote>\n<p>And I believe that the single file RingTheory/Ideal/Quotient/Defs is sufficient for the proof of the H–L theorem. I don't immediately see further files to be generalized, and I think we'll probably see further use of IsTwoSided only in the development of new noncommutative materials, e.g. theory of Jacobson radical (in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17908\">#17908</a>), theory of noncomm. local rings, prime ideals (the current definition isn't the standard one for noncomm. rings), etc.<br>\nIf you can generate a list of a mathlib files importing RingTheory/Ideal/Quotient/Defs, we might go over the list and take a closer look together.</p>",
        "id": 481495510,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731187197
    },
    {
        "content": "<p><strong>Update</strong>: by <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930/commits/ae80df938ef7fed955e726763b5f668973664821\">modifying</a> the <code>Ideal.Quotient.commRing</code> instance to directly inherit the <code>ring</code> instance (instead of directly using the <a href=\"https://github.com/leanprover-community/mathlib4/blob/42ff2ccb6d99b39a65e43b8da21a60f8e7d3f9ca/Mathlib/RingTheory/Congruence/Defs.lean#L361-L364\">RingCon CommRing instance</a>), I'm able to reduce the build slowdown to 0.63% and lint slowdown to 0.71%. Looks like Lean has been spending a lot of time checking the defeq between the Ring and CommRing instances, probably because sometimes one gets synthesized and sometimes the other. The current highest slowdown percentage among unmodified files is +88.38%, in <code>Mathlib.RingTheory.QuotSMulTop</code>.</p>\n<p>Current experiment: making <code>Ideal.Quotient.ring</code> a local instance as needed (<strong>Update</strong>: no improvement observed from this)</p>",
        "id": 481508937,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731198905
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2317908.20Hopkins.E2.80.93Levitzki.20theorem/near/481495510\">said</a>:</p>\n<blockquote>\n<p>If you can generate a list of a mathlib files importing RingTheory/Ideal/Quotient/Defs</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">graph</span><span class=\"w\"> </span><span class=\"c1\">--from Mathlib.RingTheory.Ideal.Quotient.Defs o.pdf</span>\n</code></pre></div>\n<p>produces <a href=\"/user_uploads/3121/6oZEtfGJRXuBhKC7o58m9aAT/o.pdf\">o.pdf</a> and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">graph</span><span class=\"w\"> </span><span class=\"c1\">--from Mathlib.RingTheory.Ideal.Quotient.Defs o.dot &amp;&amp; cat o.dot | grep ellipse | cut -f3 -d' ' | sed s/\\\"//g &gt; list</span>\n</code></pre></div>\n<p>produces <a href=\"/user_uploads/3121/5zXegwp4qTxmq4Vy2nDaIbaE/list\">list</a></p>",
        "id": 481530421,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1731217808
    },
    {
        "content": "<p>It appears that my idea is not good; the list contains 1418 files, which is 26% of Mathlib and probably too many to examine.</p>\n<p>In the meantime I continued to experiment the previous idea: bringing the CommRing instance closer to the Ring instance reduced the <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2466011471\">1.21/1.19%</a> slowdown to <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2466523634\">0.63/0.71%</a>. What if we <a href=\"https://github.com/leanprover-community/mathlib4/pull/18824/commits/2713dca1e73f02909ad222cf9723a76a8b6b0f13\">bring</a> the Ring instance closer to the AddCommGroup instance? It turns out it reduces the slowdown further to <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2466836246\">0.52/0.44%</a>, so it's a net speedup of 0.11/0.27%. However, if we apply this to the current Mathlib (<a href=\"https://github.com/leanprover-community/mathlib4/pull/18824\">#18824</a>), we only observe a <a href=\"https://github.com/leanprover-community/mathlib4/pull/18824#issuecomment-2466850970\">0.09/0.09%</a> speedup.</p>\n<p>In the latest experiment I made <code>Ideal.Quotient.ring</code> a global instance again, and the slowdown reduced to <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2466898319\">0.43/0.48%</a>. It's quite interesting to note that <code>RingTheory.QuotSMulTop</code> gets 12.93% faster in the latest experiments, despite being 88.38% slower in the <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2466523634\">0.63/0.71%</a> run.</p>",
        "id": 481589959,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1731266884
    },
    {
        "content": "<p>The slowdown in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930\">#17930</a> has now been reduced to <a href=\"https://speed.lean-lang.org/mathlib4/compare/ebb99c83-c6cd-40a8-bb94-c281708d838a/to/c63083b2-0ab2-4b63-b6d2-ad92153dd78f\">0.155/0.13%</a> (Update: 0.178/0.124% after merging master). Since mathlib currently has 5738 files and 17M lines, the slowdown is comparable to the effect of adding 9 files or 2635 lines to mathlib. There are 9 files that got &gt;10% slower, and slowdown in unchanged files are all &lt;25%. It's still an interesting problem to <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930#issuecomment-2497723912\">investigate</a> why those files get slower, but maybe the PR could be merged now so as not to block subsequent developments.</p>\n<p>Some lessons learned since my last post:</p>\n<ul>\n<li>It's important to specialize <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Submodule.hasQuotient#doc\">docs#Submodule.hasQuotient</a> to <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930/commits/51f7d40d247636d7816448fc8e2a8edface08708\">shortcut instances</a> for ideals in CommRing (already exists) and Ring.</li>\n<li>Priorities of IsTwoSided instances have a tiny effect, but adding a <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930/commits/49dbf9e257e9bdeb637147ffd5d7487b73171b45#diff-b07d9879de8e5aaf8c99da0c8f04b1eed23daf73af82696409093926ee1f3afeR109\">shortcut IsTwoSided instance for CommRing</a> (when there's already one for CommSemiring) is important.</li>\n<li>Adding <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930/commits/b08a94baa321ced6a7fc9fb82f96024cac590cd3\">shortcut Ring/(Comm)Semiring instances</a> for R/I (where R is a CommRing) has a decent speedup effect on <a href=\"https://github.com/leanprover-community/mathlib4/pull/17930\">#17930</a>. On master <a href=\"https://github.com/leanprover-community/mathlib4/pull/20186#issuecomment-2558620973\">its effect</a> is mixed: build slows down by 0.014% but lint speeds up by 0.028%.</li>\n</ul>",
        "id": 490432382,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1734915025
    },
    {
        "content": "<p>Thanks to <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> and <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> for getting the IsTwoSided ideal PR into mathlib. The PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/21451\">#21451</a> for the H--L theorem is now ready for review. The diff stands at +728 −177. It adds three new files HopkinsLevitzki, Jacobson/Semiprimary and Jacobson/Radical under the RingTheory directory, and splits out a single lemma from SimpleModule.</p>\n<p>If I'm asked to split the PR, I would make a PR that only splits this file, and maybe another PR that develops the theory of Jacobson radical (for modules), possibly including the Semiprimary file. The splitting PR reduces imports, so follow-up PRs have a chance to get a large-import warning.</p>\n<p>There is a simpNF timeout so a @[simp] attribute is removed. I'm not sure exactly what change(s) caused this.</p>",
        "id": 498017595,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738806284
    },
    {
        "content": "<p>Could you just split between adding new files and refactoring existing files?</p>",
        "id": 498056246,
        "sender_full_name": "Andrew Yang",
        "timestamp": 1738828322
    },
    {
        "content": "<p>Nice work on getting the PR ready again! And yes, such a split would be helpful.</p>",
        "id": 498057975,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1738828929
    },
    {
        "content": "<blockquote>\n<p>Could you just split between adding new files and refactoring existing files?</p>\n</blockquote>\n<p>It can't be done exactly that way, because e.g. Artinian/Module now imports the new file Semiprimary. But maybe I can come up with something close ...</p>",
        "id": 498099056,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738841618
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21544\">#21544</a> splits out everything below Artinian/Module, including the split of SimpleModule.</p>",
        "id": 498316373,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1738927134
    },
    {
        "content": "<p>The main PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/21451\">#21451</a> is down to +465 −75 now and ready for review. I can still split out materials about the Jacobson radical if desired.</p>",
        "id": 498521557,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1739037197
    }
]