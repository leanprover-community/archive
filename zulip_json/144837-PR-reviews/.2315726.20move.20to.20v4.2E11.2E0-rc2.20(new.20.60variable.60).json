[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/15726\">#15726</a></p>",
        "id": 460049903,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723457947
    },
    {
        "content": "<p>This is a big PR, touching &gt;300 files, as it adapts Mathlib for the new <code>variable</code> command, and so has many <code>include</code> statements.</p>",
        "id": 460050088,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723457996
    },
    {
        "content": "<p>This is as discussed over the last two weeks at <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/stream/287929-mathlib4/topic/New.20variable.20inclusion.20mechanism\">#mathlib4 &gt; New variable inclusion mechanism</a></p>",
        "id": 460050290,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723458034
    },
    {
        "content": "<p>There is some style variation between a single <code>include</code> statement after the <code>variable</code>, vs many <code>include in</code>.</p>\n<p>I would prefer if we can defer making decisions about uniform style, and implementing that, until after this PR is merged, as the PR touches 10% of Mathlib and I don't want to put unnecessary effort into keeping it afloat.</p>",
        "id": 460050444,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723458103
    },
    {
        "content": "<p>However it does need review --- the branches are a bit of a mess, and I'm not confident I've got exactly the right set of changes.</p>",
        "id": 460050541,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723458131
    },
    {
        "content": "<p>I've looked through the changes in <code>CategoryTheory/Sites/</code> and everything there looks good. </p>\n<p>CI is still building mathlib though, and <code>lake exe cache get(!)</code>Â doesn't find anything, so it's impossible to interact with the files right now. It will be easier to review once there is some olean cache</p>",
        "id": 460055596,
        "sender_full_name": "Dagur Asgeirsson",
        "timestamp": 1723459789
    },
    {
        "content": "<p>I had a look at random files in number theory, and they look OK.</p>",
        "id": 460059704,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1723461185
    },
    {
        "content": "<p>So are we OK with <code>include</code>?</p>",
        "id": 460059765,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1723461200
    },
    {
        "content": "<p>Yes</p>",
        "id": 460059794,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1723461207
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2315726.20move.20to.20v4.2E11.2E0-rc2.20.28new.20.60variable.60.29/near/460059765\">said</a>:</p>\n<blockquote>\n<p>So are we OK with <code>include</code>?</p>\n</blockquote>\n<p>The whole point of this was to require <code>include</code>, so I hope so. :-)</p>",
        "id": 460059861,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461225
    },
    {
        "content": "<p>I'm about half way through the files. So far found 4 files with spurious or bad changes, so I think I'll go through the rest of it. Unfortunately as I keep committing this keeps restarting CI and so the cache will be delayed.</p>",
        "id": 460060548,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461400
    },
    {
        "content": "<p>(Back in mathlib3 days when a build job was cancelled I think we still uploaded the cache. I wonder if that is a good idea to restore?)</p>",
        "id": 460060588,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461426
    },
    {
        "content": "<p>But happy to have a delegation from whoever has reached sufficient confidence based on the above to give it. :-)</p>",
        "id": 460060625,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461451
    },
    {
        "content": "<p>I mean <code>include</code> vs <code>include in</code> (I admit I didn't follow the discussion closely, so maybe I missed something)</p>",
        "id": 460060772,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1723461514
    },
    {
        "content": "<p>it hasn't been decided what's preferable yet. discussing that will happen after this PR is merged, because the PR rots fast</p>",
        "id": 460061162,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723461683
    },
    {
        "content": "<p>There are a few diffs that are separately on <a href=\"https://github.com/leanprover-community/mathlib4/pull/15728\">#15728</a>, which I've already sent to bors.</p>",
        "id": 460061168,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461686
    },
    {
        "content": "<p>Yes -- the plan is that <code>include</code> (no <code>in</code>) is okay <em>for now</em>, and we will take stock of that next.</p>",
        "id": 460061210,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461704
    },
    {
        "content": "<p>I'm leaning to yes.</p>",
        "id": 460061216,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461708
    },
    {
        "content": "<p>Note that for now there is no <code>omit</code>.</p>",
        "id": 460061256,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461719
    },
    {
        "content": "<p>It is implemented, but not in <code>rc2</code>. We will provide it, but I hope that Mathlib can forbid it via a linter.</p>",
        "id": 460061384,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723461738
    },
    {
        "content": "<p>(wait, i thought it was <code>exclude</code>?)</p>",
        "id": 460061550,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723461782
    },
    {
        "content": "<p><code>omit</code>: <a href=\"https://github.com/leanprover/lean4/pull/5000\">lean#5000</a></p>",
        "id": 460063886,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723462612
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2315726.20move.20to.20v4.2E11.2E0-rc2.20.28new.20.60variable.60.29/near/460060588\">said</a>:</p>\n<blockquote>\n<p>(Back in mathlib3 days when a build job was cancelled I think we still uploaded the cache. I wonder if that is a good idea to restore?)</p>\n</blockquote>\n<p>I think that the uploading of the cache-so-far is still there, but if you stop the build process with a push, then the upload takes to long to be useful to the <code>get cache</code> step of the newer PR.</p>",
        "id": 460064564,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723462923
    },
    {
        "content": "<p>In fact, I just \"recycled\" some cache by first <code>Cancel workflow</code>, go get a drink of water, push the change.</p>",
        "id": 460064720,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1723462995
    },
    {
        "content": "<p>I've just gone through the whole PR, clicking \"Viewed\" on every file, phew! Found a few minor problems.</p>\n<p>There are three places I've be happy to have eyes on:</p>\n<ul>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/15726/files#diff-5cd9477a43742d8333032dbc1f5c359ba28abcc39d160c773e35c400e6253371\">https://github.com/leanprover-community/mathlib4/pull/15726/files#diff-5cd9477a43742d8333032dbc1f5c359ba28abcc39d160c773e35c400e6253371</a></li>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/15726/files#diff-354a92be01d71743fa0ce521c136bb14ad4105c3e864799f1171cb2e6c771890\">https://github.com/leanprover-community/mathlib4/pull/15726/files#diff-354a92be01d71743fa0ce521c136bb14ad4105c3e864799f1171cb2e6c771890</a></li>\n<li><a href=\"https://github.com/leanprover-community/mathlib4/pull/15726/files#diff-d4eb26b65bd033a18f8c4183d73adb4a1ed517a0b598ff16d1ceb3eb42ec51ed\">https://github.com/leanprover-community/mathlib4/pull/15726/files#diff-d4eb26b65bd033a18f8c4183d73adb4a1ed517a0b598ff16d1ceb3eb42ec51ed</a></li>\n</ul>\n<p>I think these are okay as is, but happy if anyone wants to push changes.</p>",
        "id": 460066618,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723463533
    },
    {
        "content": "<p>I have a local build+test, linting now.</p>",
        "id": 460066636,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723463545
    },
    {
        "content": "<p>r? <a href=\"https://github.com/leanprover-community/mathlib4/pull/15735\">#15735</a></p>",
        "id": 460068336,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1723464156
    },
    {
        "content": "<p>Yay, local lint too!</p>",
        "id": 460069731,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723464643
    },
    {
        "content": "<p>I merged master including <a href=\"https://github.com/leanprover-community/mathlib4/pull/15735\">#15735</a> into this PR</p>",
        "id": 460081070,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1723468685
    },
    {
        "content": "<p>Just ran into another conflict with <code>master</code>, and resolved it. I'm pretty confident this is good to go now, so <code>r+</code> welcome. :-) I'm off to sleep.</p>",
        "id": 460088480,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723471172
    },
    {
        "content": "<p>Thanks! I just gave <span aria-label=\"peace sign\" class=\"emoji emoji-270c\" role=\"img\" title=\"peace sign\">:peace_sign:</span></p>",
        "id": 460089020,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723471321
    },
    {
        "content": "<p>But if you're asleep, I'll merge once CI is happy</p>",
        "id": 460089093,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723471332
    },
    {
        "content": "<p>Snap... build failed</p>",
        "id": 460093486,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723472739
    },
    {
        "content": "<p>it seems to be a lint...</p>",
        "id": 460096696,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723473781
    },
    {
        "content": "<p>Looking</p>",
        "id": 460097154,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1723473961
    },
    {
        "content": "<p>I, too, am looking...</p>",
        "id": 460097423,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723474053
    },
    {
        "content": "<p>Pushed</p>",
        "id": 460098142,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1723474305
    },
    {
        "content": "<p>apparently merging also resulted in an error at <code>Mathlib.CategoryTheory.Limits.Preserves.Shapes.Square</code>, which i'm looking at too...</p>",
        "id": 460098529,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723474442
    },
    {
        "content": "<p>It just passed CI</p>",
        "id": 460100421,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723474917
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"684366\">@Edward van de Meent</span> please don't push to the PR now, because that will cause bors to cancel</p>",
        "id": 460100573,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723474934
    },
    {
        "content": "<p>bors will fail though</p>",
        "id": 460100630,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723474943
    },
    {
        "content": "<p>there is also a build error in the file i mentioned</p>",
        "id": 460100689,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723474953
    },
    {
        "content": "<p>because of a compile-time error after merging master?</p>",
        "id": 460100778,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723474968
    },
    {
        "content": "<p>yes</p>",
        "id": 460100805,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723474973
    },
    {
        "content": "<p>check the previous CI</p>",
        "id": 460100835,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723474978
    },
    {
        "content": "<p>ok, in that case, please go ahead!</p>",
        "id": 460101001,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723475006
    },
    {
        "content": "<p>pushed</p>",
        "id": 460101565,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723475168
    },
    {
        "content": "<p>turns out there's yet another build error hiding... looking</p>",
        "id": 460102179,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723475389
    },
    {
        "content": "<p>ok, pushed the hopefully final fix</p>",
        "id": 460103441,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1723475834
    },
    {
        "content": "<p>Let the current staging finish first</p>",
        "id": 460103490,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1723475857
    },
    {
        "content": "<p>It's just completed its build</p>",
        "id": 460103641,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1723475893
    },
    {
        "content": "<p>OK, let's merge this</p>",
        "id": 460117512,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1723480100
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598052\">@Jeremy Tan</span> seems like some tests are failing: <a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/10355084721/job/28661870965?pr=15726#step:21:119\">https://github.com/leanprover-community/mathlib4/actions/runs/10355084721/job/28661870965?pr=15726#step:21:119</a></p>",
        "id": 460120116,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723480862
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> I did a vulcan nerve pinch and fixed the failing <code>fun_prop_dev</code> test (some merges were screwed up)</p>",
        "id": 461033545,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1723486189
    },
    {
        "content": "<p><em>Now</em> it should be ready</p>",
        "id": 461033600,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1723486205
    },
    {
        "content": "<p>Thanks so much! <span class=\"user-mention\" data-user-id=\"598052\">@Jeremy Tan</span> I left some comments</p>",
        "id": 461035115,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723486812
    },
    {
        "content": "<p>Addressed</p>",
        "id": 461036066,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1723487130
    },
    {
        "content": "<p>thanks!<br>\nborsified</p>",
        "id": 461927185,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1723487385
    },
    {
        "content": "<p>Thanks everyone for getting this in while I slept. :-)</p>",
        "id": 461981137,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1723507997
    }
]