[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/34551\">#34551</a></p>\n<p><span class=\"user-mention\" data-user-id=\"252920\">@Alex Kontorovich</span>  Hi Professor, as mentioned in the workshop we need the Mul variant for <code>HasAntidiagonal</code> to generalize the Dirichlet Convolution. I split this part from the original long PR. It would be very helpful if you could let someone review this PR and perhaps provide a tighter feedback cycle.</p>",
        "id": 570673109,
        "sender_full_name": "Fengyang Wang",
        "timestamp": 1769639820
    },
    {
        "content": "<p><span aria-label=\"writing\" class=\"emoji emoji-270d\" role=\"img\" title=\"writing\">:writing:</span></p>",
        "id": 570675145,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769640831
    },
    {
        "content": "<p>This looks ok to me - <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span>, who would be a good person to give this a \"proper\" review?</p>",
        "id": 570915859,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1769730113
    },
    {
        "content": "<p>It needs someone to help out resolving the conflict with existing material.</p>",
        "id": 570920857,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769733478
    },
    {
        "content": "<p>I'm copying this from github. I could make the change to \"resolve\" the conflict, but I'm sure it won't be optimal enough for people who know mathlib better than me. </p>\n<p>Two files define Finset.swap_mem_mulAntidiagonal:<br>\n<a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finset/MulAntidiagonal.html#Finset.mulAntidiagonal\">MulAntidiagonal.lean</a> - set-based API:  </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">swap_mem_mulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">   </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"n\">a</span>\n</code></pre></div>\n<p>Takes explicit IsPWO proofs for sets s and t, where</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">IsPWO</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">IsPWO</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span>\n</code></pre></div>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/Antidiag/Prod.html#Finset.antidiagonal.fst_le\">Prod.lean</a> (this PR) - typeclass API:  </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">swap_mem_mulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">   </span><span class=\"n\">xy</span><span class=\"bp\">.</span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">↔</span><span class=\"w\"> </span><span class=\"n\">xy</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"n\">n</span>\n</code></pre></div>\n<p>Uses HasMulAntidiagonal typeclass, where</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">HasMulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Monoid</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Solution:</p>\n<ul>\n<li>Name change (API change)?</li>\n<li>Rename namespace?</li>\n<li>Nested namespaces? (ew)</li>\n</ul>",
        "id": 570928920,
        "sender_full_name": "Fengyang Wang",
        "timestamp": 1769739103
    },
    {
        "content": "<p>Can the old mulAntidiagonal move under the IsPWO namespace? It seems like the new one should have priority.</p>",
        "id": 570931842,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769741024
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2334551.20Adds.20HasMulAntidiagonal.20and.20links.20to.20HasAntidiagonal/near/570931842\">said</a>:</p>\n<blockquote>\n<p>IsPWO</p>\n</blockquote>\n<p>I'm working on the renaming but with another approach. Testing build now.</p>\n<p><span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> Passed</p>",
        "id": 570934482,
        "sender_full_name": "Fengyang Wang",
        "timestamp": 1769743100
    },
    {
        "content": "<p>Pasting from github</p>\n<p>Main file is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/Antidiag/Prod.html\">Prod.lean</a>. Adds <code>Finset.HasMulAntidiagonal</code>, the multiplicative counterpart to <code>HasAntidiagonal</code>, linked via <code>@[to_additive existing]</code>.</p>\n<p>For a monoid <code>M</code>, <code>mulAntidiagonal n</code> returns the finset of pairs <code>(i, j)</code> such that <code>i * j = n</code>.</p>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finset/MulAntidiagonal.html\">MulAntidiagonal.lean</a></p>\n<ul>\n<li><code>mulAntidiagonal</code> → <code>setMulAntidiagonal</code></li>\n<li><code>addAntidiagonal</code> → <code>setAddAntidiagonal</code> (via <code>@[to_additive]</code>)</li>\n<li>All related theorems renamed accordingly:<ul>\n<li><code>mem_setMulAntidiagonal</code></li>\n<li><code>setMulAntidiagonal_mono_left</code>/<code>setMulAntidiagonal_mono_right</code></li>\n<li><code>swap_mem_setMulAntidiagonal</code></li>\n<li><code>support_setMulAntidiagonal_subset_mul</code></li>\n<li><code>isPWO_support_setMulAntidiagonal</code></li>\n<li><code>setMulAntidiagonal_min_mul_min</code></li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Finset/SMulAntidiagonal.html\">SMulAntidiagonal.lean</a></p>\n<ul>\n<li><code>setSMulAntidiagonal</code> (lowercase <code>set</code> prefix)</li>\n<li><code>setVAddAntidiagonal</code> (via <code>@[to_additive setVAddAntidiagonal ...]</code>)</li>\n<li>All related theorems use lowercase <code>set</code> prefix:<ul>\n<li><code>mem_setSMulAntidiagonal</code> / <code>mem_setVAddAntidiagonal</code></li>\n<li><code>setSMulAntidiagonal_mono_left</code>/<code>setSMulAntidiagonal_mono_right</code> / <code>setVAddAntidiagonal_mono_left</code>/<code>setVAddAntidiagonal_mono_right</code></li>\n<li><code>support_setSMulAntidiagonal_subset_smul</code> / <code>support_setVAddAntidiagonal_subset_vadd</code></li>\n<li><code>isPWO_support_setSMulAntidiagonal</code> / <code>isPWO_support_setVAddAntidiagonal</code></li>\n<li><code>setSMulAntidiagonal_min_smul_min</code> / <code>setVAddAntidiagonal_min_vadd_min</code></li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Order/Antidiag/Prod.html\">Prod.lean</a></p>\n<ul>\n<li>Added explicit <code>@[to_additive]</code> target names:<ul>\n<li><code>@[to_additive antidiagonal_congr ...]</code> for <code>mulAntidiagonal_congr</code></li>\n<li><code>@[to_additive (attr := ext) antidiagonal_subtype_ext ...]</code> for <code>mulAntidiagonal_subtype_ext</code></li>\n<li><code>@[to_additive antidiagonal_congr' ...]</code> for <code>mulAntidiagonal_congr'</code></li>\n<li><code>@[to_additive (attr := simps) sigmaAntidiagonalEquivProd ...]</code> for <code>sigmaMulAntidiagonalEquivProd</code></li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/HahnSeries/Multiplication.html\">Multiplication.lean</a></p>\n<ul>\n<li>Updated all VAdd antidiagonal references to use lowercase <code>set</code> prefix:<ul>\n<li><code>setVAddAntidiagonal</code></li>\n<li><code>mem_setVAddAntidiagonal</code></li>\n<li><code>setVAddAntidiagonal_mono_left</code>/<code>setVAddAntidiagonal_mono_right</code></li>\n<li><code>isPWO_support_setVAddAntidiagonal</code></li>\n<li><code>support_setVAddAntidiagonal_subset_vadd</code></li>\n<li><code>setVAddAntidiagonal_min_vadd_min</code></li>\n</ul>\n</li>\n<li>Updated all Add antidiagonal references:<ul>\n<li><code>mem_setAddAntidiagonal</code></li>\n<li><code>swap_mem_setAddAntidiagonal</code></li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/HahnSeries/Summable.html\">Summable.lean</a></p>\n<ul>\n<li><code>setVAddAntidiagonal</code> references updated</li>\n<li><code>mem_setAddAntidiagonal</code> references updated</li>\n</ul>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/RingTheory/HahnSeries/PowerSeries.html\">PowerSeries.lean</a></p>\n<ul>\n<li><code>mem_addAntidiagonal</code> → <code>mem_setAddAntidiagonal</code></li>\n</ul>\n<p>Even though the approach may not be Mathlib enough, at least it gets the dependency clear.</p>",
        "id": 570940154,
        "sender_full_name": "Fengyang Wang",
        "timestamp": 1769747105
    },
    {
        "content": "<p>There's a lot of renaming here. I think you will need to separate out an initial PR that renames the existing definitions, which we can merge first.</p>",
        "id": 571153791,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1769825097
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Kim Morrison</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2334551.20Adds.20HasMulAntidiagonal.20and.20links.20to.20HasAntidiagonal/near/571153791\">said</a>:</p>\n<blockquote>\n<p>There's a lot of renaming here. I think you will need to separate out an initial PR that renames the existing definitions, which we can merge first.</p>\n</blockquote>\n<p>Updated the PR to only rename defs</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Data/Finset/MulAntidiagonal.lean\">MulAntidiagonal.lean</a></p>\n<ul>\n<li><code>mulAntidiagonal</code> → <code>setMulAntidiagonal</code></li>\n<li><code>addAntidiagonal</code> → <code>setAddAntidiagonal</code> (via <code>@[to_additive]</code>)</li>\n</ul>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Data/Finset/SMulAntidiagonal.lean\">SMulAntidiagonal.lean</a></p>\n<ul>\n<li><code>SMulAntidiagonal</code> → <code>setSMulAntidiagonal</code></li>\n<li><code>VAddAntidiagonal</code> → <code>setVAddAntidiagonal</code> (via <code>@[to_additive]</code>)</li>\n</ul>\n<p>Propagates to:</p>\n<ul>\n<li><code>Mathlib/RingTheory/HahnSeries/Multiplication.lean</code></li>\n<li><code>Mathlib/RingTheory/HahnSeries/Summable.lean</code></li>\n</ul>\n<hr>\n<p>Added deprecation aliases for the renamed definitions.</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Data/Finset/MulAntidiagonal.lean\">Finset/MulAntidiagonal.lean</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">attr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">setAddAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2026-01-31\"</span><span class=\"o\">)),</span>\n<span class=\"w\">  </span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">setMulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2026-01-31\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">setMulAntidiagonal</span>\n</code></pre></div>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Data/Finset/SMulAntidiagonal.lean\">Finset/SMulAntidiagonal.lean</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">attr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">setVAddAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2026-01-31\"</span><span class=\"o\">)),</span>\n<span class=\"w\">  </span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">setSMulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2026-01-31\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">smulAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">setSMulAntidiagonal</span>\n</code></pre></div>\n<p>Propagates:<br>\n<a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Data/Finsupp/PointwiseSMul.lean\">PointwiseSMul.lean</a> - updated to use Set.vaddAntidiagonal (the original Set name)</p>",
        "id": 571219811,
        "sender_full_name": "Fengyang Wang",
        "timestamp": 1769883259
    }
]