[
    {
        "content": "<p>Testing comment</p>",
        "id": 515735800,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746198315
    },
    {
        "content": "<p>Adding the awaiting-author label prior to creating this thread did nothing (as expected)</p>",
        "id": 515735837,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746198326
    },
    {
        "content": "<p>Removing it seems to have worked. Let's apply it again:</p>",
        "id": 515736147,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746198405
    },
    {
        "content": "<p>That worked</p>",
        "id": 515736258,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746198435
    },
    {
        "content": "<p>Let's apply maintainer-merge <em>on top of</em> the awaiting-author</p>",
        "id": 515736345,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746198459
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/14797866336/job/41549330374?pr=24556\">Here</a> is the corresponding workflow run: it added/kept the awaiting-author emoji. BUG (or at least under discussion)</p>",
        "id": 515736537,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746198511
    },
    {
        "content": "<p>Let's remove the awaiting-author label (<a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/14797892316/job/41549417790?pr=24556\">workflow</a>): BUG, the awaiting-author label is removed, but the emoji should now have a maintainer merge emoji</p>",
        "id": 515736589,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746198528
    },
    {
        "content": "<p>Summary so far: the emojibot really assumes the labels are mutually exclusive. This worked so far --- but with the maintainer-merge label, it doesn't always hold in practice. (Perhaps one should make it hold in practice...)</p>",
        "id": 515737058,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746198671
    },
    {
        "content": "<p>Is the bug that there should be a loop over <code>LABEL</code>?  Or (equivalently, but applied at a different place) that the script should be called for every label that the PR has?</p>",
        "id": 515738030,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1746198944
    },
    {
        "content": "<p>Does the github API gives you access to \"the label that triggered the action\", or does it just start an action when a label is applied, but which label it was is lost?</p>",
        "id": 515738216,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1746199004
    },
    {
        "content": "<p>Well, the emojibot currently stops at one label. I don't know if that is a bug, or its specification is unclear :-)</p>",
        "id": 515738254,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746199016
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2324556.20Testing.20the.20new.20emojibot.20label/near/515738216\">said</a>:</p>\n<blockquote>\n<p>Does the github API gives you access to \"the label that triggered the action\", or does it just start an action when a label is applied, but which label it was is lost?</p>\n</blockquote>\n<p>It tells you which one.</p>",
        "id": 515738356,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746199049
    },
    {
        "content": "<p>Ok, so this is indeed what the bot was explicitly designed to do: for instance, when a PR gets <code>bors merge</code>d, it should be tagged as such, but the tag should convert to <code>merged</code> once the PR has been merged.</p>",
        "id": 515740921,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1746199843
    },
    {
        "content": "<p>Maybe the script should now take into account that <em>some</em> labels are incompatible, but others can coexist.</p>",
        "id": 515741051,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1746199888
    },
    {
        "content": "<p>This requires some fiddling around with the code that is more than just \"copy-paste and follow your nose\".</p>",
        "id": 515741142,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1746199915
    },
    {
        "content": "<p>Testing further: removed the maintainer merge label (so should be unmarked now)</p>",
        "id": 515761138,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746206139
    },
    {
        "content": "<p>Added the maintainer merge label: the bot uses the author emoji. Something's wrong here</p>",
        "id": 515761325,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746206200
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24556\">#24556</a> should fix the the logic - critical comments are welcome.</p>",
        "id": 515764683,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746207312
    },
    {
        "content": "<p>There are two different bugs in the script: one around treating labels as mutually exclusive, the other meant the label would never be applied in the first place.</p>",
        "id": 515764832,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746207355
    },
    {
        "content": "<p>I'm happy to split that PR into several; for now, the commits are hopefully self-contained enough.</p>",
        "id": 515764914,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746207369
    },
    {
        "content": "<p>I left some comments on the PR. Thanks for taking on the task of refactoring <code>zulip_emoji_merge_delegate.py</code>, by the way! Though I'm now wondering whether all the different workflows that call this script should be merged / refactored as well...</p>",
        "id": 515782098,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1746213441
    },
    {
        "content": "<p>As a historical remark, I think that the first version of the script was written by Johan in combination with some AI.  I then modified it, while learning python and then expanded on it.</p>",
        "id": 515784315,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1746214303
    },
    {
        "content": "<p>It is not a surprise that there are bugs and I'm happy if they get ironed out!</p>",
        "id": 515784382,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1746214322
    },
    {
        "content": "<p>Update: I have split that PR in two; now <a href=\"https://github.com/leanprover-community/mathlib4/pull/24556\">#24556</a> documents the current logic (and the parameters the four different workflows calling the script are passing in) and <a href=\"https://github.com/leanprover-community/mathlib4/pull/24565\">#24565</a> fixes the maintainer merge labelling for the bot.</p>",
        "id": 516001360,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746342669
    },
    {
        "content": "<p>Let's test the new emojibot: <a href=\"https://github.com/leanprover-community/mathlib4/pull/24565\">#24565</a> --- it worked!</p>",
        "id": 516885704,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1746707962
    },
    {
        "content": "<p>Merging emoji reaction: welcome back!  <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span></p>",
        "id": 516895627,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1746710826
    }
]