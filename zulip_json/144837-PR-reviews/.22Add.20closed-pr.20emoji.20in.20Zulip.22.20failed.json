[
    {
        "content": "<p>Hi, sorry if this is a dumb question. I am trying to create my first PR, <a href=\"https://github.com/leanprover-community/mathlib4/pull/22742\">https://github.com/leanprover-community/mathlib4/pull/22742</a>, but one of the CI job \"Add closed-pr emoji in Zulip\" failed. I don't quite understand what it tried to do but it doesn't look related to my code change. How do I resolve it?</p>",
        "id": 504417972,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1741544596
    },
    {
        "content": "<p>Hah that's a novel one! You deserve a point for that one -- I'm not sure I've ever seen that error before. <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> any idea?</p>",
        "id": 504418477,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741544970
    },
    {
        "content": "<p>it looks like the api key is <del>malformed</del> missing</p>",
        "id": 504418698,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1741545124
    },
    {
        "content": "<p>Right, but I do not see when/if it was changed recently...</p>",
        "id": 504418779,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741545176
    },
    {
        "content": "<p>The failures appear to be correlated with branch names that involve <code>:</code>.</p>",
        "id": 504420244,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741546219
    },
    {
        "content": "<p>So, it may be an \"escaping\" bug of some sort.</p>",
        "id": 504420260,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741546241
    },
    {
        "content": "<p>But this branch name is just <code>argpow</code>? <span class=\"user-mention\" data-user-id=\"873350\">@Weiyi Wang</span> we usually use branch names of the form <code>githubusernane-actualbranchname</code> just so we know whose branch it is in case it goes stale, but in this case it's unlikely to happen.</p>",
        "id": 504421279,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741547016
    },
    {
        "content": "<p>Oh, I was looking <a href=\"https://github.com/leanprover-community/mathlib4/actions/workflows/zulip_emoji_closed_pr.yaml\">here</a>, where the branch seems to be <code>wwylele:argpow</code>.  Look also at the \"branch names\" of the other failures.</p>",
        "id": 504421471,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547133
    },
    {
        "content": "<p>I wonder if it is a \"PR from a fork-like\" kind of issue.</p>",
        "id": 504421490,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547150
    },
    {
        "content": "<p>Yeah, I closed a previous one that I mistakenly opened from my fork. I think the branch name from a fork automatically includes \":\"</p>",
        "id": 504421573,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1741547190
    },
    {
        "content": "<p>Actually, it is a branch from a fork?</p>",
        "id": 504421581,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547196
    },
    {
        "content": "<p>Ok, that clears it: CI failed because the PR was opened from a fork.</p>",
        "id": 504421604,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547222
    },
    {
        "content": "<p><em>Some</em> part of CI is bound to fail in such situations.</p>",
        "id": 504421624,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547237
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22742\">#22742</a> is not opened from a fork. It is a PR from a new contributor which is essentially the same as a PR which was opened a couple of hours earlier from a fork before they knew the workflow. So it's still a mystery to me why CI is failing.</p>",
        "id": 504421710,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741547288
    },
    {
        "content": "<p>Oh, CI picked the PR <em>number</em> of the PR from a fork, even though that PR is indeed from a <em>branch</em>!</p>",
        "id": 504421787,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547344
    },
    {
        "content": "<p>The fork PR was <a href=\"https://github.com/leanprover-community/mathlib4/pull/22738\">#22738</a> and it is now closed.</p>",
        "id": 504421824,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741547378
    },
    {
        "content": "<p>The error message says <code>PR_NUMBER: '22738'</code>, which is <em>not</em> the PR number where CI is failing.</p>",
        "id": 504421903,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547412
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.22Add.20closed-pr.20emoji.20in.20Zulip.22.20failed/near/504421787\">said</a>:</p>\n<blockquote>\n<p>Oh, CI picked the PR <em>number</em> of the PR from a fork, even though that PR is indeed from a <em>branch</em>!</p>\n</blockquote>\n<p>how even????</p>",
        "id": 504421913,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1741547419
    },
    {
        "content": "<p>Yes you're absolutely right! Well spotted!</p>",
        "id": 504421919,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741547424
    },
    {
        "content": "<p>This is bizarre!  CI is always entertaining.</p>",
        "id": 504421953,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547450
    },
    {
        "content": "<p>maybe the <em>commit</em> is from the fork?</p>",
        "id": 504422129,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1741547535
    },
    {
        "content": "<p><span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> Sorry for the mess. Maybe it is because I used the exact same commit message &amp; commit hash?</p>",
        "id": 504422154,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1741547552
    },
    {
        "content": "<p>which through github magic got moved into a proper mathlib branch?</p>",
        "id": 504422158,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1741547554
    },
    {
        "content": "<p>You recycled a commit hash?!  Is that even possible?  <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>",
        "id": 504422191,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547583
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"873350\">@Weiyi Wang</span> you don't need to apologise -- it is our obscure and nonstandard workflow which causes these problems.</p>",
        "id": 504422196,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741547586
    },
    {
        "content": "<p>Thanks for testing so thoroughly our system!</p>",
        "id": 504422203,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547593
    },
    {
        "content": "<p>Let me try changing the commit message a little bit and change the hash</p>",
        "id": 504422212,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1741547598
    },
    {
        "content": "<p>I have to go prepare dinner now, but this has been lots of fun!  <span aria-label=\"lol\" class=\"emoji emoji-1f606\" role=\"img\" title=\"lol\">:lol:</span></p>",
        "id": 504422313,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1741547649
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.22Add.20closed-pr.20emoji.20in.20Zulip.22.20failed/near/504422191\">said</a>:</p>\n<blockquote>\n<p>You recycled a commit hash?!  Is that even possible?  <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>\n</blockquote>\n<p>Both PRs have commit hash <code>4240101</code>. <span class=\"user-mention\" data-user-id=\"873350\">@Weiyi Wang</span> I left two style comments which could be used to change the hash.</p>",
        "id": 504422398,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741547719
    },
    {
        "content": "<p>OK it looks like that CI step has now passed. Thanks Damiano for the very weird diagnosis!</p>",
        "id": 504423341,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741548350
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 504423479,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1741548411
    },
    {
        "content": "<p>Yeah, I think the problem here is that github doesn't tell the code we're running what PR we're actually dealing with, and so we try to extract it from the commit hash. But as you reminded us, there can be multiple PRs with the exact same commit</p>",
        "id": 504423859,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1741548637
    }
]