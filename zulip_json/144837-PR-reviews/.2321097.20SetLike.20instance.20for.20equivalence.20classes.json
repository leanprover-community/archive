[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21097\">#21097</a> by <span class=\"user-mention\" data-user-id=\"519269\">@Pim Otte</span> introduces a <code>SetLike</code> instance for equivalence classes. All the comments were adressed, but <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> said that it was maybe not a good idea to have this instance. What should we do about this? Some discussion is in <a class=\"stream-topic\" data-stream-id=\"287929\" href=\"/#narrow/channel/287929-mathlib4/topic/Tutte.27s.20theorem\">#mathlib4 &gt; Tutte's theorem</a></p>",
        "id": 497260446,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1738504502
    },
    {
        "content": "<p>Part of my hesitation is that a lot of new user confusion and difficulty around quotients in Lean seems to stem from thinking about <code>Quot</code> as equivalence classes rather than in ways that encourage using <code>Quotient.lift</code>.</p>",
        "id": 497262326,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738506102
    },
    {
        "content": "<p>I think adding an <em>implicit</em> coercion is going to make this confusion worse. A regular named function would be less objectionable, but I still worry a little that this API will end up being a trap.</p>",
        "id": 497262439,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738506220
    },
    {
        "content": "<p>(one unrelated concern, if we decide we do want it, is whether we need to duplicate it all for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Quotient#doc\">docs#Quotient</a>)</p>",
        "id": 497262499,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738506259
    },
    {
        "content": "<p>Thanks for starting a thread, I'd appreciate some other opinions on this!</p>",
        "id": 497262642,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738506383
    },
    {
        "content": "<p>Indeed I don’t really know what to do either, you have some good points. Let’s wait for other opinions</p>",
        "id": 497262999,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1738506701
    },
    {
        "content": "<p>I am rather strongly against this. I think it’s doing a great disservice to new users indeed. There are exceptions to this but in general they should learn to think in terms of universal properties instead.</p>",
        "id": 497270291,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1738513379
    },
    {
        "content": "<p>I tell people that if they want the equivalence class / coset / whatever, they can just look at the preimage of the canonical surjection (and then tell them that they probably don't want the equivalence class). We can moan about it all we like but the truth is that in mathematics departments the world over, young people are being told that the quotient G/N is <em>equal</em> to the set of cosets and there's nothing we can do to prevent this.</p>",
        "id": 497278129,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738519973
    },
    {
        "content": "<p>They're also being told that they need to check a function from the quotient is \"well-defined\" by defining it using an arbitrarily-chosen element of the class and then checking that it's independent of the choice of element in the class. This is in some sense even more confusing because if you use the axiom of choice to choose an element of the equivalence class then the resulting lean function is perfectly well-defined and you don't need to check anything. </p>\n<p>Five years ago I know exactly what I would do in this situation -- I'd write a Xena blog post saying \"mathematicians -- here's what you need to know about lean quotients\" and then people would occasionally point beginners to it here. But is there a place on the community website where such a post could go? I've done several hours of FLT today so I'm allowed some time off</p>",
        "id": 497278401,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738520216
    },
    {
        "content": "<p>(I tried to do my part in our math department teaching that G/N is any convenient set that satisfies the properties, and if you've got no other ideas you've got the set-of-equivalence-classes construction.)</p>",
        "id": 497278587,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738520376
    },
    {
        "content": "<p>Ignoring universal properties, I'm worried about this coercion leading to some chaos, where elements that you didn't know were quotients but were defined with <code>abbrev</code> somehow become very willing to become sets for no apparent reason.</p>",
        "id": 497279328,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738520968
    },
    {
        "content": "<p>(Pinging <span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span>, who weighed in in favor of the SetLike instance)</p>",
        "id": 497279427,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738521018
    },
    {
        "content": "<p>I personally like Eric's suggestion of an explicit function rather than a coercion.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">}</span>\n<span class=\"c1\">-- or: Quot.mk r ⁻¹' {q}</span>\n</code></pre></div>",
        "id": 497279639,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738521191
    },
    {
        "content": "<p>That could have a long docstring explaining that it is not actually as useful as it might appear</p>",
        "id": 497279681,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738521234
    },
    {
        "content": "<p>(indeed the preimage spelling seems a little more useful)</p>",
        "id": 497279793,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738521315
    },
    {
        "content": "<p>We have this already, it's called preimage</p>",
        "id": 497279824,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738521344
    },
    {
        "content": "<p>Why clog things up with another definition?</p>",
        "id": 497279909,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738521408
    },
    {
        "content": "<p>I remember being amazed in 2019 or so that we didn't have what I thought was the \"fundamental theorem of equivalence relations\", namely that they were the same as partitions. So I got Amelia to PR it and it was merged and it's never used! That taught me a lesson!</p>",
        "id": 497280094,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1738521576
    },
    {
        "content": "<p>It might not hurt too much having it as an <code>abbrev</code>. (Though it can hurt <code>rw</code>)</p>\n<p>Or, better, if we ever get to the feature in core Lean, having it marked as <code>@[elab_inline]</code> so that when you use it, it automatically gets unfolded into the preimage version immediately.</p>",
        "id": 497280236,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738521713
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321097.20SetLike.20instance.20for.20equivalence.20classes/near/497279427\">said</a>:</p>\n<blockquote>\n<p>(Pinging <span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span>, who weighed in in favor of the SetLike instance)</p>\n</blockquote>\n<p>To put this back in context, the proposed use of this instance was to view a connected component of a graph as a set. This isn't a situation where someone is defining a function out of a quotient as mistakenly choosing an element, this is a situation where a subset of the vertices of a graph is genuinely a more helpful way to view a connected component. I'm also happy with Eric's suggestion.</p>",
        "id": 497282547,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1738523532
    },
    {
        "content": "<p>Let me also add that <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Setoid.quotientEquivClasses#doc\">docs#Setoid.quotientEquivClasses</a> and the lemmas around it already give API for viewing elements of the quotient as sets. To me, the new instance is just a version of that for the more modern way of working with viewing something as a set.</p>",
        "id": 497283010,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1738523981
    },
    {
        "content": "<p>I think SetLike should be reserved for something that \"is\" a set, and quotient elements are only sets if you pretend that the set-of-equivalence-classes construction is the only way to form a quotient.</p>\n<p>What do you think about giving only ConnectedComponent a SetLike instance?</p>",
        "id": 497283589,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738524466
    },
    {
        "content": "<p>I'd be happy with that.</p>",
        "id": 497283772,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1738524608
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321097.20SetLike.20instance.20for.20equivalence.20classes/near/497283589\">said</a>:</p>\n<blockquote>\n<p>What do you think about giving only ConnectedComponent a SetLike instance?</p>\n</blockquote>\n<p>In fact this instance already exists: <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=SimpleGraph.ConnectedComponent.instSetLike#doc\">docs#SimpleGraph.ConnectedComponent.instSetLike</a></p>",
        "id": 497283811,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1738524644
    },
    {
        "content": "<p>In this case I think what to do with this PR is fairly clear - remove the new instance and the API for it (lines 21 to 32) and keep the material below line 34, which doesn't need the new instance.</p>",
        "id": 497284045,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1738524793
    },
    {
        "content": "<p>(I completely forgot about that instance; it was added in <a href=\"https://github.com/leanprover-community/mathlib3/pull/18442\">mathlib3#18442</a>)</p>",
        "id": 497284357,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1738525041
    },
    {
        "content": "<p>I think what happened is that Pim was implementing sets of representatives for connected components and it was pointed out that it was something which was not specific to graphs, and so Pim went with a general framework for quotients. Now it appears that this instance is not desirable, so I agree with Bhavik.</p>",
        "id": 497284362,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1738525043
    },
    {
        "content": "<p>Thanks everyone for weighing in on this! I can't say I fully grasp the nuance here yet, but I'm looking forward to understanding it better, because it feels related to traps I have fallen into at some point.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"246273\">Bhavik Mehta</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321097.20SetLike.20instance.20for.20equivalence.20classes/near/497284045\">said</a>:</p>\n<blockquote>\n<p>In this case I think what to do with this PR is fairly clear - remove the new instance and the API for it (lines 21 to 32) and keep the material below line 34, which doesn't need the new instance.</p>\n</blockquote>\n<p>So to clarify, by this you mean specializing it all to <code>ConnectedComponent</code>, so that we can use the existing instance, right?<br>\n(Or maybe even stick with using <code>.supp</code> and leaving the existing instance be as is all together?)</p>",
        "id": 497292753,
        "sender_full_name": "Pim Otte",
        "timestamp": 1738531855
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321097.20SetLike.20instance.20for.20equivalence.20classes/near/497278587\">said</a>:</p>\n<blockquote>\n<p>(I tried to do my part in our math department teaching that G/N is any convenient set that satisfies the properties, and if you've got no other ideas you've got the set-of-equivalence-classes construction.)</p>\n</blockquote>\n<p>I can tell you I’m also doing my part. And every year I’m a bit more tempted to simply give negative grades to students who refer to equivalence classes in my algebra classes. Last week I was grading exams where one of the early build up questions was to prove that the π₀ of a locally path connected topological space is discrete (when equipped with the quotient topology). There was a couple of students who tried to see <code>π₀(X)</code> as the set of path connected components of <code>X</code> instead of seeing it as an abstract quotient and they got extremely confused.</p>",
        "id": 497294197,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1738532890
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"519269\">Pim Otte</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321097.20SetLike.20instance.20for.20equivalence.20classes/near/497292753\">said</a>:</p>\n<blockquote>\n<p>Thanks everyone for weighing in on this! I can't say I fully grasp the nuance here yet, but I'm looking forward to understanding it better, because it feels related to traps I have fallen into at some point.</p>\n</blockquote>\n<p>Do you want to read more about why seeing quotients as sets of equivalence classes is bad in algebra and topology on paper? Or do you mean in Lean? Or do you want to tell us about a specific trap example?</p>",
        "id": 497294589,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1738533205
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2321097.20SetLike.20instance.20for.20equivalence.20classes/near/497294589\">said</a>:</p>\n<blockquote>\n<p>Do you want to read more about why seeing quotients as sets of equivalence classes is bad in algebra and topology on paper? Or do you mean in Lean? Or do you want to tell us about a specific trap example?</p>\n</blockquote>\n<p>I meant in Lean, but I'm also interested in the paper side (the example you sketch above does help with that). I think the traps I'm talking about are about not thinking enough in terms of functions and universal properties. I might have some follow up questions on that, depending on how my reflection on all of this pans out:)</p>",
        "id": 497295226,
        "sender_full_name": "Pim Otte",
        "timestamp": 1738533659
    },
    {
        "content": "<p>I don't know much about this, but <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>'s point about surjections reminds me of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Setoid.quotientKerEquivRange#doc\">docs#Setoid.quotientKerEquivRange</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Setoid.quotientKerEquivOfSurjective#doc\">docs#Setoid.quotientKerEquivOfSurjective</a>. That is, if your quotient is defined by the kernel of a surjective function, you may as well just talk about the output of the function, and skip the quotient business altogether.</p>",
        "id": 497588579,
        "sender_full_name": "Chris Wong",
        "timestamp": 1738648696
    },
    {
        "content": "<p>The quotient version gives you rfl theorems and computable operations that are impossible with the Set.range spelling</p>",
        "id": 497594636,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1738652358
    },
    {
        "content": "<p>Another thing is <code>Quot</code> is in <code>Init</code> independent of mathlib, while <code>Set</code> is in mathlib</p>",
        "id": 497935924,
        "sender_full_name": "Jz Pan",
        "timestamp": 1738773409
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span> I have modified <a href=\"https://github.com/leanprover-community/mathlib4/pull/20024\">#20024</a> to adopt the improvements that came from reviewing this PR, but house them in the SimpleGraph namespace</p>",
        "id": 498150671,
        "sender_full_name": "Pim Otte",
        "timestamp": 1738856378
    }
]