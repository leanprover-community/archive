[
    {
        "content": "<p>I would like this linting step installed sooner rather than later.</p>",
        "id": 558761080,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1763764137
    },
    {
        "content": "<p>Kim, will this silently fail because <code>#grind_lint</code> only logs errors? Should it have an empty <code>#guard_msgs</code> to make sure it's actually passing?</p>",
        "id": 560810727,
        "sender_full_name": "Chris Henson",
        "timestamp": 1764343741
    },
    {
        "content": "<p>Mathlib CI is expected to be completely silent, so emitting a message, whether or not it is an error, should be caught and flagged.</p>",
        "id": 560812096,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764344094
    },
    {
        "content": "<p>At the same time, it is also not wrong to be more explicit and add a <code>#guard_msgs</code>, so that a change is flagged as an error.</p>",
        "id": 560812510,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764344228
    },
    {
        "content": "<p>Ah, thanks. Do you happen to know how that is configured? I didn't see anything in the lakefile, is it on the GitHub actions side? Maybe it should be an option for <code>lean-action</code> to replicate this behavior.</p>",
        "id": 560813170,
        "sender_full_name": "Chris Henson",
        "timestamp": 1764344469
    },
    {
        "content": "<p>It is on the GitHub action side.  Let me find where exactly.</p>",
        "id": 560813438,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764344579
    },
    {
        "content": "<p>(It is a \"manual\" check, though, not some flag that can be turned on or off.)</p>",
        "id": 560813520,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764344607
    },
    {
        "content": "<p>This</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/4bb77eb8ab0306647ec206d365aa52a06b316345/.github/build.in.yml#L512\">https://github.com/leanprover-community/mathlib4/blob/4bb77eb8ab0306647ec206d365aa52a06b316345/.github/build.in.yml#L512</a></p>\n<p>is the check that <code>lake build</code> is silent.</p>",
        "id": 560813995,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764344686
    },
    {
        "content": "<p>Oh I see, thanks for tracking that down!</p>",
        "id": 560814723,
        "sender_full_name": "Chris Henson",
        "timestamp": 1764344900
    },
    {
        "content": "<p>I think that this is the test check:</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/blob/4bb77eb8ab0306647ec206d365aa52a06b316345/.github/workflows/build.yml#L494\">https://github.com/leanprover-community/mathlib4/blob/4bb77eb8ab0306647ec206d365aa52a06b316345/.github/workflows/build.yml#L494</a></p>\n<p>I forget whether the <code>-iofail</code> flag does what I said, but I am hoping that it does!</p>",
        "id": 560814789,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764344922
    },
    {
        "content": "<p>Yes, that appears correct, <code>lake --help</code> says:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>--iofail<span class=\"w\">      </span>fail<span class=\"w\"> </span>build<span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span>any<span class=\"w\"> </span>I/O<span class=\"w\"> </span>or<span class=\"w\"> </span>other<span class=\"w\"> </span>info<span class=\"w\"> </span>is<span class=\"w\"> </span>logged<span class=\"w\"> </span><span class=\"o\">(</span>same<span class=\"w\"> </span>as<span class=\"w\"> </span>--fail-level<span class=\"o\">=</span>info<span class=\"o\">)</span>\n</code></pre></div>",
        "id": 560815931,
        "sender_full_name": "Chris Henson",
        "timestamp": 1764345316
    },
    {
        "content": "<p>(And you can already pass args like this to either <code>lake build</code> or <code>lake test</code> with the GitHub action)</p>",
        "id": 560816056,
        "sender_full_name": "Chris Henson",
        "timestamp": 1764345364
    },
    {
        "content": "<p>Ok, great!  Mathlib has various stages of the build in CI and only at the very end it should fail.  Also, when the CI was setup, these flags and the replay feature were not available, which probably explains a little of the clunkiness.</p>",
        "id": 560818124,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764345973
    },
    {
        "content": "<p>Basically, try to build as much as you can, possibly with errors, upload the cache, lint and after that, fail if there were some errors/noise.</p>",
        "id": 560818278,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1764346015
    }
]