[
    {
        "content": "<p>I delayed writing this for far too long, but it turns out to have been quite straightforward to get something minimal working. I haven't tested much yet, but I invite others to do so too! :-)</p>\n<p>From the PR description: in </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">subalgebraMap</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Subalgebra</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"bp\">≃ₐ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">→ₐ</span><span class=\"o\">[</span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toRingEquiv</span><span class=\"bp\">.</span><span class=\"n\">subsemiringMap</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">.</span><span class=\"n\">toSubsemiring</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"n\">commutes'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">ext</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"n\">only</span>\n<span class=\"w\">      </span><span class=\"n\">erw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">RingEquiv</span><span class=\"bp\">.</span><span class=\"n\">subsemiringMap_apply_coe</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">commutes</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>replace <code>erw</code> with <code>erw?</code>. You'll get the informational message:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toRingEquiv</span><span class=\"bp\">.</span><span class=\"n\">subsemiringMap</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">.</span><span class=\"n\">toSubsemiring</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toFun</span>\n<span class=\"w\">  </span><span class=\"n\">and</span>\n<span class=\"bp\">⇑</span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"bp\">.</span><span class=\"n\">toRingEquiv</span><span class=\"bp\">.</span><span class=\"n\">subsemiringMap</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"bp\">.</span><span class=\"n\">toSubsemiring</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">defeq</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"n\">transparency</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">reducible</span><span class=\"w\"> </span><span class=\"n\">transparency</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 498738571,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739187732
    },
    {
        "content": "<p>(The implementation doesn't hook into the implementation of <code>erw</code> at all --- it simply inspects the term that it produces. Realising that this was enough explains why the implementation is much easier than I'd expected/feared.)</p>",
        "id": 498738708,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739187771
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/21643\">#21643</a></p>",
        "id": 498969261,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739267806
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>, I used some tricks to abbreviate your message collection code: state transformers and a macro! :-)</p>",
        "id": 498992399,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739275223
    },
    {
        "content": "<p>Great, I like it!</p>",
        "id": 498992909,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739275354
    },
    {
        "content": "<p>Do we want to use the widget diff view here, to deal with highlighting the mismatching subexpressions?</p>",
        "id": 498995001,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1739276001
    },
    {
        "content": "<p>Happy to have that added/replaced, but can we proceed with merging this one first? I want to go hunt <code>erw</code>s.</p>",
        "id": 498995221,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739276064
    },
    {
        "content": "<p>I am happy to merge as is and fix/upgrade in production.</p>",
        "id": 498995488,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739276163
    },
    {
        "content": "<p>Btw, I think that <code>erw?</code> can be \"silent\" and hence might survive into final code: should <code>erw?</code> either always emit a message or be linted?</p>",
        "id": 498995703,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739276229
    },
    {
        "content": "<p>Oh, that's a good point.</p>",
        "id": 498995763,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739276252
    },
    {
        "content": "<p>Sorry, I need to sleep now. Please feel free to take if off the queue, or we can make this modification later, as you think best.</p>",
        "id": 498995835,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1739276277
    },
    {
        "content": "<p>Simply adding a <code>log</code> saying \"Testing <code>erw</code>\" will make CI catch it.</p>",
        "id": 498995901,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739276291
    },
    {
        "content": "<p>I see that Eric is making suggestions: I will remove it from the queue, apply the suggestions and then merge again.</p>",
        "id": 498996049,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739276355
    },
    {
        "content": "<p>The <code>erw?</code> tactic has been merged!  It has not been tested very much, so, if you use it and notice some roughness, feel free to report any issues!</p>",
        "id": 499049006,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1739291303
    }
]