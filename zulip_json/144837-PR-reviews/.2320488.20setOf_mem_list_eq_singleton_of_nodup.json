[
    {
        "content": "<p>I'm curious about <a href=\"https://github.com/leanprover-community/mathlib4/pull/20488#discussion_r1911770327\">this comment</a> about an instance:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">setOf_fintype</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">//</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">}]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>\n<p>My main question is: Why is this worrying? (<span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span>)</p>",
        "id": 494028186,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1736979906
    },
    {
        "content": "<p>I agree that this is worrying. The simp-normal form of <code>↑{x | p x}</code> is <code>{x // p x}</code>. These two are def-eq, but things like <code>rw</code> or instance search can't see through it, which can lead to hard-to-debug issues if you write the former and in the middle of the calculation it turns into the latter without you noticing.</p>",
        "id": 494037053,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1736984682
    },
    {
        "content": "<p>So really, we shouldn't ever be having to write expressions like <code>Fintype ↑{x | p x}</code>.</p>",
        "id": 494037099,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1736984717
    },
    {
        "content": "<p>What's the context for this expression appearing?</p>",
        "id": 494037133,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1736984752
    },
    {
        "content": "<p>Oh nevermind I read the PR now. I think there's two possible solutions.</p>",
        "id": 494037652,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1736985056
    },
    {
        "content": "<p>One is to prove some other version of <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Set/Finite/Basic.html#Set.toFinite_toFinset\"><code>Set.toFinite_toFinset</code></a> which takes in <code>{x | p x}</code> argument and a <code>Fintype {x // p x}</code> instance.</p>\n<p>The other is to directly add <code>have : Fintype {x | p x} := inferinstanceAs (Fintype {x // p x})</code> or something similar in the proof where you make use of this.</p>",
        "id": 494037911,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1736985201
    },
    {
        "content": "<p>Oh actually there's a third, better solution! Just don't take a <code>DecidableEq</code> argument in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=setOf_mem_list_eq_singleton_of_nodup#doc\">docs#setOf_mem_list_eq_singleton_of_nodup</a>.</p>",
        "id": 494040909,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1736986825
    }
]