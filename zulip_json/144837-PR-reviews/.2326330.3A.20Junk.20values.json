[
    {
        "content": "<p>There's been no comments or reviews on <a href=\"https://github.com/leanprover-community/mathlib4/pull/26330\">#26330</a> since May. It's (I think) a pretty quick review: it tests (but more importantly, tries to _document_ for humans) junk files across various places in Mathlib, to try to introduce people to when and where to expect them and how to handle them correctly.</p>",
        "id": 537880813,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757081656
    },
    {
        "content": "<p>(Side note: are people expected to report most of their PRs in this channel? I wasn't aware it existed until recently. I'm not entirely clear what its purpose is or how mandatory it is. I also couldn't find an answer by searching zulip.)</p>",
        "id": 537880942,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1757081700
    },
    {
        "content": "<p>It's not mandatory. It can sometimes help to get eyes on your pr</p>",
        "id": 537897039,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1757086597
    },
    {
        "content": "<p>Many of these don't feel like junk values to me. A junk value to me is when an arbitrary choice is made, but in many of these cases the choice is not arbitrary!</p>",
        "id": 544385690,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760261604
    },
    {
        "content": "<p>E.g. truncated subtraction in Nat still has a meaning.</p>",
        "id": 544385716,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760261636
    },
    {
        "content": "<p>I think outside of Lean people would say that 1/0 is undefined instead of 0. I think maybe working with Lean too much makes your brain see them as \"not junk values\"</p>",
        "id": 544385837,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760261767
    },
    {
        "content": "<p>To me, truncated subtraction is really junk: I wouldn't want an \"public\" theorem to depend on that for correctness.</p>\n<p>But it's true that a couple of things in that file aren't really about junk values, e.g.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div>\n<p>It's still \"an operation that you might expect to be undefined but actually is\". That is, if <code>Fin 31</code> is \"Natural numbers less than 31\" (which is exactly how <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Fin#doc\">docs#Fin</a> defines it), then a numeric literal <code>37 : Fin 31</code> seems like nonsense. But this being interpreted as a number mod 31 is sensible.</p>",
        "id": 544400185,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1760275282
    },
    {
        "content": "<p>Would you feel better if it was titled something like \"Unconventional definitions\" or something?</p>",
        "id": 544400211,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1760275309
    },
    {
        "content": "<p>well it's clearly not junk if it said ZMod instead of Fin</p>",
        "id": 544400239,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760275327
    },
    {
        "content": "<p>Right, of course. I'm specfically referring to numeral interpretation in Fin. (It came as a big surprise to me when I first encountered it.)</p>",
        "id": 544400541,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1760275589
    },
    {
        "content": "<p>i'm saying that in this case using addition on Fin n is suspicious</p>",
        "id": 544400610,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760275635
    },
    {
        "content": "<blockquote>\n<p>I wouldn't want an \"public\" theorem to depend on that for correctness.</p>\n</blockquote>\n<p>not long ago I ran into a bad example of this is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Intervals.html#Finset.sum_range_id\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Intervals.html#Finset.sum_range_id</a> (do you spot the problem?)</p>",
        "id": 544400680,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1760275686
    },
    {
        "content": "<p>in fact... one of the tech debt tracker is \"CommRing (Fin n) instances\"?? idk if this is related</p>",
        "id": 544400681,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760275687
    },
    {
        "content": "<p>I think there are both junk values (e.g., division by zero, or various functions such as <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=fderiv#doc\">docs#fderiv</a> which become total by adding a junk value), and operations which may be unexpected (tsub in Nat, addition wrapping around in Fin n)</p>",
        "id": 544400687,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760275693
    },
    {
        "content": "<p>tsub in Nat is junk value, maths before negative numbers (like 400 years ago) treated 3-5 as undefined</p>",
        "id": 544400734,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1760275745
    },
    {
        "content": "<p>Well, wrapping subtraction is a perfectly well-defined operation (and sometimes just what you want, though hardly in my kind of math).</p>",
        "id": 544400815,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760275812
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/544400680\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>I wouldn't want an \"public\" theorem to depend on that for correctness.</p>\n</blockquote>\n<p>not long ago I ran into a bad example of this is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Intervals.html#Finset.sum_range_id\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Intervals.html#Finset.sum_range_id</a> (do you spot the problem?)</p>\n</blockquote>\n<p>this looks fine to me</p>",
        "id": 544400821,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760275816
    },
    {
        "content": "<p>I'd argue it's not what you want, most of the time.</p>",
        "id": 544400843,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1760275837
    },
    {
        "content": "<p>perhaps usually the one directly above would be better</p>",
        "id": 544400855,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760275850
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.sum_range_id_mul_two#doc\">docs#Finset.sum_range_id_mul_two</a></p>",
        "id": 544400861,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760275856
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/544400821\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/544400680\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>I wouldn't want an \"public\" theorem to depend on that for correctness.</p>\n</blockquote>\n<p>not long ago I ran into a bad example of this is <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Intervals.html#Finset.sum_range_id\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/BigOperators/Intervals.html#Finset.sum_range_id</a> (do you spot the problem?)</p>\n</blockquote>\n<p>this looks fine to me</p>\n</blockquote>\n<p>when n = 0, the right side invokes tsub and just happens to be still the correct result, but when you substitute this in a larger expression it is hard to do arithmetic, and hard to lift to int</p>",
        "id": 544400899,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1760275880
    },
    {
        "content": "<p>(I wasn't talking about the div, that's ok and I understand you can use the mul version)</p>",
        "id": 544401316,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1760276216
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/544400861\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Finset.sum_range_id_mul_two#doc\">docs#Finset.sum_range_id_mul_two</a></p>\n</blockquote>\n<p>I actually this exact issue come up in a dream last night. (Someone had <code>Nat.choose n 2 = n * (n - 1) / 2</code>, and they were complaining that it involved nat division and so they really wanted <code>2 * Nat.choose n 2 = n * (n-1)</code>. It was an extremely tedious dream.)</p>",
        "id": 544401346,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1760276238
    },
    {
        "content": "<p>in a dream???</p>",
        "id": 544401358,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760276248
    },
    {
        "content": "<p>maybe one day I'll dream of a snake eating its own tail and discover the structure of benzene or something</p>",
        "id": 544401443,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1760276326
    },
    {
        "content": "<p>It's too bad. NMR and X-ray crystallography have taken all the fun out of sleep.</p>",
        "id": 544401581,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1760276429
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"873350\">Weiyi Wang</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/544401316\">said</a>:</p>\n<blockquote>\n<p>(I wasn't talking about the div, that's ok and I understand you can use the mul version)</p>\n</blockquote>\n<p>The div is also bad because it means that even for n&gt;0 the statement is weaker than what a reader would expect (it allows the possibility that rounding has occurred)</p>",
        "id": 544411219,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1760285068
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/544400734\">said</a>:</p>\n<blockquote>\n<p>tsub in Nat is junk value, maths before negative numbers (like 400 years ago) treated 3-5 as undefined</p>\n</blockquote>\n<p>Fundamentally I suppose the question is \"do you view truncated subtraction as a partial function with junk values added\".</p>",
        "id": 545016846,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760547211
    },
    {
        "content": "<p>I don't.</p>",
        "id": 545016851,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760547213
    },
    {
        "content": "<p>Like - while division by zero <em>is</em> to me junk, the fact that 3 / 4 = 0 is not a junk value - that is just integer division. 3 - 4 = 0 is the additive analogue, to me.</p>",
        "id": 545017026,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760547262
    },
    {
        "content": "<p>I think the trap in a sense is that the signature of subtraction on the naturals is (Nat -&gt; Nat -&gt; Nat), NOT Nat -&gt; Nat -&gt; Int which is what naive or \"schoolbook\" subtraction would be.</p>",
        "id": 545017337,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760547368
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"448405\">Alex Meiburg</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/544400211\">said</a>:</p>\n<blockquote>\n<p>Would you feel better if it was titled something like \"Unconventional definitions\" or something?</p>\n</blockquote>\n<p>Instead of \"junk\".</p>",
        "id": 545017943,
        "sender_full_name": "Alex Meiburg",
        "timestamp": 1760547577
    },
    {
        "content": "<p>I think \"Unexpected\" might be better than \"unconventional\"</p>",
        "id": 545018015,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760547597
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/545017026\">said</a>:</p>\n<blockquote>\n<p>Like - while division by zero <em>is</em> to me junk, the fact that 3 / 4 = 0 is not a junk value - that is just integer division. 3 - 4 = 0 is the additive analogue, to me.</p>\n</blockquote>\n<p>(I think actually truncated subtraction is precisely correct - I think I can make an argument that it is exactly the tropical form of natural division, in the following way.</p>\n<p>Suppose a, b are natural numbers. By the Euclidean algorithm there's some<br>\nq and r with r &lt; b such that a = q*b + r. Translating tropically, this would be min(q + b, r). I'm not sure how the bound on r translates, but I note that b = min ((b - a) + a, b), <em>as long as subtraction truncates</em>.</p>",
        "id": 545019110,
        "sender_full_name": "Wrenna Robson",
        "timestamp": 1760547954
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330967\">Wrenna Robson</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326330.3A.20Junk.20values/near/544385716\">said</a>:</p>\n<blockquote>\n<p>E.g. truncated subtraction in Nat still has a meaning.</p>\n</blockquote>\n<p>Sure but in ordinary mathematics you typically don't use the symbol <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo></mrow><annotation encoding=\"application/x-tex\">-</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span></span></span></span> for this modified notion. People sometimes use stuff like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mo>−</mo><mo>˙</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\dot{-}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9035em;vertical-align:-0.0833em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8202em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mbin\">−</span></span><span style=\"top:-3.1523em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1389em;\"><span class=\"mord\">˙</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.0833em;\"><span></span></span></span></span></span></span></span></span>. Likewise with division, people will write something like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">⌊</mo><mfrac><mi>n</mi><mi>m</mi></mfrac><mo stretchy=\"false\">⌋</mo></mrow><annotation encoding=\"application/x-tex\">\\lfloor{\\frac{n}{m}}\\rfloor</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.095em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌊</span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mclose\">⌋</span></span></span></span> to be unambiguous.</p>",
        "id": 545728136,
        "sender_full_name": "James E Hanson",
        "timestamp": 1760762560
    }
]