[
    {
        "content": "<p>CI says there are unused imports but I think it is wrong.</p>",
        "id": 533586944,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754755082
    },
    {
        "content": "<p><code>Matrix.etaExpand_eq</code> is in <code>import Mathlib.Data.Matrix.Reflection</code></p>",
        "id": 533586972,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754755112
    },
    {
        "content": "<p>The warning message should tell you how to get shake to ignore it. It’s <code>update</code> or something like that.</p>",
        "id": 533587382,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1754755551
    },
    {
        "content": "<p>ah, I didn't expect it to be a command</p>",
        "id": 533587511,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754755704
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I hope you don't mind if I discuss your comments here. I've thought about your suggestions and found an alternate pathway:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Matrix</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">cons_transpose</span>\n<span class=\"c1\">-- (v : n' → α) (A : Matrix (Fin m) n' α) :</span>\n<span class=\"c1\">--  (of (vecCons v A))ᵀ = of fun i =&gt; vecCons (v i) (Aᵀ i)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">cons_transpose'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">n'</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">))</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">cons_transpose</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">A</span>\n\n<span class=\"c1\">-- https://github.com/leanprover-community/mathlib4/pull/24155</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">FinVec</span><span class=\"bp\">.</span><span class=\"n\">eta3</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">etaExpand_eq</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">of_apply'</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">FinVec</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp?</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">cons_transpose</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">cons_transpose'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">of_apply'</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- (of fun i =&gt; ![![1, 2, 3] i, ![4, 5, 6] i])</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">eta3</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"c1\">-- !![![1, 2, 3] 0, ![4, 5, 6] 0; ![1, 2, 3] 1, ![4, 5, 6] 1; ![1, 2, 3] 2, ![4, 5, 6] 2]</span>\n<span class=\"w\">  </span><span class=\"n\">simp?</span><span class=\"w\"> </span><span class=\"c1\">-- uses cons_val</span>\n<span class=\"w\">  </span><span class=\"c1\">-- !![1, 4; 2, 5; 3, 6]</span>\n</code></pre></div>",
        "id": 533590534,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759146
    },
    {
        "content": "<p>so, the alternate pathway involves these steps:</p>\n<ol>\n<li><code>Matrix.cons_transpose</code> is basically the \"wrong\" simp lemma, because Lean will destruct a <code>Matrix (Fin (m+1)) (Fin n) R</code> into the first part being a vector <code>Fin n -&gt; R</code>, and the second part will actually be a double vector <code>Fin m -&gt; Fin n -&gt; R</code>, so this lemma will not be able to be used again. I've fixed it with <code>Matrix.cons_transpose'</code> in the code above.</li>\n<li>Your PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/24155\">#24155</a> needs to be merged, so that we can eta expand fin vectors, but ideally it should be a simproc instead of a rw proc. (We can stop recursion by refusing to treat vectors that are already expanded.)</li>\n<li>The <code>Matrix.of_apply</code> lemma also needs to be changed, as demonstrated above</li>\n</ol>",
        "id": 533590687,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759332
    },
    {
        "content": "<p>However, I still feel like it would be a good idea to expand it all in one step, which is what my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/28148\">#28148</a> will achieve.</p>",
        "id": 533590712,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759361
    },
    {
        "content": "<p>It feels morally incorrect to see <code>simp?</code> has 10 lemmas applied to reduce a transpose of an explicit matrix.</p>",
        "id": 533590733,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759383
    },
    {
        "content": "<p>regardless of which pathway we decide on, I think the points 1 2 3 are still good to have in Mathlib.</p>",
        "id": 533590827,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759491
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533590733\">said</a>:</p>\n<blockquote>\n<p>It feels morally incorrect to see <code>simp?</code> has 10 lemmas applied to reduce a transpose of an explicit matrix.</p>\n</blockquote>\n<p>(if you want a stronger argument, consider:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>!![![1, 2, 3] 0, ![4, 5, 6] 0; ![1, 2, 3] 1, ![4, 5, 6] 1; ![1, 2, 3] 2, ![4, 5, 6] 2]\n</code></pre></div>\n<p>)</p>",
        "id": 533590981,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759701
    },
    {
        "content": "<p>I'm not at all opposed to a single \"lemma\" for tranposition</p>",
        "id": 533591034,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754759764
    },
    {
        "content": "<p>What I wonder is whether the lemma should be a simproc or what I previously called a \"rw_proc\"</p>",
        "id": 533591053,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754759785
    },
    {
        "content": "<p>what's the key difference? whether it's optional or mandatory?</p>",
        "id": 533591077,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759818
    },
    {
        "content": "<p>I think !![1,2,3;4,5,6]^T should be mandatorily simplified to !![1,4;2,5;3,6]</p>",
        "id": 533591087,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759834
    },
    {
        "content": "<p>\"rw_proc\"s work with <code>rw</code></p>",
        "id": 533591093,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754759837
    },
    {
        "content": "<p>can we have both?</p>",
        "id": 533591098,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759849
    },
    {
        "content": "<p>also, on a similar note, I think we should also have rw&amp;simproc for matrix multiplication even tho Lean can do it already currently</p>",
        "id": 533591124,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759887
    },
    {
        "content": "<p>I have a PR with that in</p>",
        "id": 533591138,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754759900
    },
    {
        "content": "<p>and right now i'm writing a simproc for Matrix.diagonal</p>",
        "id": 533591153,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754759916
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533591098\">said</a>:</p>\n<blockquote>\n<p>can we have both?</p>\n</blockquote>\n<p>I don't know if we need both, I think the rw_procs can be tagged with <code>simp</code></p>",
        "id": 533591280,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754760092
    },
    {
        "content": "<p>does it use the same code?</p>",
        "id": 533591293,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760107
    },
    {
        "content": "<p>No</p>",
        "id": 533591301,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754760112
    },
    {
        "content": "<p>i.e. do i have to do nothing to convert the simproc to rwproc?</p>",
        "id": 533591305,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760118
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/24155\">#24155</a> is the example; it doesn't do any matching on cons literals</p>",
        "id": 533591318,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754760139
    },
    {
        "content": "<p>Instead it matches on the size, then generates a lemma that has the appropriate <code>!![...]</code> literal on the LHS. Then <code>rw</code> does the matching.</p>",
        "id": 533591330,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754760161
    },
    {
        "content": "<p>At least, that's how it's supposed to work (and did in Lean 3, where it was merged into mathlib during the port)</p>",
        "id": 533591360,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754760196
    },
    {
        "content": "<p>aha</p>",
        "id": 533591443,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760321
    },
    {
        "content": "<p>rw_proc isn't even an official object</p>",
        "id": 533591447,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760326
    },
    {
        "content": "<p>that's neat</p>",
        "id": 533591450,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760327
    },
    {
        "content": "<p>Yeah, this was the hack we used in Lean3 where we didn't have simprocs</p>",
        "id": 533591469,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754760341
    },
    {
        "content": "<p>But it's also more flexible, as you can pass arguments:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">FinVec</span>\n\n<span class=\"kn\">section</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"eta_tac\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">liftMetaFinishingTactic</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">en</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferTypeQ</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"Could not infer type for eta\"</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">en</span><span class=\"bp\">.</span><span class=\"n\">nat?</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"Vector is not of a known length\"</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">new_rhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">en</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PiFin</span><span class=\"bp\">.</span><span class=\"n\">mkLiteralQ</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ei</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">en</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">toExpr</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">      </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ei</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">new_rhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"n\">Q</span><span class=\"w\"> </span><span class=\"n\">etaExpand</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨⟩</span>\n<span class=\"w\">    </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">commitIfNoEx</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">defEq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">isDefEqQ</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">new_rhs</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"Could not assign RHS\"</span>\n<span class=\"w\">      </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span><span class=\"bp\">.</span><span class=\"n\">assignIfDefEq</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">etaExpand_eq</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">|&gt;.</span><span class=\"n\">symm</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- This \"rw_proc\" expands `v` into `![v 0, v 1, ⋯]`. -/</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">eta</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"bp\">«!</span><span class=\"o\">[</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"o\">]</span><span class=\"bp\">»</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">«!</span><span class=\"o\">[</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"o\">]</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">eta_tac</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">«!</span><span class=\"o\">[</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">⋯</span><span class=\"o\">]</span><span class=\"bp\">»</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"kn\">end</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">eta</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"c1\">-- v = ![v 0, v 1, v 2]</span>\n</code></pre></div>",
        "id": 533591497,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754760375
    },
    {
        "content": "<p>yeah, me and Bhavik discovered a hack to make simprocs accept arguments (as you already know)</p>",
        "id": 533591519,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760397
    },
    {
        "content": "<p>I don't really understand how you intended to use your hack from <del>the PR that you made</del> <a href=\"https://github.com/leanprover-community/mathlib4/pull/28124\">#28124</a>.</p>",
        "id": 533591587,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754760464
    },
    {
        "content": "<p>actually maybe i can use your hack (\"rw_proc\") to power my other PR (<a href=\"https://github.com/leanprover-community/mathlib4/pull/28072\">#28072</a>, tactic for rewriting with equivalent valuations) instead</p>",
        "id": 533591619,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760506
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533591587\">said</a>:</p>\n<blockquote>\n<p>I don't really understand how you intended to use your hack from the PR that you made.</p>\n</blockquote>\n<p>sorry, which PR are we talking about now?</p>",
        "id": 533591648,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760549
    },
    {
        "content": "<p>currently I don't see how to make rw_proc work with transpose</p>",
        "id": 533591673,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760581
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533591619\">said</a>:</p>\n<blockquote>\n<p>actually maybe i can use your hack (\"rw_proc\") to power my other PR (<a href=\"https://github.com/leanprover-community/mathlib4/pull/28072\">#28072</a>, tactic for rewriting with equivalent valuations) instead</p>\n</blockquote>\n<p>update: i also don't see how to do that now...</p>",
        "id": 533591701,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760604
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533591587\">said</a>:</p>\n<blockquote>\n<p>I don't really understand how you intended to use your hack from <del>the PR that you made</del> <a href=\"https://github.com/leanprover-community/mathlib4/pull/28124\">#28124</a>.</p>\n</blockquote>\n<p>that simproc hack was for <a href=\"https://github.com/leanprover-community/mathlib4/pull/28072\">#28072</a> (valuation tactic)</p>",
        "id": 533591738,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760645
    },
    {
        "content": "<p>it's not relevant to <a href=\"https://github.com/leanprover-community/mathlib4/pull/28148\">#28148</a> (transpose simproc)</p>",
        "id": 533591757,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760655
    },
    {
        "content": "<p>basically i think <a href=\"https://github.com/leanprover-community/mathlib4/pull/28148\">#28148</a> (transpose simproc) should not be changed now, after this discussion <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 533591779,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760692
    },
    {
        "content": "<p>basically, rw proc can't see the goal, so it can't act like a simproc which selects subexpressions of the goal to rewrite</p>",
        "id": 533591812,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760741
    },
    {
        "content": "<p>but both <a href=\"https://github.com/leanprover-community/mathlib4/pull/28072\">#28072</a> (val tac) and <a href=\"https://github.com/leanprover-community/mathlib4/pull/28148\">#28148</a> (transpose tac) require looking at the goal</p>",
        "id": 533591835,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760770
    },
    {
        "content": "<p>your <a href=\"https://github.com/leanprover-community/mathlib4/pull/24155\">#24155</a> (eta tac) does not require looking at the goal, you customly provide <code>a</code> to be rewritten into <code>![a 0, a 1, a 2]</code></p>",
        "id": 533591855,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754760804
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533591673\">said</a>:</p>\n<blockquote>\n<p>currently I don't see how to make rw_proc work with transpose</p>\n</blockquote>\n<p>You'd maybe need to combine with the tricks in <a href=\"https://github.com/leanprover-community/mathlib4/pull/5863\">#5863</a>, though I haven't tried that yet</p>",
        "id": 533592379,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754761468
    },
    {
        "content": "<p>aha, I see</p>",
        "id": 533592511,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754761624
    },
    {
        "content": "<p>An alternative would be something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Matrix</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"kn\">local</span><span class=\"w\"> </span><span class=\"kn\">elab</span><span class=\"w\"> </span><span class=\"s2\">\"transpose_of_tac\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">tactic</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Elab</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">liftMetaFinishingTactic</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"n\">m</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">em</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">en</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)))</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferTypeQ</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"Could not infer type for eta in {h}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">em</span><span class=\"bp\">.</span><span class=\"n\">nat?</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"Matrix is not of a known size\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">en</span><span class=\"bp\">.</span><span class=\"n\">nat?</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"Matrix is not of a known size\"</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">new_rhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">en</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">em</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PiFin</span><span class=\"bp\">.</span><span class=\"n\">mkLiteralQ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">em</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ei</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">en</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">toExpr</span><span class=\"w\"> </span><span class=\"n\">i</span>\n<span class=\"w\">    </span><span class=\"n\">PiFin</span><span class=\"bp\">.</span><span class=\"n\">mkLiteralQ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">ej</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">em</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">toExpr</span><span class=\"w\"> </span><span class=\"n\">j</span>\n<span class=\"w\">      </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ej</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ei</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- have : $new_rhs =Q Matrix.etaExpand $lhs := ⟨⟩</span>\n<span class=\"w\">  </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">commitIfNoEx</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">defEq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">isDefEqQ</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">new_rhs</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"s2\">\"Could not assign RHS\"</span>\n<span class=\"w\">    </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">mvarId!</span><span class=\"bp\">.</span><span class=\"n\">assignIfDefEq</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">type_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">h</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">transpose_of</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">elems</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">elemsT</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">elems</span><span class=\"o\">)</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">elemsT</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">transpose_of_tac</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">elems</span><span class=\"o\">)</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">elemsT</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"o\">]</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">transpose_of</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">dsimp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">cons_val</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- TODO: should be part of transpose_of</span>\n</code></pre></div>\n<p>where you'd probably want to adopt your existing matching code</p>",
        "id": 533592537,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754761660
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> ok I see how to do a rw proc now, you basically want this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Matrix</span>\n\n<span class=\"c1\">-- to be autogenerated</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">transpose₂₃</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a₀₀</span><span class=\"w\"> </span><span class=\"n\">a₀₁</span><span class=\"w\"> </span><span class=\"n\">a₀₂</span><span class=\"w\"> </span><span class=\"n\">a₁₀</span><span class=\"w\"> </span><span class=\"n\">a₁₁</span><span class=\"w\"> </span><span class=\"n\">a₁₂</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"n\">a₀₀</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a₀₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a₀₂</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">a₁₀</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a₁₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a₁₂</span><span class=\"o\">]</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"n\">a₀₀</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a₁₀</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">a₀₁</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a₁₁</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">a₀₂</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a₁₂</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">etaExpand_eq</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">transpose₂₃</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 533592618,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754761771
    },
    {
        "content": "<p>is this correct?</p>",
        "id": 533592626,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754761778
    },
    {
        "content": "<p>one could probably share code between this simproc and rwproc</p>",
        "id": 533592651,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754761803
    },
    {
        "content": "<p>That's one of the ideas, yes</p>",
        "id": 533592658,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754761813
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> could you clarify what transpose_of is supposed to do (when m=2 and n=1)?</p>",
        "id": 533592742,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754761925
    },
    {
        "content": "<p>also, could you please tell me what the correct naming convention is for my PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/28148\">#28148</a> (transpose tac)?</p>",
        "id": 533592792,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754761984
    },
    {
        "content": "<p>I'll answer for 2,3 since you typed that out above. In what I wrote above, it should match <code>elems</code> against <code>![![a₀₀, a₀₁, a₀₂], [a₁₀, a₁₁, a₁₂]]</code>, assign <code>elemsT</code> to <code>![![a₀₀, a₁₀], ![a₀₁, a₁₁], ![a₀₂, a₁₂]]</code>, and then prove the resulting theorem.</p>",
        "id": 533592822,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754762029
    },
    {
        "content": "<p>oh, you can use rw like that? interesting</p>",
        "id": 533592836,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754762051
    },
    {
        "content": "<p>I should be clear that none of the conversation above is me insisting on a particular way to do things; rather, I'm sharing the half-baked thoughts on previous attempts to do similar things.</p>",
        "id": 533592895,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754762155
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- to be autogenerated</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">transpose₂₃</span>\n</code></pre></div>\n<p>one neat thing with this approach is that you could cache the lemma in the environment, and have the simproc just invoke it if it already exists</p>",
        "id": 533592973,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754762273
    },
    {
        "content": "<p>So a reasonable middle ground would be to skip the rw_proc stuff, but implement a simproc that generates that lemma internally</p>",
        "id": 533593021,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754762320
    },
    {
        "content": "<p>The code in <a href=\"https://github.com/leanprover-community/mathlib4/pull/5863\">#5863</a> might be helpful for such generation</p>",
        "id": 533593041,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754762347
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I might need some help understanding <a href=\"https://github.com/leanprover-community/mathlib4/pull/5863\">#5863</a>, I have no idea what the continuation stuff is ment to do (and I'm guessing I probably won't even need them)</p>",
        "id": 533599463,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754770707
    },
    {
        "content": "<p>The continuation stuff is a way of calling withLocalDecl monadically rather than with callbacks</p>",
        "id": 533599853,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754771247
    },
    {
        "content": "<p>interesting</p>",
        "id": 533599895,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754771329
    },
    {
        "content": "<p>Quite likely it wasn't actual a good idea</p>",
        "id": 533600420,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754772004
    },
    {
        "content": "<p>if it's a bad idea then don't do it?</p>",
        "id": 533600483,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754772097
    },
    {
        "content": "<p>so I had an even worse idea and it failed miserably</p>",
        "id": 533606206,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780045
    },
    {
        "content": "<p>which is, I would try to build the expression without going in runtime</p>",
        "id": 533606216,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780055
    },
    {
        "content": "<p>(i.e. without monad)</p>",
        "id": 533606219,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780058
    },
    {
        "content": "<p>is this because they need to check name collision at runtime?</p>",
        "id": 533606231,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780081
    },
    {
        "content": "<p>no that could totally work</p>",
        "id": 533606240,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754780092
    },
    {
        "content": "<p>it's just harder to do it that way</p>",
        "id": 533606247,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754780102
    },
    {
        "content": "<p>what exactly did you try?</p>",
        "id": 533606256,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754780113
    },
    {
        "content": "<p>yeah I can see that working, but is there a way to do it without doing .bvar?</p>",
        "id": 533606266,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780125
    },
    {
        "content": "<p>dB index is hard to calculate</p>",
        "id": 533606274,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780133
    },
    {
        "content": "<p>surely it can't be that hard</p>",
        "id": 533606280,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754780143
    },
    {
        "content": "<p>you can also rely on <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Expr.abstract#doc\">docs#Lean.Expr.abstract</a> to calculate it for you</p>",
        "id": 533606288,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754780157
    },
    {
        "content": "<p>ah, i remember now, i looked at it and saw \"extern\" and didn't want to use it XD</p>",
        "id": 533606313,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780186
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533606280\">said</a>:</p>\n<blockquote>\n<p>surely it can't be that hard</p>\n</blockquote>\n<p>if you go inside a matrix you actually have a function so the bvar increases by 2 again <span aria-label=\"melt\" class=\"emoji emoji-1fae0\" role=\"img\" title=\"melt\">:melt:</span></p>",
        "id": 533606330,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780205
    },
    {
        "content": "<p>aha, yeah, i think i found the point of failure</p>",
        "id": 533606439,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780343
    },
    {
        "content": "<p>there is no way to make it to work in the specific constraint of:</p>\n<ol>\n<li>calling <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Matrix/Notation.html#Matrix.mkLiteralQ\">Matrix.mkLiteralQ</a></li>\n<li>using only .bvar</li>\n</ol>",
        "id": 533606454,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780370
    },
    {
        "content": "<p>because the dB indexes are not constant throughout the Qq</p>",
        "id": 533606481,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780389
    },
    {
        "content": "<p>then don't use that function duh</p>",
        "id": 533606530,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754780444
    },
    {
        "content": "<p>no i think i just have to use that function with .fvar and then calculate the .bvar afterwards</p>",
        "id": 533606558,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780470
    },
    {
        "content": "<p>i mean, i'm not gonna write my own mkLiteralQ just to satisfy .bvar</p>",
        "id": 533606585,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754780510
    },
    {
        "content": "<p>oh that works too I guess</p>",
        "id": 533607003,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781063
    },
    {
        "content": "<p>how will you handle the lemmas with more than 10 rows or columns</p>",
        "id": 533607039,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781105
    },
    {
        "content": "<p>The PR I linked above already handles that</p>",
        "id": 533607109,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781186
    },
    {
        "content": "<p>Though you could also just not name any of the fvars uniquely</p>",
        "id": 533607130,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781221
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533606558\">said</a>:</p>\n<blockquote>\n<p>no i think i just have to use that function with .fvar and then calculate the .bvar afterwards</p>\n</blockquote>\n<p>This is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=mkForallFVars#doc\">docs#mkForallFVars</a> I think</p>",
        "id": 533607161,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781255
    },
    {
        "content": "<p>that's runtime</p>",
        "id": 533607178,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754781282
    },
    {
        "content": "<p>Whatever you do here is runtime</p>",
        "id": 533607211,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781327
    },
    {
        "content": "<p>I don't think you should care about whether the runtime involves MetaM or not</p>",
        "id": 533607226,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781353
    },
    {
        "content": "<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 533607237,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754781365
    },
    {
        "content": "<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 533607243,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781376
    },
    {
        "content": "<p><code>MetaM</code> carries around a lot of stuff</p>",
        "id": 533607258,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781398
    },
    {
        "content": "<p>but I guess it's less susceptible to breaking</p>",
        "id": 533607270,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781409
    },
    {
        "content": "<p>I think \"holding\" is a better metaphor than \"carrying\" since it's StateRefT</p>",
        "id": 533607294,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781451
    },
    {
        "content": "<p>And you're holding onto it whether you use it or not</p>",
        "id": 533607312,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781476
    },
    {
        "content": "<p>it just feels more morally correct to defer monad <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 533607358,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754781553
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533600420\">said</a>:</p>\n<blockquote>\n<p>Quite likely it wasn't actual a good idea</p>\n</blockquote>\n<p>To elaborate, I think a less risky approach would be a recursive helper that just makes all the variables and passes the callback an array</p>",
        "id": 533607360,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781555
    },
    {
        "content": "<p>btw Matrix.mkLiteralQ is not runtime (therefore I love it)</p>",
        "id": 533607377,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754781590
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533607377\">said</a>:</p>\n<blockquote>\n<p>btw Matrix.mkLiteralQ is not runtime (therefore I love it)</p>\n</blockquote>\n<p>what do you mean?</p>",
        "id": 533607398,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781629
    },
    {
        "content": "<p>Sure, I think once you're creating dynamic binders you're in the space that MetaM is designed to solve</p>",
        "id": 533607400,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781631
    },
    {
        "content": "<p>its return type doesn't have a monad <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span></p>",
        "id": 533607418,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754781656
    },
    {
        "content": "<p>It's still a loop that executes at runtime (unless the compiler can unroll it, but that could only happen for numeric literal sizes known at compile time)</p>",
        "id": 533607428,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781673
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533607400\">said</a>:</p>\n<blockquote>\n<p>Sure, I think once you're creating dynamic binders you're in the space that MetaM is designed to solve</p>\n</blockquote>\n<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 533607444,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754781687
    },
    {
        "content": "<p>MetaM is all about maintaining a context of local mvars and fvars and glueing them together correctly</p>",
        "id": 533607500,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781781
    },
    {
        "content": "<p>Of course this is overkill because you aren't using mvars, but I don't think there is any intermediate monad and so I think the overkill is generally accepted as fine</p>",
        "id": 533607546,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781825
    },
    {
        "content": "<p>you <em>should</em> just be able to get by with Qq quoting and an incrementing bvar counter</p>",
        "id": 533607570,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781854
    },
    {
        "content": "<p>yes, but that's for arbitrary goals, and in this case m and n are real natural numbers and the produced theorem has a fixed context</p>",
        "id": 533607574,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754781863
    },
    {
        "content": "<p>I can write this after dinner</p>",
        "id": 533607604,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781900
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533607570\">said</a>:</p>\n<blockquote>\n<p>you <em>should</em> just be able to get by with Qq quoting and an incrementing bvar counter</p>\n</blockquote>\n<p>Indeed, but i think this would be rather fragile to maintain</p>",
        "id": 533607618,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781924
    },
    {
        "content": "<p>no but it's Qq quoting</p>",
        "id": 533607624,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781935
    },
    {
        "content": "<p>it will fill in all the implicit variables for you</p>",
        "id": 533607640,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781957
    },
    {
        "content": "<p>I meant the counting bvars manually vs going via fvars</p>",
        "id": 533607642,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754781962
    },
    {
        "content": "<p>probably</p>",
        "id": 533607644,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781963
    },
    {
        "content": "<p>oh yeah</p>",
        "id": 533607661,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754781990
    },
    {
        "content": "<p>I guess putting on an array of fvars wouldn't hurt</p>",
        "id": 533607674,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754782003
    },
    {
        "content": "<p>By all means implement both versions and time them, but \"premature optimization is the root of all evil\" and all that</p>",
        "id": 533607680,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754782019
    },
    {
        "content": "<p>yeah I think I just missed the step to convert fvars to bvars and got the error \"unknown free var\" or something like that</p>",
        "id": 533607704,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754782035
    },
    {
        "content": "<p>You have to make the fvars via the API, not just by calling <code>.fvar</code> with a random name</p>",
        "id": 533607786,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754782164
    },
    {
        "content": "<p>what's the API?</p>",
        "id": 533607805,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754782195
    },
    {
        "content": "<p>The contT stuff was addressing this by trying to make the API easier to use</p>",
        "id": 533607827,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754782217
    },
    {
        "content": "<p><code>withLocalDecl</code></p>",
        "id": 533607832,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754782224
    },
    {
        "content": "<p>I think</p>",
        "id": 533607841,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754782237
    },
    {
        "content": "<p>hmm... I see a middle ground here if I believe that .fvar is bad</p>",
        "id": 533607859,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754782255
    },
    {
        "content": "<p>(I can be known to be a bit stubborn <span aria-label=\"melt\" class=\"emoji emoji-1fae0\" role=\"img\" title=\"melt\">:melt:</span> )</p>",
        "id": 533607871,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754782267
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Qq.withLocalDeclDQ#doc\">docs#Qq.withLocalDeclDQ</a> is a little nicer than that Aaron suggests</p>",
        "id": 533607880,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754782274
    },
    {
        "content": "<p>Though <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.withLocalDeclsD#doc\">docs#Lean.Meta.withLocalDeclsD</a> or nearby is the version that you'll want for an array of variables</p>",
        "id": 533608017,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754782414
    },
    {
        "content": "<p>and there is no DeclsQ? <span aria-label=\"melt\" class=\"emoji emoji-1fae0\" role=\"img\" title=\"melt\">:melt:</span></p>",
        "id": 533608035,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754782444
    },
    {
        "content": "<p>What would its type be?</p>",
        "id": 533608046,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754782463
    },
    {
        "content": "<p>No, because the array would not be homogenous</p>",
        "id": 533608049,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754782468
    },
    {
        "content": "<p>Though for your case it is, so you could add that version</p>",
        "id": 533608060,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754782484
    },
    {
        "content": "<p>You would need a dependent array</p>",
        "id": 533608063,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754782486
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"sd\">/-- ⟨∀ (α : Type u) (a : α), a = a, fun α a ↦ rfl⟩ -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkRefl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`a</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkApp3</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``Eq</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkApp2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``Eq.refl</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">mkForall</span>\n<span class=\"w\">    </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`a</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`a</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">]),</span>\n<span class=\"w\">  </span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">mkLambda</span>\n<span class=\"w\">    </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`a</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`a</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">rfl</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">])</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">test_tac</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkRefl</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferTypeQ</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">trace</span><span class=\"o\">[</span><span class=\"n\">debug</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{α}, {h}\"</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 533608640,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783325
    },
    {
        "content": "<p>now actually <em>not</em> using monad feels morally incorrect now</p>",
        "id": 533608657,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783340
    },
    {
        "content": "<p>but i guess i failed to understand why <code>.fvar</code> is a bad idea</p>",
        "id": 533608670,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783361
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> i know you're probably correct, but could you briefly explain why</p>",
        "id": 533608764,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783503
    },
    {
        "content": "<p>Well you need to ensure you have not accidentally duplicated an fvar name</p>",
        "id": 533608790,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754783536
    },
    {
        "content": "<p>that's not hard to do</p>",
        "id": 533608794,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783548
    },
    {
        "content": "<p>i just named my variables a_{i}_{j}</p>",
        "id": 533608807,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783563
    },
    {
        "content": "<p>And to interface with MetaM you need to ensure it's added to the local context and instance list</p>",
        "id": 533608839,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754783603
    },
    {
        "content": "<ol>\n<li>local context: that's the <code>.cdecl</code></li>\n<li>instance: there are no instances for transpose</li>\n</ol>",
        "id": 533608854,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783625
    },
    {
        "content": "<p>Of course, this only matters when you are using <code>MetaM</code> (or any of the other monads with a context)</p>",
        "id": 533608863,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754783637
    },
    {
        "content": "<p>If you're not in a monad it's probably fine</p>",
        "id": 533608881,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754783662
    },
    {
        "content": "<p>I think my point was that there's no custom context, there are only the variables I declared</p>",
        "id": 533608914,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783703
    },
    {
        "content": "<p>there is no custom goal, no custom local hypothesis</p>",
        "id": 533608919,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754783711
    },
    {
        "content": "<p>Then it's fine</p>",
        "id": 533608923,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754783713
    },
    {
        "content": "<p>I've never seen <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Closure.mkLambda#doc\">docs#Closure.mkLambda</a> before</p>",
        "id": 533609267,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754784108
    },
    {
        "content": "<p>Me neither</p>",
        "id": 533609279,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754784118
    },
    {
        "content": "<p>it's the same as mkForall</p>",
        "id": 533609286,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754784120
    },
    {
        "content": "<p>I'm used to only <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.mkLambdaFVars#doc\">docs#Lean.Meta.mkLambdaFVars</a></p>",
        "id": 533609451,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754784335
    },
    {
        "content": "<p>Comparing the two sounds like a question for <a class=\"stream\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4\">#lean4</a></p>",
        "id": 533609482,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754784387
    },
    {
        "content": "<p>so I'll write two transpose lemma generators and time them both?</p>",
        "id": 533609554,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754784494
    },
    {
        "content": "<p>i suppose</p>",
        "id": 533609565,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754784515
    },
    {
        "content": "<p>by the end of this week we'll have 10 transpose tactics</p>",
        "id": 533609570,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754784524
    },
    {
        "content": "<p>how do I add these to the enviornment?</p>",
        "id": 533609573,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754784527
    },
    {
        "content": "<p>never done this before</p>",
        "id": 533609576,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754784534
    },
    {
        "content": "<p>use my code above</p>",
        "id": 533609577,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754784535
    },
    {
        "content": "<p>the <code>elab</code> part</p>",
        "id": 533609589,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754784548
    },
    {
        "content": "<p>I guess I can just write the contents and worry about adding it to the environment later</p>",
        "id": 533609593,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754784551
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533609573\">said</a>:</p>\n<blockquote>\n<p>how do I add these to the enviornment?</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">transpose_tac_elab</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"s2\">\"transpose_of% \"</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">elabTermEnsuringType</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``Nat</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">elabTermEnsuringType</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``Nat</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">evalNat</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">run</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwErrorAt</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"w\"> </span><span class=\"s2\">\"Expecting a natural number, have{indentD m}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">evalNat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">run</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwErrorAt</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"w\"> </span><span class=\"s2\">\"Expecting a natural number, have{indentD n}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkTransposeProp</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">inferTypeQ</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">  </span><span class=\"n\">trace</span><span class=\"o\">[</span><span class=\"n\">debug</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"{α}\"</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">h</span>\n</code></pre></div>",
        "id": 533609607,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754784571
    },
    {
        "content": "<p>success, finally!!</p>",
        "id": 533610120,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754785304
    },
    {
        "content": "<p>actually, there's a little hiccup</p>",
        "id": 533610191,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754785426
    },
    {
        "content": "<p>I defined the level <code>u</code> to be <code>.param `u</code></p>",
        "id": 533610199,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754785442
    },
    {
        "content": "<p>take it as an argument</p>",
        "id": 533610212,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754785453
    },
    {
        "content": "<p>how does rw usually deal with u?</p>",
        "id": 533610233,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754785480
    },
    {
        "content": "<p>or maybe it should be mvar instead of param?</p>",
        "id": 533610239,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754785485
    },
    {
        "content": "<p>take the level as an argument</p>",
        "id": 533610243,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754785495
    },
    {
        "content": "<p>I understand, but I also want to know how rw works</p>",
        "id": 533610257,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754785508
    },
    {
        "content": "<p>it just elaborates the term</p>",
        "id": 533610264,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754785516
    },
    {
        "content": "<p>but how does it deal with <code>u</code>?</p>",
        "id": 533610271,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754785531
    },
    {
        "content": "<p>it doesn't</p>",
        "id": 533610279,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754785535
    },
    {
        "content": "<p>that's the term elaborator's job</p>",
        "id": 533610281,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754785541
    },
    {
        "content": "<p>you can just make a fresh level mvar</p>",
        "id": 533610321,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754785617
    },
    {
        "content": "<p>mwe:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkIdEqProof</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">rfl</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"sd\">/-- ⟨∀ {α : Type u} (a : α), id a = a, fun a ↦ rfl⟩ -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkIdEq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">zero</span>\n<span class=\"w\">  </span><span class=\"c1\">-- let u : Level := .param `u</span>\n<span class=\"w\">  </span><span class=\"c1\">-- let u : Level := .mvar ⟨`u⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`a</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkIdEqProof</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsE</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsEA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">argsE</span><span class=\"bp\">.</span><span class=\"n\">toArray</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsD</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">LocalDecl</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`a</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`a</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsDA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">LocalDecl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">argsD</span><span class=\"bp\">.</span><span class=\"n\">toArray</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">mkForall</span><span class=\"w\"> </span><span class=\"n\">argsDA</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"n\">argsEA</span><span class=\"o\">),</span>\n<span class=\"w\">  </span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">mkLambda</span><span class=\"w\"> </span><span class=\"n\">argsDA</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"n\">argsEA</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">test_tac</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkIdEq</span>\n<span class=\"w\">  </span><span class=\"n\">mkExpectedTypeHint</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">P</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">test</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 533610661,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786127
    },
    {
        "content": "<p>(I tried .mvar too and got a different error: unknown universe metavariable '?u')</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">mvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`u</span><span class=\"bp\">⟩</span>\n</code></pre></div>",
        "id": 533610714,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786221
    },
    {
        "content": "<p>maybe I'm missing the mvar equivalent of abstract?</p>",
        "id": 533610724,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786230
    },
    {
        "content": "<p>you need to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.mkFreshLevelMVar#doc\">docs#Lean.Meta.mkFreshLevelMVar</a></p>",
        "id": 533610888,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786534
    },
    {
        "content": "<p>since it needs to be added to the metavariable context</p>",
        "id": 533610896,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786546
    },
    {
        "content": "<p>hmm</p>",
        "id": 533610902,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786552
    },
    {
        "content": "<p>so this has to be runtime?</p>",
        "id": 533610905,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786557
    },
    {
        "content": "<p>to ensure unique names</p>",
        "id": 533610912,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786569
    },
    {
        "content": "<p>oh!</p>",
        "id": 533610920,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786581
    },
    {
        "content": "<p>that's the <code>?m.31415926</code> that we always see?</p>",
        "id": 533610930,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786593
    },
    {
        "content": "<p>31 million mvars is a lot</p>",
        "id": 533610937,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786613
    },
    {
        "content": "<p>usually you see smaller numbers</p>",
        "id": 533610943,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786629
    },
    {
        "content": "<p>but yeah basically that's it</p>",
        "id": 533610949,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786636
    },
    {
        "content": "<p>but the answer is yes?</p>",
        "id": 533610950,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786637
    },
    {
        "content": "<p>bad idea incoming</p>",
        "id": 533610972,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786663
    },
    {
        "content": "<p>what if i just ensure it's unique by giving it a name specific to the tactic</p>",
        "id": 533610978,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786671
    },
    {
        "content": "<p>for this case <code>?matrix_transpose_tac_2_3</code></p>",
        "id": 533610986,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786683
    },
    {
        "content": "<p>please don't</p>",
        "id": 533610988,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786685
    },
    {
        "content": "<p>is that name hardcoded?</p>",
        "id": 533610995,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786695
    },
    {
        "content": "<p>what happens if you run the tactic twice?</p>",
        "id": 533611000,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754786701
    },
    {
        "content": "<p>2 and 3 depend on the m and n</p>",
        "id": 533611007,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786705
    },
    {
        "content": "<p>ah...</p>",
        "id": 533611012,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786714
    },
    {
        "content": "<p>ey, it works!</p>",
        "id": 533611041,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786763
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Lean</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Algebra</span><span class=\"bp\">.</span><span class=\"n\">Group</span><span class=\"bp\">.</span><span class=\"n\">Defs</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkIdEqProof</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">rfl</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"sd\">/-- ⟨∀ {α : Type u} (a : α), id a = a, fun a ↦ rfl⟩ -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkIdEq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`a</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkIdEqProof</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsE</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsEA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">argsE</span><span class=\"bp\">.</span><span class=\"n\">toArray</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsD</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">LocalDecl</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`a</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`a</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsDA</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">LocalDecl</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">argsD</span><span class=\"bp\">.</span><span class=\"n\">toArray</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">mkForall</span><span class=\"w\"> </span><span class=\"n\">argsDA</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"n\">argsEA</span><span class=\"o\">),</span>\n<span class=\"w\">  </span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">mkLambda</span><span class=\"w\"> </span><span class=\"n\">argsDA</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"n\">argsEA</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">test_tac</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">mkFreshLevelMVar</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkIdEq</span><span class=\"w\"> </span><span class=\"n\">u</span>\n<span class=\"w\">  </span><span class=\"n\">mkExpectedTypeHint</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">P</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">id</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">test</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 533611046,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754786775
    },
    {
        "content": "<p>I've updated the PR.</p>",
        "id": 533611740,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754787975
    },
    {
        "content": "<p>is transpose not a definitional equality???</p>",
        "id": 533613330,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754790617
    },
    {
        "content": "<p>will I have to actually prove stuff????</p>",
        "id": 533613365,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754790663
    },
    {
        "content": "<p>what's the most efficient way to do this tranpose proofs</p>",
        "id": 533613571,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754790953
    },
    {
        "content": "<p>I guess I'll just do the cases on every number</p>",
        "id": 533614116,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754791585
    },
    {
        "content": "<p>that's like quadratic right</p>",
        "id": 533614120,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754791592
    },
    {
        "content": "<p>oh we have <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Matrix.etaExpand#doc\">docs#Matrix.etaExpand</a></p>",
        "id": 533614172,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754791675
    },
    {
        "content": "<p>oh it works</p>",
        "id": 533614238,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754791774
    },
    {
        "content": "<p>this is what I get</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">info: fun {α} r0c0 r0c1 r0c2 r0c3 r0c4 r0c5 r0c6 r1c0 r1c1 r1c2 r1c3 r1c4 r1c5 r1c6 r2c0 r2c1 r2c2 r2c3 r2c4 r2c5 r2c6 r3c0</span>\n<span class=\"sd\">    r3c1 r3c2 r3c3 r3c4 r3c5 r3c6 r4c0 r4c1 r4c2 r4c3 r4c4 r4c5 r4c6 r5c0 r5c1 r5c2 r5c3 r5c4 r5c5 r5c6 r6c0 r6c1 r6c2</span>\n<span class=\"sd\">    r6c3 r6c4 r6c5 r6c6 r7c0 =&gt;</span>\n<span class=\"sd\">  ⋯ : ∀ {α : Type u_1}</span>\n<span class=\"sd\">  (r0c0 r0c1 r0c2 r0c3 r0c4 r0c5 r0c6 r1c0 r1c1 r1c2 r1c3 r1c4 r1c5 r1c6 r2c0 r2c1 r2c2 r2c3 r2c4 r2c5 r2c6 r3c0 r3c1</span>\n<span class=\"sd\">    r3c2 r3c3 r3c4 r3c5 r3c6 r4c0 r4c1 r4c2 r4c3 r4c4 r4c5 r4c6 r5c0 r5c1 r5c2 r5c3 r5c4 r5c5 r5c6 r6c0 r6c1 r6c2 r6c3</span>\n<span class=\"sd\">    r6c4 r6c5 r6c6 r7c0 r7c1 r7c2 r7c3 r7c4 r7c5 r7c6 r8c0 r8c1 r8c2 r8c3 r8c4 r8c5 r8c6 r9c0 r9c1 r9c2 r9c3 r9c4 r9c5</span>\n<span class=\"sd\">    r9c6 r10c0 r10c1 r10c2 r10c3 r10c4 r10c5 r10c6 r11c0 r11c1 r11c2 r11c3 r11c4 r11c5 r11c6 : α),</span>\n<span class=\"sd\">  !![r0c0, r0c1, r0c2, r0c3, r0c4, r0c5, r0c6;</span>\n<span class=\"sd\">        r1c0, r1c1, r1c2, r1c3, r1c4, r1c5, r1c6;</span>\n<span class=\"sd\">        r2c0, r2c1, r2c2, r2c3, r2c4, r2c5, r2c6;</span>\n<span class=\"sd\">        r3c0, r3c1, r3c2, r3c3, r3c4, r3c5, r3c6;</span>\n<span class=\"sd\">        r4c0, r4c1, r4c2, r4c3, r4c4, r4c5, r4c6;</span>\n<span class=\"sd\">        r5c0, r5c1, r5c2, r5c3, r5c4, r5c5, r5c6;</span>\n<span class=\"sd\">        r6c0, r6c1, r6c2, r6c3, r6c4, r6c5, r6c6;</span>\n<span class=\"sd\">        r7c0, r7c1, r7c2, r7c3, r7c4, r7c5, r7c6;</span>\n<span class=\"sd\">        r8c0, r8c1, r8c2, r8c3, r8c4, r8c5, r8c6;</span>\n<span class=\"sd\">        r9c0, r9c1, r9c2, r9c3, r9c4, r9c5, r9c6;</span>\n<span class=\"sd\">        r10c0, r10c1, r10c2, r10c3, r10c4, r10c5, r10c6;</span>\n<span class=\"sd\">        r11c0, r11c1, r11c2, r11c3, r11c4, r11c5, r11c6].transpose =</span>\n<span class=\"sd\">    !![r0c0, r1c0, r2c0, r3c0, r4c0, r5c0, r6c0, r7c0, r8c0, r9c0, r10c0, r11c0;</span>\n<span class=\"sd\">      r0c1, r1c1, r2c1, r3c1, r4c1, r5c1, r6c1, r7c1, r8c1, r9c1, r10c1, r11c1;</span>\n<span class=\"sd\">      r0c2, r1c2, r2c2, r3c2, r4c2, r5c2, r6c2, r7c2, r8c2, r9c2, r10c2, r11c2;</span>\n<span class=\"sd\">      r0c3, r1c3, r2c3, r3c3, r4c3, r5c3, r6c3, r7c3, r8c3, r9c3, r10c3, r11c3;</span>\n<span class=\"sd\">      r0c4, r1c4, r2c4, r3c4, r4c4, r5c4, r6c4, r7c4, r8c4, r9c4, r10c4, r11c4;</span>\n<span class=\"sd\">      r0c5, r1c5, r2c5, r3c5, r4c5, r5c5, r6c5, r7c5, r8c5, r9c5, r10c5, r11c5;</span>\n<span class=\"sd\">      r0c6, r1c6, r2c6, r3c6, r4c6, r5c6, r6c6, r7c6, r8c6, r9c6, r10c6, r11c6]</span>\n<span class=\"sd\">-/</span>\n<span class=\"bp\">#</span><span class=\"n\">guard_msgs</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">transpose_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n</code></pre></div>",
        "id": 533614462,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754792138
    },
    {
        "content": "<p>I'll just put this here</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">specialize</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ih</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">next</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">specialize</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ih</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">next</span>\n\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"r{t/m}c{t%m}\"</span>\n<span class=\"w\">    </span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">lam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">t</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkTransposeTheorem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">array</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">emptyWithCapacity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">⟩</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">arr</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">uM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">vM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">transpose</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">uM</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">rhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">vM</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqPrf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">etaExpand</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">etaExpand_eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqExpr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">pe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``id</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">levelZero</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">eqExpr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">eqPrf</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">array</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ek</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"s2\">\"α\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">pe</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span>\n<span class=\"w\">  </span><span class=\"n\">ek</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">transpose_tac_elab</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"transpose_of% \"</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshLevelMVar</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkTransposeTheorem</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"bp\">.</span><span class=\"n\">getNat</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"bp\">.</span><span class=\"n\">getNat</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">transpose_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"mi\">7</span>\n</code></pre></div>",
        "id": 533614889,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754792725
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">15</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n\n<span class=\"c1\">-- #eval of fun (i : Fin M) (j : Fin N) ↦ finProdFinEquiv (i, j)</span>\n<span class=\"c1\">-- #eval of fun (i : Fin N) (j : Fin M) ↦ finProdFinEquiv (j, i)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">14</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">45</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">48</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">49</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">53</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">60</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">63</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">67</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">69</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">71</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">72</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">76</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">78</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">82</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">84</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">86</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">87</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">88</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">90</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">91</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">92</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">93</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">96</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">97</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">98</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">101</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">102</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">103</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">104</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">105</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">108</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">109</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">111</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">112</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">114</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">115</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">116</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">118</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">119</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">120</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">121</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">122</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">123</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">124</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">125</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">126</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">127</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">129</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">131</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">132</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">133</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">134</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">135</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">136</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">137</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">138</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">139</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">140</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">141</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">142</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">143</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">144</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">145</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">146</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">147</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">148</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">149</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">151</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">152</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">153</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">154</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">155</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">156</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">157</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">158</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">159</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">160</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">161</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">162</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">163</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">164</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">165</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">166</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">167</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">168</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">169</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">170</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">171</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">172</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">173</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">174</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">175</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">176</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">178</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">60</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">72</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">96</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">108</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">120</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">132</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">144</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">156</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">168</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">49</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">97</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">109</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">121</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">133</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">145</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">157</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">169</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">14</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">86</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">98</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">122</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">134</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">146</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">158</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">170</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">63</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">87</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">111</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">123</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">135</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">147</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">159</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">171</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">76</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">88</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">112</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">124</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">136</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">148</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">160</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">172</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">53</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">101</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">125</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">137</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">149</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">161</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">173</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">78</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">90</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">102</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">114</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">126</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">138</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">162</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">174</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">67</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">91</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">103</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">115</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">127</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">139</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">151</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">163</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">175</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">92</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">104</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">116</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">140</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">152</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">164</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">176</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">45</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">69</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">93</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">105</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">129</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">141</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">153</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">165</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">82</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">118</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">142</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">154</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">166</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">178</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">71</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">119</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">131</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">143</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">155</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">167</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"o\">]</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of'</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">matrix_transpose</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">V</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span>\n<span class=\"cm\">MathlibDemo.lean:233:8</span>\n<span class=\"cm\">[Elab.async] [0.376078] Lean.addDecl ▶</span>\n<span class=\"cm\">MathlibDemo.lean:233:0</span>\n<span class=\"cm\">[Elab.async] [2.254021] elaborating proof of Test.test1 ▶</span>\n<span class=\"cm\">MathlibDemo.lean:236:8</span>\n<span class=\"cm\">[Elab.async] [0.424043] Lean.addDecl ▶</span>\n<span class=\"cm\">MathlibDemo.lean:236:0</span>\n<span class=\"cm\">[Elab.async] [0.071033] elaborating proof of Test.test2 ▶</span>\n<span class=\"cm\">MathlibDemo.lean:239:8</span>\n<span class=\"cm\">[Elab.async] [0.390846] Lean.addDecl ▶</span>\n<span class=\"cm\">MathlibDemo.lean:239:0</span>\n<span class=\"cm\">[Elab.async] [3.175737] elaborating proof of Test.test3 ▶</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n</code></pre></div>",
        "id": 533638465,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754817878
    },
    {
        "content": "<p>I say Aaron is the clear winner here <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span></p>",
        "id": 533638474,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754817888
    },
    {
        "content": "<p>it seems like this might in part be due to the fact that the vecCons stuff is usually backwards to the usual ordering so the naive algorithm might be O(n^2) while Aaron's algorithm is O(n)?</p>",
        "id": 533638842,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754818324
    },
    {
        "content": "<p>this is a real dilemma for me, mathlib prefers using existing code, but in this case Aaron's custom equivalent of Matrix.mkLiteralQ is clearly faster</p>",
        "id": 533638863,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754818354
    },
    {
        "content": "<p>Can you make the above a mwe, I'm losing track of which version is which</p>",
        "id": 533638925,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1754818414
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c\">/-</span>\n<span class=\"cm\">Copyright (c) 2025 Kenny Lau. All rights reserved.</span>\n<span class=\"cm\">Released under Apache 2.0 license as described in the file LICENSE.</span>\n<span class=\"cm\">Authors: Kenny Lau</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">Reflection</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">!</span>\n<span class=\"cm\"># Simprocs for matrices</span>\n\n<span class=\"cm\">In this file we provide a simproc and a \"rw proc\" for transpose of explicit matrices.</span>\n\n<span class=\"cm\">Existing theorems are `Matrix.cons_transpose` and a simproc `Matrix.cons_val`, but this simproc</span>\n<span class=\"cm\">and rw proc aim to do it in one step to optimise the proof term and intermediate goal sizes.</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Matrix</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Simp</span><span class=\"w\"> </span><span class=\"n\">Simproc</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kn\">attribute</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">simp</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">cons_transpose</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"sd\">/-- Decompose a vector expression into a vector of expressions. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">piFinLit?</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_+</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">et</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">piFinLit?</span><span class=\"w\"> </span><span class=\"n\">et</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- Decompose a \"double vector\" expression, i.e. `Fin m → Fin n → R`, into a double vector of</span>\n<span class=\"sd\">expressions. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">piFinPiFinLit?</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"bp\">!</span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"bp\">_+</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">et</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">piFinLit?</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">piFinPiFinLit?</span><span class=\"w\"> </span><span class=\"n\">et</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- Decompose a matrix expression into a matrix of expressions. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">matrixLit?</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">eM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">MetaM</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Option</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">eM</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">eM</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">piFinPiFinLit?</span><span class=\"w\"> </span><span class=\"n\">eM</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">none</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">M</span>\n\n<span class=\"sd\">/-- Given a matrix of expressions, construct a proof of `(mkLiteralQ M)ᵀ = mkLiteralQ (Mᵀ)`. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkTransposeProof</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkLiteralQ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkLiteralQ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"bp\">ᵀ</span><span class=\"o\">)),</span>\n<span class=\"w\">  </span><span class=\"n\">cast</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"n\">etaExpand_eq</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">mkLiteralQ</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"bp\">ᵀ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"sd\">/-- Prove a statement of the form</span>\n<span class=\"sd\">```</span>\n<span class=\"sd\">theorem Matrix.transpose₂₃ {α : Type*} (a₀₀ a₀₁ a₀₂ a₁₀ a₁₁ a₁₂ : α) :</span>\n<span class=\"sd\">    !![a₀₀, a₀₁, a₀₂; a₁₀, a₁₁, a₁₂]ᵀ = !![a₀₀, a₁₀; a₀₁, a₁₁; a₀₂, a₁₂] :=</span>\n<span class=\"sd\">  (etaExpand_eq _).symm</span>\n<span class=\"sd\">```</span>\n<span class=\"sd\">Returns the type of this statement and its proof. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkTransposeProp</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">P</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">varName</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"s2\">\"a_\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">repr</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"s2\">\"_\"</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">repr</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toName</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">varName</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">pf'</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkTransposeProof</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsE</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">++</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">finRange</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">flatMap</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">ofFn</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">argsD</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">LocalDecl</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"ss\">`α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">++</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">finRange</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">flatMap</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">ofFn</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">↦</span>\n<span class=\"w\">      </span><span class=\"bp\">.</span><span class=\"n\">cdecl</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">finProdFinEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">varName</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">varName</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span>\n<span class=\"w\">  </span><span class=\"bp\">⟨</span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">mkForall</span><span class=\"w\"> </span><span class=\"n\">argsD</span><span class=\"bp\">.</span><span class=\"n\">toArray</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">P'</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"n\">argsE</span><span class=\"bp\">.</span><span class=\"n\">toArray</span><span class=\"o\">),</span>\n<span class=\"w\">  </span><span class=\"n\">Closure</span><span class=\"bp\">.</span><span class=\"n\">mkLambda</span><span class=\"w\"> </span><span class=\"n\">argsD</span><span class=\"bp\">.</span><span class=\"n\">toArray</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">pf'</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"n\">argsE</span><span class=\"bp\">.</span><span class=\"n\">toArray</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Qq</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"n\">Tactic</span>\n\n<span class=\"sd\">/-- A custom theorem for reducing transpose of explicit matrices. For example, `transpose_of% 2 3`</span>\n<span class=\"sd\">is the theorem saying `!![a, b, c; d, e, f]ᵀ = !![a, d; b, e; c, f]`. Usage:</span>\n\n<span class=\"sd\">```lean</span>\n<span class=\"sd\">example : (!![1, 2, 3; 4, 5, 6]ᵀ : Matrix (Fin (2+1)) (Fin 2) ℤ) = !![1, 4; 2, 5; 3, 6] := by</span>\n<span class=\"sd\">  rw [transpose_of% 2 3]</span>\n<span class=\"sd\">``` -/</span>\n<span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">transpose_tac_elab</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"s2\">\"transpose_of% \"</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"bp\">.</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">mkFreshLevelMVar</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">elabTermEnsuringType</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``Nat</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">Term</span><span class=\"bp\">.</span><span class=\"n\">elabTermEnsuringType</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mkConst</span><span class=\"w\"> </span><span class=\"ss\">``Nat</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">evalNat</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">run</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwErrorAt</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"w\"> </span><span class=\"s2\">\"Expecting a natural number, have{indentD m}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">evalNat</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">run</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwErrorAt</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"w\"> </span><span class=\"s2\">\"Expecting a natural number, have{indentD n}\"</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkTransposeProp</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">checkTypeQ</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">throwError</span><span class=\"w\"> </span><span class=\"n\">m!</span><span class=\"s2\">\"Wrong proof generated for {m}, {n}.\"</span>\n<span class=\"w\">  </span><span class=\"n\">mkExpectedTypeHint</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">P</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hu</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">u</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hu</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hv</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- Here we use the convention that `e{name}` is the expression for `{name}`, e.g. `eMT` is the</span>\n<span class=\"c1\">-- expression corresponding to the transpose of the matrix `M`.</span>\n<span class=\"sd\">/-- A simproc for terms of the form `Matrix.transpose (Matrix.of _)`. Usage:</span>\n\n<span class=\"sd\">```lean</span>\n<span class=\"sd\">example : (!![1, 2, 3; 4, 5, 6]ᵀ : Matrix (Fin (2+1)) (Fin 2) ℤ) = !![1, 4; 2, 5; 3, 6] := by</span>\n<span class=\"sd\">  simp</span>\n<span class=\"sd\">```</span>\n<span class=\"sd\">-/</span>\n<span class=\"n\">simproc</span><span class=\"w\"> </span><span class=\"n\">matrix_transpose</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">transpose</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofQ</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">eMT</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">en</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">OfNat</span><span class=\"bp\">.</span><span class=\"n\">ofNat</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">em</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">transpose</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">eM</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">eMT</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">matrixLit?</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">em</span><span class=\"bp\">.</span><span class=\"n\">natLit!</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">en</span><span class=\"bp\">.</span><span class=\"n\">natLit!</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">eM</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkTransposeProof</span><span class=\"w\"> </span><span class=\"n\">M</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">continue</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">visit</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rhs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">proof?</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">some</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">}</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℤ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hu</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">u</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hu</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">matrix_transpose</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hv</span><span class=\"o\">]</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">specialize</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ih</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">next</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">specialize</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ih</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">next</span>\n\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"r{t/m}c{t%m}\"</span>\n<span class=\"w\">    </span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">lam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">t</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkTransposeTheorem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">array</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">emptyWithCapacity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">⟩</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">arr</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">uM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">vM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">transpose</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">uM</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">rhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">vM</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqPrf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">etaExpand</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">etaExpand_eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqExpr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">pe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``id</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">levelZero</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">eqExpr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">eqPrf</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">array</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ek</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"s2\">\"α\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">pe</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span>\n<span class=\"w\">  </span><span class=\"n\">ek</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">transpose_tac_elab'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"transpose_of'% \"</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshLevelMVar</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">mkTransposeTheorem</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"bp\">.</span><span class=\"n\">getNat</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"bp\">.</span><span class=\"n\">getNat</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">15</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n\n<span class=\"c1\">-- #eval of fun (i : Fin M) (j : Fin N) ↦ finProdFinEquiv (i, j)</span>\n<span class=\"c1\">-- #eval of fun (i : Fin N) (j : Fin M) ↦ finProdFinEquiv (j, i)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">14</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">45</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">48</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">49</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">53</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">60</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">63</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">67</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">69</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">71</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">72</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">76</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">78</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">82</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">84</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">86</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">87</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">88</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">90</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">91</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">92</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">93</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">96</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">97</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">98</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">101</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">102</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">103</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">104</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">105</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">108</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">109</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">111</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">112</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">114</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">115</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">116</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">118</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">119</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">120</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">121</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">122</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">123</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">124</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">125</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">126</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">127</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">129</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">131</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">132</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">133</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">134</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">135</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">136</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">137</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">138</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">139</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">140</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">141</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">142</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">143</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">144</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">145</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">146</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">147</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">148</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">149</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">151</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">152</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">153</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">154</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">155</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">156</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">157</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">158</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">159</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">160</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">161</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">162</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">163</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">164</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">165</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">166</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">167</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">168</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">169</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">170</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">171</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">172</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">173</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">174</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">175</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">176</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">178</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">60</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">72</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">96</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">108</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">120</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">132</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">144</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">156</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">168</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">49</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">97</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">109</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">121</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">133</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">145</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">157</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">169</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">14</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">86</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">98</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">122</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">134</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">146</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">158</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">170</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">63</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">87</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">111</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">123</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">135</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">147</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">159</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">171</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">76</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">88</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">112</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">124</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">136</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">148</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">160</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">172</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">53</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">101</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">125</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">137</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">149</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">161</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">173</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">78</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">90</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">102</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">114</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">126</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">138</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">162</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">174</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">67</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">91</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">103</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">115</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">127</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">139</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">151</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">163</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">175</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">92</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">104</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">116</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">140</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">152</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">164</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">176</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">45</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">69</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">93</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">105</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">129</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">141</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">153</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">165</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">82</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">118</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">142</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">154</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">166</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">178</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">71</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">119</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">131</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">143</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">155</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">167</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"o\">]</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of'</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">matrix_transpose</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">V</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 533638946,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754818449
    },
    {
        "content": "<p>there you go <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span></p>",
        "id": 533638961,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754818463
    },
    {
        "content": "<p>actually i'm a bit confused, i thought <code>have</code> deletes data</p>",
        "id": 533640048,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754819619
    },
    {
        "content": "<p>oh god, that's a tactic thing</p>",
        "id": 533640123,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754819708
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n<span class=\"w\">  </span><span class=\"n\">n</span>\n\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"c1\">-- 37</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">37</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n<span class=\"w\">  </span><span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 533640124,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754819710
    },
    {
        "content": "<p>wait, no, it's also not true for Props</p>",
        "id": 533640173,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754819764
    },
    {
        "content": "<p>aha, you can't access <code>have</code> from inside the definition, the same is also true for <code>foo</code> above  (I believe that's the \"nondep\" part)</p>",
        "id": 533640211,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754819802
    },
    {
        "content": "<p>but outside the definition it remembers the value</p>",
        "id": 533640213,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754819809
    },
    {
        "content": "<p>huh, that <code>uVec</code> is quite interesting, I think given (m,k) = (4,0) it goes through (4,0) -&gt; (3,1) -&gt; (2,2) -&gt; (1,3) -&gt; (0,4) <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 533640912,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754820454
    },
    {
        "content": "<p>right, the logic is <code>uVec n 4 0 ![] = ![a0, a1, a2, a3] = uVec n 3 1 ![a3]</code></p>",
        "id": 533641140,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754820664
    },
    {
        "content": "<p><code>k</code> is actually tracking the length of the subvector currently stored in ih</p>",
        "id": 533641149,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754820684
    },
    {
        "content": "<p>I think I see how to make it mathlib compliant, assuming that this was the bottleneck to begin with?</p>",
        "id": 533641470,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754821058
    },
    {
        "content": "<p>i'm not really sure at this point what the main slowdown is</p>",
        "id": 533641485,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754821073
    },
    {
        "content": "<p>I don't understand this, every step i make to make it more \"mathlib compliant\" slows down the proof more</p>",
        "id": 533642163,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754821762
    },
    {
        "content": "<p>actually, that's wrong, (i forgot i changed the testcase)</p>",
        "id": 533642386,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754821962
    },
    {
        "content": "<p>my more compliant code is currently faster actually</p>",
        "id": 533642394,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754821971
    },
    {
        "content": "<p>0.16 s for Aaron's original code, and 0.13 s for my edit</p>",
        "id": 533642425,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754822004
    },
    {
        "content": "<p>aha, that <code>id</code> trick is neat</p>",
        "id": 533642837,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754822464
    },
    {
        "content": "<p>in this situation we want to prove <code>$lhs = $rhs</code> but we only have a proof <code>h</code> of <code>$lhs = $rhs'</code> where we know that <code>$rhs'</code> is defeq to <code>$rhs</code>, then the proof is:<br>\n<code>@id ($lhs = $rhs) h</code></p>",
        "id": 533642919,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754822524
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">Reflection</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Lean</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Tactic</span><span class=\"w\"> </span><span class=\"n\">Simp</span><span class=\"w\"> </span><span class=\"n\">Qq</span><span class=\"w\"> </span><span class=\"n\">Elab</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Matrix</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Aaron</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">specialize</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ih</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">next</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">specialize</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ih</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">next</span>\n\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"r{t/m}c{t%m}\"</span>\n<span class=\"w\">    </span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">lam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">t</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkTransposeTheorem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"ss\">`α</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">FVarId</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">array</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Id</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mut</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"bp\">.</span><span class=\"n\">emptyWithCapacity</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">      </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">[:</span><span class=\"n\">m</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">        </span><span class=\"n\">arr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">push</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">⟩</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">arr</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">uM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">vM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">    </span><span class=\"n\">uMatrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"bp\">.</span><span class=\"n\">vecEmpty</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">transpose</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">uM</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">rhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">vM</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqPrf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">etaExpand</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">etaExpand_eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqExpr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">pe</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``id</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">levelZero</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">eqExpr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">eqPrf</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">array</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ek</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">str</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"s2\">\"α\"</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">coabst</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"n\">pe</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span>\n<span class=\"w\">  </span><span class=\"n\">ek</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Aaron</span>\n\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Aaron2</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">specialize</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"c1\">-- k ≤ m</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ih</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">specialize</span><span class=\"kd\">]</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">uVecVec</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"c1\">-- k ≤ n</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">ih</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">uVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">!</span><span class=\"o\">[])</span>\n<span class=\"w\">    </span><span class=\"n\">uVecVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">vecCons</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ih</span><span class=\"o\">)</span>\n\n<span class=\"sd\">/-- Converts `f #0 #1 #2` to `fun a₀ a₁ a₂ ↦ f a₀ a₁ a₂`.</span>\n\n<span class=\"sd\">This assumes they are all explicit variables with the same type. -/</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkLambdas</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">names</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Expr</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">names</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">lam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">b'</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">default</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mkTransposeTheorem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Level</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">anonymous</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">fvar</span><span class=\"w\"> </span><span class=\"bp\">⟨.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">uM</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">uVecVec</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">!</span><span class=\"o\">[])))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">uM</span><span class=\"bp\">ᵀ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">rhs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"o\">(</span><span class=\"n\">uVecVec</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">flip</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">!</span><span class=\"o\">[])))</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqProp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqPrf'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">etaExpand</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">((</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">etaExpand_eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">eqPrf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">lhs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">rhs</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkApp2</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">const</span><span class=\"w\"> </span><span class=\"ss\">``id</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">.</span><span class=\"n\">zero</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">eqProp</span><span class=\"w\"> </span><span class=\"n\">eqPrf'</span>\n<span class=\"w\">  </span><span class=\"c1\">--have equiv : Fin (n * m) ≃ Fin n × Fin m := finProdFinEquiv.symm</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">names</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofFn</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">s!</span><span class=\"s2\">\"r{t/m}c{t%m}\"</span><span class=\"bp\">.</span><span class=\"n\">toName</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Array</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofFn</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">nam</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"bp\">/</span><span class=\"n\">m</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">t</span><span class=\"bp\">%</span><span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">lam_eqPrf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mkLambdas</span><span class=\"w\"> </span><span class=\"n\">names</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">eqPrf</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">.</span><span class=\"n\">lam</span><span class=\"w\"> </span><span class=\"ss\">`α</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">lam_eqPrf</span><span class=\"bp\">.</span><span class=\"n\">abstract</span><span class=\"w\"> </span><span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">implicit</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Aaron2</span>\n\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">transpose_tac_elab_aaron</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"transpose_of_aaron% \"</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshLevelMVar</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">Aaron</span><span class=\"bp\">.</span><span class=\"n\">mkTransposeTheorem</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"bp\">.</span><span class=\"n\">getNat</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"bp\">.</span><span class=\"n\">getNat</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"w\"> </span><span class=\"n\">Elab</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">elab</span><span class=\"o\">:</span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">transpose_tac_elab_aaron2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"s2\">\"transpose_of_aaron2% \"</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"o\">:</span><span class=\"n\">num</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">term</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">mkFreshLevelMVar</span>\n<span class=\"w\">  </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">Aaron2</span><span class=\"bp\">.</span><span class=\"n\">mkTransposeTheorem</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">mStx</span><span class=\"bp\">.</span><span class=\"n\">getNat</span><span class=\"w\"> </span><span class=\"n\">nStx</span><span class=\"bp\">.</span><span class=\"n\">getNat</span>\n\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">transpose_of_aaron</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"bp\">#</span><span class=\"n\">check</span><span class=\"w\"> </span><span class=\"n\">transpose_of_aaron2</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">23</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">21</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">  #eval of fun (i : Fin M) (j : Fin N) ↦ finProdFinEquiv (i, j)</span>\n<span class=\"cm\"> #eval of fun (i : Fin N) (j : Fin M) ↦ finProdFinEquiv (j, i) -/</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">14</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">45</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">49</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">53</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">60</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">63</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">67</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">69</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">71</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">72</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">76</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">78</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">82</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">84</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">86</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">87</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">88</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">90</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">91</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">92</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">93</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">96</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">97</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">98</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">101</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">102</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">103</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">104</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">105</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">108</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">109</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">111</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">112</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">114</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">115</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">116</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">118</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">119</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">120</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">121</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">122</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">123</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">124</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">125</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">126</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">127</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">129</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">131</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">132</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">133</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">134</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">135</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">136</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">137</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">138</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">139</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">140</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">141</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">142</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">143</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">144</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">145</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">146</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">147</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">148</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">149</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">151</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">152</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">153</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">154</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">155</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">156</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">157</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">158</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">159</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">160</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">161</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">162</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">163</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">164</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">165</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">166</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">167</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">168</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">169</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">170</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">171</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">172</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">173</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">174</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">175</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">176</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">178</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">180</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">181</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">182</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">183</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">184</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">185</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">186</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">187</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">188</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">189</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">190</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">191</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">192</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">193</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">194</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">195</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">196</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">197</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">198</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">199</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">201</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">202</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">203</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">204</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">205</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">206</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">207</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">208</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">209</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">210</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">211</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">212</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">213</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">214</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">215</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">216</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">217</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">218</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">219</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">220</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">221</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">222</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">223</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">224</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">225</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">226</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">227</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">228</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">229</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">230</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">231</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">232</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">233</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">234</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">235</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">236</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">238</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">239</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">240</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">241</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">242</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">243</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">244</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">245</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">246</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">247</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">248</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">249</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">250</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">251</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">252</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">253</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">254</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">255</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">257</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">258</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">259</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">260</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">261</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">262</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">263</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">264</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">265</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">266</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">267</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">268</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">269</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">270</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">271</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">273</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">274</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">275</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">276</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">277</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">278</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">279</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">280</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">281</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">282</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">283</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">284</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">285</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">286</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">287</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">288</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">289</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">290</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">291</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">292</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">293</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">294</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">295</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">296</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">297</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">298</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">299</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">301</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">302</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">303</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">304</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">305</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">306</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">307</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">308</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">309</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">310</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">311</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">312</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">313</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">314</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">315</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">316</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">317</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">318</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">319</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">320</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">321</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">322</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">323</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">324</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">325</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">326</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">327</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">328</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">329</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">330</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">331</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">332</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">333</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">334</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">335</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">336</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">337</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">338</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">339</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">340</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">341</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">342</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">343</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">344</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">345</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">346</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">347</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">348</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">349</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">350</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">351</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">353</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">354</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">355</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">356</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">357</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">358</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">359</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">360</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">361</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">362</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">363</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">364</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">365</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">366</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">367</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">368</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">369</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">370</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">371</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">372</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">373</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">374</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">375</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">376</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">377</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">378</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">379</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">380</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">381</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">382</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">383</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">384</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">385</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">386</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">387</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">388</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">389</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">390</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">391</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">392</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">393</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">394</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">395</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">396</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">397</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">398</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">399</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">400</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">401</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">402</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">403</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">404</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">405</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">406</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">407</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">408</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">409</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">410</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">411</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">412</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">413</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">414</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">415</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">416</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">417</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">418</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">419</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">420</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">421</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">422</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">423</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">424</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">425</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">426</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">427</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">428</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">429</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">430</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">431</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">432</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">433</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">434</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">435</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">436</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">437</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">438</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">439</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">440</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">441</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">442</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">443</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">444</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">445</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">446</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">447</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">448</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">449</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">450</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">451</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">452</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">453</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">454</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">455</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">456</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">457</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">458</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">459</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">460</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">461</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">462</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">463</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">464</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">465</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">466</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">467</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">468</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">469</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">470</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">471</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">472</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">473</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">474</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">475</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">476</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">477</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">478</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">479</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">480</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">481</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">482</span><span class=\"o\">]</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Matrix</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">63</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">84</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">105</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">126</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">147</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">168</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">189</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">210</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">231</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">252</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">273</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">294</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">315</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">336</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">357</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">378</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">399</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">420</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">441</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">462</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">106</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">127</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">148</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">169</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">190</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">211</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">232</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">253</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">274</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">295</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">316</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">337</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">358</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">379</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">400</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">421</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">442</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">463</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">86</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">107</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">149</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">170</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">191</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">212</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">233</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">254</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">275</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">296</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">317</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">338</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">359</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">380</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">401</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">422</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">443</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">464</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">45</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">87</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">108</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">129</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">150</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">171</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">192</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">213</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">234</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">255</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">276</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">297</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">318</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">339</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">360</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">381</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">402</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">423</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">444</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">465</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">67</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">88</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">109</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">151</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">172</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">193</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">214</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">235</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">256</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">277</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">298</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">319</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">340</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">361</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">382</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">403</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">424</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">445</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">466</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">110</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">131</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">152</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">173</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">194</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">215</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">236</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">257</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">278</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">299</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">320</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">341</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">362</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">383</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">404</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">425</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">446</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">467</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">69</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">90</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">111</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">132</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">153</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">174</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">195</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">216</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">237</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">258</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">279</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">300</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">321</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">342</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">363</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">384</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">405</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">426</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">447</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">468</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">49</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">91</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">112</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">133</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">154</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">175</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">196</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">217</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">238</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">259</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">280</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">301</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">322</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">343</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">364</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">385</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">406</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">427</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">448</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">469</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">71</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">92</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">113</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">134</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">155</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">176</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">197</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">218</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">239</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">260</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">281</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">302</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">323</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">344</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">365</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">386</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">407</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">428</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">449</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">470</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">72</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">93</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">114</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">135</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">156</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">177</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">198</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">219</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">240</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">261</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">282</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">303</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">324</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">345</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">366</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">387</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">408</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">429</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">450</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">471</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">115</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">136</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">157</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">178</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">199</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">220</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">241</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">262</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">283</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">304</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">325</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">346</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">367</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">388</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">409</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">430</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">451</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">472</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">53</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">116</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">137</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">158</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">179</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">200</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">221</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">242</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">263</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">284</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">305</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">326</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">347</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">368</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">389</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">410</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">431</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">452</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">473</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">96</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">138</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">159</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">180</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">201</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">222</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">243</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">264</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">285</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">306</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">327</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">348</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">369</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">390</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">411</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">432</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">453</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">474</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">13</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">76</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">97</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">118</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">139</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">160</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">181</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">202</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">223</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">244</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">265</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">286</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">307</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">328</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">349</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">370</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">391</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">412</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">433</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">454</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">475</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">98</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">119</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">140</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">161</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">182</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">203</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">224</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">245</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">266</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">287</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">308</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">329</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">350</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">371</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">392</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">413</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">434</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">455</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">476</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">15</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">78</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">120</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">141</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">162</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">183</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">204</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">225</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">246</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">267</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">288</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">309</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">330</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">351</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">372</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">393</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">414</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">435</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">456</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">477</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">16</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">100</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">121</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">142</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">163</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">184</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">205</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">226</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">247</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">268</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">289</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">310</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">331</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">352</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">373</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">394</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">415</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">436</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">457</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">478</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">101</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">122</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">143</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">164</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">185</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">206</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">227</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">248</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">269</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">290</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">311</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">332</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">353</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">374</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">395</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">416</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">437</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">458</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">479</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">18</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">60</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">102</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">123</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">144</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">165</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">186</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">207</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">228</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">249</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">270</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">291</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">312</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">333</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">354</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">375</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">396</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">417</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">438</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">459</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">480</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">19</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">82</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">103</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">124</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">145</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">166</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">187</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">208</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">229</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">250</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">271</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">292</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">313</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">334</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">355</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">376</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">397</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">418</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">439</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">460</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">481</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">20</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">104</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">125</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">146</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">167</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">188</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">209</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">230</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">251</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">272</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">293</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">314</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">335</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">356</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">377</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">398</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">419</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">440</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">461</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">482</span><span class=\"o\">]</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of_aaron</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">test2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of_aaron2</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Test</span>\n</code></pre></div>",
        "id": 533643960,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754823703
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I have cleaned up Aaron's code into Aaron2 above and compared them side by side with a 23-by-21 matrix, and they have about the same runtime (how do I time this more accurately, say looping 100 times?)</p>",
        "id": 533643987,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754823746
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span> I think I'll PR the cleaned version of your code to Mathlib to replace <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Fin/VecNotation.html#PiFin.mkLiteralQ\">PiFin.mkLiteralQ</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Matrix/Notation.html#Matrix.mkLiteralQ\">Matrix.mkLiteralQ</a></p>",
        "id": 533648697,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754828531
    },
    {
        "content": "<p>for (my own) reference, I think <code>uVecVec</code> above can be safely converted to two applications of <code>uVec</code> without any performance hit, which means that the existing Matrix.mkLiteralQ should be performantically equivalent to Aaron's new code</p>",
        "id": 533649880,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754830075
    },
    {
        "content": "<p>made <a href=\"https://github.com/leanprover-community/mathlib4/pull/28180\">#28180</a></p>",
        "id": 533650079,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754830314
    },
    {
        "content": "<p>heartbeats profile: (test matrix is 23-by-21)<br>\nTest 1 (Aaron's original code):<br>\naddDecl = 10431971, elab = 2106794<br>\nTest 2 (cleanup):<br>\naddDecl = 10431970, elab = 2111035<br>\nTest 3 (cleanup, but use the builtin <code>Matarix.mkLiteralQ</code>):<br>\naddDecl = 10431977, elab = 2108795</p>",
        "id": 533650968,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754831365
    },
    {
        "content": "<p>with original code (12-by-7 matrix):</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>proc            | addDecl | elab\n====================================\nKenny's simproc | 938450  | 711617\nKenny's rwproc  | 943157  | 10258669\nAaron 1         | 932454  | 428985\nAaron 2         | 932453  | 429734\nAaron 3         | 932460  | 429281\n</code></pre></div>",
        "id": 533651282,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754831733
    },
    {
        "content": "<p>so safe to say i'll be yeeting the rwproc and replacing it with Aaron 3 in <a href=\"https://github.com/leanprover-community/mathlib4/pull/28148\">#28148</a></p>",
        "id": 533651305,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754831765
    },
    {
        "content": "<p>done</p>",
        "id": 533655889,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754836686
    },
    {
        "content": "<p>By the way, I don't know why my version is faster</p>",
        "id": 533657967,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1754838972
    },
    {
        "content": "<p>well I suspect it's because my code use list and append and also a bunch of localdecls</p>",
        "id": 533658027,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754839064
    },
    {
        "content": "<p>whereas your code just builds the fvars and uses abstract</p>",
        "id": 533658046,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754839078
    },
    {
        "content": "<p>I have cooked</p>",
        "id": 533748600,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754905858
    },
    {
        "content": "<p>I see a way to remove <code>% 2 3</code>!</p>",
        "id": 533748621,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754905867
    },
    {
        "content": "<p>heartbeats result:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">finProdFinEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span>\n<span class=\"bp\">#</span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fin</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">finProdFinEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">28</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">35</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">45</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">49</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">53</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">60</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">63</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">67</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">69</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">70</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">71</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">72</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">76</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">78</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">82</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"o\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">!!</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">14</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">28</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">49</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">56</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">63</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">70</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">77</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">29</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">43</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">50</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">71</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">78</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">37</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">65</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">72</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">45</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">52</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">66</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">73</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">25</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">46</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">53</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">60</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">67</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">26</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">33</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">40</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">47</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">54</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">61</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">68</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">82</span><span class=\"bp\">;</span>\n<span class=\"w\">  </span><span class=\"mi\">6</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">13</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">34</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">41</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">55</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">69</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">76</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"o\">]</span>\n\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">trace</span><span class=\"bp\">.</span><span class=\"n\">profiler</span><span class=\"bp\">.</span><span class=\"n\">useHeartbeats</span><span class=\"w\"> </span><span class=\"n\">true</span>\n<span class=\"c1\">-- 547742</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n<span class=\"c1\">-- 428366</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n<span class=\"c1\">-- 547801</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">U</span><span class=\"bp\">ᵀ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">U</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">transpose_of</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">V</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 533760595,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754909712
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> do you want to keep <code>transpose_of%</code> given that it has fewer heartbeats than the new <code>transpose_of</code>?</p>",
        "id": 533760672,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754909742
    },
    {
        "content": "<p>Also, might it be a good idea to incorporate this into <a href=\"https://github.com/leanprover-community/mathlib4/blob/2f21638cd958b4b8e8acd44291730f81398ae2dc/Mathlib/Data/Matrix/Auto.lean\">Mathlib/Data/Matrix/Auto.lean</a>?</p>",
        "id": 533763528,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1754910711
    },
    {
        "content": "<p>is everyone happy with <a href=\"https://github.com/leanprover-community/mathlib4/pull/28148\">#28148</a>?</p>",
        "id": 534822626,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1755435983
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2328148.20Simproc.20for.20Matrix.20Transpose/near/533760672\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> do you want to keep <code>transpose_of%</code> given that it has fewer heartbeats than the new <code>transpose_of</code>?</p>\n</blockquote>\n<p>I haven't any much time to look I'm afraid</p>",
        "id": 534868147,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1755490847
    }
]