[
    {
        "content": "<p>This PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/21525\">#21525</a> brings locally cartesian closed categories (LCCCs) to mathlib. With <span class=\"user-mention\" data-user-id=\"246635\">@Emily Riehl</span> we formalized LCCCs last summer at HIM to support the formalization of polynomial functors here: <a href=\"https://github.com/sinhp/Poly\">https://github.com/sinhp/Poly</a></p>\n<p>Currently, the CI gives me an interesting build-error which I spent couple of hours trying to debug without success. The error is a bit bizarre: </p>\n<blockquote>\n<p><code>âœ– [6038/6042] Building Mathlib.CategoryTheory.Galois.Examples</code><br>\n<code>error: ././././Mathlib/CategoryTheory/Galois/Examples.lean:105:17: application type mismatch\n  @IsConnected (Action.FintypeCat.ofMulAction G X)\nargument\n  Action.FintypeCat.ofMulAction G X\nhas type\n  Action FintypeCat (MonCat.of G) : Type (u + 1)\nbut is expected to have type\n  Type ?u.27516 : Type (?u.27516 + 1)</code></p>\n</blockquote>\n<p>LCCCs have nothing to do with <code>CategoryTheory.Galois</code>, so this error was surprising. The only thing I could think of is the following possibility:<br>\n<code>CategoryTheory.Galois.Examples</code> has a transitive import of <code>CategoryTheory.Adjunction.Over</code> and the latter is one of the only two files that got changed in this PR -- the other is the newly created file <code>CategoryTheory.LocallyCartesianClosed.Basic.lean</code>.  Now, in <code>CategoryTheory.Adjunction.Over</code> an instance of <code>IsConnected</code> -- the expression appearing in the error message -- is _implicitly_ used in order to infer that <code>Over</code> categories have finite products. Indeed the instance </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"n\">hasFiniteLimits</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">âˆ€</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">158142</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Category</span><span class=\"bp\">.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">158141</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?</span><span class=\"n\">u</span><span class=\"bp\">.</span><span class=\"m\">158142</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inst_1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasFiniteWidePullbacks</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">],</span>\n<span class=\"w\">  </span><span class=\"n\">HasFiniteLimits</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Over</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>has been used in synthesizing the monoidal structure on <code>Over X</code>.  Be it as it may, I still do not not see how all this makes the above-mentioned error about <code>IsConnected</code> in the <code>Galois.Examples</code> file. It's possible the source of the error is something different/simpler. </p>\n<p>Maybe someone here with better debugging experience in mathlib can help?</p>",
        "id": 498346104,
        "sender_full_name": "Sina Hazratpour ð“ƒµ",
        "timestamp": 1738936533
    },
    {
        "content": "<p>From a brief look, I think what is going on here is that the <code>IsConnected</code> in <code>Mathlib.CategoryTheory.Galois.Examples</code> refers to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.PreGaloisCategory.IsConnected#doc\">docs#CategoryTheory.PreGaloisCategory.IsConnected</a>, not <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.IsConnected#doc\">docs#CategoryTheory.IsConnected</a>. On master, <code>Mathlib.CategoryTheory.Galois.Examples</code> does not import <code>Mathlib.CategoryTheory.IsConnected</code>, hence <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.IsConnected#doc\">docs#CategoryTheory.IsConnected</a> is not visible.</p>\n<p>But now your PR changes the import tree such that now <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=CategoryTheory.IsConnected#doc\">docs#CategoryTheory.IsConnected</a> is available in <code>Mathlib.CategoryTheory.Galois.Examples</code> and now Lean interprets the <code>IsConnected</code> as <code>CategoryTheory.IsConnected</code> and no longer as <code>CategoryTheory.PreGaloisCategory.IsConnected</code>.</p>\n<p>As a quick fix, you could replace the <code>IsConnected</code> by <code>PreGaloisCategory.IsConnected</code>,  to make sure this is indeed the cause. For the PR, you probably want to dis-entangle the imports so that this import bump does not happen.</p>",
        "id": 498347899,
        "sender_full_name": "Christian Merten",
        "timestamp": 1738936997
    },
    {
        "content": "<p>Good catch, that does fix the error</p>",
        "id": 498349054,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738937332
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"648495\">@Christian Merten</span> Thanks, good catch! I think i am done with LCCCs and want to PR it, so it would be great to do it the right way to disentangle the imports. I am hesitant in changing anything in <code>Mathlib.CategoryTheory.Galois.Examples</code>, is there a way to do that avoiding the import bump?</p>",
        "id": 498351554,
        "sender_full_name": "Sina Hazratpour ð“ƒµ",
        "timestamp": 1738938051
    },
    {
        "content": "<p>I would search for a good splitting point of <code>Mathlib/CategoryTheory/Adjunction/Over.lean</code>. Maybe look for which of your results you need the extra imports. Currently this file has +50% imports, so this you probably have to change anyway. My guess is that this will be sufficient to avoid the import bump in <code>Mathlib.CategoryTheory.Galois.Examples</code>.</p>",
        "id": 498352185,
        "sender_full_name": "Christian Merten",
        "timestamp": 1738938243
    },
    {
        "content": "<p>I would just do the quick fix and ask the reviewers for advice</p>",
        "id": 498352969,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1738938467
    },
    {
        "content": "<p>I see! Alright, I'll have a look and think about it. I had run <code>#min_imports</code> at the bottom of the <code>Mathlib/CategoryTheory/Adjunction/Over.lean</code> to minimize imports. Other than, I don't know a way other than putting some of the results using <code>IsConnected</code> instance in <code>Adjunction.Over</code> into another file (possibly in an appropriate namespace in <code>LocallyCartesianClosed.Basic</code> which is not imported anywhere else so far). </p>\n<p><span class=\"user-mention\" data-user-id=\"307953\">@Ruben Van de Velde</span> good idea!</p>",
        "id": 498353223,
        "sender_full_name": "Sina Hazratpour ð“ƒµ",
        "timestamp": 1738938534
    }
]