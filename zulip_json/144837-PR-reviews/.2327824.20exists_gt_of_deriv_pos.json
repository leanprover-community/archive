[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"703970\">@Etienne Marion</span> last looked at this PR by <span class=\"user-mention\" data-user-id=\"110044\">@Chris Hughes</span> 2 months ago, and all the comments seem to have been resolved; Etienne, do you think this PR is alright now?</p>",
        "id": 548169920,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761920728
    },
    {
        "content": "<p>I completely forgot about this PR <span aria-label=\"fear\" class=\"emoji emoji-1f628\" role=\"img\" title=\"fear\">:fear:</span> I think it should be ready to go, I just asked Chris to merge master to see if everything is all right.</p>",
        "id": 548173698,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1761921477
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"703970\">@Etienne Marion</span> I'm wondering if it's worth it to try to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Analysis/Calculus/Deriv/Slope.html#HasDerivWithinAt.limsup_slope_le\">HasDerivWithinAt.limsup_slope_le</a>, as well as why that lemma doesn't have all the variants</p>",
        "id": 548174557,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761921667
    },
    {
        "content": "<p>oh nvm that lemma is specialised on Real</p>",
        "id": 548174613,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761921680
    },
    {
        "content": "<p>I think that part of the file should be moderately generalised but that's a future PR</p>",
        "id": 548174699,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761921699
    },
    {
        "content": "<p>I'm not sure there is a field other than the reals that fulfils all the hypotheses of these theorems, but I generalised it anyway.</p>",
        "id": 548174904,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1761921752
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"703970\">@Etienne Marion</span> I'm reasonably certain that it will compile fine (I copied the whole file to live editor), would  you like to just click approve?</p>",
        "id": 548174952,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761921764
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110044\">Chris Hughes</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2327824.20exists_gt_of_deriv_pos/near/548174904\">said</a>:</p>\n<blockquote>\n<p>I'm not sure there is a field other than the reals that fulfils all the hypotheses of these theorems</p>\n</blockquote>\n<p>you didn't say complete, so Q satisfies it</p>",
        "id": 548175100,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761921798
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2327824.20exists_gt_of_deriv_pos/near/548174952\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"703970\">Etienne Marion</span> I'm reasonably certain that it will compile fine (I copied the whole file to live editor), would  you like to just click approve?</p>\n</blockquote>\n<p>I did that too, but I'd prefer to have a quick look at it in VSCode in case I missed something.</p>",
        "id": 548175303,
        "sender_full_name": "Etienne Marion",
        "timestamp": 1761921843
    },
    {
        "content": "<p>Can we use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=IsLocalMaxOn.hasFDerivWithinAt_nonpos#doc\">docs#IsLocalMaxOn.hasFDerivWithinAt_nonpos</a> with <code>contrapose!</code> here?</p>",
        "id": 548207322,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761930141
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> what can you deduce from something <em>not</em> being a local max? I suppose this means that there is a sequence xn that tends to x such that each f(xn) &gt; f(x), and i'm not sure you can then derive Chris's result</p>",
        "id": 548208220,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761930420
    },
    {
        "content": "<p><span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span> sorry</p>",
        "id": 548208391,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761930477
    },
    {
        "content": "<p>I should think more before posting (and don't post when I have no time to think more).</p>",
        "id": 548208496,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761930510
    },
    {
        "content": "<p>I'll try to golf a little tonight and I think it makes sense to add <code>derivWithin</code> versions, otherwise LGTM.</p>",
        "id": 548210867,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761931277
    },
    {
        "content": "<p>Do we want this filter version too</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">Calculus</span><span class=\"bp\">.</span><span class=\"n\">Deriv</span><span class=\"bp\">.</span><span class=\"n\">Slope</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NontriviallyNormedField</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">IsStrictOrderedRing</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">}</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Topology</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">eventually_gt_of_hasDerivAtFilter_pos</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">ClosedIicTopology</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f'_pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasDerivAtFilter</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">‚àÄ·∂†</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">ùìù</span><span class=\"o\">[</span><span class=\"bp\">&gt;</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚äì</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hasDerivAtFilter_iff_tendsto_slope</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hF</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ùìù</span><span class=\"o\">[</span><span class=\"bp\">&gt;</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚äì</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"bp\">‚äì</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">principal</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span><span class=\"bp\">·∂ú</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">order</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">nhdsGT_le_nhdsNE</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">le_principal_iff</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"n\">self_mem_nhdsWithin</span><span class=\"o\">)]</span>\n<span class=\"w\">  </span><span class=\"n\">filter_upwards</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hF</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ioi_mem_nhds</span><span class=\"w\"> </span><span class=\"n\">f'_pos</span><span class=\"o\">)),</span>\n<span class=\"w\">    </span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">mem_inf_of_left</span><span class=\"w\"> </span><span class=\"n\">self_mem_nhdsWithin</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"n\">hxa</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">slope_def_field</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">div_pos_iff_of_pos_right</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">sub_pos</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"n\">hxa</span><span class=\"o\">)]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">ha</span>\n\n<span class=\"c1\">-- it golfs the proof of the other theorem</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">exists_gt_of_hasDerivWithinAt_pos</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">OrderTopology</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">ùïú</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f'_pos</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">HasDerivWithinAt</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">f'</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">Ioc</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">‚à©</span><span class=\"w\"> </span><span class=\"n\">S</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">eventually_gt_of_hasDerivAtFilter_pos</span><span class=\"w\"> </span><span class=\"n\">f'_pos</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">nhdsWithin_inter</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">nhdsWithin_inter'</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Filter</span><span class=\"bp\">.</span><span class=\"n\">eventually_inf</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_nhdsGT_iff_exists_Ioc_subset</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hux</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hus</span><span class=\"bp\">‚ü©</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hst</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hux</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">hst</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">hus</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">‚ü©‚ü©</span>\n</code></pre></div>",
        "id": 548221317,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1761935041
    },
    {
        "content": "<p>aha!</p>",
        "id": 548221455,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761935107
    },
    {
        "content": "<p>i love generalisations</p>",
        "id": 548221471,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1761935111
    },
    {
        "content": "<p>IMHO, we should only use <code>HasFDerivWithinAt</code>/<code>HasFDerivAt</code>, not <code>HasFDerivAtFilter</code> outside of basic theory. We never use it for other filters anyway.</p>",
        "id": 548221955,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1761935311
    }
]