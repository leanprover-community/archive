[
    {
        "content": "<p>We prove five key formulae about the forward difference operator<a href=\"https://github.com/leanprover-community/mathlib4/pull/26793\">#26793</a> , submitted by Weijie  Jiang. These theorems are still relatively common in related professional combinatorial mathematics textbooks.The main focus is on the nth-order difference of an nth-degree polynomial and the (n + 1)th-order difference being equal to a specific value, as well as the properties of the 0th diagonal in the difference table.But we do have some deficiencies in terms of types and proofs. We hope to receive some guidance so that our contributions can be merged as soon as possible. Thanks!</p>",
        "id": 527353776,
        "sender_full_name": "ShaoYu",
        "timestamp": 1751815624
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"917771\">@ShaoYu</span> I've left a comment</p>",
        "id": 527487307,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1751896971
    },
    {
        "content": "<p>Ok!we will change it!</p>",
        "id": 527501375,
        "sender_full_name": "ShaoYu",
        "timestamp": 1751901009
    },
    {
        "content": "<p>We have updated and re-uploaded the files. Looking forward to your reply.</p>",
        "id": 527862008,
        "sender_full_name": "ShaoYu",
        "timestamp": 1752058776
    },
    {
        "content": "<p>The issue we are currently facing is that the reviewers have provided inconsistent feedback. The last reviewer's suggestion aligns almost exactly with my initial submission—specifically, regarding whether to use linear maps and which data type to employ when proving the theorem related to <em>the nth-order difference of an nth-degree polynomial</em>. We sincerely invite all reviewers to provide a definitive version for us to revise, so that we can submit it to Mathlib as soon as possible.</p>",
        "id": 536884896,
        "sender_full_name": "SHAO YU",
        "timestamp": 1756525035
    },
    {
        "content": "<p>I guess \"the last reviewer's suggestion\" is <span class=\"user-mention\" data-user-id=\"481963\">@David Loeffler</span>'s <a href=\"https://github.com/leanprover-community/mathlib4/pull/26793#discussion_r2307061611\">comment</a>:</p>\n<blockquote>\n<p>I'm not sure that what's proved here is what you really wanted to prove. The operator <code>fwdDiffₗ R[X] R[X] 1</code> acts on functions from <code>R[X]</code> to <code>R[X]</code>. I think you actually want to consider forward difference acting on functions from <code>R</code> to <code>R</code>. Moreover, <code>fwdDiffₗ</code> is packaging it as a <code>ℤ</code>-linear map, but not an <code>R</code>-linear one, so the linearity is not useful for your purposes anyway. </p>\n<p>I also think you may have confused yourself a bit by using <code>X</code> both for a polynomial variable, and a generic element of the ring <code>R</code>; these are not the same thing (if <code>R</code> is Z/pZ, then <code>X^p - X</code> is a non-zero polynomial in <code>R[X]</code>, but the function <code>fun r : R ↦ r^p - r</code> is the zero function by Fermat's little theorem). (Edit: In your code, in the function definition, it's worse than that: X is actually a generic element of <code>R[X]</code> where the two <code>X</code>'s aren't the same...)</p>\n<p>I think a better formulation might be this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">fwdDiff_iter_pow_eq_zero_of_lt</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Δ_</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"bp\">^</span><span class=\"o\">[</span><span class=\"n\">n</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">succ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Δ_</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Finset.range</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">j.choose</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">      </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">nsmul_eq_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">fwdDiff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">add_pow</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Finset.sum_range_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul_comm</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Function.iterate_succ_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">fwdDiff_iter_finset_sum</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Finset.sum_eq_zero</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">fwdDiff_iter_const_smul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Finset.mem_range</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">nsmul_zero</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Can you try to modify the other lemmas similarly? If you get stuck, then let me know. </p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"738806\">@SHAO YU</span> Could you link to and / or quote the comment(s) that this is inconsistent with? There are 40+ comments on your PR and many of them are marked resolved, which makes it difficult to find.</p>",
        "id": 536885954,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1756526589
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"123965\">@Bryan Gin-ge Chen</span> Ok.This is the comment suggesting that we write it as a linear mapping： <a href=\"https://github.com/leanprover-community/mathlib4/pull/26793#discussion_r2190211422.But\">https://github.com/leanprover-community/mathlib4/pull/26793#discussion_r2190211422.But</a> I also can't find the comment that asked me to change \"((fwdDiffₗ R R 1 ^ n) fun X ↦ X ^ j) = 0\" to \"((fwdDiffₗ R[X] R[X] 1 ^ n) fun X ↦ X ^ j) = 0\". So the form we submitted went from something like \"Δ_[1]^[n] (fun (r : R) ↦ r ^ j) = 0\" to \"((fwdDiffₗ R R 1 ^ n) fun X ↦ X ^ j) = 0\", and then to \"((fwdDiffₗ R[X] R[X] 1 ^ n) fun X ↦ X ^ j) = 0\". The final reviewer requested that we revert to the original \"Δ_[1]^[n] (fun (r : R) ↦ r ^ j) = 0\", and we are unsure which version is actually needed for merging into mathlib.</p>",
        "id": 536887993,
        "sender_full_name": "SHAO YU",
        "timestamp": 1756528808
    },
    {
        "content": "<p>I guess the comment you're trying to link is <a href=\"https://github.com/leanprover-community/mathlib4/pull/26793#discussion_r2190211422\">this comment</a> by <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span>:</p>\n<blockquote>\n<p>You should first generalise this theorem to <code>x</code> taking value in <code>R</code>, which will give you a much more efficient proof (with one <code>sorry</code> here left as exercise):</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span><span class=\"w\"> </span><span class=\"n\">fwdDiff_iter_pow_eq_zero_of_lt</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"o\">((</span><span class=\"n\">fwdDiffₗ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">  </span><span class=\"n\">induction'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">j</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">contradiction</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">pow_succ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Module.End.mul_apply</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">fwdDiffₗ</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span>\n<span class=\"w\">        </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">Finset.range</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">j.choose</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">•</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"kd\">by</span>\n<span class=\"w\">      </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_sum</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">sum_eq_zero</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"w\"> </span><span class=\"bp\">↦</span><span class=\"w\"> </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mem_range</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">hi</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">map_nsmul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"kd\">by</span><span class=\"w\"> </span><span class=\"n\">omega</span><span class=\"o\">)]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 536888233,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1756529072
    },
    {
        "content": "<p>Yes, thank you. I'm still not very proficient with using it yet.</p>",
        "id": 536888469,
        "sender_full_name": "SHAO YU",
        "timestamp": 1756529325
    },
    {
        "content": "<p>Kenny Lau's comment suggested going from functions <code>ℕ → R</code> to functions <code>R → R</code> (which I agree with) and using the bundled linear map version <code>fwdDiffₗ R R 1</code>rather than the unbundled version <code>Δ_[1]</code> (which I don't like so much, but isn't a big deal either way). But neither Kenny's comment, nor any of the other comments I can see, are telling you to consider functions <code>R[X] → R[X]</code>, which is what you are doing when you write <code>fwdDiffₗ R[X] R[X] 1</code>.</p>",
        "id": 536894770,
        "sender_full_name": "David Loeffler",
        "timestamp": 1756536078
    },
    {
        "content": "<p>Looking through the PR history more carefully, the usage – in my opinion incorrect – of functions valued in <code>R[X]</code> rather than <code>R</code> seems to be already present in your commit bacc6c6 of July 5th, in <code>theorem sum_of_poly_sequence</code>.</p>\n<p>Now, this commit was in the initial batch of commits present when the PR was first opened, which does not seem consistent with your claim that this was something that Mathlib reviewers insisted you adopt.</p>",
        "id": 536895880,
        "sender_full_name": "David Loeffler",
        "timestamp": 1756537330
    },
    {
        "content": "<p>FWIW, I am rather familiar with this particular part of Mathlib (as you might expect, since the existing <code>fwdDiff</code> code was written jointly by one of my students and me). I'm very happy to see that others are interested in developing this code further; and by assigning the PR to myself I was signalling my willingness to take charge of the review process from here onwards.</p>",
        "id": 536898554,
        "sender_full_name": "David Loeffler",
        "timestamp": 1756540830
    },
    {
        "content": "<p>Indeed, we had previously submitted a version using type <code>R</code>, which was later changed to the <code>R[X]</code> version. Thank you for your attention to this matter — we are truly honored. We will now revise it to the version you suggested and would appreciate your further review.</p>",
        "id": 536900543,
        "sender_full_name": "SHAO YU",
        "timestamp": 1756543120
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"481963\">David Loeffler</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2326793.20proves.20on.20difference.20sequences.20in.20combinatorial.20Math/near/536898554\">said</a>:</p>\n<blockquote>\n<p>FWIW, I am rather familiar with this particular part of Mathlib (as you might expect, since the existing <code>fwdDiff</code> code was written jointly by one of my students and me). I'm very happy to see that others are interested in developing this code further; and by assigning the PR to myself I was signalling my willingness to take charge of the review process from here onwards.</p>\n</blockquote>\n<p>Dear Professor, I hope you don’t mind me reaching out again. With your help last time, we uploaded several theorems related to differences. We’ve now revised the remaining theorem and submitted another PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/31092\">#31092</a>. Would you be interested in taking another look when you have time?</p>",
        "id": 548076875,
        "sender_full_name": "SHAO YU",
        "timestamp": 1761887210
    }
]