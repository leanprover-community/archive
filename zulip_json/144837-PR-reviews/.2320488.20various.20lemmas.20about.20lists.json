[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20488\">#20488</a> came up at the triage meeting. It's been on the queue for 56 days, making it currently the PR which has been on the queue for the longest time. It is +36 -0. It's a bunch of very easy proofs. I don't know a thing about this corner of the library. It's had a few reviews and the code looks fine to me, I'm just clueless about whether we want these things at all (most of them seem fine to me but </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">setOf_nodup_perm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">Nodup</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">finite_toSet</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"bp\">.</span><span class=\"n\">toList</span><span class=\"bp\">.</span><span class=\"n\">Perm</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>looked a bit weird). Can someone who can confidently speak about lists say something about this?</p>",
        "id": 503038216,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741011612
    },
    {
        "content": "<p>It should be <code>l.toFinset....</code> instead of <code>l.finite_toSet.toFinset</code>. Otherwise, looks reasonable</p>",
        "id": 503049247,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1741014268
    },
    {
        "content": "<p>Something else that looks weird to me is the <code>Fintype</code> instance here</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Since this simp theorem is specifically to be used when working with</span>\n<span class=\"c1\">-- set builder notation, we explicitly add the instance requirement</span>\n<span class=\"c1\">-- `[Fintype {x | x ∈ l}]` instead of making it a global instance</span>\n<span class=\"c1\">-- (as the proper simp-normal form of `↑ { x | p x }` is `{ x // p x }`)</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">setOf_finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">}]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_toFinset</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_toFinset</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Is this OK? It looks a bit stange asking for a fintype instance for a type which is provably finite.</p>\n<p><span class=\"user-mention\" data-user-id=\"767695\">@Tristan Figueroa-Reid</span> what do you think of Yael's comment above?</p>",
        "id": 504530765,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1741601787
    },
    {
        "content": "<p>I'll try reformatting the PR to deal with instances better, incorporating Yael's comment. I believe the only problem with Yael's comment is that it will require a <code>[DecidableEq α]</code> instance, but I'll see what the consequences of that are. (Now that I actually know more about instances and such, I am starting to look back at this PR with some vague worry)</p>",
        "id": 504640971,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1741625673
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2320488.20various.20lemmas.20about.20lists/near/504530765\">said</a>:</p>\n<blockquote>\n<p>Something else that looks weird to me is the <code>Fintype</code> instance here</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Since this simp theorem is specifically to be used when working with</span>\n<span class=\"c1\">-- set builder notation, we explicitly add the instance requirement</span>\n<span class=\"c1\">-- `[Fintype {x | x ∈ l}]` instead of making it a global instance</span>\n<span class=\"c1\">-- (as the proper simp-normal form of `↑ { x | p x }` is `{ x // p x }`)</span>\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">setOf_finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DecidableEq</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fintype</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">}]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">toFinset</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">ext</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_toFinset</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mem_toFinset</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Is this OK? It looks a bit stange asking for a fintype instance for a type which is provably finite.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"767695\">Tristan Figueroa-Reid</span> what do you think of Yael's comment above?</p>\n</blockquote>\n<p>The <code>Fintype</code> there is necessary for the global theorem to work and can be synthesized when using the theorem locally. I'm unsure about how to synthesize instances that apply to the _definition_ rather than the proof, but the opposition to having <code>[Fintype {x | x ∈ l}]</code> as a global instance is in the comment there.</p>",
        "id": 504768637,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1741681059
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">Yaël Dillies</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2320488.20various.20lemmas.20about.20lists/near/503049247\">said</a>:</p>\n<blockquote>\n<p>It should be <code>l.toFinset....</code> instead of <code>l.finite_toSet.toFinset</code>. Otherwise, looks reasonable</p>\n</blockquote>\n<p>That theorem already existed! Thanks! <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/20488/commits/ff1c4b0d04a535d9a03a3940d5c989089238adbe\">commit</a>) that should simplify this a little.</p>",
        "id": 504770388,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1741681547
    },
    {
        "content": "<p>(<a href=\"https://github.com/leanprover-community/mathlib4/pull/20488/commits/52c2664b592cea6928bf66605b6f135b486a7ca4\">Dropped the other strange theorem too</a> <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> ) - <del>though CI is failing</del> it failed because the CI was cancelled by recent commits.</p>",
        "id": 504772039,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1741682001
    },
    {
        "content": "<p>Passed! This PR can be reviewed now: I can delete/move the other theorems since this PR no longer uses them.</p>",
        "id": 504780947,
        "sender_full_name": "Tristan Figueroa-Reid",
        "timestamp": 1741684469
    }
]