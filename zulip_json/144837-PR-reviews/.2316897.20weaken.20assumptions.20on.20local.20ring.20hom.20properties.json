[
    {
        "content": "<p>In <a href=\"https://github.com/leanprover-community/mathlib4/pull/16897\">#16897</a> I significantly weaken the assumptions for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RingHom.PropertyIsLocal#doc\">docs#RingHom.PropertyIsLocal</a>: This predicate is meant to capture what is needed for <code>affineLocally P</code> (<a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AlgebraicGeometry.affineLocally#doc\">docs#AlgebraicGeometry.affineLocally</a>) to be local at the source and the target (see e.g. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AlgebraicGeometry.HasRingHomProperty.instIsLocalAtSource#doc\">docs#AlgebraicGeometry.HasRingHomProperty.instIsLocalAtSource</a>). </p>\n<p>Currently for a property of ring homomorphisms <code>P</code>, <code>PropertyIsLocal P</code> in particular contains <code>StableUnderComposition P</code> and <code>HoldsForLocalizationAway P</code>. But for the proof of <code>affineLocally P</code> being local at source and target, it is sufficient to ask instead for what I call <code>StableUnderCompositionWithLocalizationAway P</code>, which says: If <code>P</code> holds for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo>→</mo><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">R \\to S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>, then <code>P</code> also holds for the composition <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo>→</mo><mi>S</mi><mo>→</mo><msub><mi>S</mi><mi>g</mi></msub></mrow><annotation encoding=\"application/x-tex\">R \\to S \\to S_{g}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9694em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo>∈</mo><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">g \\in S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> (and similarly for composition on the left).</p>\n<p>This works without causing major disruptions, the main difference being that open immersions do no longer automatically satisfy any <code>affineLocally P</code> if <code>PropertyIsLocal P</code> is given, but requires the assumption that <code>P</code> is satisfied by identities.</p>\n<p>Now for the initial motivation for this change: I want to use the <code>HasRingHomProperty</code> machinery for morphisms standard smooth of relative dimension <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">n &gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>. This class of ring homs is neither stable under composition (dimensions add up) nor does it contain identities. But still (modulo existence of a cover of the (geometric) source) they satisfy the weakened <code>PropertyIsLocal</code> and hence can be used with the <code>HasRingHomProperty</code> API.</p>\n<p>What do you think? (<span class=\"user-mention\" data-user-id=\"439483\">@Andrew Yang</span> is certainly interested, but is currently on vacation I think).</p>",
        "id": 471063233,
        "sender_full_name": "Christian Merten",
        "timestamp": 1726598617
    },
    {
        "content": "<p>I think this makes a lot of sense. Do you provide an alternative constructor in terms of the original assumptions?</p>",
        "id": 471063682,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726598741
    },
    {
        "content": "<p>I add the lemma <code>RingHom.StableUnderComposition.stableUnderCompositionWithLocalizationAway</code> (<a href=\"https://github.com/leanprover-community/mathlib4/pull/16897/files#diff-4c9b45ae583898f1c0f64be4a0e08176e3711f212b1299c09c9387c5affe481bR183-R190\">https://github.com/leanprover-community/mathlib4/pull/16897/files#diff-4c9b45ae583898f1c0f64be4a0e08176e3711f212b1299c09c9387c5affe481bR183-R190</a>) which produces <code>StableUnderCompositionWithLocalizationAway P</code> from <code>StableUnderComposition P</code> and <code>HoldsForLocalizationAway P</code>. Should I also add an alternative constructor for the full <code>PropertyIsLocal</code>?</p>",
        "id": 471064378,
        "sender_full_name": "Christian Merten",
        "timestamp": 1726598917
    },
    {
        "content": "<p>Hmm, not sure. I think this is enough. But maybe it's convenient to have the shortcut? The names are quite long <span aria-label=\"oops\" class=\"emoji emoji-1f643\" role=\"img\" title=\"oops\">:oops:</span></p>",
        "id": 471065453,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726599180
    },
    {
        "content": "<p>I added the shortcut constructor.</p>",
        "id": 471238537,
        "sender_full_name": "Christian Merten",
        "timestamp": 1726659987
    }
]