[
    {
        "content": "<p>I am now starting a series of PRs that provide the ingredients for the proof of the Prime Number Theorem and Dirichlet's Theorem on primes in AP. Essentially, one has to show that a certain linear combination of logarithmic derivatives of Dirichlet L-series has certain properties. This will at some point build on the earlier PRs discussed <a href=\"#narrow/channel/144837-PR-reviews/topic/Orthogonality.20of.20Dirichlet.20characters/near/481388514\">here</a>.</p>\n<p>The series stats with <a href=\"https://github.com/leanprover-community/mathlib4/pull/18923\">#18923</a>, which adds \"logarithmic\" versions of Euler products of completely multiplicative (complex-valued) functions.</p>",
        "id": 482005581,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731434240
    },
    {
        "content": "<p>The next one is <a href=\"https://github.com/leanprover-community/mathlib4/pull/18924\">#18924</a>; it adds two easy <code>IsBigO</code> lemmas that help going from complex functions to their restrictions to the real line.</p>",
        "id": 482011202,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731436121
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18927\">#18927</a> is the third; it adds two further <code>IsBigO</code> lemmas for shifted functions.</p>",
        "id": 482015366,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731437781
    },
    {
        "content": "<p>It continues with <a href=\"https://github.com/leanprover-community/mathlib4/pull/18928\">#18928</a>; it adds API showing that <code>LSeries</code> commutes with <code>Finset.sum</code>.</p>",
        "id": 482019482,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731439360
    },
    {
        "content": "<p>The next one will be a bit larger (~270 loc); it will show that <code>L(χ, s)</code> does not vanish for <code>s.re ≥ 1</code> when <code>χ</code> is a Dirichlet character (and either <code>χ</code> is nontrivial or <code>s ≠ 1</code>). But this depends on the four preparatory PRs mentioned above.</p>",
        "id": 482021079,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731439933
    },
    {
        "content": "<p>Are they literally a series with each PR depending on the previous one, or can they be reviewed in any order?</p>",
        "id": 482041103,
        "sender_full_name": "David Loeffler",
        "timestamp": 1731446481
    },
    {
        "content": "<p>Does the series converge? (Sorry)</p>",
        "id": 482043183,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1731447343
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"481963\">David Loeffler</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Prerequisites.20for.20PNT.20and.20Dirichlet's.20Thm/near/482041103\">said</a>:</p>\n<blockquote>\n<p>Are they literally a series with each PR depending on the previous one, or can they be reviewed in any order?</p>\n</blockquote>\n<p>These four are independent. Thanks for the reviews!</p>",
        "id": 482128447,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731490742
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"479359\">Michael Stoll</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Prerequisites.20for.20PNT.20and.20Dirichlet's.20Thm/near/482015366\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18927\">#18927</a> is the third; it adds two further <code>IsBigO</code> lemmas for shifted functions.</p>\n</blockquote>\n<p>After some discussion, whose result was that it is better to inline these two lemmas where they are used (once each, in the next PR), I have closed this now.</p>",
        "id": 482150288,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731497599
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/18923\">#18923</a> (Euler products) could do with a review...</p>",
        "id": 482153414,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731498672
    },
    {
        "content": "<p>Another small preparatory PR: <a href=\"https://github.com/leanprover-community/mathlib4/pull/18973\">#18973</a>. It just adds one lemma (the derivatives of the L-function and the L-series of a Dirichlet character agree on the half-plane of convergence of the latter).</p>",
        "id": 482194943,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731510757
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19034\">#19034</a> uses the previously merged PR to establish an exp-log Euler product formula for Dirichlet L-series.</p>",
        "id": 482385971,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731589322
    },
    {
        "content": "<p>Now the first substantial step: <a href=\"https://github.com/leanprover-community/mathlib4/pull/19043\">#19043</a> proves that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mo stretchy=\"false\">(</mo><mi>χ</mi><mo separator=\"true\">,</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo mathvariant=\"normal\">≠</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L(\\chi, s) \\ne 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">χ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Re</mi><mo>⁡</mo><mi>s</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\operatorname{Re} s \\ge 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">Re</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> (unless <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>χ</mi></mrow><annotation encoding=\"application/x-tex\">\\chi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">χ</span></span></span></span> is trivial and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">s = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>). (About 240 loc.)</p>",
        "id": 482457039,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1731609188
    },
    {
        "content": "<p>This is so cool! These results are important!</p>",
        "id": 482543603,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1731653713
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19254\">#19254</a> adds some results on logarithmic derivatives of L-functions of Dirichlet characters.</p>",
        "id": 483303184,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732033488
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19334\">#19334</a> and <a href=\"https://github.com/leanprover-community/mathlib4/pull/19335\">#19335</a> are two further (small and indpendent) preparatory PRs.</p>",
        "id": 483711000,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732199369
    },
    {
        "content": "<p>Next up are the following lemmas.</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">tsum_eq_tsum_primes_of_support_subset_prime_powers</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">     </span><span class=\"o\">[</span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformAddGroup</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">T0Space</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span>\n<span class=\"w\">     </span><span class=\"o\">(</span><span class=\"n\">hfs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Summable</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">IsPrimePow</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Primes</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">tsum_eq_tsum_primes_add_tsum_primes_of_support_subset_prime_powers</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">α</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">[</span><span class=\"n\">AddCommGroup</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformAddGroup</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">T0Space</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">α</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hfs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Summable</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hf</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">⊆</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">IsPrimePow</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Primes</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\">  </span><span class=\"bp\">∑'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Primes</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Should these go somewhere under <code>Mathlib.Topology.Algebra.InfiniteSum</code>, or are they too special, so that they should go close to their application?</p>",
        "id": 483714489,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732200303
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19344\">#19344</a> creates a new file <code>Mathlib.NumberTheory.LSeries.PrimesInAP</code> that will eventually contain a proof of Dirichlet's Theorem. The first step is to add the lemmas mentioned above. (If desired, they can be moved elsewhere at some point, but there does not appear to be a canonical place.)</p>",
        "id": 483785853,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732222015
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19368\">#19368</a> is the next step: properties of the von Mangoldt function restricted to a residue class.</p>",
        "id": 483904451,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732279880
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19418\">#19418</a> adds two further relevant statements on <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ArithmeticFunction.vonMangoldt.residueClass#doc\">docs#ArithmeticFunction.vonMangoldt.residueClass</a>.</p>",
        "id": 484088927,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732389503
    },
    {
        "content": "<p>Btw, how far are we from Dirichlet's theorem? 10 PRs? Or twice that? Can you already estimate this?</p>",
        "id": 484092361,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732392540
    },
    {
        "content": "<p>About 200 loc. Probably two further PRs.</p>",
        "id": 484092491,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732392624
    },
    {
        "content": "<p>Ooh, wow!</p>",
        "id": 484092547,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732392679
    },
    {
        "content": "<p>Would you mind opening a PR already?</p>",
        "id": 484092555,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732392691
    },
    {
        "content": "<p>You can see what remains <a href=\"https://github.com/MichaelStollBayreuth/EulerProducts/blob/main/EulerProducts/PNT.lean\">here</a>. (Minus the last part, which needs the Wiener-Ikehara Theorem; this is done in PNT+.)</p>",
        "id": 484092675,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732392806
    },
    {
        "content": "<p>I prefer tinkering in my own repo rather than pushing everything to a Mathlib branch while I'm working on it. Though I think that the proof in its current shape looks quite good.</p>",
        "id": 484092915,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732393021
    },
    {
        "content": "<p>I've decided to end the suspense: <a href=\"https://github.com/leanprover-community/mathlib4/pull/19421\">#19421</a> contains everything that is still missing including <strong>Dirichlet's Theorem</strong> itself (in two versions).<br>\nNote that this is \"just\" the infinity statement; more precise asymptotic versions are and will be obtained in the <a href=\"https://github.com/AlexKontorovich/PrimeNumberTheoremAnd\">PNT+</a> project.</p>",
        "id": 484099088,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732398714
    },
    {
        "content": "<p>I left two comments. But I think people with more expertise in analytic number theory should also take a look.</p>",
        "id": 484221788,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732518215
    },
    {
        "content": "<p>I am travelling at the moment but can take a look on Wednesday, unless someone else gets there first.</p>",
        "id": 484228459,
        "sender_full_name": "David Loeffler",
        "timestamp": 1732521341
    },
    {
        "content": "<p>Enjoy your travels. If you need some distraction: do you know a nice name for</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- The auxiliary function used, e.g., with the Wiener-Ikehara Theorem to prove</span>\n<span class=\"sd\">Dirichlet's Theorem. On `re s &gt; 1`, it agrees with the L-series of the von Mangoldt</span>\n<span class=\"sd\">function restricted to the residue class `a : ZMod q` minus the principal part</span>\n<span class=\"sd\">`(q.totient)⁻¹/(s-1)` of the pole at `s = 1`; see `DirichletsThm.auxFun_prop`. -/</span>\n<span class=\"kn\">noncomputable</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">auxFun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">totient</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LFunctionTrivChar₁</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">LFunctionTrivChar₁</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">-</span>\n<span class=\"w\">    </span><span class=\"bp\">∑</span><span class=\"w\"> </span><span class=\"n\">χ</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"mi\">1</span><span class=\"o\">}</span><span class=\"bp\">ᶜ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">DirichletCharacter</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"o\">)),</span><span class=\"w\"> </span><span class=\"n\">χ</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">deriv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">LFunction</span><span class=\"w\"> </span><span class=\"n\">χ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">LFunction</span><span class=\"w\"> </span><span class=\"n\">χ</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 484228812,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732521468
    },
    {
        "content": "<p><code>LfunctionResidueClassSubInvTotientDiv</code> is descriptive in a way, but I'm not sure it is actually better. <code>auxFunForDirichletsThm</code>? <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 484242035,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732525549
    },
    {
        "content": "<p>Maybe <code>LfunctionResidueClassAux</code> is a little more explicit, but also maintains an <code>aux</code> status.</p>",
        "id": 484242623,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1732525714
    },
    {
        "content": "<p>It's mostly that when a module docstring starts talking about <code>auxFun</code>, then this decl seems important enough to get a different name...</p>",
        "id": 484242806,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732525772
    },
    {
        "content": "<p>I'll go with <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>'s suggestion for now. If somebody comes up with a better idea, we can change it again.</p>",
        "id": 484294979,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732539925
    },
    {
        "content": "<p>Elsewhere in the L-functions library there is a convention of using subscript \"0\" to mean \"L-series modified by adding a multiple of <code>1 / (s -1)</code> to kill the pole\". So perhaps this could be \"ZMod.LFunctionVonMangoldt0\"?</p>",
        "id": 484341429,
        "sender_full_name": "David Loeffler",
        "timestamp": 1732551247
    },
    {
        "content": "<p>The function it's related to the L-series of is not periodic, so <code>ZMod</code> is not the right namespace. Perhaps <code>ArithmeticFunction.vonMangoldt.LFunctionResidueClass₀</code>?</p>",
        "id": 484341812,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732551352
    },
    {
        "content": "<p>Using <code>vonMangoldt</code> as a namespace seems a bit unorthodox. I would also be happy with Damiano's suggestion, and (as Johan observes) it would be very easy to change the name later anyway so it's probably not worth worrying too much about it now.</p>",
        "id": 484343050,
        "sender_full_name": "David Loeffler",
        "timestamp": 1732551678
    },
    {
        "content": "<p>I've put the modified von Mangoldt function in the <code>ArithmeticFunction.vonMangoldt</code> namespace because I think this makes sense. Then using this namespace also for the associated L-function follows in a way the precedent of <code>DirichletCharacter.LFunction</code>.</p>",
        "id": 484343501,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732551814
    },
    {
        "content": "<p>The alternative would probably be to use <code>ArithmeticFunction.vonMangoldtResidueClass</code>, but then one has to write out the \"vonMangoldt\" part every single time...</p>",
        "id": 484343754,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732551885
    },
    {
        "content": "<p>Besides this name... does anybody have any other comments?</p>",
        "id": 484350106,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732553808
    },
    {
        "content": "<p>LGTM, and I'm happy to get this merged today <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 484350170,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732553829
    },
    {
        "content": "<p>Having a look</p>",
        "id": 484352765,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732554604
    },
    {
        "content": "<p>I gave it a quick once-over (while sitting in a hotel room in Amsterdam). All looks reasonable to me, and I think it is important enough that we should merge it ASAP and sort out any rough edges later.</p>",
        "id": 484353045,
        "sender_full_name": "David Loeffler",
        "timestamp": 1732554709
    },
    {
        "content": "<p>It looks (very) good also to me, I've left two minor comments and I think it is ready to go.</p>",
        "id": 484353788,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732554971
    },
    {
        "content": "<p>A related question, do we want to remove <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/PrimesCongruentOne.html\">Mathlib.NumberTheory.PrimesCongruentOne</a>?</p>",
        "id": 484353879,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732555006
    },
    {
        "content": "<p><img alt=\":bors:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/dce2c3bb.png\" title=\"bors\"></p>",
        "id": 484355607,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732555622
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/PrimesCongruentOne.html\">Mathlib.NumberTheory.PrimesCongruentOne</a> is used in an IMO problem. It seems a bit extravagant to use Dirichlet for that... but ey, it typechecks <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>",
        "id": 484355848,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732555701
    },
    {
        "content": "<p>Well, we can always move everything in the same IMO file, it is a short proof. Anyway I think we will have more and more situation like this, when easy results become a special case of big ones</p>",
        "id": 484356292,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732555845
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Prerequisites.20for.20PNT.20and.20Dirichlet's.20Thm/near/484355848\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/PrimesCongruentOne.html\">Mathlib.NumberTheory.PrimesCongruentOne</a> is used in an IMO problem. It seems a bit extravagant to use Dirichlet for that... but ey, it typechecks <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>\n</blockquote>\n<p>Makes sense to me. Dirichlet's theorem is one of the first things I learned when preparing for the IMO, along with Hensel's lemma</p>",
        "id": 484358546,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1732556673
    },
    {
        "content": "<p>It's landed! Massive milestone! Congrats <span class=\"user-mention\" data-user-id=\"479359\">@Michael Stoll</span></p>",
        "id": 484359728,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732557109
    },
    {
        "content": "<p>Just noticed that it should be <code>LFunctionResidueClassAux</code> instead of <code>LfunctionResidueClassAux</code>...</p>",
        "id": 484362473,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732558017
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/19474\">#19474</a> fixes the names.</p>",
        "id": 484366612,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732559605
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130384\">Riccardo Brasca</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Prerequisites.20for.20PNT.20and.20Dirichlet's.20Thm/near/484353879\">said</a>:</p>\n<blockquote>\n<p>A related question, do we want to remove <a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/PrimesCongruentOne.html\">Mathlib.NumberTheory.PrimesCongruentOne</a>?</p>\n</blockquote>\n<p>I'd suggest that the proof of that file should be transferred to another part of mathlib, so that it isn't lost (it's a Proof from the Book!), but the theorem should be refactored using Dirichlet's theorem.</p>",
        "id": 484377501,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732563852
    },
    {
        "content": "<p>Maybe move it to <code>Archive</code>?</p>",
        "id": 484377618,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732563904
    },
    {
        "content": "<p>It seems that this result is only used in <code>Imo2008Q3</code> (and there is a comment in <a href=\"https://tqft.net/mathlib4files/Mathlib/NumberTheory/FermatPsp\">file#Mathlib/NumberTheory/FermatPsp</a> referring to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.frequently_atTop_modEq_one#doc\">docs#Nat.frequently_atTop_modEq_one</a>).</p>",
        "id": 484382066,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732565641
    },
    {
        "content": "<p>You see, I'm not sure the full Dirichlet's theorem will have many applications in mathlib before some time!<br>\nThe congruent to one case has a nice proof that can serve as an interesting example to people, and I would even suggest that mathlib documents it.</p>",
        "id": 484397391,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732572279
    },
    {
        "content": "<p>I hope to get the Hasse-Minkowski Theorem (over <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord mathbb\">Q</span></span></span></span> at least) into Mathlib eventually, and this will need Dirichlet's Theorem at some point. But this will certainly take a while...</p>",
        "id": 484397652,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732572380
    },
    {
        "content": "<p>And that will be a wonderful application!</p>",
        "id": 484397734,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732572424
    },
    {
        "content": "<p>Some people have a notion that IMO problems shouldn't <em>depend</em> for their solution on non-elementary cases of Dirichlet's theorem (but that such dependence would be considered fine at some other competitions such as the Romanian Master of Mathematics): that while it's OK to use non-elementary results in solving a problem (indeed, people might occasionally quote FLT or Catalan-Mihăilescu in olympiad solutions), a problem ought to have a solution that doesn't use such results.</p>",
        "id": 484422005,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1732586959
    },
    {
        "content": "<p>That's not relevant for what goes in mathlib; heavy dependencies are fine in the mathlib archive without needing to be concerned with whether the particular case of Dirichlet used is or is not an elementary one. Rather, the key question for whether to keep an elementary special case of Dirichlet in mathlib would be whether there is likely to be anything added to mathlib itself that (a) depends on such a case and (b) ought to have limited dependencies.</p>",
        "id": 484422168,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1732587066
    },
    {
        "content": "<p>Moving to a particular IMO file in the mathlib archive doesn't seem such a good idea, though, since quite likely other IMO problems might also want to use that special case. (Though IMO 2003 P6 is more a matter of \"solution uses similar ideas\" than \"solution quotes the result\" - albeit that there is said to be a solution to 2003 P6 by quoting Chebotarev. Maybe once we have Chebotarev formalized we can see if that ends up much shorter than the elementary solution in compfiles.)</p>",
        "id": 484422660,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1732587445
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130609\">Antoine Chambert-Loir</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Prerequisites.20for.20PNT.20and.20Dirichlet's.20Thm/near/484397391\">said</a>:</p>\n<blockquote>\n<p>You see, I'm not sure the full Dirichlet's theorem will have many applications in mathlib before some time!<br>\nThe congruent to one case has a nice proof that can serve as an interesting example to people, and I would even suggest that mathlib documents it.</p>\n</blockquote>\n<p>How about bounded generation of higher rank groups like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><msub><mi>L</mi><mi>n</mi></msub><mo stretchy=\"false\">(</mo><mi mathvariant=\"double-struck\">Z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SL_n(\\Z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathbb\">Z</span><span class=\"mclose\">)</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>≥</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">n\\ge3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>...?</p>",
        "id": 484433073,
        "sender_full_name": "Alex Kontorovich",
        "timestamp": 1732595083
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"112680\">Johan Commelin</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Prerequisites.20for.20PNT.20and.20Dirichlet's.20Thm/near/484355848\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/NumberTheory/PrimesCongruentOne.html\">Mathlib.NumberTheory.PrimesCongruentOne</a> is used in an IMO problem. It seems a bit extravagant to use Dirichlet for that... but ey, it typechecks <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span></p>\n</blockquote>\n<p>Which one? There's always the possibility that there's some alternate solution without it that isn't much harder.</p>",
        "id": 484447765,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732605632
    },
    {
        "content": "<p>Archive/Imo/Imo2008Q3.lean</p>",
        "id": 484448284,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1732605892
    },
    {
        "content": "<p>Seems like it just needs infinitely many primes congruent to 1 mod 4</p>",
        "id": 484449824,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1732606711
    },
    {
        "content": "<p>And there's an elementary proof of this (given finitely many such primes, multiply them all together, double, square, add one and take a factor, using the fact that -1 is a square mod the factor)</p>",
        "id": 484451336,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732607382
    },
    {
        "content": "<p>And having primes congruent to -1 mod 4 is easy as well. Even easier.</p>",
        "id": 484556949,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1732639978
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Prerequisites.20for.20PNT.20and.20Dirichlet's.20Thm/near/484451336\">said</a>:</p>\n<blockquote>\n<p>And there's an elementary proof of this (given finitely many such primes, multiply them all together, double, square, add one and take a factor, using the fact that -1 is a square mod the factor)</p>\n</blockquote>\n<p>Although technically this proof follows the same route as the general 1 mod n proof, since you're using the fourth cyclotomic polynomial.</p>",
        "id": 484557357,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1732640111
    },
    {
        "content": "<p>I think the general version of the elementary argument for primes -1 mod 4 results in: given a subgroup of <code>(ZMod n)ˣ</code> that's not the whole group, there are infinitely many primes whose values mod n are not in that subgroup.</p>",
        "id": 484634832,
        "sender_full_name": "Joseph Myers",
        "timestamp": 1732678528
    },
    {
        "content": "<p>The general result is (I think) that there infinitely many primes not congruent to 1 mod n, but this gives -1 only mod 4.</p>",
        "id": 484659515,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1732694587
    },
    {
        "content": "<p>That's the special case of what <span class=\"user-mention\" data-user-id=\"266253\">@Joseph Myers</span> says when the subgroup is trivial. But the more general result also includes the statement that there are infinitely many primes that are quadratic nonresidues mod a fixed prime, for example. (And the complementary statement that there are infinitely many primes that are quadratic residues follows from an argument like the one <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> has sketched.)</p>",
        "id": 484686197,
        "sender_full_name": "Michael Stoll",
        "timestamp": 1732703077
    }
]