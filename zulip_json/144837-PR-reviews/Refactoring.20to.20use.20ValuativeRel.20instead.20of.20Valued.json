[
    {
        "content": "<p>I'd like to use this thread to track PRs in the Valued -&gt; ValuativeRel refactor. I am planning on doing it in three ways:</p>\n<ul>\n<li>PRs that build API up bottom up for ValuativeRel</li>\n<li>PRs that work backwards from leaf files, replacing usages of Valued with ValuativeRel</li>\n<li>PRs that improve existing Valued usage to make it easier for them to get refactored later</li>\n</ul>\n<p>Here are some outstanding PRs in these directions</p>",
        "id": 527182254,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751635972
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26712\">#26712</a> (+43/-1): additional API for ValuativeRel</p>",
        "id": 527182322,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751635991
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26713\">#26713</a> (+151/-1) (relies on previous): helper instance to get a Valued from ValuativeTopology</p>",
        "id": 527182404,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751636023
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/25450\">#25450</a> (+272/-30): ideal and submodule versions of Valuation.ltAddSubgroup</p>",
        "id": 527182531,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751636070
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26524\">#26524</a> (+35/-22): Valuation.Integers implies IsFractionRing</p>",
        "id": 527182593,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751636089
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26545\">#26545</a> (+94/-33): generalizing lemmas about valuation of irreducibles in the subring, so that they can be applied to a Valued (or ValRel in the future)</p>",
        "id": 527182719,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751636129
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26549\">#26549</a> (+205/-84) (relies on previous): refactor locally compact proofs to discuss Valued instead of NormedField -- will make it easier to switch to ValRel</p>",
        "id": 527182843,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751636170
    },
    {
        "content": "<p>I will also be adding soon PRs on interaction of ValuativeRel.IsRankLeOne and Valuation.RankOne (below), as well as NormedField implies ValuativeTopology.</p>",
        "id": 527182965,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751636217
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span> <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> <span class=\"user-mention\" data-user-id=\"300245\">@Filippo A. E. Nuccio</span> <span class=\"user-mention\" data-user-id=\"816344\">@Aaron Liu</span></p>",
        "id": 527183022,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751636234
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26754\">#26754</a> (+79/-7): Valuation.RankOne iff ValuativeRel.isRankLeOne</p>",
        "id": 527204342,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751645007
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26713\">#26713</a>¬†(+108/0): helper instance to get a Valued from ValuativeTopology -- now ready for review</p>",
        "id": 527377663,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751841416
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26826\">#26826</a> (+19/-12): generalize Valuation.IsEquiv inequality lemmas to not require DivisionRing</p>",
        "id": 527377713,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751841485
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26827\">#26827</a> (+296/-12) (includes two above): NormedDivisionRing induces scoped ValuativeRel (substitute for NormedField-&gt;Valued)</p>",
        "id": 527377758,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751841549
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26829\">#26829</a> (+177/-0): ideal and submodule versions of Valuation.ltAddSubgroup, without lemmas about their clopen-ness for Valued. This is a subset of <a href=\"https://github.com/leanprover-community/mathlib4/pull/25450\">#25450</a> to avoid interaction with Valued, as requested by Filippo.</p>",
        "id": 527377811,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751841614
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26833\">#26833</a> (+12/-0): MulArchimedean (ValueGroupWithZero R) when IsRankLeOne. I left a <code>proof_wanted</code> for the reverse implication.</p>",
        "id": 527396615,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751861555
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26834\">#26834</a> (waiting on <a href=\"https://github.com/leanprover-community/mathlib4/pull/26713\">#26713</a>, will be +13/-0): add notation of ùí™[K]</p>",
        "id": 527397457,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751862346
    },
    {
        "content": "<p>Wow, thanks for the amazing work (let me also add <span class=\"user-mention\" data-user-id=\"406490\">@Mar√≠a In√©s de Frutos Fern√°ndez</span> to the thread): just to be sure, are you on the long run thinking about getting rid of <code>Valued</code> (so that it will disappear from mathlib) or refactor its definition by something related to <code>ValuativeRel</code>?</p>",
        "id": 527418682,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1751874533
    },
    {
        "content": "<p>My understanding from the comment thread on the PR that made ValuativeRel is that we'd like to refactor Mathlib to prefer ValuativeRel instead of Valued. Following this my plan is to provide helper instances of how one implies the other, and convert Mathlib results that mention Valued to ones that mention ValuativeRel. Then, deprecate Valued without removing it outright. </p>\n<p>This way, downstream users that still rely on Valued can use all the current results, thanks to the helper instances that give ValuativeRel, and can take a gradual approach to refactoring.</p>",
        "id": 527447947,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751884134
    },
    {
        "content": "<p>That sounds perfect, but are you sure that there is a way to \"deprecate a class\"?</p>",
        "id": 527448072,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1751884186
    },
    {
        "content": "<p>We've done such deprecations for class declarations like with the rename of UniformAddGroup to IsUniformAddGroup</p>",
        "id": 527449877,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751884897
    },
    {
        "content": "<p>Yes, I agree that you can deprecate some name when it changes, but deprecating a declaration altogether?</p>",
        "id": 527449968,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1751884931
    },
    {
        "content": "<p>One can deprecate a declaration without providing a direct alias reference to the same statement. Like in <a href=\"https://github.com/leanprover-community/mathlib4/blob/master/Mathlib%2FDeprecated%2FOrder.lean\">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib%2FDeprecated%2FOrder.lean</a></p>",
        "id": 527450552,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751885125
    },
    {
        "content": "<p>Excellent, I was unaware of this. Then yes, I agree that your plan looks perfect, including the deprecation instead of direct erasure.</p>",
        "id": 527450673,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1751885163
    },
    {
        "content": "<p>There is a bit of an obstacle in completely generalizing away from NontriviallyNormedField since results on LocallyCompact are phrased using <code>ProperSpace</code>, and <code>ProperSpace</code> requires <code>PseudoMetricSpace</code>. An example result that needs to be generalized to <code>UniformSpace</code> would be <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=NormedField.completeSpace_iff_isComplete_closedBall#doc\">docs#NormedField.completeSpace_iff_isComplete_closedBall</a></p>",
        "id": 527532375,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751911786
    },
    {
        "content": "<p>What is a ball without <code>PseudoMetricSpace</code>?</p>",
        "id": 527533008,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751912004
    },
    {
        "content": "<p>What would be needed here is a complete entourage in the uniformity, such that any entourage can be scaled to be inside this complete entourage.</p>",
        "id": 527533471,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751912156
    },
    {
        "content": "<p>what is scaling in a uniform space?</p>",
        "id": 527533700,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751912245
    },
    {
        "content": "<p>does <code>Set.univ</code> count as such an entourage?</p>",
        "id": 527533749,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1751912264
    },
    {
        "content": "<blockquote>\n<p>scaling in a uniform space</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">SMul</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">UniformContinuousConstSMul</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 527535390,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751912806
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/527377758\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26827\">#26827</a> (+296/-12) (includes two above): NormedDivisionRing induces scoped ValuativeRel (substitute for NormedField-&gt;Valued)</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26827\">#26827</a> is now (+242/-25): it includes some proof refactor to refer to uniform space balls. LMK if that is not useful.</p>",
        "id": 527539185,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751913938
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/527397457\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26834\">#26834</a> (waiting on <a href=\"https://github.com/leanprover-community/mathlib4/pull/26713\">#26713</a>, will be +13/-0): add notation of ùí™[K]</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26834\">#26834</a> (+13/-0): add notation of ùí™[K]</p>",
        "id": 527539352,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751913984
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26874\">#26874</a> (+13/-0): ValuativeRel + UniformSpace implies Valued (scoped)</p>",
        "id": 527539488,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751914026
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26885\">#26885</a> (+95/-10): ValuativeTopology ùí™[K] (depends on notation PR)</p>",
        "id": 527594374,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751941832
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26886\">#26886</a> (+315/-25, depends on normed field PR): ValuativeRel ‚Ñö_[p] and associated instances</p>",
        "id": 527597036,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1751944574
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/527533749\">said</a>:</p>\n<blockquote>\n<p>does <code>Set.univ</code> count as such an entourage?</p>\n</blockquote>\n<p>If <code>Set.univ</code> is complete, then sure</p>",
        "id": 527633126,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1751964268
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/26942\">#26942</a> (+236/-14): isomorphism of value groups when compatible</p>",
        "id": 527936924,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752082849
    },
    {
        "content": "<p>Relies on small API PRs <a href=\"https://github.com/leanprover-community/mathlib4/pull/26939\">#26939</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/26940\">#26940</a>, <a href=\"https://github.com/leanprover-community/mathlib4/pull/26941\">#26941</a>. Should help with RankOne refactoring.</p>",
        "id": 527936975,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752082877
    },
    {
        "content": "<p>Is there no point in keeping <code>Valued</code> purely as a convenient way to have a canonical valuation?</p>",
        "id": 528107621,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752160874
    },
    {
        "content": "<p>Or is the idea that we should just use <code>Compatible</code> hypotheses?</p>",
        "id": 528108933,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752161316
    },
    {
        "content": "<p>I don't know. It's not just a canonical valuation, it's also a canonical target monoid, which is what was causing problems.</p>",
        "id": 528120673,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752164976
    },
    {
        "content": "<p>Imagine you start from a ring, and define a valuation on it. What is the way to get the corresponding topology? For the moment, one has to use <code>Valued</code>, no? Although, of course, the path through <code>ValuationRel</code> will be more natural.</p>",
        "id": 528170168,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1752187979
    },
    {
        "content": "<p>Something like <code>TopologicalSpace.induced (ValuativeRel.valuation R) (nhdsAdjoint atBot)</code></p>",
        "id": 528171060,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752188547
    },
    {
        "content": "<p>I don't think that works.</p>",
        "id": 528328884,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752236830
    },
    {
        "content": "<p>But indeed one should be able to create the topology from just the relation (and eventually the canonical valuation associated to it).</p>",
        "id": 528329233,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752236934
    },
    {
        "content": "<p>Related: I commented on <a href=\"https://github.com/leanprover-community/mathlib4/pull/26827\">#26827</a> to argue that it would be good to have API allowing to study any/the <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuatedTopology#doc\">docs#ValuatedTopology</a> associated to a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuativeRel#doc\">docs#ValuativeRel</a> through any <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valuation.Compatible#doc\">docs#Valuation.Compatible</a> valuation. Since I don't know how these things are used in practice I may be completely wrong, but I wonder what people here think about this.</p>",
        "id": 528329907,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752237161
    },
    {
        "content": "<p>The delicate issue here, as Antoine has been keen to stress, is that the naive topology associated to a valuation (pull back sets of the form B_eps := {x : 0 &lt;= x &lt; eps} in the target and these are a basis of nhds of 0 in the domain) is not the correct topology; the issue is that the target type might be gigantic and include e.g. infinitely small elements which are not in the imge of the valuation map, meaning that the corresponding B_eps pulls back to {0} giving you the discrete topology). Indeed this ValuativeRel business is exactly trying to get around that problem.</p>",
        "id": 528357335,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752245942
    },
    {
        "content": "<p>Can you give an example?</p>",
        "id": 528357643,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752246027
    },
    {
        "content": "<p>To put it another way, you can have two valuations which are compatible with the rel, but which introduce different \"naive\" topologies on the ring</p>",
        "id": 528357689,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752246039
    },
    {
        "content": "<p>Another approach (that has been not been deemed very efficient, so I'm developing it mainly for other reasons) is to only look at the <em>range</em> of the valuation, as in <a href=\"https://github.com/leanprover-community/mathlib4/pull/26588\">#26588</a> .</p>",
        "id": 528358034,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1752246138
    },
    {
        "content": "<p>Aaron yes: take your favourite ring, which is the p-adic numbers, which has an interesting topology. Put the usual valuation on it, taking values in, say, the non-negative reals. Now change the target groupwithzero by adding in a formal new infinitely small element e, with 0&lt;e but e&lt;epsilon for all real epsilon&gt;0, and then beef up the system to make it a totally ordered group with zero again (so basically add in re^n for n an integer and r a positive real). Now use the same valuation, but now you have a different topology because there are open nhds of 0 in the target which now miss v(x) for all nonzero x (namely open ball centre 0 radius e) and their preimage under v is now just {0} which has mysteriously become open.</p>",
        "id": 528358209,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752246207
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528358209\">said</a>:</p>\n<blockquote>\n<p>0&lt;e but e&lt;epsilon for all real epsilon&gt;0</p>\n</blockquote>\n<p>I thought the domain was the padics?</p>",
        "id": 528358419,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752246275
    },
    {
        "content": "<p>The valuation is on the p-adics, I'm altering the target groupwithzero, sorry, I made a typo, now fixed. Thanks.</p>",
        "id": 528358496,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752246298
    },
    {
        "content": "<p>Yes, but the point is that the <em>codomain</em> can a priori be anything</p>",
        "id": 528358499,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1752246299
    },
    {
        "content": "<p>(yeah I made a typo)</p>",
        "id": 528358666,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752246349
    },
    {
        "content": "<p>Look at this example<br>\n<a href=\"#narrow/channel/116395-maths/topic/Question.20about.20.60Valued.2Eis_topological_valuation.60/near/528153343\">#maths &gt; Question about &#96;Valued.is_topological_valuation&#96; @ üí¨</a> <br>\nby <span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> , building upon a previous idea of <span class=\"user-mention\" data-user-id=\"611077\">@Jiang Jiedong</span> .</p>",
        "id": 528358667,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1752246349
    },
    {
        "content": "<p>I thought the target groupwithzero was <code>ValuativeRel.ValueGroupWithZero</code> and you weren't supposed to alter it</p>",
        "id": 528358675,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752246351
    },
    {
        "content": "<p>My understanding of what Anatole was suggesting is that we talk about the topology associated to an arbitrary valuation which is compatible with the rel, and the technical issue with this is precisely that if you allow arbitrary valuations then you can't control the target groupwithzero.</p>",
        "id": 528358911,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752246416
    },
    {
        "content": "<p>There is a middle ground to be had here, which may be what Anatole has in mind (I haven't followed all the discussion the last few hours). Namely, the definition of <code>ValuativeTopology</code> uses <code>ValuativeRel.ValueGroupWithZero</code> in its definition, but all the api lemmas about <code>ValuativeTopology</code> are stated in terms of an arbitrary valuation <code>v</code> satisfying <code>[v.Compatible]</code>. Since <code>ValuativeRel.valuation</code> is compatible, that means that this approach is strictly more general.</p>",
        "id": 528359364,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752246563
    },
    {
        "content": "<p>The example linked above is showing that the current mathlib <code>Valution.IsEquiv</code> isn't strong enough, which means that I'm afraid that <code>v.Compatible</code> isn't strong enough.</p>",
        "id": 528359599,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752246627
    },
    {
        "content": "<p>I'm not sure what you mean <span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> .</p>",
        "id": 528359812,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752246689
    },
    {
        "content": "<p>Whatever issues we might have with <code>Valuation.IsEquiv</code>, this is the notion which is in the literature so we're stuck with it.</p>",
        "id": 528359827,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752246694
    },
    {
        "content": "<p>you could restrict to the range before pulling back a neighborhood of zero</p>",
        "id": 528359893,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752246715
    },
    {
        "content": "<p>The lemmas need to hold true for <em>arbitrary</em> valuations <code>v</code> which are compatible</p>",
        "id": 528359928,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752246723
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"816344\">Aaron Liu</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528359893\">said</a>:</p>\n<blockquote>\n<p>you could restrict to the range before pulling back a neighborhood of zero</p>\n</blockquote>\n<p>Yes, that's exactly what is done in the literature, although it is more complicated than you might think because the domain is typically a ring, so the image of the valuation is a monoid with zero, and for technical reasons one wants to look at the associated group with zero, so things can get a bit messy.</p>",
        "id": 528360149,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752246791
    },
    {
        "content": "<p>I'll try to formalize what I mean.</p>",
        "id": 528360461,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752246890
    },
    {
        "content": "<p>See definition 1.22 (value group, after (c)), and def 1.27 of equiv (one definition using value groups, one using rel) and definition 5.39 (topology associated to a valuation, which has to use the value group rather than the target groupwithzero) of <a href=\"https://arxiv.org/abs/1910.05934\">https://arxiv.org/abs/1910.05934</a></p>",
        "id": 528361684,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752247287
    },
    {
        "content": "<p>I know about the codomain vs range issue, I‚Äôve talked about this with Antoine a few times. What I had in mind is indeed that all the lemmas for an arbitrary valuation would only refer to balls with radii a quotient of valuations of elements of the ring. And maybe have a predicate like <code>Valuation.DenseAtZero</code> with conditions allowing to take any element in the codomain as a radius.</p>",
        "id": 528366887,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752249104
    },
    {
        "content": "<p>And again, I agree that doing the definitions in terms of the relation is cleaner. But in practice people may want to use their favorite valuation, no ?</p>",
        "id": 528367365,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752249237
    },
    {
        "content": "<p>What is \"their favorite valuation\"?</p>",
        "id": 528367568,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752249279
    },
    {
        "content": "<p>In practice people would prove theorems about valued fields.</p>",
        "id": 528367640,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752249293
    },
    {
        "content": "<p>you could argue that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mi>p</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.975em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> has a preferred valuation, but I think in practice we would prove theorems about local fields of characteristic zero, instead of just that one example</p>",
        "id": 528368430,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752249514
    },
    {
        "content": "<p>FWIW, a lot of the work concerning \"playing with the range rather than a random huge group\" was being done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/26872\">#26872</a>, but we're thinking about giving up if you all agree that <code>Valued</code> will disappear. The main problem is that currently <code>toNormedField</code> depends both on <code>RankOne</code> and on <code>Valued</code>: if we refactor <code>RankOne</code> to mean that the range embeds in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">R</mi><mrow><mo>‚â•</mo><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}_{\\geq 0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9341em;vertical-align:-0.2452em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mrel mtight\">‚â•</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2452em;\"><span></span></span></span></span></span></span></span></span></span>, we also need to refactor <code>Valued</code> (so that the topology is defined in terms of the <code>valueGroup</code>) for <code>toNormedValued</code> to compile. This might not be too long (or yes? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> ) but if <code>Valued</code> is going to die at any rate, it is probably a waste of time.</p>",
        "id": 528369385,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1752249848
    },
    {
        "content": "<p>I think the better approach is to define a <code>ValuativeRel.CompatibleNorm</code> class stating that a <code>NormedRing</code> structure is compatible with a <code>ValuativeRel</code>, and provide a constructor <code>toNormedValued</code> that takes a compatible real-valued valuation as a parameter.</p>",
        "id": 528369788,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752249985
    },
    {
        "content": "<p>This way <code>NormedRing</code> and <code>ValuativeRel</code> can coexist.</p>",
        "id": 528369836,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752250006
    },
    {
        "content": "<p>Here's what I mean. I construct a new valuation that is into <code>Zm0 x Zm0</code> that is compatible with the regular valuation on Q_p, but would induce a different <code>TopologicalSpace</code> if one used its <code>Valuation.subgroups_basis</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">vothercomp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Compatible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- should be a .of_isEquiv constructor</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">otherIsEquiv</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">vcomp</span><span class=\"bp\">.</span><span class=\"n\">rel_iff_le</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"c1\">-- now imagine we had not already had a topology on `Q_[p]`</span>\n<span class=\"c1\">-- but instead used the valuation's topology like how Valued.mk' does</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">otherv_disc</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">@</span><span class=\"n\">DiscreteTopology</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">topology</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">discreteTopology_of_isOpen_singleton_zero</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">topology</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">isOpen_iff_mem_nhds</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_singleton_iff</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">hasBasis_nhds_zero</span><span class=\"bp\">.</span><span class=\"n\">mem_iff</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">problem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">?_‚ü©</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Valuation</span><span class=\"bp\">.</span><span class=\"n\">ltAddSubgroup</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"c1\">-- here, the ValuativeRel is still from the \"true\" valuation on `‚Ñö_[p]`</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">topology</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">topology</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">otherv_disc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mem_nhds_discrete</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">H</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">subset_singleton_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Œ≥</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hŒ≥</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">valuation_surjective</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">vIsEquiv</span><span class=\"bp\">.</span><span class=\"n\">lt_div_iff_lt_div</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hŒ≥</span>\n<span class=\"w\">   </span><span class=\"c1\">-- multiply by some power of `p`</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">hx0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ≥</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">lt_div_iff‚ÇÄ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zero_lt_iff</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 528375238,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752252273
    },
    {
        "content": "<p>The full example is</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"n\">LinearOrderedCommGroupWithZero</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">Œì‚ÇÄ</span><span class=\"w\"> </span><span class=\"n\">Œì'‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Ring</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"n\">Œì‚ÇÄ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedCommGroupWithZero</span><span class=\"w\"> </span><span class=\"n\">Œì'‚ÇÄ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">Œì‚ÇÄ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">Œì'‚ÇÄ</span><span class=\"o\">}</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">eq_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">val_eq</span>\n<span class=\"w\">  </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">v‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">map_zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"bp\">.</span><span class=\"n\">map_zero</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">div_le_iff_div_le</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">eq_zero</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">div_le_iff‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_lt_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">div_le_iff‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_lt_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">ne_zero</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">)),</span>\n<span class=\"w\">      </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">le_div_iff_le_div</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hz</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hz</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">eq_zero</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hz</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">eq_zero</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">le_div_iff‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_lt_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">hz</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">le_div_iff‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero_lt_iff</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">ne_zero</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"w\"> </span><span class=\"n\">hz</span><span class=\"o\">)),</span>\n<span class=\"w\">      </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">map_mul</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">div_lt_iff_div_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">le_iff_le_iff_lt_iff_lt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">le_div_iff_le_div</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">lt_div_iff_lt_div</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÅ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">v‚ÇÇ</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">le_iff_le_iff_lt_iff_lt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">div_le_iff_div_le</span><span class=\"o\">]</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span>\n\n<span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞</span><span class=\"o\">)</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞À£</span><span class=\"w\"> </span><span class=\"bp\">√ó‚Çó</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞À£</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toMonoidWithZeroHom</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toMonoidWithZeroHom</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">toMonoidWithZeroHom</span>\n<span class=\"w\">  </span><span class=\"n\">map_add_le_max'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">    </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">monotone'</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">map_add_le_max'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">))</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">other_apply</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">coe</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">toLex</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">mk0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- simp lemmas get in the way</span>\n<span class=\"w\">  </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">inr_eq_coe_inr‚Çó</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">otherIsEquiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">other_apply</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">other_apply</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">Lex</span><span class=\"bp\">.</span><span class=\"n\">toLex_le_toLex</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">val_le_val</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">problem</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞À£</span><span class=\"w\"> </span><span class=\"bp\">√ó‚Çó</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞À£</span><span class=\"o\">))</span><span class=\"bp\">À£</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">OrderMonoidHom</span><span class=\"bp\">.</span><span class=\"n\">inl‚Çó</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞À£</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞À£</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">OrderMonoidIso</span><span class=\"bp\">.</span><span class=\"n\">unitsWithZero</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">ofAdd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)))</span>\n<span class=\"w\">  </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">OrderMonoidIso</span><span class=\"bp\">.</span><span class=\"n\">unitsWithZero</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"w\"> </span><span class=\"n\">r</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">  </span><span class=\"n\">contrapose!</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hx</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">other_apply</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">Lex</span><span class=\"bp\">.</span><span class=\"n\">toLex_le_toLex</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">val_lt_val</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">Multiplicative</span><span class=\"bp\">.</span><span class=\"n\">toAdd_lt</span><span class=\"o\">]</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">]</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"c1\">-- #26942, among others</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">val_posSubmonoid_ne_zero</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">prop</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">posSubmonoid_def</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">contrapose!</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">]</span>\n\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Classical</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"bp\">·µê‚Å∞</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">toFun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">then</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">exp</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">valuation</span>\n<span class=\"w\">  </span><span class=\"n\">map_zero'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">map_one'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">  </span><span class=\"n\">map_mul'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">map_add_le_max'</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">norm_eq</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">x</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">vrel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofValuation</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">vcomp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"bp\">.</span><span class=\"n\">Compatible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">.</span><span class=\"n\">ofValuation</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">vIsEquiv</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">IsEquiv</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">isEquiv</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">vtop</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- this should use a `.ofHasBasis` constructor that I have in one of my PRs</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">s</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">gt_iff_lt</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Œµ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Œµpos</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"bp\">‚Äñ</span><span class=\"n\">x</span><span class=\"bp\">‚Äñ</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Œµ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">mk0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">trans'</span><span class=\"w\"> </span><span class=\"bp\">?_‚ü©</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hx0</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">      </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">eq_or_ne</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hy</span>\n<span class=\"w\">      </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Œµpos</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">val_mk0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">vIsEquiv</span><span class=\"bp\">.</span><span class=\"n\">lt_iff_lt</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">mem_ball</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">dist_zero_right</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hyx</span>\n<span class=\"w\">      </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">.</span><span class=\"n\">trans'</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">norm_eq</span><span class=\"w\"> </span><span class=\"n\">hx0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_eq</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">zpow_lt_zpow_right‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">exact_mod_cast</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">one_lt</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">?_</span>\n<span class=\"w\">      </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">log_lt_iff_lt_exp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">WithZero</span><span class=\"bp\">.</span><span class=\"n\">exp_log</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">&lt;;&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hx0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Œ≥</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">valuation_surjective</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">    </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">eq_or_ne</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hr0</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">eq_comm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hr</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">‚ü®‚Äñ</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">‚Äñ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">trans'</span><span class=\"w\"> </span><span class=\"bp\">?_‚ü©</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">norm_eq</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">zpow_pos</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">        </span><span class=\"n\">exact_mod_cast</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"bp\">.</span><span class=\"n\">out</span>\n<span class=\"w\">      </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hr0</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">      </span><span class=\"n\">rcases</span><span class=\"w\"> </span><span class=\"n\">eq_or_ne</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"k\">with</span><span class=\"w\"> </span><span class=\"n\">rfl</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">hy</span>\n<span class=\"w\">      </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">norm_div</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_eq</span><span class=\"w\"> </span><span class=\"n\">hr0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_eq</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">val_posSubmonoid_ne_zero</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">Metric</span><span class=\"bp\">.</span><span class=\"n\">mem_ball</span><span class=\"o\">,</span>\n<span class=\"w\">        </span><span class=\"n\">dist_zero_right</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">norm_eq</span><span class=\"w\"> </span><span class=\"n\">hy</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">vIsEquiv</span><span class=\"bp\">.</span><span class=\"n\">lt_div_iff_lt_div</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">lt_div_iff‚ÇÄ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">lt_div_iff‚ÇÄ</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">zpow_add‚ÇÄ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zpow_lt_zpow_iff_right‚ÇÄ</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">log_mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">log_lt_iff_lt_exp</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">exp_log</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">id</span>\n<span class=\"w\">        </span><span class=\"n\">all_goals</span><span class=\"w\"> </span><span class=\"n\">simp_all</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">one_lt</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">ne_zero</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zero_lt_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">vIsEquiv</span><span class=\"bp\">.</span><span class=\"n\">ne_zero</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">zpow_pos</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">        </span><span class=\"n\">exact_mod_cast</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"bp\">.</span><span class=\"n\">pos</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"bp\">.</span><span class=\"n\">out</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">vothercomp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">Compatible</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"c1\">-- should be a .of_isEquiv constructor</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">otherIsEquiv</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">vcomp</span><span class=\"bp\">.</span><span class=\"n\">rel_iff_le</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"c1\">-- now imagine we had not already had a topology on `Q_[p]`</span>\n<span class=\"c1\">-- but instead used the valuation's topology like how Valued.mk' does</span>\n\n<span class=\"kn\">instance</span><span class=\"w\"> </span><span class=\"n\">otherv_disc</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">@</span><span class=\"n\">DiscreteTopology</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">topology</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">discreteTopology_of_isOpen_singleton_zero</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">topology</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">isOpen_iff_mem_nhds</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_singleton_iff</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">hasBasis_nhds_zero</span><span class=\"bp\">.</span><span class=\"n\">mem_iff</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">problem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"bp\">?_‚ü©</span>\n<span class=\"w\">  </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Valuation</span><span class=\"bp\">.</span><span class=\"n\">ltAddSubgroup</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"c1\">-- here, the ValuativeRel is still from the \"true\" valuation on `‚Ñö_[p]`</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hp</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">topology</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hp</span>\n<span class=\"w\">  </span><span class=\"n\">letI</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">subgroups_basis</span><span class=\"bp\">.</span><span class=\"n\">topology</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">otherv_disc</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">({</span><span class=\"mi\">0</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">nhds</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">mem_nhds_discrete</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">H</span><span class=\"bp\">.</span><span class=\"n\">mem_nhds_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">subset_singleton_iff</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mem_setOf_eq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Œ≥</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hŒ≥</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">valuation_surjective</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">  </span><span class=\"n\">simp_rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">vIsEquiv</span><span class=\"bp\">.</span><span class=\"n\">lt_div_iff_lt_div</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hŒ≥</span>\n<span class=\"w\">   </span><span class=\"c1\">-- multiply by some power of `p`</span>\n<span class=\"w\">  </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÉ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñö_</span><span class=\"o\">[</span><span class=\"n\">p</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">hx0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hŒ≥</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">lt_div_iff‚ÇÄ</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zero_lt_iff</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 528375261,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752252286
    },
    {
        "content": "<p>But you constructed a topology that does not satisfy ValuativeTopology as it is currently defined. As long as ValuativeTopology doesn‚Äôt change, is there still an issue?</p>",
        "id": 528375788,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752252504
    },
    {
        "content": "<p>Correct. And so what I am saying is that <code>v.IsEquiv v'</code> or <code>v'.Compatible</code> does not promise that if <code>v.subgroups_basis.topology</code> is a <code>ValuativeTopology</code> then <code>v'.sugroups_basis.topology</code> is also a <code>ValuativeTopology</code>.</p>",
        "id": 528378205,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752253616
    },
    {
        "content": "<blockquote>\n<p>you constructed a topology that does not satisfy ValuativeTopology as it is currently defined</p>\n</blockquote>\n<p>Rather, I showed that the topology on <code>Q_p</code> as currently defined _is_ a <code>ValuativeTopology</code>, and that a topology coming from <code>other v</code> would not be.</p>",
        "id": 528378370,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752253683
    },
    {
        "content": "<p>‚ÄòAs currently defined‚Äô there refers to the definition of the class ValuativeTopology</p>",
        "id": 528378528,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752253742
    },
    {
        "content": "<p>Just a note that <code>Valued</code> may disappear, but that will not suppress the task of having a ring <code>R</code>, with some valuation <code>v</code>, and willing to <em>define</em> the corresponding topology on <code>R</code>. This is what is done in the API for <code>Valued</code>.</p>",
        "id": 528387634,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1752258003
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"930308\">Norbert Voelker</span> has marked this topic as resolved.</p>",
        "id": 528390694,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752259565
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300245\">Filippo A. E. Nuccio</span> has marked this topic as unresolved.</p>",
        "id": 528391324,
        "sender_full_name": "Notification Bot",
        "timestamp": 1752259923
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528378205\">said</a>:</p>\n<blockquote>\n<p>Correct. And so what I am saying is that <code>v.IsEquiv v'</code> or <code>v'.Compatible</code> does not promise that if <code>v.subgroups_basis.topology</code> is a <code>ValuativeTopology</code> then <code>v'.sugroups_basis.topology</code> is also a <code>ValuativeTopology</code>.</p>\n</blockquote>\n<p>I  think the point is then that <code>v.subgroup_basis.topology</code> is not the right construction!</p>",
        "id": 528392349,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752260300
    },
    {
        "content": "<p>One should rather define the subgroup basis on a ring <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> as indexed by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo>√ó</mo><mo stretchy=\"false\">{</mo><mi>r</mi><mi mathvariant=\"normal\">‚à£</mi><mi>v</mi><mi>r</mi><mo mathvariant=\"normal\">‚â†</mo><mn>0</mn><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">R \\times \\{ r | v r \\ne 0\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">√ó</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\">‚à£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\">ÓÄ†</span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">}</span></span></span></span>, sending <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(r,s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span> to the set of all <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span> such that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>‚ãÖ</mo><mi>v</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>&lt;</mo><mi>v</mi><mo stretchy=\"false\">(</mo><mi>r</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v(t) \\cdot v(s) &lt; v(r)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">‚ãÖ</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">)</span></span></span></span>.</p>",
        "id": 528392731,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752260454
    },
    {
        "content": "<p>... or index it by the nonzero elements of the subgroup-with-zero generated by the image of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>, as others have suggested (the two approaches should yield the same result)</p>",
        "id": 528393558,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752260825
    },
    {
        "content": "<p>... or you could go via the route <code>Valuation -&gt; ValuativeRel -&gt; SubgroupBasis</code></p>",
        "id": 528393614,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752260864
    },
    {
        "content": "<p>I think the subgroup basis would need to be indexed by a pair of <code>posSubmonoid</code> -- the first element can't be 0. At least that what my experiment below showed. Did I miss something?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">CommRing</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ValuativeRel</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">Topology</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"c1\">-- #26942, among others</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">val_posSubmonoid_ne_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">prop</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">posSubmonoid_def</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">contrapose!</span><span class=\"w\"> </span><span class=\"n\">this</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">valuation_eq_zero_iff</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â§·µ•</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">ValueGroupWithZero</span><span class=\"bp\">.</span><span class=\"n\">mk_eq_zero</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">simp</span><span class=\"kd\">]</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">valuation_posSubmonoid_ne_zero</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ne_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">valuation_eq_zero_iff</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">prop</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">rel_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â§·µ•</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚â§·µ•</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"kn\">notation</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">valuativeRelLt</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"w\"> </span><span class=\"s2\">\" &lt;·µ• \"</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"mi\">51</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">binrel</span><span class=\"bp\">%</span><span class=\"w\"> </span><span class=\"n\">ValuativeRel</span><span class=\"bp\">.</span><span class=\"n\">rel_lt</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">rel_lt_iff</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;·µ•</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚Üî</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">‚â§·µ•</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">‚â§·µ•</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Iff</span><span class=\"bp\">.</span><span class=\"n\">rfl</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">ValuativeTopology</span><span class=\"bp\">.</span><span class=\"n\">of_hasBasis</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">HasBasis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">True</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ValueGroupWithZero</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">À£</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">‚ü®</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">mem_iff</span><span class=\"o\">]</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">of_hasBasis_pair</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">HasBasis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\">  </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;·µ•</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">ValuativeTopology</span><span class=\"bp\">.</span><span class=\"n\">of_hasBasis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">to_hasBasis</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"bp\">‚ü©</span>\n<span class=\"w\">    </span><span class=\"c1\">-- by_cases hr : valuation R r = 0</span>\n<span class=\"w\">    </span><span class=\"c1\">-- ¬∑ refine ‚ü®1, trivial, ?_‚ü© -- the choice of unit won't matter here</span>\n<span class=\"w\">    </span><span class=\"c1\">--   intro x</span>\n<span class=\"w\">    </span><span class=\"c1\">--   simp only [valuation, Valuation.coe_mk, MonoidWithZeroHom.coe_mk, ZeroHom.coe_mk,</span>\n<span class=\"w\">    </span><span class=\"c1\">--     Units.val_one, Set.mem_setOf_eq]</span>\n<span class=\"w\">    </span><span class=\"c1\">--   -- goal is `(x * s) ‚â§·µ• r`, which means that since we have `r ‚â§·µ• 0`,</span>\n<span class=\"w\">    </span><span class=\"c1\">--   -- then we need `x ‚â§·µ• 0`, but x was arbitrary</span>\n<span class=\"w\">    </span><span class=\"c1\">--   sorry</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">mk0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"bp\">‚ü©</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">trivial</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_‚ü©</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hr</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">valuation</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">rintro</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"w\"> </span><span class=\"bp\">-</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">valuation_surjective</span><span class=\"w\"> </span><span class=\"n\">Œ≥</span><span class=\"bp\">.</span><span class=\"n\">val</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eq_comm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"bp\">‚ü®‚ü®</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">‚ü©</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simpa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">valuation</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">hr</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">prop</span><span class=\"bp\">‚ü©</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">?_‚ü©</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">setOf_subset_setOf</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">and_imp</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"w\"> </span><span class=\"n\">hx'</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">lt_div_iff‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zero_lt_iff</span><span class=\"o\">])]</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">valuation</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hx'</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 528398442,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752263635
    },
    {
        "content": "<p>Oh, yes, you're right. So both <code>r</code> and <code>s</code> should satisfy <code>v x \\neq 0</code>.</p>",
        "id": 528413404,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752272808
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"268315\">Anatole Dedecker</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528367365\">said</a>:</p>\n<blockquote>\n<p>And again, I agree that doing the definitions in terms of the relation is cleaner. But in practice people may want to use their favorite valuation, no ?</p>\n</blockquote>\n<p>What is your favourite <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">R</mi><mrow><mo>‚â•</mo><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\R_{\\geq0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9341em;vertical-align:-0.2452em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mrel mtight\">‚â•</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2452em;\"><span></span></span></span></span></span></span></span></span></span>-valued valuation on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mn>3</mn></msub><mo stretchy=\"false\">(</mo><msqrt><mrow><mo>‚àí</mo><mn>1</mn></mrow></msqrt><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_3(\\sqrt{-1})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1156em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8656em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">‚àí</span><span class=\"mord\">1</span></span></span><span style=\"top:-2.8256em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1744em;\"><span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>? There are two canonical ones. There is the one which sends an element to the amount that multiplication by it scales additive Haar measure (cf <a href=\"https://github.com/leanprover-community/mathlib4/pull/25829\">#25829</a>) which is completely canonical, and then there is the one which is the unique nonarchimedean valuation which extends the standard 3-adic valuation on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mn>3</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>; this is also completely canonical, and different; one is the square of the other, just like how the function sending a complex number to the amount it scales additive Haar measure is not the complex norm but its square. So <code>Valued</code> is a bit dangerous because maybe I want two different instances of <code>Valued Q3i NNReal</code></p>",
        "id": 528418549,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1752278227
    },
    {
        "content": "<p>Although I agree with the content of <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> 's comment, the current <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"fraktur\">p</mi></mrow><annotation encoding=\"application/x-tex\">\\mathfrak{p}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.713em;vertical-align:-0.1891em;\"></span><span class=\"mord mathfrak\">p</span></span></span></span>-adic valuation on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mn>3</mn></msub><mo stretchy=\"false\">(</mo><msqrt><mrow><mo>‚àí</mo><mn>1</mn></mrow></msqrt><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_3(\\sqrt{-1})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1156em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8656em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">‚àí</span><span class=\"mord\">1</span></span></span><span style=\"top:-2.8256em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1744em;\"><span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> actually takes values in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"double-struck\">Z</mi><mrow><mi>m</mi><mn>0</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}^{m0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Z</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span></span></span></span> (which is the new notation for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Z</mi><mrow><mi>m</mi><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}_{m0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>).</p>",
        "id": 528456468,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1752324769
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27111\">#27111</a>: (+3/-0): valuationSubring_integers, a shortcut lemma</p>",
        "id": 528589361,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752472605
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27112\">#27112</a> (+127/-0): <code>Int.set_denselyOrdered_iff_subsingleton</code>, but importantly, that subsets of Zm0 are not densely ordered, which is a critical ingredient for DVR of valuation subrings. This PR has some basic DenselyOrdered API as well</p>",
        "id": 528589452,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752472671
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27114\">#27114</a> (+10/-0): <code>MonoidWithZeroHom.(m)range_nontrivial</code>, the other ingredient to show that a valuation subring of a Zm0 valuation is a PIR, which implied DVR</p>",
        "id": 528589531,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752472722
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27116\">#27116</a> (+24/-6): R-algebras that go to <code>K_v</code> via <code>K</code> maintain <code>FaithfulSMul</code>, which gives helper simp lemmas and golfs proofs</p>",
        "id": 528589665,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752472792
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27117\">#27117</a> (+212/-6): combines the 4 PRs above + that the valuation subring of <code>K_v</code> for <code>v : HeightOneSpectrum A</code> is a DVR</p>",
        "id": 528589780,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752472852
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528392731\">said</a>:</p>\n<blockquote>\n<p>One should rather define the subgroup basis on a ring <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> as indexed by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi><mo>√ó</mo><mo stretchy=\"false\">{</mo><mi>r</mi><mi mathvariant=\"normal\">‚à£</mi><mi>v</mi><mi>r</mi><mo mathvariant=\"normal\">‚â†</mo><mn>0</mn><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">R \\times \\{ r | v r \\ne 0\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">√ó</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\">‚à£</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\">ÓÄ†</span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">}</span></span></span></span>, sending <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(r,s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span> to the set of all <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span> such that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>‚ãÖ</mo><mi>v</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>&lt;</mo><mi>v</mi><mo stretchy=\"false\">(</mo><mi>r</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v(t) \\cdot v(s) &lt; v(r)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">‚ãÖ</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">)</span></span></span></span>.</p>\n</blockquote>\n<p>There is a suggestion by <span class=\"user-mention\" data-user-id=\"268315\">@Anatole Dedecker</span> that subgroup basis be indexed by a set and a predicate, similarly to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Filter.HasBasis#doc\">docs#Filter.HasBasis</a>. This would eliminate some (moderately, but still painful) coercion stuff all over the proofs, but requires that someone takes care of this first.</p>",
        "id": 528700671,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1752510800
    },
    {
        "content": "<p>Antoine, does the phrasing of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">HasBasis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\">  </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;·µ•</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">})</span>\n</code></pre></div>\n<p>work for you?</p>\n<p>Should we also state things using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopologicalSpace.IsTopologicalBasis#doc\">docs#TopologicalSpace.IsTopologicalBasis</a> ?</p>",
        "id": 528704029,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752512099
    },
    {
        "content": "<p>Sorry, I disappeared for the weekend. First, let me insist that I do not want to block anything: building the theory on top of <code>ValuativeRel</code> is clearly the best thing to do, and the API can be cleaned up a bit later.</p>\n<p>Let me answer things a bit out of order.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528392349\">said</a>:</p>\n<blockquote>\n<p>I  think the point is then that <code>v.subgroup_basis.topology</code> is not the right construction!</p>\n</blockquote>\n<p>Indeed, this is what I had in mind: one should only take radii to be quotients of valuations of elements of the ring.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528393614\">said</a>:</p>\n<blockquote>\n<p>... or you could go via the route <code>Valuation -&gt; ValuativeRel -&gt; SubgroupBasis</code></p>\n</blockquote>\n<p>I think ultimately this is the way to go for the \"defining the topology\" part: we should have a way to endow the type with the unique topology compatible with a given valuative rel. But this is a different question of the API provided to study a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuativeTopology#doc\">docs#ValuativeTopology</a> through a single appropriate valuation.</p>",
        "id": 528846582,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752581845
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528418549\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"268315\">Anatole Dedecker</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528367365\">said</a>:</p>\n<blockquote>\n<p>And again, I agree that doing the definitions in terms of the relation is cleaner. But in practice people may want to use their favorite valuation, no ?</p>\n</blockquote>\n<p>What is your favourite <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">R</mi><mrow><mo>‚â•</mo><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\R_{\\geq0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9341em;vertical-align:-0.2452em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mrel mtight\">‚â•</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2452em;\"><span></span></span></span></span></span></span></span></span></span>-valued valuation on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mn>3</mn></msub><mo stretchy=\"false\">(</mo><msqrt><mrow><mo>‚àí</mo><mn>1</mn></mrow></msqrt><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_3(\\sqrt{-1})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1156em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8656em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">‚àí</span><span class=\"mord\">1</span></span></span><span style=\"top:-2.8256em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1744em;\"><span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>? There are two canonical ones. There is the one which sends an element to the amount that multiplication by it scales additive Haar measure (cf <a href=\"https://github.com/leanprover-community/mathlib4/pull/25829\">#25829</a>) which is completely canonical, and then there is the one which is the unique nonarchimedean valuation which extends the standard 3-adic valuation on <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mn>3</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8556em;vertical-align:-0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>; this is also completely canonical, and different; one is the square of the other, just like how the function sending a complex number to the amount it scales additive Haar measure is not the complex norm but its square. So <code>Valued</code> is a bit dangerous because maybe I want two different instances of <code>Valued Q3i NNReal</code></p>\n</blockquote>\n<p>This is actually a great example of my point. First, I am <strong>not</strong> advocating for <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Valued#doc\">docs#Valued</a>, precisely because valuations are not canonical enough compared to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuativeRel#doc\">docs#ValuativeRel</a>. When I said \"favorite valuation\", I really meant \"favorite in some context\", and that is the point: say that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mn>3</mn></msub><mo stretchy=\"false\">(</mo><msqrt><mrow><mo>‚àí</mo><mn>1</mn></mrow></msqrt><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_3(\\sqrt{-1})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1156em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8656em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">‚àí</span><span class=\"mord\">1</span></span></span><span style=\"top:-2.8256em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1744em;\"><span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> is endowed with a valuative topology, and you want to know that balls for the Haar valuation are a basis of neighborhoods at zero. Ideally, you should just need a lemma saying that this valuation is compatible with the relation, and another saying that its image is dense around zero in <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">R</mi><mrow><mo>‚â•</mo><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}_{\\geq 0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9341em;vertical-align:-0.2452em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mrel mtight\">‚â•</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2452em;\"><span></span></span></span></span></span></span></span></span></span>, and then you'd be able to work with the topology using this valuation instead of the abstract <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuativeRel.valuation#doc\">docs#ValuativeRel.valuation</a>. And likewise for your second choice of valuation. Does that make sense?</p>",
        "id": 528848208,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752582377
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528704029\">said</a>:</p>\n<blockquote>\n<p>Antoine, does the phrasing of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">HasBasis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\">  </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;·µ•</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">})</span>\n</code></pre></div>\n<p>work for you?</p>\n<p>Should we also state things using <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=TopologicalSpace.IsTopologicalBasis#doc\">docs#TopologicalSpace.IsTopologicalBasis</a> ?</p>\n</blockquote>\n<p>I think Antoine was specifically referring to the \"defining the topology through a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RingSubgroupsBasis#doc\">docs#RingSubgroupsBasis</a>\" step. But indeed the <code>HasBasis</code> statement would be the most useful once the topology exists.</p>",
        "id": 528848745,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752582550
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"243562\">Adam Topaz</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528368430\">said</a>:</p>\n<blockquote>\n<p>you could argue that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mi>p</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.975em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> has a preferred valuation, but I think in practice we would prove theorems about local fields of characteristic zero, instead of just that one example</p>\n</blockquote>\n<p>This is the part where my whole argument may break down: I don't know precisely how any of this will be used. It just felt wrong to design the API around the abstractly defined <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuativeRel.valuation#doc\">docs#ValuativeRel.valuation</a> only, because it would mean unnecessary boilerplate any time some other valuation would fit more naturally (e.g the one coming from the Haar measure if you're studying local fields, or a more specific one in the case of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">Q</mi><mi>p</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Q}_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.975em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">‚Äã</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> and Laurent Series). But if you tell me that this never happens then you can indeed ignore everything I've said.</p>",
        "id": 528850207,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752582994
    },
    {
        "content": "<p>I still don't really see what the issue is when you have some ring with a natural valuation. You can always define <code>ValuativeRel</code> using the canonical valuation, and include a <code>Valuation.Compatible</code> instance. As long as the API is developed generally enough using <code>Valuation.Compatible</code>, I don't see what issues would pop up?</p>",
        "id": 528854339,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752584197
    },
    {
        "content": "<p>Having the API developped generally enough using <code>Valuation.Compatible</code> is precisely my point, so I think we agree!</p>",
        "id": 528854893,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752584343
    },
    {
        "content": "<p>I see :) I thought that was implicitly understood!</p>",
        "id": 528855137,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752584403
    },
    {
        "content": "<p>Ah, maybe my initial message on this thread about <code>Valued</code> was giving the impression that I was advocating for <code>Valued</code> to stay, but this was really not my (main) point, and I'm okay with it disappearing. </p>\n<p>What I've been saying is that, eventually, <a href=\"https://github.com/leanprover-community/mathlib4/pull/26827\">#26827</a>'s <code>of_hasBasis</code> (for example) should allow any compatible valuation instead of specifically <code>ValuativeRel.valuation</code>.</p>",
        "id": 528855988,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752584602
    },
    {
        "content": "<p>Ah I see. Yes, I do agree with that. Sorry I didn't look closely enough before.</p>",
        "id": 528858482,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752585263
    },
    {
        "content": "<p>Indeed making this <code>of_hasBasis</code> use an arbitrary compatible valuation would be <em>strictly</em> more general than the current version.</p>",
        "id": 528858555,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752585287
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/Refactoring.20to.20use.20ValuativeRel.20instead.20of.20Valued/near/528704029\">said</a>:</p>\n<blockquote>\n<p>Antoine, does the phrasing of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">HasBasis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"n\">posSubmonoid</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\">  </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;·µ•</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">})</span>\n</code></pre></div>\n<p>work for you?</p>\n</blockquote>\n<p>I'm not sure I can tell, in any direction. I had rewritten everything using the ‚ÄúSubgroupWithZero‚Äù defined by the valuation, the difficulty was not the math, but the avalanche of coercions required in the middle of the argument. I can't predict whether this will be cleaner, or not.</p>",
        "id": 528865019,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1752587040
    },
    {
        "content": "<p>I think I've summarized the discussion above in the following theorems:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">of_hasBasis_compatible</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œì‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedCommMonoidWithZero</span><span class=\"w\"> </span><span class=\"n\">Œì‚ÇÄ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">TopologicalSpace</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">{</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">Œì‚ÇÄ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">Compatible</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">HasBasis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">})</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">ValuativeTopology</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">hasBasis_nhds_zero_compatible</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œì‚ÇÄ</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LinearOrderedCommMonoidWithZero</span><span class=\"w\"> </span><span class=\"n\">Œì‚ÇÄ</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Valuation</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"n\">Œì‚ÇÄ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">v</span><span class=\"bp\">.</span><span class=\"n\">Compatible</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">ùìù</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">HasBasis</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚àß</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">‚â†</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">rs</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 528876862,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752590302
    },
    {
        "content": "<p>Which is in <a href=\"https://github.com/leanprover-community/mathlib4/pull/27163\">#27163</a> (+105/-5): of and to basis of compatible valuations</p>",
        "id": 528876897,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752590310
    },
    {
        "content": "<p>The <code>x * rs.2 &lt;·µ• rs.1</code> are in there as well</p>",
        "id": 528877097,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752590352
    },
    {
        "content": "<p>An easy one: <a href=\"https://github.com/leanprover-community/mathlib4/pull/27167\">#27167</a> (adds an unexpander for the relation notation)</p>",
        "id": 528887949,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1752593416
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27177\">#27177</a> (+57/-0): ValuativeRel ‚Ñö_[p]. This is via Zm0, not via general normed field work in other PRs. Should be more direct and easier to review.</p>",
        "id": 528926104,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752606759
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27183\">#27183</a> (+91/-1): IsRankLeOne when there is a compatible Zm0 or NNReal valuation</p>",
        "id": 528953327,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752619565
    },
    {
        "content": "<p>Le or LE?</p>",
        "id": 528954199,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1752620050
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27207\">#27207</a> (+23/-0): ValuativeRel (WithVal v). Just the basics, no ValuativeTopology etc yet, waiting on other PRs for those.</p>",
        "id": 529061712,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752672912
    },
    {
        "content": "<p>Let me mention <a href=\"https://github.com/leanprover-community/mathlib4/pull/27181\">#27181</a> here: I had some fun playing with the definition of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=ValuativeRel.ValueGroupWithZero#doc\">docs#ValuativeRel.ValueGroupWithZero</a> to make it more conceptual and less ad-hoc:</p>\n<ul>\n<li>First, I define the equivalence relation associated to a valuative rel (I think this comes up often enough in the basic API to be justified) and the corresponding <code>ValueQuotient</code>. I show (by using some generic API) that this is always a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedCommMonoidWithZero#doc\">docs#LinearOrderedCommMonoidWithZero</a>, and that the quotient map is a valuation. I also show that it is a <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedCommGroupWithZero#doc\">docs#LinearOrderedCommGroupWithZero</a> when <code>R</code> is local with maximal ideal the support of the relation (and in particular a field).</li>\n<li>Then, I define the <code>ValuativeRel</code> on the localization of <code>R</code> with respect to any submonoid <code>S</code> of <code>posSubmonoid R</code>, and show that its support is the <code>Ideal.map</code> of the support of the original valuation.</li>\n<li>In particular, for <code>S = posSubmonoid R</code>, this localization is a local ring with maximal ideal the support of its valuation, so its <code>ValueQuotient</code> is a <code>LinearOrderedCommGroupWithZero</code>, and I take this as a definition of <code>ValueGroupWithZero R</code>.</li>\n<li>This means that we get all the structure on it by general arguments, but then I make sure that all the existing API matches (e.g all the induction stuff), but I'm not sure how much is really needed since we no longer need it to define e.g the order relation.</li>\n</ul>\n<p>I should probably have discussed it here before, but I just had a sudden burst of motivation to start this and then wanted to finish it. I don't think we gain anything (we don't really care about the definition after all), but I think the intermediate steps are nice byproducts, which should be interesting in any case.</p>",
        "id": 529487973,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1752853927
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27625\">#27625</a> (+33/-0): discrete topology on a valued field when trivial valuation. Part of the preparation for ValuativeTopology refactor.</p>",
        "id": 529528707,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752874257
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27264\">#27264</a> (+60/-0): range of valuation on competion is the same as base field. Also helper lemmas of Valued topology that use a <code>v r * v x &lt; v s</code> style, which is what we'll need for ValuativeTopology.</p>",
        "id": 529528788,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752874312
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27172\">#27172</a> (+169/-2): linearly ordered locally finite dense orders are trivial, now ready for review</p>",
        "id": 529533752,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752878322
    },
    {
        "content": "<p>I have a proof that in a dense locally finite order, no element is strictly less than another, and this proof is about 10 lines long and only imports <code>Mathlib.Order.Interval.Finset.Basic</code>. Would you be interested in taking a look?</p>",
        "id": 529534183,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752878687
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span>  Here it is</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>The whole thing</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LocallyFiniteOrder</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DenselyOrdered</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">hn</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">strongRecOn</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ind</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">subst</span><span class=\"w\"> </span><span class=\"n\">hn</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hcb</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exists_between</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">card_lt_card</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Icc_subset_Icc_right</span><span class=\"w\"> </span><span class=\"n\">hcb</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">ssubset_of_ne</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">ne_of_apply_ne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hab</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hcb</span><span class=\"bp\">.</span><span class=\"n\">not_ge</span><span class=\"o\">]</span>\n</code></pre></div>\n</div></div>\n<p>I never PR'd it because I didn't think it'd find a use.</p>",
        "id": 529534826,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752879336
    },
    {
        "content": "<p>you can combine what I have with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=nontrivial_iff_lt#doc\">docs#nontrivial_iff_lt</a> to get that linear dense locally finite order are trivial pretty easily</p>",
        "id": 529534943,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752879443
    },
    {
        "content": "<p>Great! That proof could help golf LocallyFiniteOrder.denselyOrdered_iff_subsingleton. The rest of the PR is installing instances of DenselyOrdered on various other types.</p>",
        "id": 529536501,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752880929
    },
    {
        "content": "<p>The current proof basically does strong induction on the finset, I just fail every single time to remember how to invoke strong induction properly.</p>",
        "id": 529537071,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1752881504
    },
    {
        "content": "<p>Congrats! You shaved a line:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Order</span><span class=\"bp\">.</span><span class=\"n\">Interval</span><span class=\"bp\">.</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Preorder</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">LocallyFiniteOrder</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">DenselyOrdered</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬¨</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">  </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">hs</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"kn\">using</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">strongInduction</span><span class=\"w\"> </span><span class=\"n\">generalizing</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"c1\">-- chore: rename `H` to `ind`</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">subst</span><span class=\"w\"> </span><span class=\"n\">hs</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hcb</span><span class=\"bp\">‚ü©</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">exists_between</span><span class=\"w\"> </span><span class=\"n\">hab</span>\n<span class=\"w\">    </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Icc</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">?_</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">hac</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Finset</span><span class=\"bp\">.</span><span class=\"n\">Icc_subset_Icc_right</span><span class=\"w\"> </span><span class=\"n\">hcb</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">ssubset_of_ne</span>\n<span class=\"w\">    </span><span class=\"n\">apply</span><span class=\"w\"> </span><span class=\"n\">ne_of_apply_ne</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">‚àà</span><span class=\"w\"> </span><span class=\"bp\">¬∑</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hab</span><span class=\"bp\">.</span><span class=\"n\">le</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hcb</span><span class=\"bp\">.</span><span class=\"n\">not_ge</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 529537194,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1752881671
    },
    {
        "content": "<p>The proof in the PR has been golfed using that.</p>",
        "id": 529709476,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753041076
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27312\">#27312</a> (+54/-0): the trivial valuation, as One (Valuation R Œì‚ÇÄ)</p>",
        "id": 529709490,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753041096
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27313\">#27313</a> (+182/-5): the trivial valuative relation, depends on the PR above. This is in a new <code>ValuativeRel/Trivial.lean</code> file -- I moved <code>Valuation/ValuativeRel.lean</code> to <code>Valuation/ValuativeRel/Basic.lean</code>.</p>",
        "id": 529709657,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753041339
    },
    {
        "content": "<p>this is in preparation for showing that the trivial relation, when <code>ValuativeTopology</code>, then <code>DiscreteTopology</code>, and the reverse. Which also then leads to a ValuativeRel on finite fields.</p>",
        "id": 529709708,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753041427
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27314\">#27314</a>: (+459/-111): the big kahuna. Refactoring Valued to use the <code>{rs | v x * v rs.1 &lt; v rs.2}</code> topology. Prove that this is coarser than the previous topology. Migrate all uses of topology of Valued to rely on this. Do not yet assume <code>ValuativeTopology</code>, but still provide a <code>ValuativeTopology</code> =&gt; <code>Valued</code> helper instance (scoped). This is basically the largest (intermediate) step in the refactor. This relies on 3 upstream PRs.</p>",
        "id": 529745867,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753068087
    },
    {
        "content": "<p>Re-upping <a href=\"https://github.com/leanprover-community/mathlib4/pull/27116\">#27116</a> (+16/-6), which is <code>[FaithfulSMul R K] =&gt; FaithfulSMul R (hat K)</code></p>",
        "id": 530643669,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753389915
    },
    {
        "content": "<p>Which leads to <a href=\"https://github.com/leanprover-community/mathlib4/pull/27117\">#27117</a> (+64/-6): IsDVR (K_v)</p>",
        "id": 530643785,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1753389970
    }
]