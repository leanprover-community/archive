[
    {
        "content": "<p>Hello, <a href=\"https://github.com/leanprover-community/mathlib4/pull/28818\">#28818</a> is a small PR adding a few simple theorems to <code>Setoid.ker</code>, wdyt?</p>",
        "id": 540906620,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758582786
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"933054\">@Snir Broshi</span> Hello, I have left comments.</p>",
        "id": 540970953,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758620625
    },
    {
        "content": "<p>Thanks! Updated and responded</p>",
        "id": 541064030,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758647648
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"933054\">@Snir Broshi</span> <code>abbrev</code> doesn't mean what you think it means, it basically just means \"look through this definition when you're doing typeclass searching\", and for your usecases there are very few instances that work on functions</p>",
        "id": 541070778,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758650032
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"933054\">@Snir Broshi</span> also I should expand more on <a href=\"https://github.com/leanprover-community/mathlib4/pull/28818#discussion_r2371730665\">this comment</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">kerLift_eq_apply_out</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">kerLift</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">out</span>\n</code></pre></div>\n<p>The reason I said that I doubt the usefulness of this theorem is that this is what I would consider a \"wrong path\" when you try to prove something. Instead of using <code>Quotient.out</code>, a far more tested path is to use <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Quotient.inductionOn#doc\">docs#Quotient.inductionOn</a> to convert the element of the quotient to the form <code>‚ü¶a‚üß</code>, which allows to use better definitional equalities (which <code>Quotient.out</code> does not have).</p>",
        "id": 541071837,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758650397
    },
    {
        "content": "<p>According to the <a href=\"https://lean-lang.org/doc/reference/latest/Definitions/Recursive-Definitions/#--tech-term-Reducible\">docs</a> <code>abbrev</code> makes stuff identical \"essentially everywhere\", which includes but is not limited to typeclass searching. I'm not sure what this includes, but I agree that the typeclass point isn't relevant here.</p>",
        "id": 541079489,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758653265
    },
    {
        "content": "<blockquote>\n<p>this is what I would consider a \"wrong path\"</p>\n</blockquote>\n<p>I think <code>Quotient.out</code> is much easier to grasp and use when translating mathematical proofs, even though <code>inductionOn</code> would be better. Proofs usually say \"pick a representative\" and not \"let's prove something for all equivalence classes\".</p>",
        "id": 541080638,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758653786
    },
    {
        "content": "<p>\"pick a representative\" is inherently evil</p>",
        "id": 541080725,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1758653826
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328818.20.60Setoid.2Eker_lift.60/near/541080638\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>this is what I would consider a \"wrong path\"</p>\n</blockquote>\n<p>I think <code>Quotient.out</code> is much easier to grasp and use when translating mathematical proofs, even though <code>inductionOn</code> would be better. Proofs usually say \"pick a representative\" and not \"let's prove something for all equivalence classes\".</p>\n</blockquote>\n<p>I agree that this is what people usually do in maths, but that's not what people usually do in Lean.</p>",
        "id": 541081477,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758654160
    },
    {
        "content": "<p>I was \"forced\" to get rid of all the <code>.out</code> in a code review and the resulting new code was really clean, so now I am in the \"don't pick a representative\" camp</p>",
        "id": 541083655,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758655124
    },
    {
        "content": "<p>Huh, I'm working on some topology theorem using connected components and I use <code>.out</code> a lot. I don't think I'll be able to get rid of all of it, but it sounds like it's worth trying.</p>",
        "id": 541091772,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758658386
    },
    {
        "content": "<p>Also since it seems like the popular opinion, maybe someone can write something about it in <a href=\"https://leanprover-community.github.io/extras/pitfalls.html\">Common Lean Pitfalls</a> which will guide new users away from <code>.out</code>?</p>",
        "id": 541091965,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758658464
    },
    {
        "content": "<p>Can the <a href=\"https://github.com/leanprover-community/mathlib4/blob/c73c039bf84773d203b6f130b7bb5c1de8c31694/Mathlib/Data/Setoid/Basic.lean#L121\"><code>.out</code></a> in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Setoid.piQuotientEquiv#doc\">docs#Setoid.piQuotientEquiv</a> be removed somehow?</p>",
        "id": 541092280,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758658621
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328818.20.60Setoid.2Eker_lift.60/near/541092280\">said</a>:</p>\n<blockquote>\n<p>Can the <a href=\"https://github.com/leanprover-community/mathlib4/blob/c73c039bf84773d203b6f130b7bb5c1de8c31694/Mathlib/Data/Setoid/Basic.lean#L121\"><code>.out</code></a> in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Setoid.piQuotientEquiv#doc\">docs#Setoid.piQuotientEquiv</a> be removed somehow?</p>\n</blockquote>\n<p>I don't think so</p>",
        "id": 541092846,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758658877
    },
    {
        "content": "<p>Unless you somehow put a well-ordering on Œπ and use well-founded recursion</p>",
        "id": 541092901,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758658904
    },
    {
        "content": "<p>I've replaced <code>abbrev</code> with <code>def</code>, and adjusted the <code>.out</code> theorem to have the <code>.out</code> on the LHS so that <code>rw</code> will replace <code>.out</code> with <code>kerLift</code>.<br>\nThese are the two theorems with <code>.out</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">ker_apply_mk_out</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">‚ü¶</span><span class=\"n\">a</span><span class=\"bp\">‚üß</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"bp\">@</span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">mk_out</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">a</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">apply_out_eq_kerLift</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">kerLift</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">nth_rw</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">out_eq</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"n\">rfl</span>\n</code></pre></div>\n<p>Should I remove one or both completely or is it okay like this?</p>",
        "id": 541094037,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758659374
    },
    {
        "content": "<p>Well the first one already exists in mathlib and is used <a href=\"https://github.com/search?q=repo%3Aleanprover-community%2Fmathlib4%20ker_apply_mk_out%20&amp;type=code\">once</a> so I wouldn't remove it, I personally would remove the second one but I'm not really sure.</p>",
        "id": 541094671,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1758659605
    },
    {
        "content": "<p>Removed <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 541095121,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758659784
    },
    {
        "content": "<blockquote>\n<p><code>abbrev</code>¬†doesn't mean what you think it means, it basically just means \"look through this definition when you're doing typeclass searching\", and for your usecases there are very few instances that work on functions</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/actions/runs/17958413812/job/51075623277?pr=28818\">https://github.com/leanprover-community/mathlib4/actions/runs/17958413812/job/51075623277?pr=28818</a></p>\n<p>If <code>kerLift</code> is a <code>def</code> and not <code>abbrev</code> the build fails because <a href=\"https://github.com/NotWearingPants/mathlib4/blob/8c1309a89c334bae82710409d9ef90adc2644317/Mathlib/NumberTheory/NumberField/CanonicalEmbedding/FundamentalCone.lean#L394\">some <code>convert</code> tactic</a> doesn't produce the same goal as before.<br>\nI reverted to <code>abbrev</code>, unless there are any other suggestions.</p>",
        "id": 541121134,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758672629
    },
    {
        "content": "<p>with <code>def</code>, you can still <code>unfold</code> the definition. Does that resolve the convert problem?</p>",
        "id": 541121463,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758672827
    },
    {
        "content": "<p>I tried that, it doesn't. The <code>convert</code> creates some weird goal with <code>HEq</code></p>",
        "id": 541121515,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758672862
    },
    {
        "content": "<p>I think I understand why it doesn't work, but I don't know what the solution should be. <code>Setoid.ker_lift_injective </code> was used on something defeq to <code>Quotient (ker f)</code>, but it can't be restated using the new <code>kerLift</code> (or, it would be very cumbersome)</p>",
        "id": 541122007,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758673192
    },
    {
        "content": "<p>Is this another instance of \"usage of Quotient has to pierce through defeq in an awkward way, until we get QuotLike\"?</p>",
        "id": 541122239,
        "sender_full_name": "Weiyi Wang",
        "timestamp": 1758673330
    },
    {
        "content": "<p>If you want to try, here's the broken code, isolated:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">NumberTheory</span><span class=\"bp\">.</span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">CanonicalEmbedding</span><span class=\"bp\">.</span><span class=\"n\">FundamentalCone</span>\n\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">Setoid</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">kerLift</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">ker</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">id</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">kerLift_injective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"bp\">.</span><span class=\"n\">Injective</span><span class=\"w\"> </span><span class=\"bp\">&lt;|</span><span class=\"w\"> </span><span class=\"n\">kerLift</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">inductionOn‚ÇÇ'</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">sound'</span><span class=\"w\"> </span><span class=\"n\">h</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">Setoid</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Field</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">mixedEmbedding</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">NumberField</span><span class=\"w\"> </span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">InfinitePlace</span>\n<span class=\"kn\">noncomputable</span><span class=\"w\"> </span><span class=\"kn\">section</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">Units</span><span class=\"w\"> </span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">Units</span><span class=\"bp\">.</span><span class=\"n\">dirichletUnitTheorem</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">NumberField</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">]</span>\n<span class=\"kn\">namespace</span><span class=\"w\"> </span><span class=\"n\">fundamentalCone</span>\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">K</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">mixedSpace</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span><span class=\"o\">}</span>\n<span class=\"kn\">open</span><span class=\"w\"> </span><span class=\"kn\">scoped</span><span class=\"w\"> </span><span class=\"n\">nonZeroDivisors</span>\n\n<span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">integerSetQuotEquivAssociates'</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">orbitRel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">torsion</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integerSet</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ</span><span class=\"w\"> </span><span class=\"n\">Associates</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"bp\">‚Å∞</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">ofBijective</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integerSetToAssociates</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">integerSetToAssociates_eq_iff</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">‚ü®</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">kerLift_injective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integerSetToAssociates</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"n\">all_goals</span>\n<span class=\"w\">        </span><span class=\"bp\">¬∑</span><span class=\"w\"> </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">ker_def</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eq_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">integerSetToAssociates_eq_iff</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span>\n<span class=\"w\">            </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">orbitRel_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">mem_orbit_iff</span><span class=\"o\">],</span>\n<span class=\"w\">        </span><span class=\"o\">(</span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">surjective_lift</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integerSetToAssociates_surjective</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"bp\">‚ü©</span>\n\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">fundamentalCone</span>\n<span class=\"kn\">end</span>\n<span class=\"kn\">end</span><span class=\"w\"> </span><span class=\"n\">NumberField</span><span class=\"bp\">.</span><span class=\"n\">mixedEmbedding</span>\n</code></pre></div>",
        "id": 541122262,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758673354
    },
    {
        "content": "<p>Swapping the <code>def</code> with <code>abbrev</code> fixes the issue, but also commenting the <code>open scoped nonZeroDivisors</code> for some reason. Though I think that'll break other stuff in the same file.</p>",
        "id": 541122338,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758673406
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328818.20.60Setoid.2Eker_lift.60/near/541092280\">said</a>:</p>\n<blockquote>\n<p>Can the <a href=\"https://github.com/leanprover-community/mathlib4/blob/c73c039bf84773d203b6f130b7bb5c1de8c31694/Mathlib/Data/Setoid/Basic.lean#L121\"><code>.out</code></a> in <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Setoid.piQuotientEquiv#doc\">docs#Setoid.piQuotientEquiv</a> be removed somehow?</p>\n</blockquote>\n<p>No! This equivalence is a form of the axiom of choice.</p>",
        "id": 541166770,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758701203
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"933054\">Snir Broshi</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2328818.20.60Setoid.2Eker_lift.60/near/541079489\">said</a>:</p>\n<blockquote>\n<p>According to the <a href=\"https://lean-lang.org/doc/reference/latest/Definitions/Recursive-Definitions/#--tech-term-Reducible\">docs</a> <code>abbrev</code> makes stuff identical \"essentially everywhere\", which includes but is not limited to typeclass searching. I'm not sure what this includes, but I agree that the typeclass point isn't relevant here.</p>\n</blockquote>\n<p>I think that docstring is very misleading, since <code>abbrev</code> doesn't make things syntactically identical, which I'd argue is what most people expect out of an abbreviation.</p>",
        "id": 541166997,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1758701285
    },
    {
        "content": "<p>So can this PR be merged?</p>",
        "id": 541226623,
        "sender_full_name": "Snir Broshi",
        "timestamp": 1758719685
    },
    {
        "content": "<p>If you want, you can make the code work with <code>def</code> using</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">integerSetQuotEquivAssociates'</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Quotient</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">orbitRel</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">torsion</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integerSet</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">‚âÉ</span><span class=\"w\"> </span><span class=\"n\">Associates</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ùìû</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"bp\">‚Å∞</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">Equiv</span><span class=\"bp\">.</span><span class=\"n\">ofBijective</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">Quotient</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integerSetToAssociates</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">‚Ü¶</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">integerSetToAssociates_eq_iff</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">‚ü®</span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">convert</span><span class=\"w\"> </span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">kerLift_injective</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integerSetToAssociates</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">swap</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">focus</span><span class=\"w\"> </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">kerLift</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">congr!</span>\n<span class=\"w\">      </span><span class=\"n\">all_goals</span>\n<span class=\"w\">        </span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Setoid</span><span class=\"bp\">.</span><span class=\"n\">ker_def</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">eq_comm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">integerSetToAssociates_eq_iff</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">orbitRel_apply</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">MulAction</span><span class=\"bp\">.</span><span class=\"n\">mem_orbit_iff</span><span class=\"o\">],</span>\n<span class=\"w\">      </span><span class=\"o\">(</span><span class=\"n\">Quot</span><span class=\"bp\">.</span><span class=\"n\">surjective_lift</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">integerSetToAssociates_surjective</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"o\">)</span><span class=\"bp\">‚ü©</span>\n</code></pre></div>",
        "id": 541375153,
        "sender_full_name": "Robert Maxton",
        "timestamp": 1758780238
    }
]