[
    {
        "content": "<p>Upstreamed from the <a href=\"https://github.com/teorth/equational_theories\">EquationalTheories</a> project.</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/22639\">#22639</a> defines in the new file <code>Mathlib/GroupTheory/FreeGroup/ReducedWords.lean</code> some extra lemmas for free groups, in particular about (cyclically) reduced words.</p>\n<p>The theory of cyclically reduced words is then used to show that the power maps are injective on free groups.</p>\n<p>Co-authored-by: <span class=\"user-mention\" data-user-id=\"302984\">@Amir Livne Bar-on</span></p>",
        "id": 507934146,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1742882387
    },
    {
        "content": "<p>Would it be helpful for the review process to split this PR into smaller PRs? I could do something like </p>\n<ol>\n<li>Added lemmas in <code>FreeGroup/Basic.lean</code> and <code>FreeGroup/Reduce.lean</code></li>\n<li>The <code>FreeGroup/ReducedWords.lean</code> part about reduced words</li>\n<li>the part about cyclically reduced words</li>\n<li>Application: power maps are injective</li>\n</ol>\n<p>Any thoughts?</p>",
        "id": 508462039,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1743066547
    },
    {
        "content": "<p>Yes, shorter PRs have a far bigger chance of being merged in finite time. Please also encourage the equational theories people to leave reviews -- some people seem to be under the misapprehension that only maintainers can leave reviews.</p>",
        "id": 508465023,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743067387
    },
    {
        "content": "<p>OK, I have split off already the following:</p>",
        "id": 508481815,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1743072561
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23366\">#23366</a>: lemmas in <code>FreeGroup/Basic.lean</code></p>",
        "id": 508481913,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1743072592
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23367\">#23367</a>: lemmas in <code>FreeGroup/Reduce.lean</code></p>",
        "id": 508482030,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1743072619
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23368\">#23368</a>: basic part of <code>FreeGroup/ReducedWords.lean</code> about reduced words</p>",
        "id": 508482162,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1743072658
    },
    {
        "content": "<p>So far they are all independent of each other</p>",
        "id": 508482410,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1743072728
    },
    {
        "content": "<p>On a more fundamental level, I would also be interested to hear <span class=\"user-mention\" data-user-id=\"130377\">@David WÃ¤rn</span>'s thoughts on the relation with <code>GroupTheory/CoprodI</code>, where free products of monoids are constructed. I think there the notion of \"reduced words\" is already defined at <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Monoid.CoprodI.Word#doc\">docs#Monoid.CoprodI.Word</a>. Probably one can generalize the results of the overall PR to free products of groups:</p>\n<ol start=\"0\">\n<li>There is a notion of cyclically reduced words in free products of groups, every element of the free product is conjugated to a cyclically reduced word.</li>\n<li>If an element of a free product of groups has finite order, it must be conjugated to an element coming from a single factor.</li>\n<li>If <code>x^n = y^n</code>, then <code>x = y</code> or there is <code>c</code>such that <code>c*x*c^(-1)</code> and <code>c*y*c^(-1)</code>live in the same factor. (Not 100% sure about this statement.) In particular, if taking n-th powers is injective on each factor, it is also on the free product.</li>\n</ol>\n<p>Would it make sense to do it in this generality instead or is it also convenient to have this more explicit version for free groups first?</p>",
        "id": 508505676,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1743079446
    },
    {
        "content": "<p>I don't have much to say about this except that I like the general statements better. I'm also not exactly sure how to state 2., but I guess you will have to modify it somehow since it could be that <code>x</code> and <code>y</code> are elements of finite order from different factors</p>",
        "id": 508725765,
        "sender_full_name": "David WÃ¤rn",
        "timestamp": 1743159782
    },
    {
        "content": "<p>Thanks for <span class=\"user-mention\" data-user-id=\"761203\">@Vlad Tsyrklevich</span> for the reviews! I hope that <a href=\"https://github.com/leanprover-community/mathlib4/pull/23367\">#23367</a> is now polished enough</p>",
        "id": 513563729,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1745314892
    },
    {
        "content": "<p>Left a few final comments, otherwise LGTM. Thanks for doing this, I'm working on defining Cayley graphs at the moment and I'm not sure yet but I think your <code>IsReduced</code> predicate may end up being useful for me.</p>",
        "id": 513923140,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1745427905
    },
    {
        "content": "<p>Thanks again for your comments! I think <a href=\"https://github.com/leanprover-community/mathlib4/pull/23368\">#23368</a> is also now nicer with the proper dot notation lemmas</p>",
        "id": 514062939,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1745486437
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"253861\">@Thomas Browning</span> for reviewing <a href=\"https://github.com/leanprover-community/mathlib4/pull/23367\">#23367</a>. Could I ask you to please have a look at <a href=\"https://github.com/leanprover-community/mathlib4/pull/23368\">#23368</a> as well?</p>",
        "id": 519556155,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1747817089
    },
    {
        "content": "<p>The PR about reduced words has been migrated to <a href=\"https://github.com/leanprover-community/mathlib4/pull/25966\">#25966</a>.</p>",
        "id": 524284401,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1750088703
    },
    {
        "content": "<p>Any chance somebody could have a look at the migrated PR? So far it looked good to <span class=\"user-mention\" data-user-id=\"761203\">@Vlad Tsyrklevich</span>,  I haven't made any changes after migration yet.</p>",
        "id": 531551871,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753779552
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"562819\">@Bernhard Reinke</span>, what's up with <a href=\"https://github.com/leanprover-community/mathlib4/pull/22639\">#22639</a> ? I see it's not from a fork. Did you mean to close it?</p>",
        "id": 531552627,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1753779723
    },
    {
        "content": "<p>I think it's blocked on <a href=\"https://github.com/leanprover-community/mathlib4/pull/25966\">#25966</a> which has been awaiting review for a while but now the dependent PR setup is wrong because of the migration</p>",
        "id": 531554136,
        "sender_full_name": "Vlad Tsyrklevich",
        "timestamp": 1753780067
    },
    {
        "content": "<p>Ah right, looks like you want to migrate <a href=\"https://github.com/leanprover-community/mathlib4/pull/22639\">#22639</a> too then</p>",
        "id": 531554261,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1753780105
    },
    {
        "content": "<p>I've just reviewed <a href=\"https://github.com/leanprover-community/mathlib4/pull/25966\">#25966</a>. It looks like you might have missed the existence of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=FreeGroup.Red#doc\">docs#FreeGroup.Red</a> ?</p>",
        "id": 531555230,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1753780369
    },
    {
        "content": "<p>I did not miss the existence, see for example <code>IsReduced.min</code>. <code>FreeGroup.Red</code> is the transitive closure of <code>Red.Step</code>, it is not the predicate that something is reduced</p>",
        "id": 531556169,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753780616
    },
    {
        "content": "<p>Ah right sorry, it is the predicate that a word reduces to another word</p>",
        "id": 531556397,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1753780674
    },
    {
        "content": "<p>I feel reluctant to migrate <a href=\"https://github.com/leanprover-community/mathlib4/pull/22639\">#22639</a> because of dependent changes. For me it make sense to migrate it once the previous PRs on its way have been accepted.</p>",
        "id": 531556828,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753780776
    },
    {
        "content": "<p>cf <a href=\"#narrow/channel/113488-general/topic/Any.20infimum.20based.20version.20of.20.60OmegaCompletePartialOrder.60.3F/near/531552136\">#general &gt; Any infimum based version of &#96;OmegaCompletePartialOrder&#96;? @ ðŸ’¬</a> for how to deal with this sort of situation</p>",
        "id": 531556995,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1753780813
    },
    {
        "content": "<p>Ok, I have split of some more PR of <a href=\"https://github.com/leanprover-community/mathlib4/pull/22639\">#22639</a> that depend on each other. I have not yet completely dissected <a href=\"https://github.com/leanprover-community/mathlib4/pull/22639\">#22639</a> (the theorem about injectivity of powers of the free group is still missing), but when I have done that I will probably close <a href=\"https://github.com/leanprover-community/mathlib4/pull/22639\">#22639</a>, so in a sense I will have done a manual migration. Does this make sense to you, <span class=\"user-mention\" data-user-id=\"387244\">@YaÃ«l Dillies</span> ?</p>",
        "id": 531790522,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753866863
    },
    {
        "content": "<p>Here are the new PRs:</p>",
        "id": 531790548,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753866870
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27672\">#27672</a>: add definition of cyclically reduced words</p>",
        "id": 531790608,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753866890
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27673\">#27673</a>: add definition of cyclic reduction</p>",
        "id": 531790644,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753866900
    },
    {
        "content": "<p>I finished the splitting and closed the old PR. Here are the last two:</p>",
        "id": 531830259,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753878547
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27678\">#27678</a>: reduction theorem for powers (i.e. <code>reduce_flatten_replicate</code>)</p>",
        "id": 531830468,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753878606
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/27679\">#27679</a>: the main theorem: taking n-th powers is an injective function on the free group</p>",
        "id": 531830731,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1753878654
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"387244\">YaÃ«l Dillies</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2322639.20.28cyclically.29.20reduced.20words/near/531556995\">said</a>:</p>\n<blockquote>\n<p>cf <a href=\"#narrow/channel/113488-general/topic/Any.20infimum.20based.20version.20of.20.60OmegaCompletePartialOrder.60.3F/near/531552136\">#general &gt; Any infimum based version of &#96;OmegaCompletePartialOrder&#96;? @ ðŸ’¬</a> for how to deal with this sort of situation</p>\n</blockquote>\n<p>I hope I successfully followed the workflow for the next PR in line, <a href=\"https://github.com/leanprover-community/mathlib4/pull/27672\">#27672</a>. I had to force push after the interactive rebase, is there a way around it?</p>",
        "id": 534505796,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1755184884
    },
    {
        "content": "<p>Nope, that's right! If you're working with someone else on the same branch, you might want to use <code>git push --force-with-lease</code> to avoid force-pushing away your collaborator's work in case it was coming in at the same time as yours, but personally I live every day as if it were the last, and on my last day I don't have the time to write <code>--force-with-lease</code></p>",
        "id": 534507443,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1755185396
    },
    {
        "content": "<p>I rebased <a href=\"https://github.com/leanprover-community/mathlib4/pull/27673\">#27673</a> on master, it should be ready for review now.</p>",
        "id": 542434130,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1759306793
    },
    {
        "content": "<p>Alright, now <a href=\"https://github.com/leanprover-community/mathlib4/pull/27678\">#27678</a> (reduction theorem for powers +52/-0) should be ready. There is the large import tag because this is the part where we finally use <code>reduce</code>, so <code>Mathlib.GroupTheory.FreeGroup.Reduce</code> is needed.</p>",
        "id": 546394127,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1761121469
    },
    {
        "content": "<p>I am curious to hear the bike-shedding wrt. the direction of the equations in the statements of <code>reduce_flatten_replicate</code> and <code>reduce_flatten_replicate_succ</code>. For me the reduce operation is more complicated, so the terms with reduce should go to the LHS. This is also the reason <code>conj_conjugator_reduceCyclically</code> had a different orientation in my initial draft.</p>",
        "id": 547690312,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1761737049
    },
    {
        "content": "<p>We are close to the finish line! The last PR, <a href=\"https://github.com/leanprover-community/mathlib4/pull/27679\">#27679</a> (+81/0) should be ready for review. Here we use the tools introduced before to prove that taking powers is an injective function on free groups.</p>",
        "id": 553795895,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1762332787
    },
    {
        "content": "<p>There are again large imports, namely <code>Mathlib.GroupTheory.OrderOfElement</code> and <code>Mathlib.Tactic.Linarith</code>. Does it make sense to move this result to a new file?</p>",
        "id": 553797845,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1762333346
    },
    {
        "content": "<p>With the <code>IsMulTorsionFree</code> class (that I think did not yet exist when I started this PR chain) it is now down to +29, and no large imports anymore</p>",
        "id": 554038370,
        "sender_full_name": "Bernhard Reinke",
        "timestamp": 1762420749
    },
    {
        "content": "<p>Indeed, I added <code>IsMulTorsionFree</code> at some point this summer</p>",
        "id": 554039034,
        "sender_full_name": "YaÃ«l Dillies",
        "timestamp": 1762420962
    }
]