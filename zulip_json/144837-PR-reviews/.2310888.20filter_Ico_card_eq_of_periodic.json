[
    {
        "content": "<p>I'd like some opinions on where the lemma <code>filter_Ico_card_eq_of_periodic</code> from this PR should live. The two primary dependencies are <code>data/nat/interval</code> and <code>algebra/periodic</code> but neither imports the other.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">filter_Ico_card_eq_of_periodic</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">decidable_pred</span> <span class=\"n\">p</span><span class=\"o\">]</span>\n <span class=\"o\">(</span><span class=\"n\">pp</span> <span class=\"o\">:</span> <span class=\"n\">function.periodic</span> <span class=\"n\">p</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"n\">filter</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">Ico</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"n\">a</span><span class=\"o\">)))</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">filter</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">range</span> <span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n</code></pre></div>\n<p>It would be nice to put it upstream of <code>data/nat/totient</code> so that  a <code>filter_coprime_Ico_eq_totient</code> lemma (from <a href=\"https://github.com/leanprover-community/mathlib/pull/9080\">#9080</a>), which depends on it, can be added there.</p>",
        "id": 265453800,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1639876970
    },
    {
        "content": "<p>Isn't the RHS <code>a.count p</code>?</p>",
        "id": 265453818,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1639877035
    },
    {
        "content": "<p>Oh lol, yes, I should change that now that that's been pulled.</p>",
        "id": 265453864,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1639877071
    },
    {
        "content": "<p>Also not sure how general this lemma should be made.</p>",
        "id": 265453889,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1639877152
    },
    {
        "content": "<p>For example, one could prove that <code>(filter p (Ico m (m+a))).card = (filter p (Ico n (n+a))).card</code> over cyclic groups.</p>",
        "id": 265453951,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1639877244
    },
    {
        "content": "<p>In particular, where I have this proof in <code>data.nat.interval</code> is causing errors in other files, I guess because I have added the <code>algebra.periodic</code> import to <code>data.nat.interval</code>. Should I just fix these other errors, or should I move the lemma?</p>",
        "id": 265466845,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1639899340
    },
    {
        "content": "<p>That doesn't really belong in <code>data.nat.interval</code> IMO. What about putting it where you need it?</p>",
        "id": 265468646,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1639902487
    },
    {
        "content": "<p>In particular, <code>algebra.periodic</code> imports fields! This file is definitely too late in the import tree to be imported by <code>data.nat.interval</code>.</p>",
        "id": 265468655,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1639902533
    },
    {
        "content": "<p>Hmm, ok that's a good argument for not putting it in <code>data.nat.interval</code>. But this feels a little more generally applicable than <code>data.nat.totient</code>.</p>",
        "id": 265532463,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1639988308
    },
    {
        "content": "<p>Also it seems strange to me that we need fields to import the concept of a periodic function. I guess that issue is that the periodic file contains the periodic lemmas for all the algebraic structures.</p>",
        "id": 265532739,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1639988501
    },
    {
        "content": "<p>Yes, I agree this is slightly weird.</p>",
        "id": 265535721,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1639990349
    },
    {
        "content": "<p>Proposal: Can I add a file data.nat.periodic where I put this lemma and also prove that the gcd <del>lcm</del> and coprime are periodic?</p>",
        "id": 265537351,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1639991430
    },
    {
        "content": "<p>Sounds good to me</p>",
        "id": 265537489,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1639991532
    }
]