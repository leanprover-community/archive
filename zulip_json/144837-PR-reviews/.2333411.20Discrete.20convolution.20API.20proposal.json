[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/33411\">#33411</a> (~200 lines). Split from 33130 (closed)</p>\n<p>Defines discrete convolution of functions <code>f : M → E</code> and <code>g : M → E'</code> over a monoid <code>M</code><br>\nusing a bilinear map <code>L : E →ₗ[S] E' →ₗ[S] F</code>:</p>\n<p><code>(f ⋆[L] g) x = ∑' (a, b) : mulFiber x, L (f a) (g b)</code></p>\n<p>where <code>mulFiber x</code> is an abbreviation for <code>Set.mulAntidiagonal Set.univ Set.univ x</code>.</p>\n<h3>Main definitions (Basics)</h3>\n<ul>\n<li><code>mulFiber x</code>, <code>addFiber x</code>: fiber of multiplication/addition at <code>x</code></li>\n<li><code>tripleFiber x</code>, <code>tripleAddFiber x</code>: fiber <code>{(a, b, c) | a * b * c = x}</code></li>\n<li><code>mulTripleAntidiagonal s t u a</code>: triple analog of <code>Set.mulAntidiagonal</code></li>\n<li><code>tripleFiber x</code>: the set <code>{(a, b, c) | a * b * c = x}</code>, abbreviation for <code>mulTripleAntidiagonal</code></li>\n<li><code>leftAssocEquiv</code>, <code>rightAssocEquiv</code>: equivalences for associativity proofs</li>\n<li><code>convolution</code>, <code>addConvolution</code>: convolution with bilinear map <code>L</code></li>\n<li><code>mulConvolution</code>, <code>addMulConvolution</code>: ring multiplication convolution</li>\n<li><code>delta</code>, <code>addDelta</code>: identity element for convolution</li>\n</ul>\n<h3>Notation</h3>\n<ul>\n<li><code>f ⋆[L] g</code>, <code>f ⋆₊[L] g</code>: convolution with bilinear map</li>\n<li><code>f ⋆ₘ g</code>, <code>f ⋆₊ₘ g</code>: ring multiplication convolution</li>\n</ul>",
        "id": 565841229,
        "sender_full_name": "Fengyang Wang",
        "timestamp": 1767135887
    },
    {
        "content": "<p>Can you use Set.mulAntidiagonal instead of mulFiber?</p>",
        "id": 565899557,
        "sender_full_name": "Scott Carnahan",
        "timestamp": 1767189279
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"630477\">Scott Carnahan</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2333411.20Discrete.20convolution.20API.20proposal/near/565899557\">said</a>:</p>\n<blockquote>\n<p>Set.mulAntidiagonal</p>\n</blockquote>\n<p>I found this out after implementing as MulFiber and proved (not is the current PR)</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"w\"> </span><span class=\"sd\">/-- `addFiber x` equals `Set.addAntidiagonal Set.univ Set.univ x`. -/</span><span class=\"kd\">]</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">mulFiber_eq_mulAntidiagonal_univ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">mulFiber</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>\n<p>But you are right, I should just define MulFiber as such. Thanks for pointing this out!</p>\n<p>Updated</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"w\"> </span><span class=\"sd\">/-- The fiber of addition at `x`: all pairs `(a, b)` with `a + b = x`.</span>\n<span class=\"sd\">This is `Set.addAntidiagonal Set.univ Set.univ x`. -/</span><span class=\"kd\">]</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">mulFiber</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">mulAntidiagonal</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>\n<p>and tripleFiber for assoc, analogous to mulAntidiag </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">to_additive</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- `addTripleAntidiagonal s t u a` is the set of all triples `(x, y, z)` with `x ∈ s`, `y ∈ t`,</span>\n<span class=\"sd\">  `z ∈ u`, and `x + y + z = a`. This is the triple analog of `Set.addAntidiagonal`. -/</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">mulTripleAntidiagonal</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[</span><span class=\"n\">to_additive</span><span class=\"w\"> </span><span class=\"n\">tripleAddFiber</span>\n<span class=\"w\">  </span><span class=\"sd\">/-- The fiber of triple addition at `x`: all triples `(a, b, c)` with `a + b + c = x`.</span>\n<span class=\"sd\">  This is `addTripleAntidiagonal Set.univ Set.univ Set.univ x`. -/</span><span class=\"kd\">]</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">tripleFiber</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">mulTripleAntidiagonal</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"n\">Set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"w\"> </span><span class=\"n\">x</span>\n</code></pre></div>",
        "id": 565913380,
        "sender_full_name": "Fengyang Wang",
        "timestamp": 1767198849
    }
]