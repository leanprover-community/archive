[
    {
        "content": "<p>This PR is essentially writing a topological space as a disjoint union of the fibres of a map, indexed by the set of fibres. </p>\n<p>It is a result of trying to simplify proofs of naturality of the counit of the adjunction between the functor from sets to condensed sets of locally constant maps and the underlying set functor from condensed sets to sets (see <a href=\"https://github.com/leanprover-community/mathlib4/pull/15321\">#15321</a>, where it's really useful).</p>\n<p>I'm not sure if we want this in the new files I created, or if this should just live in an auxiliary namespace in the new file <code>Condensed.Discrete.LocallyConstant</code> added by <a href=\"https://github.com/leanprover-community/mathlib4/pull/15321\">#15321</a>.</p>",
        "id": 459852352,
        "sender_full_name": "Dagur Asgeirsson",
        "timestamp": 1723363110
    },
    {
        "content": "<p>This has been sitting untouched for a while, and is now the only PR blocking the rest of the dependencies of the discreteness characterization of condensed sets/modules in <a href=\"https://github.com/leanprover-community/mathlib4/pull/14027\">#14027</a></p>",
        "id": 467769989,
        "sender_full_name": "Dagur Asgeirsson",
        "timestamp": 1725526594
    },
    {
        "content": "<p>Having a look. I'm somewhat wondering what the relationship to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Bundle.TotalSpace#doc\">docs#Bundle.TotalSpace</a> is</p>",
        "id": 467773553,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725527244
    },
    {
        "content": "<p>I didn't know about this. I'll see if it can be used instead. Thanks for the suggestion!</p>",
        "id": 467774768,
        "sender_full_name": "Dagur Asgeirsson",
        "timestamp": 1725527468
    },
    {
        "content": "<p>To be quite clear, I have never used what's inside <code>Data.Bundle</code> and indeed even know it existed two days ago!</p>",
        "id": 467776499,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725527755
    },
    {
        "content": "<p>So, the total space is not very convenient for my application. I'm really relying on writing a space as a disjoint union of fibers, in such a way that the components of the disjoint union (the fibers) remain subtypes of the original space. So using the total space would require additional isomorphisms between the space I start with and the total space, which I want to avoid.</p>",
        "id": 467790529,
        "sender_full_name": "Dagur Asgeirsson",
        "timestamp": 1725530315
    },
    {
        "content": "<p>In fact, I am quite surprised that <code>TotalSpace</code> is defined the way it is. Instead of being a type synonym of <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Sigma#doc\">docs#Sigma</a>, I would have expected it to hold the data of an isomorphism with <code>Sigma</code> (and that's basically what you want here).</p>",
        "id": 467794047,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725531185
    },
    {
        "content": "<p>In the uses of <code>TotalSpace</code>, you really want the fibers to be types (in a canonical way, not subtypes), to endow them with a vector space structure, a topology, and so on, with nicely working typeclass inference. In the first version, we had indeed an isomorphism with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Sigma#doc\">docs#Sigma</a>, and this was a nightmare, so we refactored it to be like that.</p>",
        "id": 467794571,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1725531310
    },
    {
        "content": "<p>I don't think this disagrees with what I have in mind, Sébastien. I would expect something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">Bundle</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">B</span>\n<span class=\"w\">  </span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">proj</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">T</span>\n<span class=\"w\">  </span><span class=\"n\">fst_proj</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">proj</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"w\">  </span><span class=\"n\">snd_proj</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">fst_proj</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">▸</span><span class=\"w\"> </span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">proj</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">e</span>\n<span class=\"w\">  </span><span class=\"n\">proj_fst_snd</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">proj</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">fst</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">snd</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">t</span>\n</code></pre></div>",
        "id": 467795651,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725531569
    },
    {
        "content": "<p>The point being that now people are free to set <code>T</code> to whatever they want, in particular to a preexisiting space like in Dagur's use case, instead of having <code>T := ∑ b, E b</code></p>",
        "id": 467795880,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1725531630
    },
    {
        "content": "<p>That's the kind of thing we had in the first version, and it just didn't work well enough for our purposes. A stress test was tangent bundle of a manifold.</p>",
        "id": 467810228,
        "sender_full_name": "Sébastien Gouëzel",
        "timestamp": 1725533618
    },
    {
        "content": "<p>It would be nice to get this in soon, but I would also be happy to just close this PR and put this in an auxiliary namespace in the same file as my application in <a href=\"https://github.com/leanprover-community/mathlib4/pull/15321\">#15321</a> if people feel that it's useless outside that application. Anyone care to make a decision?</p>",
        "id": 471234829,
        "sender_full_name": "Dagur Asgeirsson",
        "timestamp": 1726658724
    },
    {
        "content": "<p>I think it's up to people like Sébastien Patrick or Heather to make a decision. I'm just a silly combinatorialist here.</p>",
        "id": 471235229,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1726658873
    },
    {
        "content": "<p>I've kicked it on the queue <img alt=\":merge:\" class=\"emoji\" src=\"https://avatars.zulip.com/3121/emoji/images/37577b95.png\" title=\"merge\"></p>",
        "id": 471468864,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1726746895
    }
]