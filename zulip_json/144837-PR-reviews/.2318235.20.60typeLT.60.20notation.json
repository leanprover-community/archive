[
    {
        "content": "<p>This PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/18235\">#18235</a> introduces an abbreviation for the order type of the <code>&lt;</code> relation on a type. This makes code cleaner and is a first step towards moving away from unbundled relations in the ordinal API.</p>",
        "id": 482021603,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1731440080
    },
    {
        "content": "<p>Should this be a notation and not an <code>abbrev</code>?</p>",
        "id": 482096465,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731478298
    },
    {
        "content": "<p>I don't really understand the difference between <code>abbrev</code> and just a standard <code>def</code>. Particularly, I don't want to lose access to <code>simp</code> lemmas for <code>type</code>, or have to duplicate them all over.</p>",
        "id": 482507586,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1731630222
    },
    {
        "content": "<p><code>simp</code> is able to see through <code>abbrev</code>, if I'm not mistaken</p>",
        "id": 482523376,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1731639789
    },
    {
        "content": "<p>Simp unfolds abbrevs when indexing simp lemmas, but as far as I've experienced, simp can't see through abbrevs in the target expression.</p>",
        "id": 482523884,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1731640178
    },
    {
        "content": "<p>Well, I guess I can just add <code>typeLT</code> to the simp set when needed</p>",
        "id": 482524155,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1731640353
    },
    {
        "content": "<p>Oh I forgot to reply</p>",
        "id": 483364422,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732055247
    },
    {
        "content": "<p>But having <code>typeLT</code> as an abbreviation does seem less convenient</p>",
        "id": 483364512,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732055259
    },
    {
        "content": "<p>You have to insert a bunch of rewrites from <code>type (· &lt; ·)</code> to <code>typeLT</code> and viceversa</p>",
        "id": 483364578,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732055274
    },
    {
        "content": "<p>It's not a situation like <code>Holomorphic</code> where there's more specific results you can prove about one definition than the other, all I'm really doing is making it more convenient to write <code>type (α := α) (· &lt; ·)</code></p>",
        "id": 483364718,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732055344
    },
    {
        "content": "<p>So I think it's fine to keep this as a notation</p>",
        "id": 483364733,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732055351
    },
    {
        "content": "<p>Using notation could behave a bit weirdly - it means one can't write <code>typeLT ∘ some_function</code>, for example. I think a good comparison is <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=AddLeftMono#doc\">docs#AddLeftMono</a>, which is defined as <code>abbrev AddLeftMono [Add M] [LE M] := CovariantClass M M (· + ·) (· ≤ ·)</code>, and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=WellFoundedLT#doc\">docs#WellFoundedLT</a>, which is defined as <code>abbrev WellFoundedLT [LT α] := IsWellFounded α (· &lt; ·)</code></p>",
        "id": 483407224,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1732079074
    },
    {
        "content": "<p><code>WellFoundedLT</code> works decently well since typeclass search can see through abbrevs</p>",
        "id": 483410703,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732081750
    },
    {
        "content": "<p>The issue is that <code>simp</code> and <code>rw</code> can't</p>",
        "id": 483410715,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732081761
    },
    {
        "content": "<p>Also, I don't think we have any instance of <code>type \\circ</code> anywhere in Mathlib</p>",
        "id": 483410724,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732081779
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/stream/144837-PR-reviews/topic/.2318235.20.60typeLT.60.20notation/near/483410724\">said</a>:</p>\n<blockquote>\n<p>Also, I don't think we have any instance of <code>type \\circ</code> anywhere in Mathlib</p>\n</blockquote>\n<p>Composition isn't the point, it's just that notation which looks like a term but actually isn't can be confusing</p>",
        "id": 483411322,
        "sender_full_name": "Daniel Weber",
        "timestamp": 1732082250
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"459227\">Violeta Hernández</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2318235.20.60typeLT.60.20notation/near/483410715\">said</a>:</p>\n<blockquote>\n<p>The issue is that <code>simp</code> and <code>rw</code> can't</p>\n</blockquote>\n<p>They seem to work fine:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ℕ</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_add</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Or do you mean something else?</p>",
        "id": 484091296,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1732391669
    },
    {
        "content": "<p>This doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"bp\">·</span><span class=\"o\">)</span>\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">add'</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">add</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">add_thm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">add'_thm</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">add'</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">add_thm</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 484091464,
        "sender_full_name": "Violeta Hernández",
        "timestamp": 1732391826
    },
    {
        "content": "<p>I was just about to give a similar example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span>\n\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zero_add</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"c1\">-- succeeds</span>\n<span class=\"kn\">example</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">zero_add</span><span class=\"o\">]</span><span class=\"w\">    </span><span class=\"c1\">-- fails</span>\n</code></pre></div>",
        "id": 484091479,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732391847
    },
    {
        "content": "<p>(I'm surprised to see <code>simp</code> works. I could have sworn it wouldn't have.)</p>",
        "id": 484091547,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1732391889
    }
]