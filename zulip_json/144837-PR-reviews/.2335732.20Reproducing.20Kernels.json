[
    {
        "content": "<p>Hi all, I am Tjeerd and I have opened my first pull-request <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span> . Reproducing kernel Hilbert spaces (RKHS) are part of basic functional analysis courses. This PR adds the kernels of RKHS. It shows that they form an ordered semiring and other basic properties often used in proofs. </p>\n<p>This pull-request doesn't include the RKHS themselves. The RKHS will be part of a follow-up pull-request, which will depend on this one. This is because the current pull-request is already 1000 lines, and the recommendation is to split PRs into smaller self-contained units.</p>\n<p>This pull-request also doesn't include Mercer's theorem. Mercer's theorem will also be part of a follow-up pull-request depending on this one, for the same reasons.</p>\n<p>Happy to hear any feedback.</p>",
        "id": 575731920,
        "sender_full_name": "Tjeerd Jan Heeringa",
        "timestamp": 1772013224
    },
    {
        "content": "<p>Hey! Nice work. Are you aware that <span class=\"user-mention\" data-user-id=\"871498\">@Hampus Nyberg</span> proved Moore's theorem for RKHS?</p>",
        "id": 575733343,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1772013600
    },
    {
        "content": "<p>If you are referring to the <a href=\"https://github.com/leanprover-community/mathlib4/pull/34528\">pull-request #34528</a>, then yes (but not until I was ready to submit though). There is also an open <a href=\"https://github.com/leanprover-community/mathlib3/pull/16351\">pull-request</a> in lean 3. Both work on the evaluation functions and construct everything from there. </p>\n<p>A conceptual difference is that there the kernel is based on a <code>kerFun</code> a function from <code>X</code> to the RKHS <code>H</code>. This means you need an RKHS to get the kernel, whilst in practice I see people manipulating kernels and then later only constructing the RKHS. </p>\n<p>In my follow-up pull-request, I was planning on something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">RKHS_eval</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">X</span>\n<span class=\"w\">  </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">FunLike</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"w\">  </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"n\">L</span><span class=\"o\">[</span><span class=\"n\">ℝ</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"w\">    </span><span class=\"n\">eval_spec</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"kn\">class</span><span class=\"w\"> </span><span class=\"n\">RKHS_kernel</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">X</span>\n<span class=\"w\">  </span><span class=\"kn\">extends</span><span class=\"w\"> </span><span class=\"n\">Kernel</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">NormedAddCommGroup</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">InnerProductSpace</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">CompleteSpace</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">FunLike</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"n\">ℝ</span>\n<span class=\"w\">  </span><span class=\"kn\">where</span>\n<span class=\"w\">    </span><span class=\"n\">Ksec</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">H</span>\n<span class=\"w\">    </span><span class=\"n\">Ksec_spec</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ksec</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">kernel</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">    </span><span class=\"n\">reproducing</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Ksec</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"kn\">abbrev</span><span class=\"w\"> </span><span class=\"n\">RKHS</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">RKHS_kernel</span><span class=\"w\"> </span><span class=\"n\">H</span><span class=\"w\"> </span><span class=\"n\">X</span>\n</code></pre></div>\n<p>where the <code>RKHS_eval</code> corresponds to the solution in <a href=\"https://github.com/leanprover-community/mathlib4/pull/34528\">PR #34528</a> (although there directly already written for the vector-valued case) and <code>RKHS_kernel</code> correspond to the more often used definition. Both <code>RKHS_kernel</code> and <code>RKHS_eval</code> are equivalent.</p>",
        "id": 575761684,
        "sender_full_name": "Tjeerd Jan Heeringa",
        "timestamp": 1772022486
    },
    {
        "content": "<p>Hello! Fun to see someone else working on this! </p>\n<p>If you see the later part of <a href=\"https://github.com/leanprover-community/mathlib4/pull/34528\">#34528</a> we construct a RKHS instance from a positive semi-definite matrix (aka a kernel).</p>\n<p>I also recently generalized Matrix.PosDef to work with infinite matrices so the definition therein of a positive semidefinite matrix should cover your definition of a kernel and there seems to be quite a few things you proved that are already there in this context. For instance, the order you defined already exists in Matrix.Order. </p>\n<p>I was also toying with the idea of making positive semidefinite matrices their own class but I think me and Yaël came to the conclusion that it was better not to. You do have some nice results but perhaps they would fit better in the Matrix.PosDef file and as results about positive semidefinite matrices.</p>",
        "id": 575779015,
        "sender_full_name": "Hampus Nyberg",
        "timestamp": 1772027555
    },
    {
        "content": "<blockquote>\n<p>If you see the later part of <a href=\"https://github.com/leanprover-community/mathlib4/pull/34528\">#34528</a> we construct a RKHS instance from a positive semi-definite matrix (aka a kernel).</p>\n</blockquote>\n<p>Ah, I see that you discuss that in line 237 to 268. I am a bit puzzled how line 237 is able to capture the span of what you call <code>kerFun</code>. Otherwise, it looks like a briefer version of what I was going for.</p>\n<blockquote>\n<p>I also recently generalized Matrix.PosDef to work with infinite matrices so the definition therein of a positive semidefinite matrix should cover your definition of a kernel and there seems to be quite a few things you proved that are already there in this context. For instance, the order you defined already exists in Matrix.Order. </p>\n</blockquote>\n<p>Didn't think about it like this before, but indeed kernels are just infinite PSD matrices. If we are going the route of modelling these kernels as infinite matrices, then we should perhaps make a remark in the documentation about it. </p>\n<blockquote>\n<p>I was also toying with the idea of making positive semidefinite matrices their own class but I think me and Yaël came to the conclusion that it was better not to. </p>\n</blockquote>\n<p>In non-math coding language, I would have expected the subclassing / inheritance. The passing around of <code>hM : M.isPosDef</code> looks also a bit klunky. What made you decide against it (aside from the maybe a lot of work)?</p>\n<blockquote>\n<p>You do have some nice results but perhaps they would fit better in the Matrix.PosDef file and as results about positive semidefinite matrices.</p>\n</blockquote>\n<p>What do you think is the best course of action? That I retract my pull-request and port the relevant bits to <code>Matrix/PosDef.lean</code> (sad for my current PR, but okay)?  Or do we accept, and over the course of a few (smaller) pull-requests port it to <code>Matrix/PosDef.lean</code>?</p>",
        "id": 575798190,
        "sender_full_name": "Tjeerd Jan Heeringa",
        "timestamp": 1772032362
    },
    {
        "content": "<blockquote>\n<p>Ah, I see that you discuss that in line 237 to 268. I am a bit puzzled how line 237 is able to capture the span of what you call <code>kerFun</code>. Otherwise, it looks like a briefer version of what I was going for.</p>\n</blockquote>\n<p>Basically, H₀ is the abstract span of the kernel functions. Then on line 237 we quotient out by elements having zero distance from each other and then complete.</p>\n<blockquote>\n<p>Didn't think about it like this before, but indeed kernels are just infinite PSD matrices. If we are going the route of modelling these kernels as infinite matrices, then we should perhaps make a remark in the documentation about it.</p>\n</blockquote>\n<p>That's probably a good idea! Any suggestions on what to write and where?</p>\n<blockquote>\n<p>In non-math coding language, I would have expected the subclassing / inheritance. The passing around of <code>hM : M.isPosDef</code> looks also a bit klunky. What made you decide against it (aside from the maybe a lot of work)?</p>\n</blockquote>\n<p>So I think the clunkiness can to a large part be solved by doing </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">variable</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Fact</span><span class=\"w\"> </span><span class=\"n\">K</span><span class=\"bp\">.</span><span class=\"n\">PosSemidef</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>which should be there in the latest version of the PR. More philosophically I think the point is that all the operations and instances we have for matrices we also want for kernels and all instances and operations we want for kernels we probably also want for matrices. If it was the case that say, matrices had a different partial order instance then I think there would be a case for making kernels a separate class. </p>\n<blockquote>\n<p>What do you think is the best course of action? That I retract my pull-request and port the relevant bits to <code>Matrix/PosDef.lean</code> (sad for my current PR, but okay)? Or do we accept, and over the course of a few (smaller) pull-requests port it to <code>Matrix/PosDef.lean</code>?</p>\n</blockquote>\n<p>It would probably be good to get some other opinions but I think the former approach sounds good. From what I understand things usually need to be at the highest level of generality and very polished in order to get merged into mathlib so I would guess that it would be easier for you if you start with a smaller piece of it.</p>",
        "id": 575818237,
        "sender_full_name": "Hampus Nyberg",
        "timestamp": 1772037205
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"871498\">Hampus Nyberg</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2335732.20Reproducing.20Kernels/near/575818237\">said</a>:</p>\n<blockquote>\n<p>Then on line 237 we quotient out by elements having zero distance from each other and then complete.</p>\n</blockquote>\n<p>I haven't looked at the PR, but if you're doing what I think you're doing, you shouldn't need to do the first step. <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=UniformSpace.completion#doc\">docs#UniformSpace.completion</a> is the Hausdorff completion, so it already does the quotienting out by inseparable elements.</p>",
        "id": 575828813,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1772039802
    },
    {
        "content": "<blockquote>\n<p>If it was the case that say, matrices had a different partial order instance then I think there would be a case for making kernels a separate class.</p>\n</blockquote>\n<p>There are multiple non-equivalent partial orders of matrices (minus, sharp, star,....). The one for kernels is called the Löwner order. So having a separate class is probably a good idea. </p>\n<blockquote>\n<p>That's probably a good idea! Any suggestions on what to write and where?</p>\n</blockquote>\n<p>When we have separate class for kernels/posSemidef matrices, we could create a <code>variable_alias</code> like how its done for <code>HilbertSpace</code>. You could then call the infinite dimensional case <code>Kernel</code> and make the structure alias <code>PSDMatrix</code> when dealing with finite domains, or just create a structure <code>PSDMatrix</code> and an alias for is called  <code>Kernel</code>.</p>",
        "id": 575983506,
        "sender_full_name": "Tjeerd Jan Heeringa",
        "timestamp": 1772100789
    }
]