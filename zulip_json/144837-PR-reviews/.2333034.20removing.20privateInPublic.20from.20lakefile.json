[
    {
        "content": "<p>I have just created a monster PR:</p>\n<blockquote>\n<p>chore: remove backward.privateInPublic from lakefile <a href=\"https://github.com/leanprover-community/mathlib4/pull/33034\">#33034</a> </p>\n</blockquote>\n<p>I have added extensive hints on how to digest the diff, because it is almost completely boring.</p>\n<p>The PR has already acquired merge conflicts. I am happy to fix those, but would prefer to do so after an initial review.</p>",
        "id": 564495786,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766073010
    },
    {
        "content": "<p>This is the next step in moving Mathlib to the module system.</p>",
        "id": 564495935,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766073043
    },
    {
        "content": "<p>It localizes the backwards compatibility option to ~ 1000 decls. Over time, we should refactor the library to reduce this technical debt.</p>",
        "id": 564496124,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766073083
    },
    {
        "content": "<p>Pinging a few people that might want to chime in:<br>\n<span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> <span class=\"user-mention\" data-user-id=\"110087\">@Kim Morrison</span> <span class=\"user-mention\" data-user-id=\"479299\">@Jovan Gerbscheid</span> <span class=\"user-mention\" data-user-id=\"634338\">@Michael Rothgang</span> <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span></p>",
        "id": 564496748,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766073217
    },
    {
        "content": "<p>I take away that <code>private</code> isn't so private.</p>",
        "id": 564510136,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1766076454
    },
    {
        "content": "<p>Merging master turned out to be relatively easy.</p>",
        "id": 564536442,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766083887
    },
    {
        "content": "<p>This does mean that the exact numbers in my review hints are no longer correct... But the methodology still applies.</p>",
        "id": 564536578,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766083940
    },
    {
        "content": "<p>Is there much point setting <code>backward.privateInPublic.warn</code> locally everywhere?</p>",
        "id": 564566042,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766091407
    },
    {
        "content": "<p>Maybe not much point, but it does provide some signal, which I think is useful when working on reducing the tech debt.</p>",
        "id": 564567116,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766091835
    },
    {
        "content": "<p>I think it's valuable to localize these <code>backward</code> options as much as possible. It both gives us something measurable to work on, and reduces the \"start up cost\" if someone wants to tackle these: they don't have to start by working out where to look!</p>",
        "id": 564589242,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766102324
    },
    {
        "content": "<p>To be clear, my question was whether the distinction between the two options is interesting</p>",
        "id": 564591128,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766103117
    },
    {
        "content": "<p>I've pushed a few more commits, now achieving a full build. I added a few adaptation_notes about places where I removed a <code>private</code> modifier.</p>",
        "id": 564604388,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1766110575
    },
    {
        "content": "<p>My inclination would be to review the <code>private</code> removals separately; the PR is way too big to load with github at the moment</p>",
        "id": 564605654,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766111469
    },
    {
        "content": "<p>Perhaps <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> should confirm, but as I understand it the _only_ change in his commits are the addition of <code>set_option</code>s, which probably need no review</p>",
        "id": 564605691,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1766111497
    },
    {
        "content": "<p>On the commit message I explicitly explain how to list the ~20-line diff of changes that are not <code>set_option</code>.<br>\nSome proofs broke in a very mild way.</p>",
        "id": 564620683,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766121664
    },
    {
        "content": "<p>I would very much prefer to get this merged, even if Kim removed 4 cases of <code>private</code>. They are clearly marked with an <code>#adaptation_note</code>.</p>",
        "id": 564620817,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766121814
    },
    {
        "content": "<p>I pushed one more commit, adding a <code>Removed private</code> header to the 4 adaptation notes, that shows up when you <code>grep adaptation_note</code>.</p>",
        "id": 564621784,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766122640
    },
    {
        "content": "<p>The linter is now also happy with this PR</p>",
        "id": 564644012,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766133742
    },
    {
        "content": "<p>Thanks a lot for your heroic work here! I think this is really important and should get merged quickly. That said, it would be nice if it were properly reviewed. To that end: is it possible to split out the interesting changes into a separate PR? (I can look at that one quickly, and then the rest is purely mechanical and can easily be checked this way.)</p>",
        "id": 564647379,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766134737
    },
    {
        "content": "<p>I've explained in the PR message which git command you need to run to see the tiny interesting part of the diff. Is that good enough?</p>",
        "id": 564648363,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766135092
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gh\">diff --git a/Mathlib/Algebra/Lie/TraceForm.lean b/Mathlib/Algebra/Lie/TraceForm.lean</span>\n<span class=\"gh\">index 93b3f09d2c6..697f9edadf5 100644</span>\n<span class=\"gd\">--- a/Mathlib/Algebra/Lie/TraceForm.lean</span>\n<span class=\"gi\">+++ b/Mathlib/Algebra/Lie/TraceForm.lean</span>\n<span class=\"gu\">@@ -227,8 +227,8 @@ lemma traceForm_eq_sum_genWeightSpaceOf</span>\n<span class=\"w\"> </span>      (genWeightSpaceOf M œá z) (genWeightSpaceOf M œá z) :=\n<span class=\"w\"> </span>    fun œá m hm ‚Ü¶ LieSubmodule.lie_mem _ &lt;| LieSubmodule.lie_mem _ hm\n<span class=\"w\"> </span>  have hfin : {œá : R | (genWeightSpaceOf M œá z : Submodule R M) ‚â† ‚ä•}.Finite := by\n<span class=\"gd\">-    convert finite_genWeightSpaceOf_ne_bot R L M z</span>\n<span class=\"gd\">-    exact LieSubmodule.toSubmodule_eq_bot (genWeightSpaceOf M _ _)</span>\n<span class=\"gi\">+    simp_rw [ne_eq, LieSubmodule.toSubmodule_eq_bot (genWeightSpaceOf M _ _)]</span>\n<span class=\"gi\">+    exact finite_genWeightSpaceOf_ne_bot R L M z</span>\n<span class=\"w\"> </span>  classical\n<span class=\"w\"> </span>  have h := LieSubmodule.iSupIndep_toSubmodule.mpr &lt;| iSupIndep_genWeightSpaceOf R L M z\n<span class=\"w\"> </span>  have hds := DirectSum.isInternal_submodule_of_iSupIndep_of_iSup_eq_top h &lt;| by\n<span class=\"gh\">diff --git a/Mathlib/Algebra/Order/Ring/StandardPart.lean b/Mathlib/Algebra/Order/Ring/StandardPart.lean</span>\n<span class=\"gh\">index 59570a4f841..99f14c3507d 100644</span>\n<span class=\"gd\">--- a/Mathlib/Algebra/Order/Ring/StandardPart.lean</span>\n<span class=\"gi\">+++ b/Mathlib/Algebra/Order/Ring/StandardPart.lean</span>\n<span class=\"gu\">@@ -110,7 +110,10 @@ namespace FiniteResidueField</span>\n<span class=\"w\"> </span>noncomputable instance : Field (FiniteResidueField K) :=\n<span class=\"w\"> </span>  inferInstanceAs (Field (IsLocalRing.ResidueField _))\n\n<span class=\"gd\">-private theorem ordConnected_preimage_mk' : ‚àÄ x, Set.OrdConnected &lt;| Quotient.mk</span>\n<span class=\"gi\">+#adaptation_note /-- Removed `private':</span>\n<span class=\"gi\">+This had been private, but while disabling `set_option backward.privateInPublic` as a global option</span>\n<span class=\"gi\">+we have made it public again. -/</span>\n<span class=\"gi\">+theorem ordConnected_preimage_mk' : ‚àÄ x, Set.OrdConnected &lt;| Quotient.mk</span>\n<span class=\"w\"> </span>    (Submodule.quotientRel (IsLocalRing.maximalIdeal (FiniteElement K))) ‚Åª¬π' {x} := by\n<span class=\"w\"> </span>  refine fun x ‚Ü¶ ‚ü®?_‚ü©\n<span class=\"w\"> </span>  rintro x rfl y hy z ‚ü®hxz, hzy‚ü©\n<span class=\"gh\">diff --git a/Mathlib/Analysis/SpecialFunctions/Exp.lean b/Mathlib/Analysis/SpecialFunctions/Exp.lean</span>\n<span class=\"gh\">index da06263a94c..af20d26894c 100644</span>\n<span class=\"gd\">--- a/Mathlib/Analysis/SpecialFunctions/Exp.lean</span>\n<span class=\"gi\">+++ b/Mathlib/Analysis/SpecialFunctions/Exp.lean</span>\n<span class=\"gu\">@@ -68,9 +68,7 @@ theorem continuous_exp : Continuous exp :=</span>\n<span class=\"w\"> </span>  continuous_iff_continuousAt.mpr fun x =&gt;\n<span class=\"w\"> </span>    continuousAt_of_locally_lipschitz zero_lt_one (2 * ‚Äñexp x‚Äñ)\n<span class=\"w\"> </span>      (fun y ‚Ü¶ by\n<span class=\"gd\">-        convert locally_lipschitz_exp zero_le_one le_rfl x y using 2</span>\n<span class=\"gd\">-        congr</span>\n<span class=\"gd\">-        ring)</span>\n<span class=\"gi\">+        simpa [dist_eq_norm, one_add_one_eq_two] using locally_lipschitz_exp zero_le_one le_rfl x y)</span>\n\n<span class=\"w\"> </span>theorem continuousOn_exp {s : Set ‚ÑÇ} : ContinuousOn exp s :=\n<span class=\"w\"> </span>  continuous_exp.continuousOn\n<span class=\"gh\">diff --git a/Mathlib/CategoryTheory/Category/Cat.lean b/Mathlib/CategoryTheory/Category/Cat.lean</span>\n<span class=\"gh\">index 6b763180e88..d73a0ae4136 100644</span>\n<span class=\"gd\">--- a/Mathlib/CategoryTheory/Category/Cat.lean</span>\n<span class=\"gi\">+++ b/Mathlib/CategoryTheory/Category/Cat.lean</span>\n<span class=\"gu\">@@ -56,13 +56,16 @@ def of (C : Type u) [Category.{v} C] : Cat.{v, u} :=</span>\n\n<span class=\"w\"> </span>section\n\n<span class=\"gi\">+#adaptation_note /-- Removed `private`:</span>\n<span class=\"gi\">+`ofFunctor` was marked `private` in #31807,</span>\n<span class=\"gi\">+but we have removed this when disabling `set_option backward.privateInPublic` as a global option. -/</span>\n<span class=\"w\"> </span>/--\n<span class=\"w\"> </span>The type of 1-morphisms in the bicategory of categories `Cat`.\n<span class=\"w\"> </span>This is a structure around `Functor` to prevent defeq-abuse\n<span class=\"w\"> </span>-/\n<span class=\"w\"> </span>@[ext]\n<span class=\"w\"> </span>structure Hom (C D : Cat.{v, u}) where\n<span class=\"gd\">-  private ofFunctor ::</span>\n<span class=\"gi\">+  ofFunctor ::</span>\n<span class=\"w\"> </span>  /-- The Functor underlying a 1-morphism in Cat -/\n<span class=\"w\"> </span>  toFunctor : C ‚•§ D\n\n<span class=\"gu\">@@ -99,12 +102,15 @@ and the type of functors between the categories corresponding to those objects.</span>\n<span class=\"w\"> </span>def Hom.equivFunctor (C D : Cat.{v, u}) :\n<span class=\"w\"> </span>    (C ‚ü∂ D) ‚âÉ C ‚•§ D := (equivCatHom _ _).symm\n\n<span class=\"gi\">+#adaptation_note /-- Removed `private`:</span>\n<span class=\"gi\">+`ofNatTrans` was marked `private` in #31807,</span>\n<span class=\"gi\">+but we have removed this when disabling `set_option backward.privateInPublic` as a global option. -/</span>\n<span class=\"w\"> </span>/--\n<span class=\"w\"> </span>The type of 2-morphisms in the bicategory of categories `Cat`.\n<span class=\"w\"> </span>This is a wrapper around `NatTrans` to prevent defeq-abuse.\n<span class=\"w\"> </span>-/\n<span class=\"w\"> </span>structure Hom‚ÇÇ {C D : Cat.{v, u}} (F G : C ‚ü∂ D) where\n<span class=\"gd\">-  private ofNatTrans ::</span>\n<span class=\"gi\">+  ofNatTrans ::</span>\n<span class=\"w\"> </span>  /-- The natural transformation underlying a 2-morphism in `Cat` -/\n<span class=\"w\"> </span>  toNatTrans : F.toFunctor ‚ü∂ G.toFunctor\n\n<span class=\"gh\">diff --git a/Mathlib/LinearAlgebra/LinearIndependent/Defs.lean b/Mathlib/LinearAlgebra/LinearIndependent/Defs.lean</span>\n<span class=\"gh\">index cb8f1ad8b7d..a86326df267 100644</span>\n<span class=\"gd\">--- a/Mathlib/LinearAlgebra/LinearIndependent/Defs.lean</span>\n<span class=\"gi\">+++ b/Mathlib/LinearAlgebra/LinearIndependent/Defs.lean</span>\n<span class=\"gu\">@@ -726,7 +726,7 @@ theorem linearIndependent_iff' :</span>\n<span class=\"w\"> </span>  refine ‚ü®fun h s f ‚Ü¶ ?_, fun h s f g ‚Ü¶ ?_‚ü©\n<span class=\"w\"> </span>  ¬∑ convert h s f 0; simp_rw [Pi.zero_apply, zero_smul, Finset.sum_const_zero]\n<span class=\"w\"> </span>  ¬∑ rw [‚Üê sub_eq_zero, ‚Üê Finset.sum_sub_distrib]\n<span class=\"gd\">-    convert h s (f - g) using 3 &lt;;&gt; simp only [Pi.sub_apply, sub_smul, sub_eq_zero]</span>\n<span class=\"gi\">+    convert h s (f - g) using 3; simp only [Pi.sub_apply, sub_smul, sub_eq_zero]</span>\n\n<span class=\"w\"> </span>/-- A version of `linearIndependent_iff` where the linear combination is a `Finset` sum\n<span class=\"w\"> </span>of a function with support contained in the `Finset`. -/\n<span class=\"gh\">diff --git a/Mathlib/Tactic/CategoryTheory/ToApp.lean b/Mathlib/Tactic/CategoryTheory/ToApp.lean</span>\n<span class=\"gh\">index 986679ea748..ada52f8eca3 100644</span>\n<span class=\"gd\">--- a/Mathlib/Tactic/CategoryTheory/ToApp.lean</span>\n<span class=\"gi\">+++ b/Mathlib/Tactic/CategoryTheory/ToApp.lean</span>\n<span class=\"gu\">@@ -93,8 +93,11 @@ def toCatExpr (e : Expr) : MetaM Expr := do</span>\n<span class=\"w\"> </span>  let value ‚Üê apprec 0 value\n<span class=\"w\"> </span>  return value\n\n<span class=\"gi\">+#adaptation_note /-- Removed `private`:</span>\n<span class=\"gi\">+`toNatTrans_congr` was marked `private` in #31807,</span>\n<span class=\"gi\">+but we have removed this when disabling `set_option backward.privateInPublic` as a global option. -/</span>\n<span class=\"w\"> </span>universe v u in\n<span class=\"gd\">-private def toNatTrans_congr {C D : Cat.{v, u}} {F G : C ‚ü∂ D} {Œ∑ Œ∏ : F ‚ü∂ G} (h : Œ∑ = Œ∏) :</span>\n<span class=\"gi\">+lemma toNatTrans_congr {C D : Cat.{v, u}} {F G : C ‚ü∂ D} {Œ∑ Œ∏ : F ‚ü∂ G} (h : Œ∑ = Œ∏) :</span>\n<span class=\"w\"> </span>  Œ∑.toNatTrans = Œ∏.toNatTrans := congr(($h).toNatTrans)\n\n<span class=\"w\"> </span>/--\n<span class=\"gh\">diff --git a/Mathlib/Topology/DiscreteSubset.lean b/Mathlib/Topology/DiscreteSubset.lean</span>\n<span class=\"gh\">index fe1dc1fc3f8..b468831cb92 100644</span>\n<span class=\"gd\">--- a/Mathlib/Topology/DiscreteSubset.lean</span>\n<span class=\"gi\">+++ b/Mathlib/Topology/DiscreteSubset.lean</span>\n<span class=\"gu\">@@ -334,7 +334,9 @@ lemma mem_codiscrete_subtype_iff_mem_codiscreteWithin {S : Set X} {U : Set S} :</span>\n<span class=\"w\"> </span>    obtain ‚ü®u, hu1, hu2, hu3‚ü© := ht1\n<span class=\"w\"> </span>    refine ‚ü®u, hu1, hu2, fun v hv ‚Ü¶ ?_‚ü©\n<span class=\"w\"> </span>    simpa using fun hv2 ‚Ü¶ ‚ü®hv2, ht2 &lt;| hu3 &lt;| by simpa [hv2]‚ü©\n<span class=\"gd\">-  ¬∑ suffices Tendsto (‚Üë) (ùìù[‚â†] (‚ü®x, hx‚ü© : S)) (ùìù[‚â†] x) by convert tendsto_def.mp this _; ext; simp</span>\n<span class=\"gi\">+  ¬∑ suffices Tendsto (‚Üë) (ùìù[‚â†] (‚ü®x, hx‚ü© : S)) (ùìù[‚â†] x) by</span>\n<span class=\"gi\">+      have aux : Subtype.val ‚Åª¬π' (S \\ Subtype.val '' U)·∂ú = U := by ext; simp</span>\n<span class=\"gi\">+      simpa [aux] using tendsto_def.mp this ((S \\ Subtype.val '' U)·∂ú)</span>\n<span class=\"w\"> </span>    exact tendsto_nhdsWithin_of_tendsto_nhds_of_eventually_within _\n<span class=\"w\"> </span>      continuous_subtype_val.continuousWithinAt &lt;| eventually_mem_nhdsWithin.mono (by simp)\n\n<span class=\"gh\">diff --git a/Mathlib/Topology/Homeomorph/Defs.lean b/Mathlib/Topology/Homeomorph/Defs.lean</span>\n<span class=\"gh\">index 4f08cc10666..5b79e970549 100644</span>\n<span class=\"gd\">--- a/Mathlib/Topology/Homeomorph/Defs.lean</span>\n<span class=\"gi\">+++ b/Mathlib/Topology/Homeomorph/Defs.lean</span>\n<span class=\"gu\">@@ -343,7 +343,7 @@ variable {Z : Type*} [TopologicalSpace X] [TopologicalSpace Y] [TopologicalSpace</span>\n<span class=\"w\"> </span>def toHomeomorph (e : X ‚âÉ Y) (he : ‚àÄ s, IsOpen (e ‚Åª¬π' s) ‚Üî IsOpen s) : X ‚âÉ‚Çú Y where\n<span class=\"w\"> </span>  toEquiv := e\n<span class=\"w\"> </span>  continuous_toFun := continuous_def.2 fun _ ‚Ü¶ (he _).2\n<span class=\"gd\">-  continuous_invFun := continuous_def.2 fun s ‚Ü¶ by convert (he _).1; simp</span>\n<span class=\"gi\">+  continuous_invFun := continuous_def.2 fun s ‚Ü¶ by simpa using (he (e.symm ‚Åª¬π' s)).1</span>\n\n<span class=\"w\"> </span>@[deprecated (since := \"2025-10-09\")] alias toHomeomorph_toEquiv := toEquiv_toHomeomorph\n\n<span class=\"gh\">diff --git a/lakefile.lean b/lakefile.lean</span>\n<span class=\"gh\">index 12bed8b240e..7d762660816 100644</span>\n<span class=\"gd\">--- a/lakefile.lean</span>\n<span class=\"gi\">+++ b/lakefile.lean</span>\n<span class=\"gu\">@@ -43,12 +43,6 @@ abbrev mathlibOnlyLinters : Array LeanOption := #[</span>\n<span class=\"w\"> </span>abbrev mathlibLeanOptions := #[\n<span class=\"w\"> </span>    ‚ü®`pp.unicode.fun, true‚ü©, -- pretty-prints `fun a ‚Ü¶ b`\n<span class=\"w\"> </span>    ‚ü®`autoImplicit, false‚ü©,\n<span class=\"gd\">-    -- Enforcing the module system's restrictions on using private declarations in public contexts</span>\n<span class=\"gd\">-    -- will require further API changes specific to the respective usage, so we disable these checks</span>\n<span class=\"gd\">-    -- for now until they can be addressed one by one.</span>\n<span class=\"gd\">-    ‚ü®`backward.privateInPublic, true‚ü©,</span>\n<span class=\"gd\">-    -- We disable the many warnings for now; this can be switched locally to work on the offenders.</span>\n<span class=\"gd\">-    ‚ü®`backward.privateInPublic.warn, false‚ü©,</span>\n<span class=\"w\"> </span>    ‚ü®`maxSynthPendingDepth, .ofNat 3‚ü©\n<span class=\"w\"> </span>  ] ++ -- options that are used in `lake build`\n<span class=\"w\"> </span>    mathlibOnlyLinters.map fun s ‚Ü¶ { s with name := `weak ++ s.name }\n</code></pre></div>",
        "id": 564650723,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766136037
    },
    {
        "content": "<p>What does <code>backward.privateInPublic</code> do? and why do we want to disable it?</p>",
        "id": 564660670,
        "sender_full_name": "Violeta Hern√°ndez",
        "timestamp": 1766139388
    },
    {
        "content": "<p>Taking a look. The diff you're showing is indeed fine...</p>",
        "id": 564664530,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766140601
    },
    {
        "content": "<p>Delegated</p>",
        "id": 564671465,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766142739
    },
    {
        "content": "<p>What this PR has shown is that the module system is too coarse-grained at the moment</p>",
        "id": 564699175,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766151930
    },
    {
        "content": "<p>In <code>Data.Int.GCD</code> for example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Unknown</span><span class=\"w\"> </span><span class=\"n\">identifier</span><span class=\"w\"> </span><span class=\"ss\">`P</span><span class=\"bp\">`</span>\n\n<span class=\"n\">Note</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"n\">declaration</span><span class=\"w\"> </span><span class=\"ss\">`P</span><span class=\"bp\">`</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">current</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">would</span><span class=\"w\"> </span><span class=\"n\">need</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">public</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"n\">here</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 564699289,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766151963
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598052\">@Jeremy Tan</span> I'm not sure I understand what you mean. Can you please elaborate a bit?</p>",
        "id": 564700499,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766152328
    },
    {
        "content": "<p>Can you elaborate, please? The PR has been merged, hence compiles - and it's not clear to me what error you're referring to.</p>",
        "id": 564700500,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766152328
    },
    {
        "content": "<p>What I'm saying is what I'm seeing __after__ the merge</p>",
        "id": 564700602,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766152368
    },
    {
        "content": "<p>In <code>Data.Int.GCD</code> we have</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">backward</span><span class=\"bp\">.</span><span class=\"n\">privateInPublic</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">P</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"w\"> </span><span class=\"bp\">√ó</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"w\"> </span><span class=\"bp\">‚Üí</span><span class=\"w\"> </span><span class=\"kt\">Prop</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñ§</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">t</span>\n</code></pre></div>\n<p>and simply removing the <code>set_option</code> causes the above error in the immediately following declaration. There appears to be no way to make <code>P</code> visible to just the module</p>",
        "id": 564700846,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766152433
    },
    {
        "content": "<p>Well, the fix is to make <code>xgcdAux_P</code> private as well; then everything works.</p>",
        "id": 564701048,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766152499
    },
    {
        "content": "<p>Feel free to push to/PR into <a href=\"https://github.com/leanprover-community/mathlib4/pull/33089\">#33089</a> with further fixes like this.</p>",
        "id": 564701412,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766152605
    },
    {
        "content": "<p>I looked at a few other cases, and the situation is not as straightforward there. What about private theorems being used inside a public <code>instance</code>, for instance (no pun intended)?</p>",
        "id": 564702745,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766152955
    },
    {
        "content": "<p>All occurrences of</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">set_option</span><span class=\"w\"> </span><span class=\"n\">backward</span><span class=\"bp\">.</span><span class=\"n\">privateInPublic</span><span class=\"w\"> </span><span class=\"n\">true</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"kn\">private</span><span class=\"w\"> </span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"bp\">...</span>\n</code></pre></div>\n<p>seem fishy, though.</p>",
        "id": 564702804,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766152969
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/33076\">#33076</a> removes a few file-level exceptions added in <a href=\"https://github.com/leanprover-community/mathlib4/pull/33034\">#33034</a></p>",
        "id": 564703561,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766153188
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2333034.20removing.20privateInPublic.20from.20lakefile/near/564702745\">said</a>:</p>\n<blockquote>\n<p>I looked at a few other cases, and the situation is not as straightforward there. What about private theorems being used inside a public <code>instance</code>, for instance (no pun intended)?</p>\n</blockquote>\n<p>I think you'll need to show more context for discussing that one. Generally, if another module should be allowed to unfold definitions until it can see the private definition, it shouldn't be private.</p>",
        "id": 564703977,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1766153298
    },
    {
        "content": "<p>Here's a different interesting case: private lemmas used only for the positivity tactic. Removing the option creates errors, because sometimes positivity proofs become part of the public API. <a href=\"https://github.com/leanprover-community/mathlib4/pull/33089/commits/34e50e4c8e84f89e63ff5d671b783c1c382603c6\">34e50e4c8e84f89e63ff5d671b783c1c382603c6</a> annotates a few cases.</p>",
        "id": 564707496,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1766154335
    },
    {
        "content": "<p>Yup! That was a nasty one to debug...</p>",
        "id": 564707705,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766154400
    },
    {
        "content": "<p>So if a theorem is part of the public API of a tactic... shouldn't it become public?</p>",
        "id": 564708351,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1766154572
    },
    {
        "content": "<p>Yeah, that made sense to me. But I tried not to remove <code>private</code> keywords.</p>",
        "id": 564709077,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766154779
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2333034.20removing.20privateInPublic.20from.20lakefile/near/564701412\">said</a>:</p>\n<blockquote>\n<p>Feel free to push to/PR into <a href=\"https://github.com/leanprover-community/mathlib4/pull/33089\">#33089</a> with further fixes like this.</p>\n</blockquote>\n<p>How do I make a PR to your PR?</p>",
        "id": 564714358,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766156154
    },
    {
        "content": "<p>(I've pushed removals to <code>Parcly-Taxel:privateInPublic</code>)</p>",
        "id": 564714579,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766156199
    },
    {
        "content": "<p>You can choose to which branch you want to open your PR, in the GH web ui. There's an option to include branches from forks.</p>",
        "id": 564717210,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766156805
    },
    {
        "content": "<p><code>grunweg/mathlib4</code> doesn't appear in the selector</p>",
        "id": 564717416,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766156858
    },
    {
        "content": "<p>Look for <a href=\"https://github.com/grunweg/mathlib4/tree/privacy\">grunweg:privacy</a></p>",
        "id": 564717847,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766156964
    },
    {
        "content": "<p>That's the branch from which <a href=\"https://github.com/leanprover-community/mathlib4/pull/33089\">#33089</a> is made.</p>",
        "id": 564717879,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766156977
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/L6dkDi0OYU-cSw6FtzsrRXWd/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/L6dkDi0OYU-cSw6FtzsrRXWd/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1252x317\" src=\"/user_uploads/thumbnail/3121/L6dkDi0OYU-cSw6FtzsrRXWd/image.png/840x560.webp\"></a></div>",
        "id": 564718125,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766157048
    },
    {
        "content": "<p>Even grunweg's repo doesn't show up</p>",
        "id": 564719334,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766157341
    },
    {
        "content": "<p>oh, when I type in the repo and branch manually in the URL, it redirects me to grunweg's repo</p>",
        "id": 564719535,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766157391
    },
    {
        "content": "<p>What happens if you click the \"compare accross forks\" link?</p>",
        "id": 564719818,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766157465
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/CXuhGoRXOCQ22884Hdh5Drwb/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/CXuhGoRXOCQ22884Hdh5Drwb/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1252x317\" src=\"/user_uploads/thumbnail/3121/CXuhGoRXOCQ22884Hdh5Drwb/image.png/840x560.webp\"></a></div>",
        "id": 564720013,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766157517
    },
    {
        "content": "<p>That link toggles between the two screenshots, and in the latter view it only shows all the stale branches of mathlib4 from the time when we did everything in one repo without forks</p>",
        "id": 564720068,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766157532
    },
    {
        "content": "<p>/me doesn't understand GitHub</p>",
        "id": 564720202,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1766157573
    },
    {
        "content": "<p>Never mind then, my removals are in <a href=\"https://github.com/leanprover-community/mathlib4/pull/33092\">#33092</a></p>",
        "id": 564720531,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1766157664
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"634338\">Michael Rothgang</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2333034.20removing.20privateInPublic.20from.20lakefile/near/564702745\">said</a>:</p>\n<blockquote>\n<p>I looked at a few other cases, and the situation is not as straightforward there. What about private theorems being used inside a public <code>instance</code>, for instance (no pun intended)?</p>\n</blockquote>\n<p>This should be fine, since it will be inside a proof, and the contents of proofs are private.</p>",
        "id": 564766842,
        "sender_full_name": "Aaron Liu",
        "timestamp": 1766173955
    }
]