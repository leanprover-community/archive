[
    {
        "content": "<p>In this PR I proved the Weierstrass preparation for formal power series over complete local ring, which states that any power series can be factored into the product of a distinguish polynomial and an unit.<br>\nI have a question here : as the weierstrass decomposition is canonical, do we prefer to write the two components as a definition?<br>\nWriting the two component as def would probably benefit the statment of uniqueness. This refactor would also break down the current big proof and make many haves in it as separate lemma.<br>\nDo we prefer to state the theorem as this form?<br>\nThis may cause some big refactor in the current code so I want to make sure, thanks.</p>",
        "id": 506963127,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742474734
    },
    {
        "content": "<p>Both the unit and the polynomial are unique, right? In this case I think a def is perfectly fine</p>",
        "id": 506967779,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1742475890
    },
    {
        "content": "<p>But we also want the fact that if somehow someone else gets a unit and a polynomial such that blah blah then those are equal to yours</p>",
        "id": 506967918,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1742475925
    },
    {
        "content": "<p>in particular, don't avoid to prove uniqueness just because you have a definition</p>",
        "id": 506968026,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1742475952
    },
    {
        "content": "<p>They are both unique, as a part of the theorem itself.<br>\nSorry I didn't say it clear, currently the uniqueness is somehow proven twice, as the proof is intertwined with the induction step, making the unique statement somehow a bit weak, so another lemma is proved outside removing the unused conditions that is wrapped together in the former proof.<br>\nSo writing them down as definition makes it possible to have more separate lemma and easier to state the uniqueness with minimal conditions.<br>\nUniqueness is always needed, as it is an important part of the statement, I only wonder which one is better.</p>",
        "id": 506975954,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742477989
    },
    {
        "content": "<p>I think a definition is better</p>",
        "id": 506981731,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1742479274
    },
    {
        "content": "<p>Then I'll try to give a refactor. This PR would probably break for a few days then.</p>",
        "id": 506992913,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742481673
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.gcdA#doc\">docs#Nat.gcdA</a> is a definition and it's not even unique! I think a definition is fine.</p>",
        "id": 506993578,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742481821
    },
    {
        "content": "<p>A bad news : breaking the lifting step down is almost impossible, as passing from <code>R/m ^ n</code> to <code>R/m ^ (n + 1)</code>, I need the expected factorization <code>f = g * h</code> with <code>g</code> monic and <code>h</code> is a unit, or else I won't be able to take out the \"difference\" after lifting, the when proving the newly obtained <code>h</code> for <code>R/m ^ (n + 1)</code> is unit it need <code>f = g * h</code>, and this calculation is still based on <code>g</code> is distinguish.<br>\nThis means that I still have to stuff almost all the things in the proof into the def.</p>",
        "id": 507207634,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742542183
    },
    {
        "content": "<p>As this part failed, do we accept writing the <code>Classical.choose</code> of this intermidiate result as a def and go on with the proof of the main theorem using it?<br>\nAs the proof of main theorem take over 100 line verifying that the series of polynomial/powerseries taken is able to take limit, this may refine the proof? (setting up appropriate lemma would probably also work)</p>",
        "id": 507208663,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742542595
    },
    {
        "content": "<p>I had a look at your PR: very nice work, but have you thought about defining the class/structure of distinguished polynomials? Because they come up in many places beyond Weierstrass preparation, and it would make a lot of results easier to state.</p>",
        "id": 507596845,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1742758178
    },
    {
        "content": "<p>I thought about it before but I am not very sure about the appropriate definition and its applications.<br>\nI didn't define it only because I didn't have much time for this work in the last few month and it didn't cause too much trouble currently.<br>\nThank you for pointing this out. Maybe we should make the definition clear now.</p>",
        "id": 507633030,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742783081
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"366779\">@Jz Pan</span>  mentioned that maybe the current <code>Nat.find ntriv</code> can be restated as the order of the power series under the map from <code>R</code> to <code>R/m</code>, ntriv can probably also be stated similarly.<br>\nThis is another refactor worth exploring.</p>",
        "id": 507717040,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742812945
    },
    {
        "content": "<p>Did you use results similar to this?</p>\n<p><a href=\"/user_uploads/3121/YD3Gg-I-jfF1hmAvq9QvaUNp/2025-03-24-204310.png\">2025-03-24 204310.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/YD3Gg-I-jfF1hmAvq9QvaUNp/2025-03-24-204310.png\" title=\"2025-03-24 204310.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"804x138\" src=\"/user_uploads/thumbnail/3121/YD3Gg-I-jfF1hmAvq9QvaUNp/2025-03-24-204310.png/840x560.webp\"></a></div><p>If yes, maybe you can add two definitions and several lemmas for it, similar to <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.divByMonic#doc\">docs#Polynomial.divByMonic</a> and <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.modByMonic#doc\">docs#Polynomial.modByMonic</a>. The <code>n</code> in above lemma is just the order of the power series under the map from <code>R</code> to <code>R/m</code>. You can define <code>q=0</code> and <code>r=g</code> if such <code>n</code> is infinity, just like <code>_ / 0</code> and <code>_ % 0</code> for natural numbers.</p>",
        "id": 507750940,
        "sender_full_name": "Jz Pan",
        "timestamp": 1742820496
    },
    {
        "content": "<p>No, I followed another proof that doesn't involve these kind of division.<br>\nAlthough I was planning to develope this lemma.</p>",
        "id": 507772283,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742824684
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749361\">Nailin Guan</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321944.20Weierstrass.20preparation.20for.20complete.20local.20ring/near/507717040\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"366779\">Jz Pan</span>  mentioned that maybe the current <code>Nat.find ntriv</code> can be restated as the order of the power series under the map from <code>R</code> to <code>R/m</code>, ntriv can probably also be stated similarly.<br>\nThis is another refactor worth exploring.</p>\n</blockquote>\n<p>This is good, it gets rid of some nondegenerate condition, also making every thing involved looks shorter.</p>",
        "id": 507948867,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742888929
    },
    {
        "content": "<p>I am trying to refactor using the two suggestions,</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">structure</span><span class=\"w\"> </span><span class=\"n\">IsDistinguish</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">])</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Ideal</span><span class=\"w\"> </span><span class=\"n\">R</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"n\">where</span>\n<span class=\"w\">  </span><span class=\"n\">monic</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f.Monic</span>\n<span class=\"w\">  </span><span class=\"n\">else_mem</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">f.degree</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">f.coeff</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">I</span>\n</code></pre></div>\n<p>is this definition good enough? (I haven't consider the naming carefully yet)</p>",
        "id": 507949040,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742888995
    },
    {
        "content": "<p>Maybe you can take <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Polynomial.IsEisensteinAt#doc\">docs#Polynomial.IsEisensteinAt</a> as a reference.</p>",
        "id": 507951739,
        "sender_full_name": "Jz Pan",
        "timestamp": 1742889914
    },
    {
        "content": "<p>Maybe <code>IsDistinguished</code> for the name?</p>",
        "id": 507957535,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742891766
    },
    {
        "content": "<p>I prefer <code>Polynomial.IsDistinguishedAt</code>.</p>",
        "id": 507994929,
        "sender_full_name": "Jz Pan",
        "timestamp": 1742901763
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321944.20Weierstrass.20preparation.20for.20complete.20local.20ring/near/506993578\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.gcdA#doc\">docs#Nat.gcdA</a> is a definition and it's not even unique! I think a definition is fine.</p>\n</blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.gcdA#doc\">docs#Nat.gcdA</a> is unique in the sense that it is the output of a specific algorithm (the “extended” Euclidean algorithm).</p>",
        "id": 508078641,
        "sender_full_name": "Antoine Chambert-Loir",
        "timestamp": 1742921718
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"366779\">Jz Pan</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321944.20Weierstrass.20preparation.20for.20complete.20local.20ring/near/507994929\">said</a>:</p>\n<blockquote>\n<p>I prefer <code>Polynomial.IsDistinguishedAt</code>.</p>\n</blockquote>\n<p>Why? What does the  <code>At</code> refer to (in the local/p-adic setting)?</p>",
        "id": 508138576,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1742941363
    },
    {
        "content": "<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span></p>",
        "id": 508139076,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1742941585
    },
    {
        "content": "<p>The refactor is finished.<br>\nI get rid of classical and the separate unique lemma.<br>\nThe property of the degree of the distinguish polynomial is now a separate lemma.</p>",
        "id": 508214603,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1742979661
    },
    {
        "content": "<p>Now as the refactored proof works good, do we still prefer to make the two component defs?<br>\nAlso in <a href=\"https://github.com/leanprover-community/mathlib4/pull/21859\">#21859</a> the three components?</p>",
        "id": 508297349,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1743000299
    },
    {
        "content": "<p>Also <span class=\"user-mention\" data-user-id=\"130384\">@Riccardo Brasca</span>  mentioned that <code>IsDistinguishedAt</code> is simply <code>Monic</code> with <code>Polynomial.IsWeaklyEisensteinAt</code>, I prefer to add it, but is it appropriate?</p>",
        "id": 508297952,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1743000424
    },
    {
        "content": "<p>Adding the new definition is probably fine, let's just try to not duplicate the API</p>",
        "id": 508299597,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1743000779
    },
    {
        "content": "<p>I think these are all the APIs that isn't straight from definition.<br>\n<a href=\"/user_uploads/3121/ooDX85omIJKwEGVpuemQZHLd/.png\">图片.png</a><br>\nI didn't see lemma that can unify with what I need.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ooDX85omIJKwEGVpuemQZHLd/.png\" title=\"图片.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1727x724\" src=\"/user_uploads/thumbnail/3121/ooDX85omIJKwEGVpuemQZHLd/.png/840x560.webp\"></a></div>",
        "id": 508429188,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1743050751
    },
    {
        "content": "<p>What results on distinguished polynomials do you need? Do they work if only <code>IsWeaklyEisensteinAt</code> is provided?</p>",
        "id": 508433076,
        "sender_full_name": "Jz Pan",
        "timestamp": 1743053826
    },
    {
        "content": "<p>No, I need the following :<br>\n<code>g</code> is distinguished at <code>I &lt; ⊤</code>, <code>h</code> is a power series with constant coeff an unit, <br>\nthen for <code>f = g * h</code>, the coefficient of  <code>f</code> at the degree of <code>g</code> is not in <code>I</code><br>\nCurrently it is proven with more general form that constant coeff of <code>h</code> is not in <code>I</code><br>\nIs distinguished at can somehow be weaken but there is always something needed for the leading coeff.</p>",
        "id": 508435078,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1743055291
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"749361\">Nailin Guan</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2321944.20Weierstrass.20preparation.20for.20complete.20local.20ring/near/508435078\">said</a>:</p>\n<blockquote>\n<p>Is distinguished at can somehow be weaken but there is always something needed for the leading coeff.</p>\n</blockquote>\n<p>I see, so you need <code>IsWeaklyEisensteinAt</code> and that the leading coefficient is a unit (?).</p>",
        "id": 508436399,
        "sender_full_name": "Jz Pan",
        "timestamp": 1743056053
    },
    {
        "content": "<p>The condition may in different form, but in all cases, I need the product of leading coeff of the polynomial and the constant coeff of the power series outside the ideal <code>I</code>, in particular, the case I used when proving the theorem is monic and constant coeff unit.</p>",
        "id": 508441829,
        "sender_full_name": "Nailin Guan",
        "timestamp": 1743059038
    }
]