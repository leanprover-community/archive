[
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20676\">#20676</a> is the culmination of an effort of <span class=\"user-mention\" data-user-id=\"455791\">@Yuyang Zhao</span>. Reading the room, I think the maintainers seem broadly happy with it but wanted to continue discussion here.</p>",
        "id": 509776995,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743621882
    },
    {
        "content": "<p>From the comments on the PR it seems that <a href=\"https://github.com/leanprover-community/mathlib4/pull/20676\">#20676</a> isn't the end of the story; there are some regressions which will only be fixed when <code>LinearOrderedCommGroupWithZero</code> and its friends are also removed.</p>",
        "id": 509783746,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743624290
    },
    {
        "content": "<p>This makes me suspect we should do the same to analysis.</p>",
        "id": 509790519,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743626751
    },
    {
        "content": "<p>I‚Äôm 100% in favor of this change, these entanglings of hierarchies always felt very weird to me.</p>",
        "id": 509805024,
        "sender_full_name": "Anatole Dedecker",
        "timestamp": 1743633044
    },
    {
        "content": "<p>As <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> found out, with <code>‚ä¢ (50 / 19) ^ 2 ‚â§ ‚Üë12 * log 2</code> (real numbers) and tactic <code>rw [‚Üê div_le_iff‚ÇÄ']</code> (line 416 of Behrend) we have this on master:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.093682</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">‚úÖÔ∏è</span><span class=\"w\"> </span><span class=\"n\">ZeroLEOneClass</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span>\n</code></pre></div>\n<p>and this on the feature branch: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">Meta</span><span class=\"bp\">.</span><span class=\"n\">synthInstance</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.355743</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">‚úÖÔ∏è</span><span class=\"w\"> </span><span class=\"n\">PosMulReflectLT</span><span class=\"w\"> </span><span class=\"n\">‚Ñù</span>\n</code></pre></div>",
        "id": 509807118,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743634132
    },
    {
        "content": "<p>Is it clear why this takes so long? Should we add shortcut instances for <code>Real</code>? Or should we do something else?</p>",
        "id": 509807215,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743634176
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedCommGroupWithZero#doc\">docs#LinearOrderedCommGroupWithZero</a> wasn‚Äôt unbundled but should be</p>",
        "id": 509807411,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743634280
    },
    {
        "content": "<p>I added the shortcut instance for Real in a commit on the PR and a file which had been 62% slower than master in the branch was suddenly 16% faster than master, so that is one possible fix. But the reason it was slow is that on the branch there's an attempt to deduce <code>PosMulReflectLT ‚Ñù</code> from the non-existing <code>LinearOrderedCommGroupWithZero ‚Ñù</code> which takes a long time to fail. Another fix, I suspect, would be to remove this class completely, and this is probably the more principled approach I guess?</p>",
        "id": 509807832,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743634496
    },
    {
        "content": "<p>One other things to note is that these are going to be obnoxious deprecations downstream; they're not of the form \"your code keeps working, but you should fix this soon\", but rather \"this doesn't work at all, but I'm going to give you a helpful error message to fix this\"</p>",
        "id": 509808994,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743635150
    },
    {
        "content": "<p>I don't think we have an alternative though, and usually in such cases mathlib errs on the side of progress rather than compatibility.</p>",
        "id": 509809100,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1743635203
    },
    {
        "content": "<p>Too bad we can‚Äôt <code>lake exe refactor</code></p>",
        "id": 509811785,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743636796
    },
    {
        "content": "<p>Can we create <code>Mathlib/Deprecated/April25.lean</code> and tell people to <code>import</code> it if they want backward compatibility?</p>",
        "id": 509812463,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743637202
    },
    {
        "content": "<p>This file can contain <code>def</code>s and <code>class</code>es that make the old code work (assuming people don't call <code>@my_lemma _ _ myInstance</code>).</p>",
        "id": 509812546,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743637240
    },
    {
        "content": "<p>I forget the exact reason for not deprecating <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedCommGroupWithZero#doc\">docs#LinearOrderedCommGroupWithZero</a> in <a href=\"https://github.com/leanprover-community/mathlib4/pull/20676\">#20676</a><del>, but it's more tricky than other typeclasses</del>.</p>",
        "id": 509834705,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743650781
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23621\">#23621</a> Haven't had any problems with deprecating <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedCommGroupWithZero#doc\">docs#LinearOrderedCommGroupWithZero</a>.<br>\nI think I confused it with <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedAddCommMonoidWithTop#doc\">docs#LinearOrderedAddCommMonoidWithTop</a>.</p>",
        "id": 509856499,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743662888
    },
    {
        "content": "<p>Regardless, it seems like <a href=\"https://github.com/leanprover-community/mathlib4/pull/20593\">#20593</a> is the first PR to be merged in this long chain of changes</p>",
        "id": 509873731,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1743668479
    },
    {
        "content": "<p>After deprecating <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=LinearOrderedCommGroupWithZero#doc\">docs#LinearOrderedCommGroupWithZero</a>, it's almost all green and</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">   </span><span class=\"n\">instructions</span><span class=\"w\">           </span><span class=\"bp\">-</span><span class=\"mf\">6.2</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">   </span><span class=\"n\">task</span><span class=\"bp\">-</span><span class=\"n\">clock</span><span class=\"w\">             </span><span class=\"bp\">-</span><span class=\"mf\">7.7</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">   </span><span class=\"n\">typeclass</span><span class=\"w\"> </span><span class=\"n\">inference</span><span class=\"w\">   </span><span class=\"bp\">-</span><span class=\"mf\">21.7</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\">   </span><span class=\"n\">wall</span><span class=\"bp\">-</span><span class=\"n\">clock</span><span class=\"w\">             </span><span class=\"bp\">-</span><span class=\"mf\">8.0</span><span class=\"bp\">%</span>\n<span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">lint</span><span class=\"w\">    </span><span class=\"n\">wall</span><span class=\"bp\">-</span><span class=\"n\">clock</span><span class=\"w\">             </span><span class=\"bp\">-</span><span class=\"mf\">9.0</span><span class=\"bp\">%</span>\n</code></pre></div>",
        "id": 509927889,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743683919
    },
    {
        "content": "<p>Amazing! And the file I was worried about is -13% rather than +60% or so.</p>",
        "id": 509935012,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1743685658
    },
    {
        "content": "<p>Thanks so much for doing this! Now there are only two red files in total!</p>",
        "id": 509944197,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743687740
    },
    {
        "content": "<p>Looking at <code>Mathlib.Topology.Algebra.Valued.LocallyCompact</code> (one of the two remaining red files) I have profiled it on (a) the branch (b) the commit to <code>master</code> which the branch branched off (\"old master\") and (c) current <code>master</code>, and it seems to me that the branch is a bit slower than old master, but current master is way way faster than either of them.</p>\n<p>Example: if <code>{K : Type*} [NontriviallyNormedField K]</code> then we have <code>(ùí™[K] : Subring K)</code> and when profiling the largest proof in the file we see things like:</p>\n<p>This branch:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">step</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.089448</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">    </span><span class=\"n\">IsDiscreteValuationRing</span><span class=\"w\"> </span><span class=\"n\">ùí™</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">‚ñº</span>\n</code></pre></div>\n<p>Old master:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">[</span><span class=\"n\">step</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.060157</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">    </span><span class=\"n\">IsDiscreteValuationRing</span><span class=\"w\"> </span><span class=\"n\">ùí™</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">‚ñº</span>\n</code></pre></div>\n<p>Current master:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"w\">      </span><span class=\"o\">[</span><span class=\"n\">step</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"mf\">0.016058</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">expected</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">term</span>\n<span class=\"w\">          </span><span class=\"n\">IsDiscreteValuationRing</span><span class=\"w\"> </span><span class=\"n\">ùí™</span><span class=\"o\">[</span><span class=\"n\">K</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"bp\">‚ñº</span>\n</code></pre></div>\n<p>Another datapoint: counting heartbeats in <code>totallyBounded_iff_finite_residueField</code>:</p>\n<p>This branch: 39378 heartbeats<br>\nOld master: 35181 heartbeats<br>\nCurrent master: 508 heartbeats(!)</p>\n<p>So in stark contrast to the Behrend file I feel like it's a waste of time trying to analyse why the branch is slightly slower on this file, because things have changed so much since January.</p>",
        "id": 509962582,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743691764
    },
    {
        "content": "<p>Should we merge <code>master</code> and <code>!bench</code> again?</p>",
        "id": 509963484,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743691983
    },
    {
        "content": "<p>(against the current <code>master</code>)</p>",
        "id": 509963524,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743691993
    },
    {
        "content": "<p>If you merge master you'll get literally hundreds of conflicts, but unfortunately the answer is probably \"yes\". My impression is that the maintainers have now decided that we're going ahead with this refactor so it will have to be done at some point.</p>",
        "id": 509963779,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743692055
    },
    {
        "content": "<p>Full disclosure: the maintainers discussed this refactor and the only real objection raised was that Behrend and other \"concrete\" files involving real numbers had slowed down -- but this is now fixed by the latest commits, so as far as I'm concerned this refactor is now going to happen.</p>",
        "id": 509969346,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743693419
    },
    {
        "content": "<p>Are canonical orderings part of this picture as well? The inability to express 'canonically ordered conditionally complete semlattice additive monoid' with typeclasses came up here  : <a class=\"stream-topic\" data-stream-id=\"144837\" href=\"/#narrow/channel/144837-PR-reviews/topic/.2323503.20ENat.20and.20tsum/with/509276812\">#PR reviews &gt; #23503 ENat and tsum</a></p>",
        "id": 509973566,
        "sender_full_name": "Peter Nelson",
        "timestamp": 1743694379
    },
    {
        "content": "<p>This is really a quite incredible feat. <a href=\"https://github.com/leanprover-community/mathlib4/pull/23621\">#23621</a> has only 19 files that increased in total instructions <em>at all</em>, and only 4 of those were above 3 billion, with the max 14 billion. In contrast there were ~130 files which decreased in instructions by at least 14 billion, and some not quite 1500 files that saw decreases of fewer that 14 billion instructions. <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span> <span aria-label=\"downwards trend\" class=\"emoji emoji-1f4c9\" role=\"img\" title=\"downwards trend\">:downwards_trend:</span></p>",
        "id": 509981745,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743696383
    },
    {
        "content": "<p>So I've had a look at LaurentSeries, the other file which got slower, and it's the same story: a random long proof (<code>Cauchy.coeff_eventually_equal</code>) is 2676 heartbeats on the branch, 2598 on old master and 182(!) on current master. So again so much has changed that we should probably just bump before debugging.</p>",
        "id": 509990195,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743698796
    },
    {
        "content": "<p>Has anyone started this bump?</p>",
        "id": 509991584,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743699225
    },
    {
        "content": "<p>We should figure out how to clear the glide path here once we bump</p>",
        "id": 509994465,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743700026
    },
    {
        "content": "<p>I can merge master on Saturday, if no one does it earlier.</p>",
        "id": 510001062,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743701978
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306577\">Matthew Ballard</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2320676.20unbundling.20ordered.20algebra/near/509994465\">said</a>:</p>\n<blockquote>\n<p>We should figure out how to clear the glide path here once we bump</p>\n</blockquote>\n<p>I didn't follow this metaphor. What?</p>",
        "id": 510014745,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743706327
    },
    {
        "content": "<p>Sorry. Clearing the airspace while a plane lands. So here avoiding merge conflicts once we get moving</p>",
        "id": 510019563,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743707848
    },
    {
        "content": "<p>I think, the easiest way is to review&amp;merge it quickly.</p>",
        "id": 510030278,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1743711630
    },
    {
        "content": "<p>Okay, that makes sense. I couldn't tell whether you meant that or preemptively addressing potential complaints (of which I suspect there will be none).</p>",
        "id": 510059451,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743726133
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"329425\">Peter Nelson</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2320676.20unbundling.20ordered.20algebra/near/509973566\">said</a>:</p>\n<blockquote>\n<p>Are canonical orderings part of this picture as well? The inability to express 'canonically ordered conditionally complete semlattice additive monoid' with typeclasses came up here  : <a class=\"stream-topic\" data-stream-id=\"144837\" href=\"/#narrow/channel/144837-PR-reviews/topic/.2323503.20ENat.20and.20tsum/with/509276812\">#PR reviews &gt; #23503 ENat and tsum</a></p>\n</blockquote>\n<p>The canonical ordering part has been done in <a href=\"https://github.com/leanprover-community/mathlib4/pull/17444\">#17444</a>.</p>",
        "id": 510067108,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743730687
    },
    {
        "content": "<p>I'll merge previous PR before merging <code>master</code> for benchmarking.</p>",
        "id": 510074199,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743735007
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20594\">#20594</a> is ready.</p>",
        "id": 510086722,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743742916
    },
    {
        "content": "<p>The <code>!bench</code> on that PR looks a lot less green. <span aria-label=\"oops\" class=\"emoji emoji-1f643\" role=\"img\" title=\"oops\">:oops:</span></p>",
        "id": 510120122,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1743754991
    },
    {
        "content": "<p>I don't expect it to be green until we finally deprecate the legacy typeclasses.</p>",
        "id": 510120765,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743755170
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> we already merged <a href=\"https://github.com/leanprover-community/mathlib4/pull/20593\">#20593</a> and benchmarking on that was horrible</p>",
        "id": 510141393,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743761043
    },
    {
        "content": "<p>This is why it was important to benchmark the final PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/23621\">#23621</a> so we knew what we were getting into.</p>",
        "id": 510142683,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743761428
    },
    {
        "content": "<p>The objection raised by the maintainers was that the <em>final</em> PR was not all green and indeed there were a certain class of files using <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span> explicitly which had consistently got slower, but now this is solved and the only remaining question is whether the last two red files will also get quicker once master is merged into <a href=\"https://github.com/leanprover-community/mathlib4/pull/23621\">#23621</a> or whether we need to do more debugging.</p>",
        "id": 510143072,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743761546
    },
    {
        "content": "<p>Thanks, I understand it now. I think I just didn't really understand what <a href=\"https://github.com/leanprover-community/mathlib4/pull/20594\">#20594</a> was accomplishing.</p>",
        "id": 510151420,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1743764124
    },
    {
        "content": "<p>I have reviewed about 4/5 of <a href=\"https://github.com/leanprover-community/mathlib4/pull/20594\">#20594</a> (just checking that all the changes look sane) but I need to go to a two-hour meeting now. I've submitted my review and I'll come back to it in 2 hours if nobody else has. There is some meta code and <code>fast_instance%</code> stuff which I'm not confident to review: I explicitly flagged these issues.</p>",
        "id": 510151805,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743764230
    },
    {
        "content": "<p>The disappearance of <code>fast_instance%</code> is a merge error. They should be added back.</p>",
        "id": 510152289,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743764383
    },
    {
        "content": "<p>I had also reviewed the first half, in parallel to <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> . Our comments overlap (fast instances, meta code) which is a sign we both did it seriously!</p>",
        "id": 510155172,
        "sender_full_name": "S√©bastien Gou√´zel",
        "timestamp": 1743765261
    },
    {
        "content": "<p>For the instances in meta programming, there is already <a href=\"https://github.com/leanprover-community/mathlib4/blob/a2a95ac62afa46cb10152fc0f6812e52cd2e2c42/Mathlib/Tactic/Positivity/Core.lean#L185-L186\">some lines in mathlib</a> that arbitrarily uses a same name. So I guessed that it's fine.</p>",
        "id": 510161345,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743766955
    },
    {
        "content": "<p>Finished a review. Lots of new <code>omit</code>‚Äôs which should be cleaned up on follow up</p>",
        "id": 510187429,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743769385
    },
    {
        "content": "<p>General question: Is the pattern of naming ‚Äúunused‚Äù instances with Qq necessary? Can you get away with <code>let _</code>? (not at computer)</p>",
        "id": 510187920,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743769505
    },
    {
        "content": "<p><code>let _</code> doesn't work. I think that's why we chose <code>let _a</code>.</p>",
        "id": 510196432,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743771652
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"214703\">Yury G. Kudryashov</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2320676.20unbundling.20ordered.20algebra/near/509963484\">said</a>:</p>\n<blockquote>\n<p>Should we merge <code>master</code> and <code>!bench</code> again? (against the current <code>master</code>)</p>\n</blockquote>\n<p>Done. There are 4 red files now.</p>",
        "id": 510229576,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743780107
    },
    {
        "content": "<p><a href=\"https://speed.lean-lang.org/mathlib4/compare/10135b38-b474-40c1-b13f-b04e64824380/to/3eb91255-4c6b-4eea-93a8-00441a20d663\">Four red files here</a>. One of them is <code>FiniteAdeleRing</code> which I literally delete and replace with a totally new file in <a href=\"https://github.com/leanprover-community/mathlib4/pull/23542\">#23542</a> so I'm not too worried about that one!</p>",
        "id": 510230364,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743780326
    },
    {
        "content": "<p>I want to point out an important lesson from these intermediate PRs: we see a performance <em>drop</em>. I'm not saying that's bad or that we shouldn't proceed. Instead my point is that, as we have suspected informally for a long time, it's extremely important to be uniform in our choices across the library. An approach which which combines mixins and forgetful inheritance while cross-cutting boundaries between disciplines is the worst of both worlds.</p>",
        "id": 510233045,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1743781039
    },
    {
        "content": "<p>I just merged <a href=\"https://github.com/leanprover-community/mathlib4/pull/20594\">#20594</a> I just a bit distracted at the moment so cannot give sustained attention</p>",
        "id": 510247881,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743785022
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"455791\">Yuyang Zhao</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2320676.20unbundling.20ordered.20algebra/near/510196432\">said</a>:</p>\n<blockquote>\n<p><code>let _</code> doesn't work. I think that's why we chose <code>let _a</code>.</p>\n</blockquote>\n<p>For future reference <code>let __</code> works and seems better in spirit.</p>",
        "id": 510248062,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1743785078
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20595\">#20595</a> is next</p>",
        "id": 510260030,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1743789345
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/20595\">#20595</a> is ready. Removing <code>[Is(Strict)OrderedRing Œ±]</code> in some definitions will cause a lot of <code>omit</code> or reordering. This PR adds the typeclass assumption and <code>@[nolint unusedArguments]</code> to these definitions.</p>",
        "id": 510323836,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743821748
    },
    {
        "content": "<p><del>I guess these unused arguments should be removed to speed up <code>isDefEq</code>.</del> Tried and it got slower overall. Not sure why.</p>",
        "id": 510342004,
        "sender_full_name": "Yuyang Zhao",
        "timestamp": 1743836134
    },
    {
        "content": "<p>(working on 20595)</p>",
        "id": 510509099,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1743964971
    },
    {
        "content": "<p>OK I have finished my review of <a href=\"https://github.com/leanprover-community/mathlib4/pull/20595\">#20595</a> . Here are the questions which I'd like resolved/checked before merging:</p>\n<p>1) I don't understand what's happening with universes in the meta code in <code>Mathlib/Algebra/Order/Floor/Defs.lean</code>. Can someone else confirm this all looks OK? I'm just not confident with meta code.</p>\n<p>2) Should the <code>let</code>s added in <code>Mathlib/Algebra/Order/Ring/InjSurj.lean</code> be <code>letI</code>s? </p>\n<p>3) Should we be adding <code>@[nolint unusedArguments]</code> in the definitions of <code>affineSegment</code>, <code>StarConvex</code>, <code>StrictConvex</code> and <code>SameRay</code>? The alternative is to remove <code>[IsStrictOrderedRing R]</code> from the definition and now pick up the pieces in the files with lots (and lots) of <code>omit [IsStrictOrderedRing R]</code> comments everywhere. My gut feeling is that this is better because it doesn't add nolints and it also indicates a pretty clear refactor, which can be done independently. I am just worried that adding the <code>nolint</code> hides the problem whereas throwing many <code>omit</code>s around and adding a <code>TODO: tidy this up</code> in the file is a better approach. But another approch is just adding the <code>nolint</code> and also adding \"TODO: remove this <code>nolint</code> later\"  in the module doc, which I guess I would also be happy with. But I'm not sure what the best approach is here. Right now I'm just scared we're adding to technical debt.</p>\n<p>If these can be dealt with before the PR picks up a merge conflict (it changes 182 files!) that would be great!</p>",
        "id": 510601513,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744016020
    },
    {
        "content": "<p>Re 3: I'm inclined to go with the <code>nolint</code> approach and a comment that we should clean up in an indep PR.</p>",
        "id": 510618013,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1744020056
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"455791\">@Yuyang Zhao</span> just to flag that I'm happy with Johan's idea, so my review comments saying \"don't nolint, instead add 100 <code>omit</code>s\" can be replaced with \"please flag the nolint in a TODO in the module docstring\".</p>",
        "id": 510639859,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744025643
    },
    {
        "content": "<p>I am thus two questions away from merging.</p>\n<p>1) (in <code>Mathlib/Algebra/Order/Ring/InjSurj.lean</code>):<br>\nShould these <code>let _</code>s be <code>letI</code>s?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Pullback an `IsOrderedRing` under an injective map. -/</span>\n<span class=\"kn\">protected</span><span class=\"w\"> </span><span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">isOrderedRing</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">IsOrderedRing</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">nsmul</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">‚Ä¢</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">npow</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"o\">(</span><span class=\"n\">natCast</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‚àÄ</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">‚Ñï</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">semiring</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"n\">nsmul</span><span class=\"w\"> </span><span class=\"n\">npow</span><span class=\"w\"> </span><span class=\"n\">natCast</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">hf</span>\n<span class=\"w\">    </span><span class=\"n\">IsOrderedRing</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Semiring</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">semiring</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"w\"> </span><span class=\"n\">nsmul</span><span class=\"w\"> </span><span class=\"n\">npow</span><span class=\"w\"> </span><span class=\"n\">natCast</span>\n<span class=\"w\">  </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"w\"> </span><span class=\"n\">Œ≤</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">PartialOrder</span><span class=\"bp\">.</span><span class=\"n\">lift</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">hf</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hf</span><span class=\"bp\">.</span><span class=\"n\">isOrderedAddMonoid</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">swap</span><span class=\"w\"> </span><span class=\"n\">nsmul</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">zero_le_one</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">zero</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">zero_le_one</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">mul_le_mul_of_nonneg_left</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">mul_le_mul_of_nonneg_left</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">?_;</span><span class=\"w\"> </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"n\">mul_le_mul_of_nonneg_right</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"n\">hc</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">show</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚â§</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">mul</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">mul</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">refine</span><span class=\"w\"> </span><span class=\"n\">mul_le_mul_of_nonneg_right</span><span class=\"w\"> </span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"bp\">?_;</span><span class=\"w\"> </span><span class=\"n\">rwa</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">zero</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">}</span>\n</code></pre></div>\n<p>2) (in <code>Mathlib/Algebra/Order/Floor/Defs.lean</code>): Is that <code>u := 0</code> OK?</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"sd\">/-- Extension for the `positivity` tactic: `Nat.ceil` is positive if its input is. -/</span>\n<span class=\"kd\">@[</span><span class=\"n\">positivity</span><span class=\"w\"> </span><span class=\"bp\">‚åà</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">‚åâ‚Çä</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">evalNatCeil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">PositivityExt</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">eval</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">zŒ±</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">pŒ±</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">do</span>\n<span class=\"w\">  </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">u</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">‚Ñï</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">ceil</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">Œ±'</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">LinearOrderedSemiring</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">Œ±'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">synthInstanceQ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"n\">‚Ñï</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"bp\">~</span><span class=\"n\">q</span><span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">ceil</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">Œ±'</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">ir</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">io</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">LinearOrder</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">Œ±'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">synthInstanceQ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">u_1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">    </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Q</span><span class=\"o\">(</span><span class=\"n\">IsStrictOrderedRing</span><span class=\"w\"> </span><span class=\"bp\">$</span><span class=\"n\">Œ±'</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">‚Üê</span><span class=\"w\"> </span><span class=\"n\">synthInstanceQ</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">u</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 510741557,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744051040
    },
    {
        "content": "<p>1) yes, i think so, at the very least for the ones in the type of <code>isOrderedRing</code>. My understanding is that that will eliminate the <code>let</code> from the type, which otherwise might inhibit synthesis. (although i'd love for someone more experienced to back me up on this)<br>\n2) i think that refers to the fact that <code>IsStrictOrderedRing _</code> is a <code>Prop</code>, i.e. a <code>Sort 0</code>, so yes, i think that's ok.</p>",
        "id": 510745299,
        "sender_full_name": "Edward van de Meent",
        "timestamp": 1744052295
    },
    {
        "content": "<p>I suspect something is fishy with those explicit universes. Does it fail if they are left to be inferred?</p>",
        "id": 510874207,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744102091
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"455791\">@Yuyang Zhao</span> I'm happy to merge this if you change the <code>let</code>s to <code>letI</code>s in <code>Mathlib/Algebra/Order/Ring/InjSurj.lean</code> and fix the merge conflicts.</p>",
        "id": 511029920,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744148229
    },
    {
        "content": "<p>I'll make a PR shortly to remove all the universes</p>",
        "id": 511035943,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744150910
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23846\">#23846</a></p>",
        "id": 511036666,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744151261
    },
    {
        "content": "<p>Now for <a href=\"https://github.com/leanprover-community/mathlib4/pull/20676\">#20676</a></p>",
        "id": 511140509,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1744196574
    },
    {
        "content": "<p>At least the following files in <a href=\"https://github.com/leanprover-community/mathlib4/pull/20676\">#20676</a> can be removed, but that is outside its scope:</p>\n<ul>\n<li><code>Mathlib/Algebra/Order/Field/InjSurj.lean</code> (deprecated stuff only)</li>\n<li><code>Mathlib/Algebra/Order/Group/InjSurj.lean</code> (ditto)</li>\n<li><code>Mathlib/Algebra/Order/Group/Instances.lean</code> (no declarations)</li>\n<li><code>Mathlib/Algebra/Order/Group/Prod.lean</code> (ditto)</li>\n<li><code>Mathlib/Algebra/Order/Group/TypeTags.lean</code> (ditto)</li>\n</ul>",
        "id": 511192094,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1744209531
    },
    {
        "content": "<p>It builds; I've benched it and everything is green!</p>",
        "id": 511201915,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1744212010
    },
    {
        "content": "<p>Also we get this</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gi\">+ build             typeclass inference   -20.2%</span>\n</code></pre></div>",
        "id": 511209655,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744214012
    },
    {
        "content": "<p>OK I'll give it a review...</p>",
        "id": 511209801,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744214053
    },
    {
        "content": "<p>OK I'm finally done. <span class=\"user-mention\" data-user-id=\"598052\">@Jeremy Tan</span> I see you've been responding to my comments and making commits to the branch -- but this is not your PR. Did you clear this with <span class=\"user-mention\" data-user-id=\"455791\">@Yuyang Zhao</span> ? I know it's super-exciting that this work is coming to a close but it's their PR, not yours.</p>",
        "id": 511258028,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744230910
    },
    {
        "content": "<p>What seems to be left in <a href=\"https://github.com/leanprover-community/mathlib4/pull/20676\">#20676</a> are the following questions:</p>\n<p>0) (several questions which I had for Yuyang and which Jeremy has answered for them by making commits to Yuyang's PR, but they seem like sensible commits to me).</p>\n<p>1) What is the plan with classes like <code>LinearOrderedAddCommMonoidWithTop</code>? Will this be Propified at some point or is this not part of the plan?</p>\n<p>2) The PR was made in January so all the deprecation have dates like <code>since := \"2025-01-05\"</code>. It might be hard to automatically change these (it might take some git wizardry or a tedious search-replace being careful not to change other deprecations made in other PRs on that day!). Do we care? </p>\n<p>3) In <a href=\"https://github.com/leanprover-community/mathlib4/blob/548ae3658a33bb10de733a7fcbefb3add349f8a3/Mathlib/Algebra/Order/Monoid/Submonoid.lean\">Mathlib/Algebra/Order/Monoid/Submonoid.lean</a> (that's a link to current <code>master</code>) most of the file is instances and many of them need to be changed in this PR. Some of the instances have priority 75, and others do not. I don't understand why this is, and hence I am not able to properly review the priorities of the changed instances.</p>\n<p>4) In <code>Mathlib/Algebra/Order/Positive/Ring.lean</code> we have this diff:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code><span class=\"gd\">- instance orderedCommMonoid [StrictOrderedCommSemiring R] :</span>\n<span class=\"gd\">-     OrderedCommMonoid { x : R // 0 &lt; x } := fast_instance%</span>\n<span class=\"gd\">-   { Subtype.partialOrder _,</span>\n<span class=\"gd\">-     Subtype.coe_injective.commMonoid (M‚ÇÇ := R) (Subtype.val) val_one val_mul val_pow with</span>\n<span class=\"gd\">-     mul_le_mul_left := fun _ _ hxy c =&gt;</span>\n<span class=\"gi\">+ instance commMonoid [CommSemiring R] [PartialOrder R] [IsStrictOrderedRing R] :</span>\n<span class=\"gi\">+     CommMonoid { x : R // 0 &lt; x } :=</span>\n<span class=\"gi\">+   Subtype.coe_injective.commMonoid (M‚ÇÇ := R) (Subtype.val) val_one val_mul val_pow</span>\n</code></pre></div>\n<p>Should there be a <code>fast_instance%</code> added here too? I am a bit unclear about what <code>fast_instance%</code> does (even after having read the docstring).</p>",
        "id": 511260197,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744231877
    },
    {
        "content": "<p>2) The ones to avoid are</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Data</span><span class=\"bp\">/</span><span class=\"n\">Set</span><span class=\"bp\">/</span><span class=\"n\">Card</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-01-05\"</span><span class=\"o\">)</span><span class=\"kd\">]</span><span class=\"w\"> </span><span class=\"kn\">alias</span><span class=\"w\"> </span><span class=\"n\">encard_le_card</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">encard_le_encard</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Order</span><span class=\"bp\">/</span><span class=\"n\">SuccPred</span><span class=\"bp\">/</span><span class=\"n\">CompleteLinearOrder</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">IsLUB</span><span class=\"bp\">.</span><span class=\"n\">mem_of_not_isSuccPrelimit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-01-05\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Order</span><span class=\"bp\">/</span><span class=\"n\">SuccPred</span><span class=\"bp\">/</span><span class=\"n\">CompleteLinearOrder</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">IsGLB</span><span class=\"bp\">.</span><span class=\"n\">mem_of_not_isPredLimit</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-01-05\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">SetTheory</span><span class=\"bp\">/</span><span class=\"n\">Ordinal</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">SuccOrder</span><span class=\"bp\">.</span><span class=\"n\">nhdsGT</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-01-05\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">SetTheory</span><span class=\"bp\">/</span><span class=\"n\">Ordinal</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">SuccOrder</span><span class=\"bp\">.</span><span class=\"n\">nhdsLT_eq_nhdsNE</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-01-05\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">SetTheory</span><span class=\"bp\">/</span><span class=\"n\">Ordinal</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">SuccOrder</span><span class=\"bp\">.</span><span class=\"n\">nhdsLE_eq_nhds</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-01-05\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n<span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">SetTheory</span><span class=\"bp\">/</span><span class=\"n\">Ordinal</span><span class=\"bp\">/</span><span class=\"n\">Topology</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"kd\">@[</span><span class=\"n\">deprecated</span><span class=\"w\"> </span><span class=\"n\">SuccOrder</span><span class=\"bp\">.</span><span class=\"n\">hasBasis_nhds_Ioc_of_exists_lt</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">since</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"s2\">\"2025-01-05\"</span><span class=\"o\">)</span><span class=\"kd\">]</span>\n</code></pre></div>\n<p>so that seems like it wouldn't be too much work</p>",
        "id": 511263396,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1744233245
    },
    {
        "content": "<p><code>fast_instance%</code> should always be used whenever the <code>Injective.&lt;typeclass&gt;</code> constructors are used</p>",
        "id": 511263712,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744233394
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307953\">Ruben Van de Velde</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2320676.20unbundling.20ordered.20algebra/near/511263396\">said</a>:</p>\n<blockquote>\n<p>2) The ones to avoid are...</p>\n</blockquote>\n<p>Some are <code>2025-01-06</code> ;-) (but they're all either 05 or 06 Jan)</p>",
        "id": 511266955,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744234888
    },
    {
        "content": "<p>I usually seach for <code>deprecated</code> in the <code>diff</code> (I can find the exact command later today)</p>",
        "id": 511268083,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1744235422
    },
    {
        "content": "<p><code>git diff -S deprecated</code> I think</p>",
        "id": 511268520,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744235640
    },
    {
        "content": "<p>I think I've just opened the diff in EMacs magit and searched for <code>deprecated</code>.</p>",
        "id": 511273222,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1744238139
    },
    {
        "content": "<p>If you want to be sure that you didn't change some old deprecation date, then the easiest way is to grep for <code>^-.*deprecated</code> in the <code>git diff</code>.</p>",
        "id": 511273330,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1744238185
    },
    {
        "content": "<p><code>-S</code> is better than <code>| grep</code> because it only searches the changed lines, not the context too</p>",
        "id": 511281268,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1744242341
    },
    {
        "content": "<p>If you grep for <code>-</code> or <code>+</code> at the start of the line, then you look at the modified lines only.</p>",
        "id": 511282107,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1744242762
    },
    {
        "content": "<p>However it was done, it seems to have been done correctly in the PR, so let's go for it!</p>",
        "id": 511458671,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744303201
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598052\">Jeremy Tan</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2320676.20unbundling.20ordered.20algebra/near/511192094\">said</a>:</p>\n<blockquote>\n<p>At least the following files in <a href=\"https://github.com/leanprover-community/mathlib4/pull/20676\">#20676</a> can be removed, but that is outside its scope:</p>\n<ul>\n<li><code>Mathlib/Algebra/Order/Field/InjSurj.lean</code> (deprecated stuff only)</li>\n<li><code>Mathlib/Algebra/Order/Group/InjSurj.lean</code> (ditto)</li>\n<li><code>Mathlib/Algebra/Order/Group/Instances.lean</code> (no declarations)</li>\n<li><code>Mathlib/Algebra/Order/Group/Prod.lean</code> (ditto)</li>\n<li><code>Mathlib/Algebra/Order/Group/TypeTags.lean</code> (ditto)</li>\n</ul>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib4/pull/23936\">#23936</a> deletes these files and moves their deprecations to the closest file. If I have missed any stub files please let me know</p>",
        "id": 511550554,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1744340905
    },
    {
        "content": "<p>IIRC there is still another PR in the chain, <a href=\"https://github.com/leanprover-community/mathlib4/pull/23621\">#23621</a> to deprecate <code>LinearOrderedComm{Monoid, Group}WithZero</code></p>",
        "id": 511551475,
        "sender_full_name": "Jeremy Tan",
        "timestamp": 1744341466
    },
    {
        "content": "<p>Unfortunately this one has lots of conflicts right now, and also 446 changed files -- does it need a merge from master <span class=\"user-mention\" data-user-id=\"455791\">@Yuyang Zhao</span> ? Jeremy I think I would rather Yuyang dealt with this (unless they give you explicit permission to mess with the branch).</p>",
        "id": 511614908,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1744367050
    },
    {
        "content": "<p>I'm trying to interpret the benchmarking results for <a href=\"https://github.com/leanprover-community/mathlib4/pull/23961\">#23961</a>: instructions are really nice (-0.5%), but wall-time, task-clock and TC inference are neutral or go up slightly (<a href=\"https://github.com/leanprover-community/mathlib4/pull/23961#issuecomment-2798034407\">summary comment</a>, <a href=\"https://speed.lean-lang.org/mathlib4/compare/cfafcc34-57c0-4585-87d6-f097043cc2e6/to/1b7b8c91-07a7-4a30-b11f-e4d579bae761\">velcom link</a>).</p>\n<p>Is TC inference just noisy, does that mean this change is not good, or do we usually merge instructions improvements even if the other metrics are neutral?</p>",
        "id": 511789770,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744445608
    },
    {
        "content": "<p>I took a look at a handful of recent benchmarking runs - ones with changes and ones without any significant changes. The TC and wall-time changes are definitely within the noise range, so I wouldn't worry about them.</p>",
        "id": 511790395,
        "sender_full_name": "Michael Rothgang",
        "timestamp": 1744446142
    },
    {
        "content": "<p>What is the general stand on speaking about \"linearly ordered commutative groups/monoids\" <em>in the doc</em>? I find it unpleasant to write \"given a commutative group G that is a linear order and an ordered monoid...\"; on the other hand, this is what it is now. Should we adapt the doc or is it fine to write \"linearly ordered comm group\" in the doc?</p>",
        "id": 512107358,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1744643954
    },
    {
        "content": "<p>I would say it is fine and better to write the shorthand</p>",
        "id": 512107733,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1744644019
    },
    {
        "content": "<p>Thanks Ya√´l, I agree <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 512108642,
        "sender_full_name": "Filippo A. E. Nuccio",
        "timestamp": 1744644193
    },
    {
        "content": "<p>How long will the deprecation period be? Do we have enough time to change <code>Type u</code> to <code>Type*</code> on everything, including those deprecated classes?<br>\nSee:<br>\n<a href=\"#narrow/channel/287929-mathlib4/topic/Algebra.20and.20.60Type*.60/with/513551711\">https://leanprover.zulipchat.com/#narrow/channel/287929-mathlib4/topic/Algebra.20and.20.60Type*.60/with/513551711</a><br>\n<a href=\"#narrow/channel/287929-mathlib4/topic/Call.20for.20help.3A.20technical.2F.20organisational.20debt/with/513551956\">https://leanprover.zulipchat.com/#narrow/channel/287929-mathlib4/topic/Call.20for.20help.3A.20technical.2F.20organisational.20debt/with/513551956</a></p>",
        "id": 513552364,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1745311665
    },
    {
        "content": "<p>I would say you don't need to change deprecated files. For deprecated declarations within otherwise non-deprecated files, do whatever is easiest for you</p>",
        "id": 513553221,
        "sender_full_name": "Ya√´l Dillies",
        "timestamp": 1745311902
    },
    {
        "content": "<p>May I change all of them where the universe level is not needed explicitly?</p>",
        "id": 513553606,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1745312026
    },
    {
        "content": "<p>Wait. Oh no!!!!!</p>\n<p>The deprecated classes have become structures instead. Therefore, downstream projects break right away, no deprecation period.</p>",
        "id": 513655177,
        "sender_full_name": "Martin Dvo≈ô√°k",
        "timestamp": 1745339620
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"455791\">@Yuyang Zhao</span> I'm sorry I didn't get to this PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/23621\">#23621</a>, and now it has merge conflicts. If you fix them I will review quickly.</p>",
        "id": 514447381,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1745608951
    }
]