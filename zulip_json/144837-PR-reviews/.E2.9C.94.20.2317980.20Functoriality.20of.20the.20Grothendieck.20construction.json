[
    {
        "content": "<p>I was playing with this just when <a href=\"https://github.com/leanprover-community/mathlib4/pull/15419\">#15419</a> was merged. One of the proof requires a slight increase in heartbeats (probably because of an <code>erw</code> that slightly abuses strictness of <code>Cat</code>), and I’d be happy to know if someone finds a golf or a workaround.</p>\n<p>I’m mostly putting it in this channel to notify <span class=\"user-mention\" data-user-id=\"132603\">@Calle Sönne</span> , since it seems relevant (and I hope not duplicate) of some of your other PRs regarding Fibered categories.</p>",
        "id": 477913382,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1729446032
    },
    {
        "content": "<p>Great to see you working on this! I actually have done some of this on the branch <code>bicategory-grothendieck-functoriality</code> <a href=\"https://github.com/leanprover-community/mathlib4/tree/bicategory-grothendieck-functoriality\">link</a>, although I wanted to do a minor refactor of some things relating to strong natural transformations first before finishing this (there are 3 sorries in <code>Bicategory/NaturalTransformation/Strong</code>, which I wanted to prove after the refactor).</p>\n<p>Looking at the code you wrote, I think something that could simplify things is to use <code>_app</code> lemmas. I have written an attribute <code>@[to_app]</code> which takes a bicategory lemma that is an equality of 2-morphisms, then creates a new lemma which is obtained by specalizing the given lemma to <code>Cat</code>, then it applies <code>.app</code> + simplifies things slightly. This allows you to use those lemmas directly in situation where they appear as <code>.app</code>, and avoids you having to use lemmas like <code>Cat.whiskerLeft_app</code> back and forth. This, simplified things greatly for me. To use this, tag any lemma with <code>@[to_app]</code> then the lemma you want will be called <code>lemmaname_app</code> where <code>lemmaname</code> is the name of the lemma. Me trying to do functoriality for the grothendieck construction was one of the primary reasons for writing this attribute, so I definitely think it should help.</p>\n<p>But we can work together on this if you want! Something that would be nice is to show that the grothendieck construction actually forms a pseudofunctor to a bicategory of pseudofunctors (at least I think this should be true).</p>",
        "id": 477914627,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1729447276
    },
    {
        "content": "<p>How come you are working on this? Is there something specific that you want to work towards?</p>",
        "id": 477914855,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1729447479
    },
    {
        "content": "<p>It would also be nice to get the strict Grothendieck construction as a special case of the general one, so that's another direction one could go in. Me and <span class=\"user-mention\" data-user-id=\"110789\">@Jakob von Raumer</span> were discussing this elsewhere.</p>",
        "id": 477914993,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1729447631
    },
    {
        "content": "<p>Thanks for telling me about <code>@[to_app]</code>!  I’ll see if I can golf more in this PR, although seems seem to be quite easier on your end, so i might as well wait that you PR an admittedly cleaner version.</p>\n<p>The reason I ended up working on this was mostly out of fun, but I guess eventually it would be nice to have a full \"straightening/unstraightening\" correspondence between pseudofunctors out of a locally discrete 2-category to Cat and (co)cartesian fibrations, and wanted to see what was missing in mathlib to start looking more seriously at it. If your current project is also in that direction I’d be glad to help!</p>\n<p>I had tried a bit this morning to promote everything to a functor out of  a bicategory of pseudofunctors, but as of now there is no bicategory of pseudofunctors (only of oplax functors, with non-strong transforms as morphisms), so I gave up.</p>\n<p>Comparing it the one you recently PRed to the usual strict one defined in <code>CategoryTheory/Grothendieck</code> and with the category of elements of a presheaf should be quite feasible, I might look into it!</p>",
        "id": 477915702,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1729448294
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2317980.20Functoriality.20of.20the.20Grothendieck.20construction/near/477915702\">said</a>:</p>\n<blockquote>\n<p>Thanks for telling me about <code>@[to_app]</code>!  I’ll see if I can golf more in this PR, although seems seem to be quite easier on your end, so i might as well wait that you PR an admittedly cleaner version.</p>\n<p>The reason I ended up working was mostly out of fun, but I guess eventually it would be nice to have a full \"straightening/unstraightening\" correspondence between pseudofunctors out of a locally discrete 2-category to Cat and (co)cartesian fibrations, and wanted to see what was missing in mathlib to start looking more seriously at it. If your current project is also in that direction I’d be glad to help!</p>\n<p>I had tried a bit this morning to promote everything to a functor out of  a bicategory of pseudofunctors, but as of now there is no bicategory of pseudofunctors (only of oplax functors, with non-strong transforms as morphisms), so I gave up.</p>\n<p>Comparing it the one you recently PRed to the usual strict one defined in <code>CategoryTheory/Grothendieck</code> and with the category of elements of a presheaf should be quite feasible, I might look into it!</p>\n</blockquote>\n<p>Great! Yeah the bicategory of pseudofunctors is in this (somewhat dying) PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/14089\">#14089</a>. I had some issues with the simpNF linter, and the code is currently broken because of me trying to debug it. Also it contains this half-finished refactor of strong natural transformations so its really messy. But I can clean it up quite quickly now that there is more interest in this part of mathlib :)</p>\n<p>Straightening/unstraightening would be an amazing result to get!  When you say (co)cartesian fibrations in this setting, does that mean fibered categories?</p>",
        "id": 477916051,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1729448668
    },
    {
        "content": "<p>I have shown that the grothendieck construction gives a fibered category in yet another branch, and <span class=\"user-mention\" data-user-id=\"376152\">@Paul Lezeau</span> has started some code on defining splittings/clivages of fibered categories (which I guess would be needed for this?).</p>",
        "id": 477916164,
        "sender_full_name": "Calle Sönne",
        "timestamp": 1729448805
    },
    {
        "content": "<p>Yes, by cocartesian fibrations I mean fibered categories. Splittings will be indeed needed in a way or another at some point. It’s nice to know there are other people interested in this!</p>",
        "id": 477916656,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1729449287
    },
    {
        "content": "<p>I'll convert my PR to draft to avoid wasting reviewer time.<br>\nI guess a thing I could also look at is functoriality on \"the base\" (namely, precomposition of a pseudofunctor <code>C =&gt; Cat</code> with some other functor 'D =&gt; C` should induce (some sort of) a pullback square on the grothendieck constructions.</p>",
        "id": 477917705,
        "sender_full_name": "Robin Carlier",
        "timestamp": 1729450279
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"286014\">Robin Carlier</span> <a href=\"#narrow/channel/144837-PR-reviews/topic/.2317980.20Functoriality.20of.20the.20Grothendieck.20construction/near/477917705\">said</a>:</p>\n<blockquote>\n<p>I'll convert my PR to draft to avoid wasting reviewer time.<br>\nI guess a thing I could also look at is functoriality on \"the base\" (namely, precomposition of a pseudofunctor <code>C =&gt; Cat</code> with some other functor 'D =&gt; C` should induce (some sort of) a pullback square on the grothendieck constructions.</p>\n</blockquote>\n<p>That would be cool, i have part of that lie around locally for strict Grothendieck constructions: </p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kd\">@[</span><span class=\"n\">simps</span><span class=\"kd\">]</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">Grothendieck</span><span class=\"bp\">.</span><span class=\"n\">pre</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Category</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">⥤</span><span class=\"w\"> </span><span class=\"n\">Cat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">⥤</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">Grothendieck</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"bp\">⋙</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">⥤</span><span class=\"w\"> </span><span class=\"n\">Grothendieck</span><span class=\"w\"> </span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"kn\">where</span>\n<span class=\"w\">  </span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"bp\">.</span><span class=\"n\">fiber</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">map</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">base</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">fiber</span><span class=\"bp\">⟩</span>\n<span class=\"w\">  </span><span class=\"n\">map_id</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Grothendieck</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">map_id</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">map_comp</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Grothendieck</span><span class=\"bp\">.</span><span class=\"n\">ext</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">G</span><span class=\"bp\">.</span><span class=\"n\">map_comp</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 477974973,
        "sender_full_name": "Jakob von Raumer",
        "timestamp": 1729493986
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"754300\">Dominic Steinitz</span> has marked this topic as resolved.</p>",
        "id": 512390518,
        "sender_full_name": "Notification Bot",
        "timestamp": 1744742374
    }
]