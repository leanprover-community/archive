[
    {
        "content": "<p>Hi, I'm trying to use lean dojo's <a href=\"https://github.com/lean-dojo/ReProver?tab=readme-ov-file\">premise retriever model</a>. In the sample code they give:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">torch</span>\n<span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">typing</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Union</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span>\n<span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">transformers</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">AutoTokenizer</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">AutoModelForTextEncoding</span>\n\n<span class=\"n\">tokenizer</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">AutoTokenizer</span><span class=\"bp\">.</span><span class=\"n\">from_pretrained</span><span class=\"o\">(</span><span class=\"s2\">\"kaiyuy/leandojo-lean4-retriever-byt5-small\"</span><span class=\"o\">)</span>\n<span class=\"n\">model</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">AutoModelForTextEncoding</span><span class=\"bp\">.</span><span class=\"n\">from_pretrained</span><span class=\"o\">(</span><span class=\"s2\">\"kaiyuy/leandojo-lean4-retriever-byt5-small\"</span><span class=\"o\">)</span>\n\n<span class=\"n\">state</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"s2\">\"n : ℕ</span><span class=\"se\">\\n</span><span class=\"s2\">⊢ gcd n n = n\"</span>\n<span class=\"n\">premises</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">  </span><span class=\"s2\">\"&lt;a&gt;vsub_eq_zero_iff_eq&lt;/a&gt; @[simp] lemma vsub_eq_zero_iff_eq {p1 p2 : P} : p1 -ᵥ p2 = (0 : G) ↔ p1 = p2\"</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"&lt;a&gt;is_scalar_tower.coe_to_alg_hom'&lt;/a&gt; @[simp] lemma coe_to_alg_hom' : (to_alg_hom R S A : S → A) = algebra_map S A\"</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"&lt;a&gt;polynomial.X_sub_C_ne_zero&lt;/a&gt; theorem X_sub_C_ne_zero (r : R) : X - C r ≠ 0\"</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"&lt;a&gt;forall_true_iff&lt;/a&gt; theorem forall_true_iff : (α → true) ↔ true\"</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"def &lt;a&gt;Nat.gcd&lt;/a&gt; : Nat → Nat → Nat</span><span class=\"se\">\\n</span><span class=\"s2\">| 0        y := y</span><span class=\"se\">\\n</span><span class=\"s2\">| (succ x) y := have y % succ x &lt; succ x, from mod_lt _ $ succ_pos _,</span><span class=\"se\">\\n</span><span class=\"s2\">                gcd (y % succ x) (succ x)\"</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"@[simp] theorem &lt;a&gt;Nat.gcd_zero_left&lt;/a&gt; (x : Nat) : gcd 0 x = x\"</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"@[simp] theorem &lt;a&gt;Nat.gcd_succ&lt;/a&gt; (x y : Nat) : gcd (succ x) y = gcd (y % succ x) (succ x)\"</span><span class=\"o\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"@[simp] theorem &lt;a&gt;Nat.mod_self&lt;/a&gt; (n : Nat) : n % n = 0\"</span><span class=\"o\">,</span>\n<span class=\"o\">]</span><span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">corpus</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">premises</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">retrieve</span><span class=\"w\"> </span><span class=\"k\">from</span><span class=\"bp\">.</span>\n\n<span class=\"bp\">@</span><span class=\"n\">torch</span><span class=\"bp\">.</span><span class=\"n\">no_grad</span><span class=\"o\">()</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">encode</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Union</span><span class=\"o\">[</span><span class=\"n\">str</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"o\">[</span><span class=\"n\">str</span><span class=\"o\">]])</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">torch</span><span class=\"bp\">.</span><span class=\"n\">Tensor</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"s2\">\"\"\"Encode texts into feature vectors.\"\"\"</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">isinstance</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"o\">):</span>\n<span class=\"w\">        </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">s</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">should_squeeze</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">True</span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"o\">:</span>\n<span class=\"w\">        </span><span class=\"n\">should_squeeze</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">False</span>\n<span class=\"w\">    </span><span class=\"n\">tokenized_s</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">tokenizer</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">return_tensors</span><span class=\"bp\">=</span><span class=\"s2\">\"pt\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">padding</span><span class=\"bp\">=</span><span class=\"n\">True</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">hidden_state</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">model</span><span class=\"o\">(</span><span class=\"n\">tokenized_s</span><span class=\"bp\">.</span><span class=\"n\">input_ids</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">last_hidden_state</span>\n<span class=\"w\">    </span><span class=\"n\">lens</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">tokenized_s</span><span class=\"bp\">.</span><span class=\"n\">attention_mask</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"o\">(</span><span class=\"n\">dim</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hidden_state</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">tokenized_s</span><span class=\"bp\">.</span><span class=\"n\">attention_mask</span><span class=\"bp\">.</span><span class=\"n\">unsqueeze</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">sum</span><span class=\"o\">(</span><span class=\"n\">dim</span><span class=\"bp\">=</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"n\">lens</span><span class=\"bp\">.</span><span class=\"n\">unsqueeze</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">should_squeeze</span><span class=\"o\">:</span>\n<span class=\"w\">      </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"bp\">.</span><span class=\"n\">squeeze</span><span class=\"o\">()</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"n\">features</span>\n\n<span class=\"bp\">@</span><span class=\"n\">torch</span><span class=\"bp\">.</span><span class=\"n\">no_grad</span><span class=\"o\">()</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">retrieve</span><span class=\"o\">(</span><span class=\"n\">state</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">str</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">premises</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"o\">[</span><span class=\"n\">str</span><span class=\"o\">],</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">-&gt;</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"o\">[</span><span class=\"n\">str</span><span class=\"o\">]:</span>\n<span class=\"w\">    </span><span class=\"s2\">\"\"\"Retrieve the top-k premises given a state.\"\"\"</span>\n<span class=\"w\">    </span><span class=\"n\">state_emb</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">encode</span><span class=\"o\">(</span><span class=\"n\">state</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">premise_embs</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">encode</span><span class=\"o\">(</span><span class=\"n\">premises</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">scores</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">state_emb</span><span class=\"w\"> </span><span class=\"bp\">@</span><span class=\"w\"> </span><span class=\"n\">premise_embs</span><span class=\"bp\">.</span><span class=\"n\">T</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">topk</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">scores</span><span class=\"bp\">.</span><span class=\"n\">topk</span><span class=\"o\">(</span><span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">indices</span><span class=\"bp\">.</span><span class=\"n\">tolist</span><span class=\"o\">()</span>\n<span class=\"w\">    </span><span class=\"n\">return</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">premises</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">topk</span><span class=\"o\">]</span>\n\n<span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">retrieve</span><span class=\"o\">(</span><span class=\"n\">state</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">premises</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">k</span><span class=\"bp\">=</span><span class=\"mi\">4</span><span class=\"o\">):</span>\n<span class=\"w\">    </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"kn\">end</span><span class=\"bp\">=</span><span class=\"s2\">\"</span><span class=\"se\">\\n\\n</span><span class=\"s2\">\"</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>It seems like if I want to apply this to different statements then I need to supply \"a corpus of premises to retrieve from\". But In general I have no clue how to do this for say a different problem. Is there some way to get lean dojo to actually generate a lists of possible premises to retrieve from?</p>",
        "id": 511811785,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1744464660
    },
    {
        "content": "<p>After reading through the docs and the code, I believe generating the premise corpus for the LeanDojo retriever is essentially a two-step process: first, you must run <code>lean_dojo.trace</code> on your Lean repository to analyze the code and produce detailed structured data files like <code>*.ast.json</code> (containing the abstract syntax tree), as detailed in the <a href=\"https://leandojo.readthedocs.io/en/latest/getting-started.html#extracting-data-from-lean-4\">Getting Started guide</a>. Once you have this raw data, the second step involves loading it using LeanDojo's Python classes (e.g., <code>TracedRepo</code>, <code>TracedFile</code> found in the <code>lean_dojo.data_extraction.traced_data</code> module) and then parsing it; specifically, you can iterate through the <code>TracedFile</code> objects and use the <code>TracedFile.get_premise_definitions()</code> method, documented <a href=\"https://leandojo.readthedocs.io/en/latest/_modules/lean_dojo/data_extraction/traced_data.html#TracedFile.get_premise_definitions\">here in the source</a>, which navigates the AST to identify premise declarations (theorems, definitions, etc.) and extracts their clean code strings (just the statement for theorems/lemmas). Aggregating these extracted <code>'code'</code> strings from all relevant files will give you the final list needed for the retriever.</p>\n<p>For instance, the direct output of <code>get_premise_definitions()</code> for a single <code>.lean</code> file yields a list of dictionaries, structured like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">[</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"bp\">'</span><span class=\"n\">full_name'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">MyNamespace</span><span class=\"bp\">.</span><span class=\"n\">my_definition'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">code'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">my_definition</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">kind'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">definition'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"o\">{</span><span class=\"bp\">'</span><span class=\"n\">full_name'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">MyNamespace</span><span class=\"bp\">.</span><span class=\"n\">my_theorem'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">code'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">my_theorem</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">my_definition</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">x'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">kind'</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"kn\">theorem</span><span class=\"bp\">'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">},</span>\n<span class=\"w\">  </span><span class=\"bp\">#</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"w\"> </span><span class=\"n\">potentially</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">dictionaries</span><span class=\"w\"> </span><span class=\"n\">for</span><span class=\"w\"> </span><span class=\"n\">other</span><span class=\"w\"> </span><span class=\"n\">premises</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">file</span>\n<span class=\"o\">]</span>\n</code></pre></div>\n<p>By collecting just the value associated with the <code>'code'</code> key from each dictionary in these lists (across all traced files), you can aggregate the desired flat list of premise strings, like the <code>premises</code> variable in the initial retriever example code you showed.</p>\n<p><em>Edit:</em> The <code>&lt;a&gt;...&lt;/a&gt;</code> tags in the example also appear in the <code>get_annotated_tactic</code> method from the aforementioned file. I am uncertain whether you need to manually add these tags to the generated dataset or not.</p>",
        "id": 511819646,
        "sender_full_name": "Justin Asher",
        "timestamp": 1744470853
    },
    {
        "content": "<p>thanks! I'll play around with this tonight and see where I get stuck :)</p>",
        "id": 511821954,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1744472708
    },
    {
        "content": "<p>I made a test repo to trace : <a href=\"https://github.com/dhyan-aranha/tracingtest/\">here</a> to try out the lean dojo tracing however when I run the script</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">lean_dojo</span>\n<span class=\"k\">from</span><span class=\"w\"> </span><span class=\"n\">lean_dojo</span><span class=\"w\"> </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">LeanGitRepo</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">trace</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"o\">():</span>\n<span class=\"w\">    </span><span class=\"n\">repo</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">LeanGitRepo</span><span class=\"o\">(</span><span class=\"s2\">\"https://github.com/dhyan-aranha/tracingtest\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"s2\">\"69180b0\"</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"n\">trace</span><span class=\"o\">(</span><span class=\"n\">repo</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dst_dir</span><span class=\"bp\">=</span><span class=\"s2\">\"traced_lean4-example\"</span><span class=\"o\">)</span>\n<span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">__</span><span class=\"n\">name__</span><span class=\"w\"> </span><span class=\"bp\">==</span><span class=\"w\"> </span><span class=\"s2\">\"__main__\"</span><span class=\"o\">:</span>\n<span class=\"w\">    </span><span class=\"n\">main</span><span class=\"o\">()</span>\n<span class=\"w\">    </span><span class=\"n\">print</span><span class=\"o\">(</span><span class=\"s2\">\"Trace completed.\"</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I get the following error message</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">04</span><span class=\"bp\">-</span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">:</span><span class=\"mi\">28</span><span class=\"o\">:</span><span class=\"mf\">08.245</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">INFO</span><span class=\"w\">     </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">lean_dojo</span><span class=\"bp\">.</span><span class=\"n\">utils</span><span class=\"o\">:</span><span class=\"n\">execute</span><span class=\"o\">:</span><span class=\"mi\">115</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ExtractData</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">339</span><span class=\"o\">:</span><span class=\"mi\">24</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">find?'</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">contain</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">HashMap</span><span class=\"bp\">.</span><span class=\"n\">find?'</span>\n<span class=\"w\">  </span><span class=\"n\">env</span><span class=\"bp\">.</span><span class=\"n\">const2ModIdx</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"n\">Std</span><span class=\"bp\">.</span><span class=\"n\">HashMap</span><span class=\"w\"> </span><span class=\"n\">Name</span><span class=\"w\"> </span><span class=\"n\">ModuleIdx</span>\n<span class=\"n\">ExtractData</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">340</span><span class=\"o\">:</span><span class=\"mi\">27</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">invalid</span><span class=\"w\"> </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"kn\">notation</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">type</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">form</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">...</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"kn\">where</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">constant</span>\n<span class=\"w\">  </span><span class=\"n\">modIdx</span>\n<span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">type</span>\n<span class=\"w\">  </span><span class=\"bp\">?</span><span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"m\">26927</span>\n\n<span class=\"mi\">2025</span><span class=\"bp\">-</span><span class=\"mi\">04</span><span class=\"bp\">-</span><span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"o\">:</span><span class=\"mi\">28</span><span class=\"o\">:</span><span class=\"mf\">08.245</span><span class=\"w\"> </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">ERROR</span><span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">lean_dojo</span><span class=\"bp\">.</span><span class=\"n\">utils</span><span class=\"o\">:</span><span class=\"n\">execute</span><span class=\"o\">:</span><span class=\"mi\">116</span><span class=\"w\"> </span><span class=\"bp\">-</span>\n<span class=\"n\">Traceback</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">most</span><span class=\"w\"> </span><span class=\"n\">recent</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">last</span><span class=\"o\">):</span>\n<span class=\"w\">  </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s2\">\"/Users/dhyanaranha/lean_dojo_1/src/lean_dojo_1/premise_selection.py\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"n\">module</span><span class=\"bp\">&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">main</span><span class=\"o\">()</span>\n<span class=\"w\">  </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s2\">\"/Users/dhyanaranha/lean_dojo_1/src/lean_dojo_1/premise_selection.py\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">main</span>\n<span class=\"w\">    </span><span class=\"n\">trace</span><span class=\"o\">(</span><span class=\"n\">repo</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">dst_dir</span><span class=\"bp\">=</span><span class=\"s2\">\"traced_lean4-example\"</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s2\">\"/Users/dhyanaranha/lean_dojo_1/.venv/lib/python3.10/site-packages/lean_dojo/data_extraction/trace.py\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">247</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">trace</span>\n<span class=\"w\">    </span><span class=\"n\">cached_path</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">get_traced_repo_path</span><span class=\"o\">(</span><span class=\"n\">repo</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">build_deps</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s2\">\"/Users/dhyanaranha/lean_dojo_1/.venv/lib/python3.10/site-packages/lean_dojo/data_extraction/trace.py\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">213</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">get_traced_repo_path</span>\n<span class=\"w\">    </span><span class=\"bp\">_</span><span class=\"n\">trace</span><span class=\"o\">(</span><span class=\"n\">repo</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">build_deps</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s2\">\"/Users/dhyanaranha/lean_dojo_1/.venv/lib/python3.10/site-packages/lean_dojo/data_extraction/trace.py\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">161</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"n\">trace</span>\n<span class=\"w\">    </span><span class=\"n\">execute</span><span class=\"o\">(</span><span class=\"n\">cmd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">capture_output</span><span class=\"bp\">=</span><span class=\"n\">True</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s2\">\"/Users/dhyanaranha/lean_dojo_1/.venv/lib/python3.10/site-packages/lean_dojo/utils.py\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">117</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">execute</span>\n<span class=\"w\">    </span><span class=\"n\">raise</span><span class=\"w\"> </span><span class=\"n\">ex</span>\n<span class=\"w\">  </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s2\">\"/Users/dhyanaranha/lean_dojo_1/.venv/lib/python3.10/site-packages/lean_dojo/utils.py\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">112</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">execute</span>\n<span class=\"w\">    </span><span class=\"n\">res</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">subprocess</span><span class=\"bp\">.</span><span class=\"n\">run</span><span class=\"o\">(</span><span class=\"n\">cmd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">shell</span><span class=\"bp\">=</span><span class=\"n\">True</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">capture_output</span><span class=\"bp\">=</span><span class=\"n\">capture_output</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">check</span><span class=\"bp\">=</span><span class=\"n\">True</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s2\">\"/Users/dhyanaranha/.pyenv/versions/3.10.9/lib/python3.10/subprocess.py\"</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">526</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">run</span>\n<span class=\"w\">    </span><span class=\"n\">raise</span><span class=\"w\"> </span><span class=\"n\">CalledProcessError</span><span class=\"o\">(</span><span class=\"n\">retcode</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">process</span><span class=\"bp\">.</span><span class=\"n\">args</span><span class=\"o\">,</span>\n<span class=\"n\">subprocess</span><span class=\"bp\">.</span><span class=\"n\">CalledProcessError</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Command</span><span class=\"w\"> </span><span class=\"bp\">'</span><span class=\"n\">lake</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">lean</span><span class=\"w\"> </span><span class=\"c1\">--threads 8 --run ExtractData.lean' returned non-zero exit status 1.</span>\n</code></pre></div>\n<p>I'd be really happy to know what these errors mean and how they might be fixed?! </p>\n<p><span class=\"user-mention\" data-user-id=\"780541\">@Justin Asher</span>  it looks like the script you ran seemed to work, maybe you could share it here? :)</p>",
        "id": 512400219,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1744745847
    },
    {
        "content": "<p>You are probably using a Lean version for which ExtractData.lean is incompatible. For instance, the LeanDojo REPL script is incompatible with Lean &gt;= 4.12.0 (<a href=\"https://github.com/lean-dojo/LeanDojo/issues/211\">issue</a>). Maybe ExtractData.lean is also affected.</p>",
        "id": 512400937,
        "sender_full_name": "Auguste Poiroux",
        "timestamp": 1744746130
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"751471\">@Dhyan Aranha</span> In <code>lean-toolchain</code> of your repository, it says you are using <code>leanprover/lean4:v4.19.0-rc3</code>, so what <span class=\"user-mention\" data-user-id=\"321854\">@Auguste Poiroux</span> mentioned is indeed likely the cause of the error. In either case, you will need to downgrade the version of lean you are using for your project to utilize LeanDojo. Thanks for pointing that out, Auguste.</p>",
        "id": 512401781,
        "sender_full_name": "Justin Asher",
        "timestamp": 1744746450
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321854\">@Auguste Poiroux</span> <span class=\"user-mention\" data-user-id=\"780541\">@Justin Asher</span> , Thanks! The reason I'm interested in LeanDojo is that I'd like to use it to test out the upcoming SorryDB project. But maybe LeanDojo is not the way to go here then because in practice it should be compatible with the most up-to-date lean version...Does anyone know of something similar that is kept more up-to-date?</p>",
        "id": 512477758,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1744786893
    },
    {
        "content": "<p>Can you remind me of the SorryDB project? Is it the project trying to collect sorries in the wild?<br>\nIf so, maybe you can use <a href=\"https://github.com/leanprover-community/repl\">Lean REPL</a>. When running it on a file, it will collect all sorries and return the associated goals.</p>",
        "id": 512500731,
        "sender_full_name": "Auguste Poiroux",
        "timestamp": 1744794229
    },
    {
        "content": "<p>yeah its the project trying to collect all the wild sorries. </p>\n<p>That sounds reasonable! I'm just not familiar enough with LeanDojo's code yet to know if it does something more nuanced to get its corpus of premise from a given lean file.</p>",
        "id": 512525992,
        "sender_full_name": "Dhyan Aranha",
        "timestamp": 1744801891
    }
]