[
    {
        "content": "<p>A context-less idea which maybe someone might find interesting to play with -- <a href=\"https://github.com/anomalyco/opencode\">opencode</a>, which probably at least a few folks use/have heard of as an LLM-agnostic TUI coding agent, supports LSP for interacting with open files. Adding Lake to it should be trivial to do so that it can access the Lean LSP. But that isn't \"enough\" -- in order to make it useful one presumably also needs to give it access to the same LSP protocol extensions Lean adds (that editor integrations like VSCode+lean.nvim use), things which are used for getting goal state information at positions in the buffer (e.g. <code>$/lean/plainGoal</code> requests -- interactive goal state isn't even really needed to get a decent start). I <em>think</em> this may not be a huge amount to figure out how to wire up inside opencode, but would make it a lot easier for it to see what the state is without invoking <code>lake</code> or <code>lean</code> to get it.</p>\n<p>Just a random Friday morning idea in case it nerd snipes anyone.</p>",
        "id": 567174246,
        "sender_full_name": "Julian Berman",
        "timestamp": 1767974445
    },
    {
        "content": "<p>I have opencode set up with the lean lsp. It works great!</p>",
        "id": 567174743,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1767974576
    },
    {
        "content": "<p>Nice! I assume you just added <code>lake serve</code> support right? (I.e. my \"first step\" there?)</p>",
        "id": 567174905,
        "sender_full_name": "Julian Berman",
        "timestamp": 1767974614
    },
    {
        "content": "<p>Yup. I also have a custom mcp server (wip!) for further lean interaction.</p>",
        "id": 567175021,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1767974642
    },
    {
        "content": "<p>One note about opencode to keep in mind: it is supposed to have Claude oauth support, but that seems to be in flux at the moment.</p>",
        "id": 567175302,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1767974714
    },
    {
        "content": "<p>FWIW, the following is a minimal but fairly effective <code>opencode.json</code> setup for Lean4 (meta)programming:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"nt\">\"$schema\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"https://opencode.ai/config.json\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"nt\">\"lsp\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nt\">\"lean\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">      </span><span class=\"nt\">\"command\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"lake\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"serve\"</span><span class=\"p\">],</span>\n<span class=\"w\">      </span><span class=\"nt\">\"extensions\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\".lean\"</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">  </span><span class=\"p\">},</span>\n<span class=\"w\">  </span><span class=\"nt\">\"mcp\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nt\">\"lean4\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">      </span><span class=\"nt\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"remote\"</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"https://gitmcp.io/leanprover/lean4\"</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"enabled\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">  </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 567180523,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1767975832
    },
    {
        "content": "<p>Ah nice I was wondering how you did it -- I did it here by modifying OpenCode's source code, it has a file with all its LSP definitions and was planning on PRing it before deciding it wasn't likely to be super useful without the extra pieces quite yet</p>",
        "id": 567180868,
        "sender_full_name": "Julian Berman",
        "timestamp": 1767975904
    },
    {
        "content": "<p><a href=\"http://gitmcp.io\">gitmcp.io</a> is useful as well -- it creates remote mcp servers for reading any (public) github repo.</p>",
        "id": 567181249,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1767975989
    },
    {
        "content": "<p>If you do figure out how to get the lsp functionality to be compatible with lsp commands like <code>plainGoal</code>, please let me know!</p>",
        "id": 567181854,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1767976119
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321696\">@Julian Berman</span> Are you still planning to open a PR to Opencode? Or do you think it is too niche and we should just have our own DIY modifications, as shown here?</p>",
        "id": 568291148,
        "sender_full_name": "Franz Huschenbeth",
        "timestamp": 1768503810
    },
    {
        "content": "<p>I definitely think we should, I just haven't gotten a moment to look at this again!</p>",
        "id": 568299635,
        "sender_full_name": "Julian Berman",
        "timestamp": 1768506787
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"1010143\">@Franz Huschenbeth</span> please feel free to beat me to it if you are asking whether you can :)</p>",
        "id": 568299659,
        "sender_full_name": "Julian Berman",
        "timestamp": 1768506797
    },
    {
        "content": "<p>Otherwise I'll get to it amongst the rest of the pile of stuff I want to get to.</p>",
        "id": 568299684,
        "sender_full_name": "Julian Berman",
        "timestamp": 1768506808
    },
    {
        "content": "<p>I mainly wondered if it is on your list, if I chose to work on it, I will let you know for sure :)</p>",
        "id": 568301086,
        "sender_full_name": "Franz Huschenbeth",
        "timestamp": 1768507356
    },
    {
        "content": "<p>I've been using Opencode with Lean using the same configuration. Although it works in theory, Opencode has unfortunately been authored with very strict hardcoded timeouts for LSP diagnostics, which I'm running into constantly. In Lean's case, the problematic timeout is the one <em>between</em> subsequent diagnostic messages. The Lean server seems to send a few of them even for simple files, and Opencode currently only waits 150ms to receive follow-ups to the latest received. In my case, the first messages have no content, so Opencode is always prematurely concluding that its slop outputs have been validated. :(</p>",
        "id": 575189122,
        "sender_full_name": "David Wood",
        "timestamp": 1771791675
    },
    {
        "content": "<p>Customising this kind of behaviour would be very useful, even without any additional Lean functionality. In the meantime, I'm considering making a non-lean-specific PR just to make the debounce period configurable for different language servers.</p>",
        "id": 575189157,
        "sender_full_name": "David Wood",
        "timestamp": 1771791699
    },
    {
        "content": "<p>I am pretty much convinced that AIs should not be using the LSP at all. It forces them into a slow iterative loop. I have better experience with just <code>lake build</code>!</p>",
        "id": 575195385,
        "sender_full_name": "Kim Morrison",
        "timestamp": 1771797482
    },
    {
        "content": "<p>To be honest, I have also come to that conclusion.</p>",
        "id": 575398584,
        "sender_full_name": "Franz Huschenbeth",
        "timestamp": 1771881264
    }
]