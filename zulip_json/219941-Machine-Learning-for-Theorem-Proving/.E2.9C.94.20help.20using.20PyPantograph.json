[
    {
        "content": "<p>I've installed PyPantograph (installing via poetry in its own isolated python environment).</p>\n<hr>\n<p>I was able to start a blank Server with</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">from</span> <span class=\"nn\">pantograph</span> <span class=\"kn\">import</span> <span class=\"n\">Server</span>\n<span class=\"n\">server</span> <span class=\"o\">=</span> <span class=\"n\">Server</span><span class=\"p\">()</span>\n</code></pre></div>\n<p>As a sanity check, running</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">imports</span>\n</code></pre></div>\n<p>returns</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"p\">[</span><span class=\"s1\">'Init'</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>However, I got an error when trying to launch a server after initializing a foo lean project (so as to be able to import mathlib4; per the PyPantograph docs).   The error is below; note that I tried many possibilities for the path-to-lean-repo and they all had the same error message..</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"n\">server</span> <span class=\"o\">=</span> <span class=\"n\">Server</span><span class=\"p\">(</span><span class=\"n\">project_path</span><span class=\"o\">=</span><span class=\"s2\">\"./path-to-lean-repo-foo/\"</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Error message:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"ne\">AssertionError</span><span class=\"p\">:</span> <span class=\"n\">Server</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">emit</span> <span class=\"n\">ready</span> <span class=\"n\">signal</span><span class=\"p\">:</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span><span class=\"p\">:</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">read</span> <span class=\"n\">file</span> <span class=\"s1\">'[/home/ec2-user/.elan/toolchains/stable/lib/lean/Init.olean]()'</span><span class=\"p\">,</span> <span class=\"n\">invalid</span> <span class=\"n\">header</span>\n</code></pre></div>\n<hr>\n<p>After an overnight break (and turning off/on my cloud instance); I'm also no longer able to call a blank Server() object: running</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">from</span> <span class=\"nn\">pantograph</span> <span class=\"kn\">import</span> <span class=\"n\">Server</span>\n<span class=\"n\">server</span> <span class=\"o\">=</span> <span class=\"n\">Server</span><span class=\"p\">()</span>\n</code></pre></div>\n<p>now gets this error:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"o\">---------------------------------------------------------------------------</span>\n<span class=\"ne\">AssertionError</span>                            <span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">)</span>\n<span class=\"n\">Cell</span> <span class=\"n\">In</span><span class=\"p\">[</span><span class=\"mi\">7</span><span class=\"p\">],</span> <span class=\"n\">line</span> <span class=\"mi\">2</span>\n      <span class=\"mi\">1</span> <span class=\"kn\">from</span> <span class=\"nn\">pantograph</span> <span class=\"kn\">import</span> <span class=\"n\">Server</span>\n<span class=\"o\">----&gt;</span> <span class=\"mi\">2</span> <span class=\"n\">server</span> <span class=\"o\">=</span> <span class=\"n\">Server</span><span class=\"p\">()</span>\n\n<span class=\"n\">File</span> <span class=\"o\">~/</span><span class=\"n\">PyPantograph</span><span class=\"o\">/</span><span class=\"n\">pantograph</span><span class=\"o\">/</span><span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"p\">:</span><span class=\"mi\">83</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">Server</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">imports</span><span class=\"p\">,</span> <span class=\"n\">project_path</span><span class=\"p\">,</span> <span class=\"n\">lean_path</span><span class=\"p\">,</span> <span class=\"n\">options</span><span class=\"p\">,</span> <span class=\"n\">core_options</span><span class=\"p\">,</span> <span class=\"n\">timeout</span><span class=\"p\">,</span> <span class=\"n\">maxread</span><span class=\"p\">)</span>\n     <span class=\"mi\">81</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"s2\">\" \"</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">imports</span> <span class=\"o\">+</span> <span class=\"p\">[</span><span class=\"sa\">f</span><span class=\"s1\">'--</span><span class=\"si\">{</span><span class=\"n\">opt</span><span class=\"si\">}</span><span class=\"s1\">'</span> <span class=\"k\">for</span> <span class=\"n\">opt</span> <span class=\"ow\">in</span> <span class=\"n\">core_options</span><span class=\"p\">])</span>\n     <span class=\"mi\">82</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">proc</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n<span class=\"o\">---&gt;</span> <span class=\"mi\">83</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">restart</span><span class=\"p\">()</span>\n     <span class=\"mi\">85</span> <span class=\"c1\"># List of goal states that should be garbage collected</span>\n     <span class=\"mi\">86</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">to_remove_goal_states</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n<span class=\"n\">File</span> <span class=\"o\">~/</span><span class=\"n\">PyPantograph</span><span class=\"o\">/</span><span class=\"n\">pantograph</span><span class=\"o\">/</span><span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"p\">:</span><span class=\"mi\">112</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">Server</span><span class=\"o\">.</span><span class=\"n\">restart</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n    <span class=\"mi\">110</span> <span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"mi\">111</span>     <span class=\"n\">ready</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">readline</span><span class=\"p\">()</span> <span class=\"c1\"># Reads the \"ready.\"</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">112</span>     <span class=\"k\">assert</span> <span class=\"n\">ready</span><span class=\"o\">.</span><span class=\"n\">rstrip</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"s2\">\"ready.\"</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s2\">\"Server failed to emit ready signal: </span><span class=\"si\">{</span><span class=\"n\">ready</span><span class=\"si\">}</span><span class=\"s2\">; Maybe the project needs to be rebuilt\"</span>\n    <span class=\"mi\">113</span> <span class=\"k\">except</span> <span class=\"n\">pexpect</span><span class=\"o\">.</span><span class=\"n\">exceptions</span><span class=\"o\">.</span><span class=\"n\">TIMEOUT</span> <span class=\"k\">as</span> <span class=\"n\">exc</span><span class=\"p\">:</span>\n    <span class=\"mi\">114</span>     <span class=\"k\">raise</span> <span class=\"ne\">RuntimeError</span><span class=\"p\">(</span><span class=\"s2\">\"Server failed to emit ready signal in time\"</span><span class=\"p\">)</span> <span class=\"kn\">from</span> <span class=\"nn\">exc</span>\n\n<span class=\"ne\">AssertionError</span><span class=\"p\">:</span> <span class=\"n\">Server</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">emit</span> <span class=\"n\">ready</span> <span class=\"n\">signal</span><span class=\"p\">:</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span><span class=\"p\">:</span> <span class=\"n\">process</span> <span class=\"s1\">'lean'</span> <span class=\"n\">exited</span> <span class=\"k\">with</span> <span class=\"n\">code</span> <span class=\"mi\">255</span>\n<span class=\"p\">;</span> <span class=\"n\">Maybe</span> <span class=\"n\">the</span> <span class=\"n\">project</span> <span class=\"n\">needs</span> <span class=\"n\">to</span> <span class=\"n\">be</span> <span class=\"n\">rebuilt</span>\n</code></pre></div>\n<p>The different behavior for Server() is particularly confusing to me; am I supposed to start lean in a specific way before launching the Server object? (I don't recall doing a step like this the first time..).</p>\n<p>After debugging the blank Server() constructor, I would like to be able to launch Server(project_pat=\"/path\") so as to import mathlib4, etc.</p>\n<p>Apologies if I'm missing something basic but would appreciate any suggestions.</p>",
        "id": 491967574,
        "sender_full_name": "Yiwei",
        "timestamp": 1736084111
    },
    {
        "content": "<p>This is not the right channel.  Use <a class=\"stream\" data-stream-id=\"219941\" href=\"/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving\">#Machine Learning for Theorem Proving</a>.  You should be able to move your message, or if not an admin can.  I don’t even know if <span class=\"user-mention\" data-user-id=\"599027\">@Leni Aniva</span> is in the channel.  (Well once I typed that I could add her.)</p>",
        "id": 491969604,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736085959
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> <a href=\"#narrow/channel/274007-lean-gptf/topic/help.20using.20PyPantograph/near/491969604\">said</a>:</p>\n<blockquote>\n<p>This is not the right channel.  Use <a class=\"stream\" data-stream-id=\"219941\" href=\"/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving\">#Machine Learning for Theorem Proving</a>.  You should be able to move your message, or if not an admin can.  I don’t even know if <span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span> is in the channel.  (Well once I typed that I could add her.)</p>\n</blockquote>\n<p>What is this channel for?</p>\n<p>I'm resolving the issue with Yiwei via PM.</p>",
        "id": 491969682,
        "sender_full_name": "Leni Aniva",
        "timestamp": 1736085999
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"599027\">Leni Aniva</span> has marked this topic as resolved.</p>",
        "id": 491970125,
        "sender_full_name": "Notification Bot",
        "timestamp": 1736086351
    },
    {
        "content": "<p>Solution (courtesy of Leni):</p>\n<p>the lean server has to has the same elan toolchain version as PyPantograph, which is 4.12.0.  This can be set by putting</p>\n<p>4.12.0 </p>\n<p>in the file lean-toolchain in the project directory and running Server(project_path=\"/path-to-4.12.0-lean-project\")</p>",
        "id": 491970686,
        "sender_full_name": "Yiwei",
        "timestamp": 1736086842
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"599027\">@Leni Aniva</span> said:</p>\n<blockquote>\n<p>What is this channel for?</p>\n</blockquote>\n<p>There used to be a tactic suggestion tool in Lean 3 called lean-gptf (tactic was <code>gptf</code>) which came out of the work in the <a href=\"https://arxiv.org/abs/2102.06203\">PACT paper</a>, one of the early papers on using transformers for theorem proving and also the first paper on neural theorem proving in Lean.  It was a tactic which called a custom trained model by Stan Polu at Open AI and was hosted by Open AI (back before ChatGPT or even Codex).  It was actually a pretty good tactic suggestion tool, until it was nerfed and then later shut off.</p>\n<p>But that was a while ago and new people aren’t in this channel.</p>",
        "id": 491970840,
        "sender_full_name": "Jason Rute",
        "timestamp": 1736086996
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> has marked this topic as resolved.</p>",
        "id": 491970858,
        "sender_full_name": "Notification Bot",
        "timestamp": 1736087018
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"274007\" href=\"/#narrow/channel/274007-lean-gptf/topic/.E2.9C.94.20help.20using.20PyPantograph\">#lean-gptf &gt; ✔ help using PyPantograph</a> by <span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span>.</p>",
        "id": 491977015,
        "sender_full_name": "Notification Bot",
        "timestamp": 1736092147
    }
]