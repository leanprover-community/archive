[
    {
        "content": "<p>I have recently been discussing with a lot of people on various implementations of MCP tools for LLMs. Since this is becoming a standard protocol, and because it is even supported outside the API in programs like Claude Desktop, I thought it would be a good idea to create a thread on various MCP tools. I think that an overall goal should be to create an MCP tool suite that makes building AI math agents easy and plug-in-play, like building with Legos.</p>\n<p>So far, here are some of the tools that I know about which support MCP:</p>\n<ul>\n<li><a href=\"https://www.leanexplore.com/docs\">LeanExplore</a> supports searching the stable versions of various Lean libraries. I plan on adding information about how to use it in, for instance, Claude Desktop too.</li>\n<li><span class=\"user-mention\" data-user-id=\"776090\">@GasStationManager</span> built <a href=\"https://github.com/GasStationManager/LeanTool\">LeanTool</a>, which connects LLMs with a Lean \"Code Interpreter,\" allowing them to interact directly with the Lean executable to improve code accuracy and leverage interactive theorem-proving features.</li>\n<li><span class=\"user-mention\" data-user-id=\"802311\">@Oliver Dressler</span> built <a href=\"https://github.com/oOo0oOo/lean-lsp-mcp\">lean-lsp-mcp</a>, which provides an MCP interface for agentic interaction with the Lean theorem prover, leveraging the Language Server Protocol via <code>leanclient</code>. This tool allows LLMs to access Lean's diagnostic messages, proof goals, hover information, and code completions, facilitating automated reasoning and proof development.</li>\n</ul>\n<p>I am sure I am missing some others, so please let me know. </p>\n<p>My main question is the following: How far away from fully automating Lean theorem proving? What about autoformalization? I think with the increasing intelligence of models, this should be possible. What additional tools do we need to enable this? Do we need to build an agentic workflow tool? This is what I will be working on once I finish updating LeanExplore. In particular, I am going to be workingon a package called LeanMiner, a math mining machine.</p>",
        "id": 520472402,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748270984
    },
    {
        "content": "<p>One of the main things I had in mind for my LeanMiner package was accessibility. I think it would be great if a user could just write a comment that says something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- LeanMiner: Finish this proof.</span>\n</code></pre></div>\n<p>and then the program begins working on this task in the background, out of sight. I think this would help a lot of researchers' by cleanly integrating such a tool into their work flow, as I do not think full automation is yet a possibility.</p>",
        "id": 520473907,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748271422
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/520472402\">said</a>:</p>\n<blockquote>\n<p>implementations of MCP tools for LLMs</p>\n</blockquote>\n<p>Let me know if you agree. </p>\n<p>While not a hammer for all MCP servers, creating an <a href=\"https://www.openapis.org/\">OpenAPI spec</a> and using with <a href=\"https://gofastmcp.com/servers/openapi\">FastMCP integrated OpenAPI</a> then testing at <a href=\"https://editor.swagger.io/\">https://editor.swagger.io/</a> is a force multiplier.</p>",
        "id": 520474389,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748271580
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"780541\">@Justin Asher</span> Thanks for starting a discussion! I think it's great to have more MCP tools for Lean. Ideally, we'd have a layer of MCP tools that expose Lean's various functionalities to the LLMs, which then allows tools that provide more complex functionalities to be built.</p>\n<p>In the former camp, one tool that I think is missing and would be great to have, is a MCP server for a Lean REPL interface. There are a few python packages providing this, including the recent <a href=\"https://github.com/stanford-centaur/PyPantograph\">Pantograph</a>, and <a href=\"https://github.com/augustepoiroux/LeanInteract\">Lean-Interact</a>. Here's why I think making a MCP wrapper for one will be useful: quite a few of the recent prover models (including Kimina Prover and Deepseek Prover v2) are trained in an RL environment provided by a lean repl; but when deploying, the tools are taken away. I think for certain models, the most effective way to do inference-time scaling is to put them in a repl environment and let them search. It'd also be interesting to put general-purpose reasoning LLMs like o3 and r1 in a repl, and see how well they do.</p>\n<p>In the latter camp, I'm building (on top of LeanTool) a development framework with automated testing feedback. The prototype is not fully MCP yet but will be. See e.g. <a href=\"https://gasstationmanager.github.io/ai/2025/05/22/alphabeta-goose.html\">https://gasstationmanager.github.io/ai/2025/05/22/alphabeta-goose.html</a></p>",
        "id": 520500777,
        "sender_full_name": "GasStationManager",
        "timestamp": 1748280537
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"776090\">@GasStationManager</span> Yes, I would like to build a Lean MCP REPL, and I do not think it would be too hard. </p>\n<p>One idea in this direction I had was <em>branching</em>. What this means is that the LLM should be able to write out the first part of the document—for instance, the part that it assumes is correct—and run that; it then saves this as the main branch. It then should be able to create test branches on top of the main branch, where it can just focus on the next theorem it would like to prove. This is somehwat similar to a Git system for the LLMs to interact with Lean. I am assuming something already exists for other AI agents, but I think having one tailored to the Lean syntax would be good. This would integrate well with MCP in like Claude desktop, because it would not have to write out the entire document and run it over and over again. The LLM could instead focus on inductively writing declarations and their proofs. I think this would also be a good general audience tool, accessible to many Lean researchers.</p>\n<p>And the automated testing feedback framework sounds really promising.</p>",
        "id": 520504842,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748282318
    },
    {
        "content": "<p>Hello, let me know if this isn’t the right channel to send this, but it seems somewhat relevant to this discussion.</p>\n<p>Besides from MCP-based methods, there was a paper on Arxiv recently on using RAG &amp; a somewhat similar branching method you mentioned. I haven’t been able to read it thoroughly so I’m not sure if it’s a particularly good paper, but it does have some interesting ideas &amp; implementation details which could help. </p>\n<p><a href=\"https://arxiv.org/pdf/2505.20613\">https://arxiv.org/pdf/2505.20613</a></p>",
        "id": 520823135,
        "sender_full_name": "Luis Valero",
        "timestamp": 1748417688
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 521205986,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748571560
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/520473907\">said</a>:</p>\n<blockquote>\n<p>One of the main things I had in mind for my LeanMiner package was accessibility. I think it would be great if a user could just write a comment that says something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- LeanMiner: Finish this proof.</span>\n</code></pre></div>\n<p>and then the program begins working on this task in the background, out of sight. I think this would help a lot of researchers' by cleanly integrating such a tool into their work flow, as I do not think full automation is yet a possibility.</p>\n</blockquote>\n<p>Is this kind of functionality necessary on top of what coding agents already provide? For example, I can type into Claude Code \"prove such-and-such theorem in such-and-such file\" and it goes away and makes its attempt.</p>",
        "id": 521206214,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748571718
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"463845\">@Alexander Heckett</span> Does this work well with Lean + Claude Code? I had asked people previously if Claude code was any good at automated theorem proving, and had not heard any responses.</p>",
        "id": 521206306,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748571768
    },
    {
        "content": "<p>The other problem that I assumed with a tool like Claude Code is that there are presumably a lot more efficient ways of interacting with Lean code for LLMs. For instance, we do not rely on just compiler feedback but rather the LSP.</p>",
        "id": 521206504,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748571894
    },
    {
        "content": "<p>I've been trying it out today. My setup is Claude Code + LeanTool + LeanExplore. After a lot of guiding the model and $16 dollars (tbf most of that went into setting up LeanTool and LeanExplore) I have a 50-line proof that x^2 + x^4 is convex. It's quite far from perfect but it kind of works.</p>",
        "id": 521206629,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748571972
    },
    {
        "content": "<p>Neat! My next goal was to update LeanExplore to do nightly updated of the repositories on Reservoir, so perhaps once I do that, we can start automating sorry proving in existing repositories. Albeit, I do not know how expensive this would be. One of the advantages of building a custom system for Lean is it would be cheaper to run.</p>",
        "id": 521206927,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748572160
    },
    {
        "content": "<p>I would also be curious to see how well your setup works on some benchmarks, like the MiniF2F.</p>",
        "id": 521206948,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748572179
    },
    {
        "content": "<p>LeanTool was set up as an MCP but I couldn't get the LeanExplore MCP to work so I just gave it access via command-line arguments. Honestly I'm not sure there's any difference between interacting via an MCP and via command-line arguments. I could imagine all of the MCP calls to LeanTool being command-line calls instead and nothing really changing.</p>",
        "id": 521207050,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748572223
    },
    {
        "content": "<p>I am going to push a MCP feature for things like Claude Desktop with the next update of LeanExplore. <span class=\"user-mention\" data-user-id=\"366057\">@Eric Taucher</span> and I had discussed this previously. The advantage of interacting with the dedicated MCP is it should be more efficient.</p>",
        "id": 521207127,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748572287
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521206927\">said</a>:</p>\n<blockquote>\n<p>Neat! My next goal was to update LeanExplore to do nightly updated of the repositories on Reservoir, so perhaps once I do that, we can start automating sorry proving in existing repositories. Albeit, I do not know how expensive this would be. One of the advantages of building a custom system for Lean is it would be cheaper to run.</p>\n</blockquote>\n<p>I think the prompt matters a lot. I found Claude Code to be quite skittish when writing Lean -- it will try an approach, fail to succeed immediately, try a completely different approach, fail again to succeed immediately, try a third approach, and so on. You really have to emphasize that it should see its attempts through. It might also be good to get Claude Code to use a more dedicated model (maybe something like DeepSeek-Prover-V2?) to make low-level progress while it guides the overall attempt. Changes like this would probably make significant differences in the eventual price.</p>",
        "id": 521208323,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748573116
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521207127\">said</a>:</p>\n<blockquote>\n<p>The advantage of interacting with the dedicated MCP is it should be more efficient.</p>\n</blockquote>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"780541\">@Justin Asher</span> </p>\n<p>Building on that point, there are other advantages with MCP:</p>\n<p><strong>AI-First Tool Integration</strong> - MCP enables AI systems to connect to tools in a fundamentally different way than traditional APIs. Rather than exposing raw APIs that require programmers to make implementation decisions, MCP allows AI to discover what functionality a tool provides and intelligently request that functionality directly.</p>\n<p><strong>Standardized Protocol</strong> - Since MCP establishes a common standard, there's no need to create custom connections between clients (like chatbots) and servers (like Lean Explore). Any MCP client can connect to any MCP server using the same protocol.</p>\n<p>One current concern with MCP is security. LeanExplore stands out as a positive example of addressing security proactively, offering API keys with a user-friendly interface for key acquisition and revocation: <a href=\"https://www.leanexplore.com/api-keys\">https://www.leanexplore.com/api-keys</a></p>\n<p><strong>Advantages of Using Anthropic Claude Desktop as Host with MCP Client:</strong> (<a href=\"https://modelcontextprotocol.io/quickstart/user\">ref</a>)</p>\n<ul>\n<li><strong>Extensible tool ecosystem</strong>: Multiple MCP servers can be added to Claude's available tools</li>\n<li><strong>Granular control</strong>: Each tool can be activated/deactivated through UI toggles</li>\n<li><strong>Function-level permissions</strong>: Specific functionality within each tool can be toggled on/off</li>\n<li><strong>Simple configuration</strong>: Adding new MCP servers only requires updating <code>claude_desktop_config.json</code></li>\n<li><strong>User consent workflow</strong>: Before any tool call, users receive notifications with options to \"Deny\", \"Allow once\", or \"Allow always\"</li>\n</ul>",
        "id": 521262023,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748599475
    },
    {
        "content": "<p>So I've been messing around a bit more and I wonder if something like a GitHub Action would be useful. I have a setup with Claude Code + DeepSeek Prover V2 + LeanTool + LeanExplore right now. Claude Code functions as the outer-loop keeping progress on track, it can call Prover V2 via API, it can access LeanTool via MCP Server, and it can query LeanExplore via command line. It sort of works but it's very haphazard. It would be nice to be able to package the prompt and setup into a GitHub Action so that I can run that process on whatever \"sorry\" statements I want.</p>",
        "id": 521383930,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748646672
    },
    {
        "content": "<p>From a user-interface perspective, I think it's also valuable to be able to operate lemma proving in \"fire-and-forget\" mode. For example, I might want to take my research ideas during the day, break them down into lemmas and formalize intermediate statements, leave some comments about how to fill in the blanks, launch Claude Code or whatever, go to bed, and wake up the next morning with the \"sorry\"'s filled in. Certainly right now it can take my setup 5-10 minutes to prove basic mathematical facts (the kinds of things which I would assert without justification in a handwritten proof) so I could imagine this automated theorem proving process being slow.</p>",
        "id": 521384860,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748647405
    },
    {
        "content": "<p>Actually maybe an MCP server itself is the answer. Maybe it makes sense to release this kind of automated theorem proving tool as an MCP Server which under the hood involves an AI agent calling other Lean-related MCP servers. Certainly it feels awkward to present this functionality in the interactive environment where it might take many minutes to get a response.</p>",
        "id": 521387343,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748649449
    },
    {
        "content": "<p>Actually I guess that's pretty close to what LeanTool does by default. I've been using LeanTool via Claude Code with the feedback loop turned off, but I suppose it also functions as an OpenAI API server in its own right. I should try plugging it into Claude Code with the feedback loop activated and see if it works well.</p>",
        "id": 521394242,
        "sender_full_name": "Alexander Heckett",
        "timestamp": 1748654924
    },
    {
        "content": "<p>LeanExplore should now be working via MCP: <a href=\"https://www.leanexplore.com/docs/mcp#integrating-with-mcp-client-applications\">https://www.leanexplore.com/docs/mcp#integrating-with-mcp-client-applications</a></p>\n<p>Regarding the \"fire-and-forget\" mode, that is what I was trying to get at with the ability to leave comments like</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- LeanMiner: Finish this proof.</span>\n</code></pre></div>\n<p>and then have the agent go through and try to finish the proofs. I think this would help speed up a lot of things; many researchers like to leave sorry statements for other people to fill out.</p>\n<p>Isn't part of slowness from Claude itself? Here is a <a href=\"https://artificialanalysis.ai/leaderboards/models\">relevant website</a>. I think if we can optimize the time it takes to get Lean feedback, the model output speed, and the model cost, we probably would already have a decent bot on our hands. For instance, my gut says that Gemini Flash Thinking 2.5 would be good here.</p>\n<p>I can see a multilevel approach, where one AI agent orchestrates others, proposing strategies and then having the other bots go off and attempt them. That is one of the things that I wanted to build.</p>",
        "id": 521396091,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748656576
    },
    {
        "content": "<p>I think if we can get it down to around $1 per sorry, that means we can prove as many statements as those that exist in Mathlib for less than say $250k. This seems like a good deal, especially since this automated approach should in theory scale well. I also presume costs will come down.</p>",
        "id": 521396223,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748656713
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"780541\">@Justin Asher</span>  thanks for the mention.</p>\n<p>I think MCP is a great way to provide additional interactivity to AI agents.</p>\n<p>While coding agents in IDEs (like Cursor or VS Code) have access to files and basic LSP features, they cannot use the full set of essential Lean tools, such as the InfoView.<br>\nThis motivated the creation of <a href=\"https://github.com/oOo0oOo/lean-lsp-mcp\">lean-lsp-mcp</a>; to provide all the other tools we use, such as looking up goal states, hover info, web search etc.<br>\nAs mentioned above, many agents were trained in REPL environments, so they are used to extra info such as goal states.</p>\n<p>I haven't used this MCP server much outside of IDE agentic coding, where state is maintained by the agent and the file content.<br>\nThererfore the design of lean-lsp-mcp is attempting to minimize statefulness, tool calls are all independent.<br>\nI'm not sure how an agent would interact with a REPL MCP, which would be very stateful, it might have to repeatedly provide the current state to the agent.</p>\n<p>As shown by <span class=\"user-mention\" data-user-id=\"463845\">@Alexander Heckett</span>  a practical setup would often involve multiple MCP servers, specialized for different tasks.<br>\nI think this is a good idea, and I would like to see more specialized MCP servers for Lean.</p>\n<p>Regarding AI agents calling AI agents, there are some protocols available such as <a href=\"https://github.com/google-a2a/A2A\">https://github.com/google-a2a/A2A</a> .<br>\nIt might be worth integrating with an existing protocol.</p>\n<p>Regarding security, while MCP is powerful, it is not a very good standard in my opinion. Hopefully some major revisions are coming soon!<br>\nIt is unsafe and not very well documented. I would encourage developers to put some information into the docs regarding security.<br>\nE.g. in the case of lean-lsp-mcp, while there is no sensitive information, it can still access your local file system etc.</p>\n<p>Overall, I am looking forward to seeing how MCPs can augment AI agents!</p>",
        "id": 521427661,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1748684805
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"802311\">Oliver Dressler</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521427661\">said</a>:</p>\n<blockquote>\n<p>I'm not sure how an agent would interact with a REPL MCP, which would be very stateful, it might have to repeatedly provide the current state to the agent.</p>\n</blockquote>\n<p>FYI</p>\n<ul>\n<li>Memory MCP Server</li>\n</ul>\n<p><a href=\"https://github.com/modelcontextprotocol/servers/tree/main/src/memory\">https://github.com/modelcontextprotocol/servers/tree/main/src/memory</a></p>\n<ul>\n<li>Sequential Thinking MCP Server</li>\n</ul>\n<p><a href=\"https://github.com/modelcontextprotocol/servers/tree/main/src/sequentialthinking\">https://github.com/modelcontextprotocol/servers/tree/main/src/sequentialthinking</a></p>",
        "id": 521428210,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748685290
    },
    {
        "content": "<p>With regards to AI working on a sorry, also see: </p>\n<p><a class=\"stream-topic\" data-stream-id=\"219941\" href=\"/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/SorryDB.20project/with/518068190\">#Machine Learning for Theorem Proving &gt; SorryDB project</a></p>",
        "id": 521428629,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748685686
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"802311\">Oliver Dressler</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521427661\">said</a>:</p>\n<blockquote>\n<p>Regarding AI agents calling AI agents, there are some protocols available such as <a href=\"https://github.com/google-a2a/A2A\">https://github.com/google-a2a/A2A</a> .<br>\nIt might be worth integrating with an existing protocol.</p>\n</blockquote>\n<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>\n<div class=\"message_inline_image\"><a href=\"https://miro.medium.com/v2/resize:fit:720/format:webp/1*g56lFcsovNzkKGOFh5GgSQ.png\"><img src=\"https://uploads.zulipusercontent.net/496bf43ffc83ed80e3e4568b0ec341637bf43792/68747470733a2f2f6d69726f2e6d656469756d2e636f6d2f76322f726573697a653a6669743a3732302f666f726d61743a776562702f312a6735366c4663736f764e7a6b4b474f466835476753512e706e67\"></a></div><p>Image source: <a href=\"https://lekha-bhan88.medium.com/mcp-vs-a2a-what-the-future-of-ai-agent-communication-looks-like-fc209a9d1a83\">MCP vs A2A: What the Future of AI Agent Communication Looks Like</a></p>\n<p><a href=\"/user_uploads/3121/dT7KFT3sfjHluCE_RoxSzuX2/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/dT7KFT3sfjHluCE_RoxSzuX2/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"617x710\" src=\"/user_uploads/thumbnail/3121/dT7KFT3sfjHluCE_RoxSzuX2/image.png/840x560.webp\"></a></div><p>Image source:  Linked in - <a href=\"http://Generative%20AI’s%20Post\">Generative AI’s Post</a></p>",
        "id": 521428722,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748685761
    },
    {
        "content": "<p>Other possibilities</p>\n<p>Expose other <a href=\"https://en.wikipedia.org/wiki/Proof_assistant\">Proof Assistants</a> </p>\n<ul>\n<li>as MCP Host and connect with A2A.</li>\n<li>as MCP Server and connect with MCP, e.g. <a href=\"https://github.com/angrysky56/mcp-rocq\">https://github.com/angrysky56/mcp-rocq</a></li>\n</ul>\n<p>Expose <a href=\"https://en.wikipedia.org/wiki/Automated_theorem_proving#Software_systems\">Automated Theorem Provers</a> as MCP Server and connect with MCP, e.g.</p>\n<div class=\"codehilite\"><pre><span></span><code>* Z3 - https://github.com/javergar/z3_mcp\n* Prover9/Mace4 - https://github.com/angrysky56/mcp-logic\n* MiniZinc - https://github.com/angrysky56/mcp-solver\n</code></pre></div>\n\n<p>Expose other useful code and connect with MCP</p>\n<ul>\n<li><a href=\"https://www.sympy.org/en/index.html\">SymPy</a>, e.g.  <a href=\"https://github.com/sdiehl/sympy-mcp\">https://github.com/sdiehl/sympy-mcp</a></li>\n</ul>\n<p>Note: There are often more than one MCP server for an entity, e.g.  for SymPy as noted with a <a href=\"https://www.google.com/search?q=sympy+mcp+server&amp;oq=sympy+mcp+server\">Google search</a>.</p>",
        "id": 521434803,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748691366
    },
    {
        "content": "<p>\"RocqStar: Leveraging Similarity-driven Retrieval and Agentic Systems for Rocq generation\" by Nikita Khramov, Andrei Kozyrev, Gleb Solovev and Anton Podkopaev (<a href=\"https://arxiv.org/pdf/2505.22846v1\">pdf</a>)</p>",
        "id": 521439567,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748695436
    },
    {
        "content": "<p>Just wanted to give a shoutout to <span class=\"user-mention\" data-user-id=\"802311\">@Oliver Dressler</span> for the lean-lsp-mcp. I've been using it in Cursor and it works like a charm! No more guessing about the proof state :). I've also managed to connect it to Claude Desktop, the mcp.json just needs an extra PATH env, otherwise it won't find lake.<br>\nI haven't tried LeanExplore or LeanTool yet, but will try them in the future.</p>",
        "id": 521448765,
        "sender_full_name": "Frauke Harms",
        "timestamp": 1748702913
    },
    {
        "content": "<p>Would anyone be interested in building a single Lean 4 agent that the community can use easily? For instance, one that can complete sorrys, to start off. Then, gradually, we can move to more complicated tasks, like creating entire documents or projects.</p>",
        "id": 521506305,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748752126
    },
    {
        "content": "<p>Similar <span class=\"user-mention\" data-user-id=\"463845\">@Alexander Heckett</span> , I am using Claude to prove Lean statements in the MiniF2F problem set, and it seems to be doing well. I think we can automate a lot of things once I add nightly indexing to LeanExplore and more repositories.</p>",
        "id": 521506912,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748752443
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521506305\">said</a>:</p>\n<blockquote>\n<p>Would anyone be interested in building a single Lean 4 agent that the community can use easily?</p>\n</blockquote>\n<p>Interested: Yes</p>\n<p>While I can not commit to making it a high priority, I can offer to stay informed and helping out when and where I can.</p>",
        "id": 521531211,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748769286
    },
    {
        "content": "<p>Id also be interested.<br>\nCurrently I cant devote lots of time, but over the summer I will be free to help develop an early version. I attached a diagram for an idea I had for the general setup, this way it would be easy to swap out pieces as it gets built. <br>\n<a href=\"/user_uploads/3121/tkq27qtm-uTRwLdayPHmE_Fa/screenshot-zo-1-jun-2025-112543-CEST.png\">screenshot-zo  1 jun 2025 11:25:43 CEST.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/tkq27qtm-uTRwLdayPHmE_Fa/screenshot-zo-1-jun-2025-112543-CEST.png\" title=\"screenshot-zo  1 jun 2025 11:25:43 CEST.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"746x589\" src=\"/user_uploads/thumbnail/3121/tkq27qtm-uTRwLdayPHmE_Fa/screenshot-zo-1-jun-2025-112543-CEST.png/840x560.webp\"></a></div><p>Let me know if I am overstepping a bit, I haven't been very active in this thread but I have followed it closely. Id also be the most interested on the ATP server.  I am aware there's existing ones, but having a powerful system for suggesting proof methods in addition to LeanSearch could be pretty effective.</p>",
        "id": 521532748,
        "sender_full_name": "Luis Valero",
        "timestamp": 1748770302
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"919443\">Luis Valero</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521532748\">said</a>:</p>\n<blockquote>\n<p>easy to swap out pieces as it gets built</p>\n</blockquote>\n<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 521534106,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748771258
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"919443\">Luis Valero</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521532748\">said</a>:</p>\n<blockquote>\n<p>having a powerful system for suggesting proof methods in addition to LeanSearch could be pretty effective</p>\n</blockquote>\n<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n<hr>\n<p>This is from the PDF in my earlier <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521439567\">post</a>. </p>\n<p><a href=\"/user_uploads/3121/iJB31vbE__nY4Z7IW5N5hnnk/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/iJB31vbE__nY4Z7IW5N5hnnk/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"550x309\" src=\"/user_uploads/thumbnail/3121/iJB31vbE__nY4Z7IW5N5hnnk/image.png/840x560.webp\"></a></div><p>One of the many interesting parts: <code>the use of multi-agent debate on the planning stage of proof synthesis.</code></p>",
        "id": 521534650,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748771640
    },
    {
        "content": "<p>FYI</p>\n<p>My current focus is not on resolving the <code>sorry</code> statements, but rather on referencing forum messages and information through an MCP (Model Context Protocol).</p>\n<p>For those who can access Anthropic Claude conversation shares, you can view a recent idea exchange with Claude here: <a href=\"https://claude.ai/share/0f0c0f11-afcf-424a-af9c-a75b91fb9c55\">https://claude.ai/share/0f0c0f11-afcf-424a-af9c-a75b91fb9c55</a></p>\n<p>Please note that I cannot guarantee how long this share will remain available, though it should be accessible for at least a week before I delete it.</p>\n<p>The gist is some of the use cases Claude suggested:</p>\n<ul>\n<li>search messages</li>\n<li>get topic summary  (This was the need that started this initiative many months ago)</li>\n<li>Search for discussions about specific mathematical concepts</li>\n<li>Find discussions and help about specific Lean code patterns</li>\n<li>Find all discussions about a specific theorem or proof</li>\n<li>Find different approaches to proving the same theorem</li>\n<li>Find discussions of similar Lean compilation errors</li>\n<li>Track how mathlib definitions/theorems evolved over time - (I suspect this would use the rss channel)</li>\n<li>Search for Lean 4 code patterns, tactics, and proof strategies</li>\n<li>Find forum discussions related to specific papers or mathematical results</li>\n<li>Track discussions about mathlib4 changes, additions, and refactoring</li>\n<li>Find expert-level discussions and insights on advanced topics</li>\n<li>Connect mathematical theory discussions to their Lean 4 implementations</li>\n<li>Fetch actual code/context from GitHub references</li>\n<li>Track mathlib4 PRs related to specific concepts</li>\n<li>Find theorems by mathematical meaning, not just keywords</li>\n<li>Handle different mathematical notations for same concept</li>\n<li>Suggest appropriate tools based on user's task and complexity</li>\n</ul>",
        "id": 521544018,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748778048
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"919443\">@Luis Valero</span> Any feedback or ideas would be helpful, too! If you could let me know more about what you mean by suggesting proof methods, I am interested.</p>",
        "id": 521558985,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748787556
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"366057\">@Eric Taucher</span> I was considering exposing forum messages via the MCP, but I know some people on the Zulip chat would not be very happy about this. Albeit, simply using messages during inference time versus training on them should be a bit different.</p>",
        "id": 521559102,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748787615
    },
    {
        "content": "<p>I created a repository here where I am going to start building out this agentic system: <br>\n<a href=\"https://github.com/justincasher/lean-miner\">https://github.com/justincasher/lean-miner</a></p>\n<p>It is empty right now, but I plan on building this over the next month or so while working on improving LeanExplore.</p>",
        "id": 521559158,
        "sender_full_name": "Justin Asher",
        "timestamp": 1748787661
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521559102\">said</a>:</p>\n<blockquote>\n<p>@Eric Taucher I was considering exposing forum messages via the MCP</p>\n</blockquote>\n<p>Thanks!</p>\n<p>Changed wording to referencing.</p>",
        "id": 521562662,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748789727
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521558985\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"919443\">Luis Valero</span> Any feedback or ideas would be helpful, too! If you could let me know more about what you mean by suggesting proof methods, I am interested.</p>\n</blockquote>\n<p>I meant systems for suggesting tactics, hypothesis, possible proof directions, maybe even having some way of recognizing when current progress is stalling, and suggesting parallel problems to gain some insight. Essentially most of the things already in <span class=\"user-mention\" data-user-id=\"366057\">@Eric Taucher</span> diagram.</p>",
        "id": 521568345,
        "sender_full_name": "Luis Valero",
        "timestamp": 1748792759
    },
    {
        "content": "<p>The use of perturbations to assess an LLMs abilities for university-level symbolic mathematics is noted in this paper. Don't remember/recall perturbations being noted for LLMs assessment on Lean task. </p>\n<p>\"ASyMOB: Algebraic Symbolic Mathematical Operations Benchmark\" by Michael Shalyt, Rotem Elimelech and Ido Kaminer (<a href=\"https://arxiv.org/pdf/2505.23851\">PDF</a>)</p>",
        "id": 521697839,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748857599
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 522102136,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1748951870
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/521396223\">said</a>:</p>\n<blockquote>\n<p>I think if we can get it down to around $1 per sorry, that means we can prove as many statements as those that exist in Mathlib for less than say $250k.</p>\n</blockquote>\n<p>A good direction for this would be to build a \"data acquisition\" company and sell the data to e.g. Anthropic or Deepmind via an acquisition. One could readily get some seed funding for this. I've once raised a few million USD for something very similar, although in a different field (computational biology).</p>\n<p>Data here would be formalisations of mathematical textbooks for example. Or research papers (I know Kevin would say that Mathlib is not ready for most research papers in his field for example).</p>",
        "id": 522463944,
        "sender_full_name": "Adam Kurkiewicz",
        "timestamp": 1749077069
    },
    {
        "content": "<p>The idea would be to optimise the dollar spent for the value of the formalisations produced. I wouldn't be surprised if Anthropic, DeepMind, etc... all already had internal/ semi-internal teams doing this.</p>",
        "id": 522464146,
        "sender_full_name": "Adam Kurkiewicz",
        "timestamp": 1749077178
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111040\">@Adam Kurkiewicz</span>  I like the analogy to computational biology. That's a good idea. Thanks for pointing this out.</p>",
        "id": 522492273,
        "sender_full_name": "Justin Asher",
        "timestamp": 1749095150
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/522492273\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"111040\">Adam Kurkiewicz</span>  I like the analogy to computational biology. That's a good idea. Thanks for pointing this out.</p>\n</blockquote>\n<p>Off topic but I also worked on computational biology (modelling the physiology of chemotherapy induced anaemia, erythrocyte production, nephrotoxicity etc via PDEs and another application liver damage via acetaminophen). We did buy in patient data to test our models on. It was surprisingly (to me at any rate) successful.</p>",
        "id": 522558382,
        "sender_full_name": "Dominic Steinitz",
        "timestamp": 1749120136
    },
    {
        "content": "<p>I think we're on the verge of being able to produce a formalisation of a standard undergraduate textbook largely automatically, which I'm sure would be valuable training data for many LLM companies, especially if done at scale (e.g. 100 or 1000 textbooks). An interesting market dynamic here as well is that if the \"database\" of formalisations is licensed to one of the LLM companies, the other LLM companies need access to that database too in order to not to fall behind. This would be especially true if the database was a leading database in this field (in our case the field of Lean 4 formalisations of maths textbooks). So getting one client (e.g. Anthropic) would automatically translate into putting a lot of pressure on other LLM companies to license the data as well. I would say it's a really good competitive position to be in.</p>\n<p>A company like this could do a lot of \"good\" things for mathematics too (not just focus on database licensing revenue). E.g. it could provide for free an autoformalisation benchmark to the entire community (which would be a small subset of the total data, e.g. 1% of all data). It could also open source a lot of the tooling (as long as some tooling remains proprietary to keep an advantage over any competition that may come up).</p>\n<p>One would have to of course be careful to only use open source textbooks with appropriate licensing (or make a deal, ideally an exclusive deal, with a publisher, e.g. Springer). But for example this would be a suitable open source textbook to use:</p>\n<p><a href=\"https://understandinglinearalgebra.org/home.html\">https://understandinglinearalgebra.org/home.html</a></p>",
        "id": 522612912,
        "sender_full_name": "Adam Kurkiewicz",
        "timestamp": 1749135568
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111040\">Adam Kurkiewicz</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/522612912\">said</a>:</p>\n<blockquote>\n<p>I think we're on the verge of being able to produce a formalisation of a standard undergraduate textbook largely automatically,</p>\n</blockquote>\n<p>I find this quite surprising: what evidence do you have to support this?</p>",
        "id": 522614189,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1749135889
    },
    {
        "content": "<p>No solid evidence, but good experience working with Claude 4 Sonnet, and extrapolation of the capability of LLMs over time. Mostly just a hunch admittedly.</p>",
        "id": 522615247,
        "sender_full_name": "Adam Kurkiewicz",
        "timestamp": 1749136180
    },
    {
        "content": "<p>Thanks, I certainly would love to see this day arrive!</p>",
        "id": 522615846,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1749136343
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"240862\">Oliver Nash</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/522614189\">said</a>:</p>\n<blockquote>\n<p>I find this quite surprising: what evidence do you have to support this?</p>\n</blockquote>\n<p>What about <a class=\"stream-topic\" data-stream-id=\"219941\" href=\"/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/Gemini.202.2E5.20Pro.2006.2F05/with/522628604\">#Machine Learning for Theorem Proving &gt; Gemini 2.5 Pro 06/05</a> ? Seems like we are trending in the right direction.</p>",
        "id": 522629953,
        "sender_full_name": "Justin Asher",
        "timestamp": 1749140589
    },
    {
        "content": "<p>Just wanted to chime in with an update. I have experimented a bit more and found that even with MCP support the current generation of general-purpose models (o3, Claude 4, Gemini 2.5 Pro)  does not help much if you already know your way around mathlib and lean. Both for textbook proofs in probability and combinatorics and original work. That said I remain very optimistic about the trajectory of the field (my background is in ML). There are some well-funded efforts announced or already underway specifically for lean (DeepMind, Darpa, Kimana, DeepSeek), so I think we just have to be a bit more patient.<br>\nEdit: This is not a criticism of the MCPs (tried LeanExplore as well and it also works like a charm!). I think they are exactly what is needed once the models are ready for it!</p>",
        "id": 522630548,
        "sender_full_name": "Frauke Harms",
        "timestamp": 1749140798
    },
    {
        "content": "<p><strong>Update:</strong> After a bit more tinkering, I think I was too harsh on the current models in my earlier post. Some of my frustration can instead be attributed to the following:</p>\n<ol>\n<li>\n<p>The textbook proof of the lemma I was trying to formalize (the sunflower lemma) was flawed. Fixing it required substantial intellectual work that I would not expect LLMs to be able to do on the spot at this point.</p>\n</li>\n<li>\n<p>Tooling glitches: The Cursor agent gets feedback about the proof primarily via linting errors. Cursor's system prompt has a cutoff of 3 attempts to fix those errors. This leads to a phenomenon where the model makes good progress, then suddenly erases everything and goes back to the initial sorry. This is exacerbated by indentation errors. When stopped before erasing and a bit of manual help, it turned out the model (Claude Sonnet 4) was often on the right track.</p>\n</li>\n</ol>\n<p>Overall it was still a fun (but expensive) experience and I wish I had made a recording so people could see what an agent-assisted proof setup looks like in practice.</p>",
        "id": 523414923,
        "sender_full_name": "Frauke Harms",
        "timestamp": 1749619667
    },
    {
        "content": "<p>Does anyone have any success with using any other agents than Claude Sonnet in combination with the MCP server of Lean? I can’t seem to force Gemini agents to query the MCP server properly.</p>",
        "id": 526466479,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751309601
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/526466479\">said</a>:</p>\n<blockquote>\n<p>Does anyone have any success with using any other agents than Claude Sonnet in combination with the MCP server of Lean?</p>\n</blockquote>\n<p>No, at present only use MCP with Claude Windows Desktop and while not always easy do have success.</p>\n<p>Mostly responding so you know others are at least interested in what you are doing and to let you know you are not being ignored.</p>\n<p>Please keep us up to date with problems, successes, etc.</p>",
        "id": 526467980,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1751310038
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"928352\">@Willem vanhulle</span> I've used the <a href=\"https://github.com/GasStationManager/LeanTool\">LeanTool MCP</a> with some combinations of LLM models and coding assistants; besides Claude, there's <a href=\"https://gasstationmanager.github.io/ai/2025/05/22/alphabeta-goose.html\">Gemini and Goose</a>, and <a href=\"https://gasstationmanager.github.io/ai/2025/06/08/proving-alphabeta.html\">Cursor and GPT 4.1 + o3</a></p>",
        "id": 526473539,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751311680
    },
    {
        "content": "<p>Oh, and this project can run an MCP server that is more powerful than <a href=\"https://github.com/oOo0oOo/lean-lsp-mcp\">https://github.com/oOo0oOo/lean-lsp-mcp</a>? <span class=\"user-mention\" data-user-id=\"776090\">@GasStationManager</span></p>",
        "id": 526473905,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751311791
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"928352\">@Willem vanhulle</span> I wouldn't say more powerful; perhaps different modes of interaction. LeanTool mainly interacts with Lean via passing whole  source files. If you have a model that is able to take advantage of the more fine-grained feedback that Lean LSP provides, perhaps it can get more out of lean-lsp-mcp.</p>\n<p>LeanTool also has a non-MCP side that provides a simple feedback loop, so you could run it in an automated workflow without human interaction.</p>",
        "id": 526475771,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751312407
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/526466479\">said</a>:</p>\n<blockquote>\n<p>Does anyone have any success with using any other agents than Claude Sonnet in combination with the MCP server of Lean? I can’t seem to force Gemini agents to query the MCP server properly.</p>\n</blockquote>\n<p>I agree the models have differing tendencies to call MCP tools. Claude 4 seems to work best.</p>\n<p>Unfortunately they are very sensitive to the prompt/instructions used but at the same time do not follow them well. I am planning to collect well working prompts but haven't gotten around to it. Feel free to message me any findings.</p>\n<p>Using (crude) prompts as an incentive to use tools works sometimes. Like:</p>\n<p><code>Analyze the statement using mcp tools (goal, hover, ...), then search for relevant lemmas, finally replace the sorry with a proof outline containing sorries to be filled in later</code></p>\n<p><code>Get diagnostics, then fix the first issue</code></p>\n<p><code>Proof the statement. Rely heavily on the lean-lsp MCP, read its instructions carefully!</code></p>\n<p>I also tend to get frustrated when the model gets side-tracked. In that case I often stop, keep all changes, start a new chat (+ button at the top), and re-prompt. Hopefully this situation improves as the models and IDE integrations develop further.</p>",
        "id": 526593298,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1751371760
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/526466479\">said</a>:</p>\n<blockquote>\n<p>Does anyone have any success with using any other agents than Claude Sonnet in combination with the MCP server of Lean? I can’t seem to force Gemini agents to query the MCP server properly.</p>\n</blockquote>\n<p>Are you using any packages or templates for this? Such as</p>\n<ul>\n<li>Google's <a href=\"https://github.com/google/adk-python\">Agent Development Kit (ADK)</a></li>\n<li><a href=\"https://github.com/a2aproject/A2A\">Agent2Agent (A2A) Protocol</a></li>\n<li>OpenAI's <a href=\"https://github.com/openai/openai-agents-python\">Agents SDK</a></li>\n<li><a href=\"https://github.com/QwenLM/Qwen-Agent\">Qwen-Agent</a></li>\n</ul>",
        "id": 526670659,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751397981
    },
    {
        "content": "<p>I do not know if the most recent Gemini model's support MCP (I know they want to). You may need to use <a href=\"https://ai.google.dev/gemini-api/docs/function-calling\">function calling</a>.</p>",
        "id": 526671527,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751398407
    },
    {
        "content": "<p>Gemini-2.5-pro does support calling MCP tools, as long as it is paired with a coding assistant interface that supports MCP. I've seen it happen with Goose (mentioned above) and Cursor. The coding assistant interface connects to the MCP server, and then exposes the MCP tool to the model as a function call.</p>",
        "id": 526681250,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751403201
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"776090\">@GasStationManager</span> Thanks for letting me know! That sounds right.</p>",
        "id": 526692580,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751409664
    },
    {
        "content": "<p>I have not used these tools yet</p>\n<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/526670659\">zei</a>:</p>\n<blockquote>\n<p>Are you using any packages or templates for this?</p>\n</blockquote>\n<p>No, not directly. I use the interface offered by VS Code's Copilot. Do you just build agents by scratch using these SDKs?</p>",
        "id": 526730735,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751438971
    },
    {
        "content": "<p>Yes, I have played around with some of the aforementioned SDKs before. There definitely is a bit of a learning curve, and you probably would want to tailor the SDK to the model that you want to use, but it is worth trying. In particular, they allow you to manage the model's context much more effectively. Albeit, I completely understand why most people would just want an out-of-the-box solution.</p>",
        "id": 526810276,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751465194
    },
    {
        "content": "<p>Glad to see some updates in this thread! I'm still using Claude (Sonnet or Opus), but have since switched to Claude Code from Cursor (you can combine it with Cursor/VS Code actually) and this has both fixed the 3 attempt cutoff issue and comes with a monthly price cap. The CLAUDE.md file repeatedly nudges the model towards using the MCPs and it seems to work well. It is still a wild ride, but I am learning :D.</p>",
        "id": 527055747,
        "sender_full_name": "Frauke Harms",
        "timestamp": 1751568186
    },
    {
        "content": "<p>I've been trying out <a href=\"https://www.leanexplore.com/docs/mcp\">LeanExplore MCP</a> recently and it's working great. <br>\nI added the LeanExplore MCP server to my Claude Desktop, together with <a href=\"https://github.com/GasStationManager/LeanTool\">LeanTool</a>'s MCP server. </p>\n<p>As an exercise, I asked Claude Sonnet / Opus to prove the theorems and lemmas from <a href=\"https://github.com/morph-labs/lean-abc-true-almost-always/tree/main\">Morph Labs/Trinity's recent autoformalization result</a>. <br>\nFor each theorem/lemma, I prompted with the lean theorem statement, and which lemma it depends on according to the published blueprint. They were able to prove the first dozen or so lemmas before I hit my usage limit for the day. <br>\n(I start with Sonnet which is cheaper, and switch to Opus if it gets stuck, which happened for two of those lemmas)</p>\n<p>Overall they are able to effectively use multiple calls to LeanExplore's search tool and LeanTool's code interpreter to iteratively refine their proof attempts.</p>\n<p>I think these tools, combined with a capable model like Sonnet &amp; Opus, can already be helpful to people working on formalization.</p>\n<p>The proofs so far:<br>\n<a href=\"/user_uploads/3121/Y8FcCTr653dlldtFhGJQe1K3/pabc_claude.lean.txt\">pabc_claude.lean.txt</a></p>",
        "id": 527073571,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751577209
    },
    {
        "content": "<p>Great! Am working on getting LeanExplore updated to v4.21.0.</p>",
        "id": 527075941,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751578404
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776090\">GasStationManager</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527073571\">said</a>:</p>\n<blockquote>\n<p>I prompted with the lean theorem statement</p>\n</blockquote>\n<p>Can you share the prompt?</p>",
        "id": 527082652,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1751582451
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776090\">GasStationManager</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527073571\">said</a>:</p>\n<blockquote>\n<p>I've been trying out <a href=\"https://www.leanexplore.com/docs/mcp\">LeanExplore MCP</a> recently and it's working great. <br>\nI added the LeanExplore MCP server to my Claude Desktop, together with <a href=\"https://github.com/GasStationManager/LeanTool\">LeanTool</a>'s MCP server. </p>\n<p>As an exercise, I asked Claude Sonnet / Opus to prove the theorems and lemmas from <a href=\"https://github.com/morph-labs/lean-abc-true-almost-always/tree/main\">Morph Labs/Trinity's recent autoformalization result</a>. <br>\nFor each theorem/lemma, I prompted with the lean theorem statement, and which lemma it depends on according to the published blueprint. They were able to prove the first dozen or so lemmas before I hit my usage limit for the day. <br>\n(I start with Sonnet which is cheaper, and switch to Opus if it gets stuck, which happened for two of those lemmas)</p>\n<p>Overall they are able to effectively use multiple calls to LeanExplore's search tool and LeanTool's code interpreter to iteratively refine their proof attempts.</p>\n<p>I think these tools, combined with a capable model like Sonnet &amp; Opus, can already be helpful to people working on formalization.</p>\n<p>The proofs so far:<br>\n<a href=\"/user_uploads/3121/Y8FcCTr653dlldtFhGJQe1K3/pabc_claude.lean.txt\">pabc_claude.lean.txt</a></p>\n</blockquote>\n<p>This is nice! Is there a version of this setup that you can share, in such a way that I can (relatively) easily try doing the same experiment myself?</p>",
        "id": 527082891,
        "sender_full_name": "Bhavik Mehta",
        "timestamp": 1751582627
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776090\">GasStationManager</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527073571\">said</a>:</p>\n<blockquote>\n<p>The proofs so far</p>\n</blockquote>\n<p>Seeing</p>\n<p><code>lemma two_rpow_ge_add_one (x : â„) (hx : x â‰¥ 1) : 2 ^ x â‰¥ x + 1 := by</code></p>\n<p>Any suggestions on how to view it correctly, e.g. save with different file type, open in XYZ tool and change encoding, etc.</p>",
        "id": 527082906,
        "sender_full_name": "Eric Taucher",
        "timestamp": 1751582635
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"366057\">@Eric Taucher</span> Here's a typical prompt:</p>\n<p>Try to prove the following theorem in Lean. You'll need to use lemma 7 from the attached file. maintain a syntactically correct proof sketch with sorrys, use the check_lean tool to check syntax and get goal states from sorrys, and iteratively refine the sketch. you may use LeanExplore's search tool to look for relevant theorems</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span>\n<span class=\"kn\">lemma</span><span class=\"w\"> </span><span class=\"n\">lemma10</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Finset</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hε</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">hε_small</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">100</span><span class=\"o\">)</span><span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">hs_prime</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"n\">Prime</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha_ge_one</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∏</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">∈</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">filter</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"w\"> </span><span class=\"bp\">≥</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">^</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">ε</span><span class=\"o\">)))</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>",
        "id": 527089511,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751588182
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"366057\">@Eric Taucher</span> it does seem like an  encoding problem with the file. I was pasting the proofs from Claude Desktop into Windows Notepad... looked fine in Windows but looks corrupted when uploaded. I will look into it and get a version without the issues.</p>",
        "id": 527089784,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751588466
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246273\">@Bhavik Mehta</span> Sure!</p>\n<ul>\n<li>install LeanExplore, see <a href=\"https://www.leanexplore.com/docs/quickstart\">https://www.leanexplore.com/docs/quickstart</a></li>\n<li>get an API key from the website</li>\n<li>install <a href=\"https://github.com/GasStationManager/LeanTool\">LeanTool</a></li>\n<li>In my case I was serving the LeanTool MCP server from a  linux machine, and accessing it from Windows. If you are running Mac or Linux it might be easier to run LeanTool MCP locally in <code>stdio</code> mode.</li>\n<li>Claude Desktop for Windows. (Claude Code or Cursor would also work.)<br>\n   Go to File &gt; Settings &gt; Developer, and edit the config file to set up the MCP servers. Here's mine:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"o\">{</span>\n<span class=\"w\">    </span><span class=\"s2\">\"mcpServers\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span><span class=\"s2\">\"LeanTool\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">            </span><span class=\"s2\">\"command\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"npx\"</span><span class=\"o\">,</span>\n<span class=\"w\">            </span><span class=\"s2\">\"args\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">                </span><span class=\"s2\">\"-y\"</span><span class=\"o\">,</span>\n<span class=\"w\">                </span><span class=\"s2\">\"supergateway\"</span><span class=\"o\">,</span>\n<span class=\"w\">                </span><span class=\"s2\">\"--sse\"</span><span class=\"o\">,</span>\n<span class=\"w\">                </span><span class=\"s2\">\"&lt;my remote leantool mcp server address&gt;/sse\"</span>\n<span class=\"w\">            </span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"o\">},</span>\n<span class=\"w\">        </span><span class=\"s2\">\"LeanExplore\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">          </span><span class=\"s2\">\"command\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"s2\">\"leanexplore\"</span><span class=\"o\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"args\"</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">[</span>\n<span class=\"w\">            </span><span class=\"s2\">\"mcp\"</span><span class=\"o\">,</span>\n<span class=\"w\">            </span><span class=\"s2\">\"serve\"</span><span class=\"o\">,</span>\n<span class=\"w\">            </span><span class=\"s2\">\"--backend\"</span><span class=\"o\">,</span>\n<span class=\"w\">            </span><span class=\"s2\">\"api\"</span><span class=\"o\">,</span>\n<span class=\"w\">            </span><span class=\"s2\">\"--api-key\"</span><span class=\"o\">,</span>\n<span class=\"w\">            </span><span class=\"s2\">\"&lt;omitted&gt;\"</span>\n<span class=\"w\">          </span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div>\n<p>Note that Claude Desktop doesn't yet support remote MCP servers; I had to use <a href=\"https://github.com/supercorp-ai/supergateway\">Supergateway</a> to act as a proxy for LeanTool.</p>\n<p>Let me know if you have trouble setting it up!</p>",
        "id": 527090915,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751589803
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"366057\">@Eric Taucher</span>  Here's a version of the file that is non-corrupted: <a href=\"https://github.com/GasStationManager/LeanTool/blob/main/examples/pabc_claude.lean.txt\">https://github.com/GasStationManager/LeanTool/blob/main/examples/pabc_claude.lean.txt</a></p>",
        "id": 527091974,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751590827
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776090\">GasStationManager</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527089784\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"366057\">Eric Taucher</span> it does seem like an  encoding problem with the file. I was pasting the proofs from Claude Desktop into Windows Notepad... looked fine in Windows but looks corrupted when uploaded. I will look into it and get a version without the issues.</p>\n</blockquote>\n<p>As far as I can tell, the file is perfectly fine utf-8 encoded Unicode, which is exactly what you'd want, but Zulip doesn't tell the browser this, so the browser guesses some weird encoding. Maybe this could be considered a Zulip bug.</p>",
        "id": 527122161,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1751614142
    },
    {
        "content": "<p>After a bit more experimenting, if you had named the file <code>pabc_claude.lean</code> instead of <code>pabc_claude.lean.txt</code>, everything should have worked fine.</p>",
        "id": 527123856,
        "sender_full_name": "Joscha Mennicken",
        "timestamp": 1751614866
    },
    {
        "content": "<p>this sounds cool and all but how expensive is this?</p>",
        "id": 527143220,
        "sender_full_name": "(deleted)",
        "timestamp": 1751621636
    },
    {
        "content": "<p>if the total cost is less than $200/month then it is worth using for me</p>",
        "id": 527144297,
        "sender_full_name": "(deleted)",
        "timestamp": 1751621964
    },
    {
        "content": "<p>You can try Claude Code for $17 per month, and then there is the max plan for $100, cf. the <a href=\"https://www.anthropic.com/pricing\">Anthropic billing page</a>. I have not used Claude Code much. Just the MCP integration into the desktop app.</p>\n<p>It would also be worth checking out the <a href=\"https://blog.google/technology/developers/introducing-gemini-cli-open-source-ai-agent/\">Gemini CLI</a>, which is free at the moment, but probably a bit harder to set up here.</p>",
        "id": 527208118,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751646435
    },
    {
        "content": "<p>Cost is definitely a concern. Opus 4 is very impressive: has strong reasoning ability, knows its way around Lean, and are good at using tools. It can solve some pretty tough tasks. But I could only get very limited access to it per day (I'm on the $17/month pro plan). Sonnet 4 is good enough most of the time.</p>\n<p>I do recommend also trying the Gemini models. Had some good experience with Gemini-2.5-pro, even before the latest June update.</p>",
        "id": 527217109,
        "sender_full_name": "GasStationManager",
        "timestamp": 1751650504
    },
    {
        "content": "<p>I have managed to configure claude-code to use two Lean MCP servers and spent more than &gt; 100 $ in a day using Claude Opus 4. The power of <code>claude-code</code> is too addicting. I am taking a break from it, because it distracts from actually learning the Lean language (and its costly).</p>",
        "id": 527283806,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751724334
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"928352\">@Willem vanhulle</span> A lot of people were saying with the max plan you essentially get a few thousand dollars in Claude Code API credits for $100 per month, for what it's worth.</p>",
        "id": 527285404,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751725990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527285404\">zei</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> A lot of people were saying with the max plan you essentially get a few thousand dollars in Claude Code API credits for $100 per month, for what it's worth.</p>\n</blockquote>\n<p>Ah thanks for mentioning! But don't you think the impact of using such agents early on in the learning process is disadvantageous? I started a month ago and don't know many details yet.</p>",
        "id": 527289533,
        "sender_full_name": "Willem vanhulle",
        "timestamp": 1751730689
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527289533\">said</a>:</p>\n<blockquote>\n<p>But don't you think the impact of using such agents early on in the learning process is disadvantageous?</p>\n</blockquote>\n<p>Yeah, probably. I more so had in mind the case where someone who is using an AI to fill in proofs that they didn't want to spend time doing themselves.</p>",
        "id": 527292539,
        "sender_full_name": "Justin Asher",
        "timestamp": 1751734339
    },
    {
        "content": "<blockquote>\n<p>Ah thanks for mentioning! But don't you think the impact of using such agents early on in the learning process is disadvantageous? I started a month ago and don't know many details yet.</p>\n</blockquote>\n<p>As an anecdote, when first learning Lean in 2022 I relied extensively on the <code>library_search</code> tactic (which is now called <code>exact?</code>), which tries to find a proof in the Lean library. This works really well for a lot of simple goals but quickly becomes less powerful the more difficult the thing you are trying to work on. Because of this, I never learned how to properly search mathlib manually or how to read the mathlib documentation. It got to the point where I would try running <code>library_search</code> after every tactic to hope it would close it and I would get frustrated when it couldn't find anything. Over time though, I learned how to properly search through mathlib, which sped up my proofs, and even though I still use <code>exact?</code> occasionally, I would still be comfortable writing Lean code without it. (In fact, I had done something similar when learning programming for the first time where I would overrely on Eclipse's autocomplete feature and didn't know how to find functions when that didn't work.)</p>\n<p>Of course, <code>library_search</code> / <code>exact?</code> is not AI-based so the situation might be different. But I would caution against being completely reliant upon a tool, regardless of whether or not it is AI-based.</p>",
        "id": 527322843,
        "sender_full_name": "Niels Voss",
        "timestamp": 1751777873
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527289533\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"780541\">Justin Asher</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/527285404\">zei</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"928352\">Willem vanhulle</span> A lot of people were saying with the max plan you essentially get a few thousand dollars in Claude Code API credits for $100 per month, for what it's worth.</p>\n</blockquote>\n<p>Ah thanks for mentioning! But don't you think the impact of using such agents early on in the learning process is disadvantageous? I started a month ago and don't know many details yet.</p>\n</blockquote>\n<p>That's a good question. I started with Lean/finding things in mathlib in late 2023/early 2024 when LLMs were still useless for it and would spit out garbled Lean3 code, so there was no other option than to use your own brain and I don't regret it at all. It takes a bit of time and effort to really learn it and I think it is worth doing that without too much LLM intervention.</p>\n<p>However, in the long run formalizing can get somewhat tedious and is just very time-consuming compared to writing things up on paper. My hope is that AI agents can help to bridge that gap, so that Lean can get more widely adopted <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span> .</p>",
        "id": 527503957,
        "sender_full_name": "Frauke Harms",
        "timestamp": 1751901803
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/kngdFRDsKMD39TDuiDCsGzmJ/Screenshot_20250713_144924_com_android_chrome_SameTaskWebApkActivity.jpg\">Screenshot_20250713_144924_com_android_chrome_SameTaskWebApkActivity.jpg</a><br>\nGemini makes errors very often. I don't think it's very good at Lean 4...</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/kngdFRDsKMD39TDuiDCsGzmJ/Screenshot_20250713_144924_com_android_chrome_SameTaskWebApkActivity.jpg\" title=\"Screenshot_20250713_144924_com_android_chrome_SameTaskWebApkActivity.jpg\"><img data-original-content-type=\"image/jpeg\" data-original-dimensions=\"1080x2412\" src=\"/user_uploads/thumbnail/3121/kngdFRDsKMD39TDuiDCsGzmJ/Screenshot_20250713_144924_com_android_chrome_SameTaskWebApkActivity.jpg/840x560.webp\"></a></div>",
        "id": 528512039,
        "sender_full_name": "(deleted)",
        "timestamp": 1752393093
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/5E-gazF74FjgLvdT71q-O_96/Screenshot_20250713_145836_com_android_chrome_SameTaskWebApkActivity.jpg\">Screenshot_20250713_145836_com_android_chrome_SameTaskWebApkActivity.jpg</a><br>\nUseless AI :))))))))))))</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/5E-gazF74FjgLvdT71q-O_96/Screenshot_20250713_145836_com_android_chrome_SameTaskWebApkActivity.jpg\" title=\"Screenshot_20250713_145836_com_android_chrome_SameTaskWebApkActivity.jpg\"><img data-original-content-type=\"image/jpeg\" data-original-dimensions=\"1080x2412\" src=\"/user_uploads/thumbnail/3121/5E-gazF74FjgLvdT71q-O_96/Screenshot_20250713_145836_com_android_chrome_SameTaskWebApkActivity.jpg/840x560.webp\"></a></div>",
        "id": 528512430,
        "sender_full_name": "(deleted)",
        "timestamp": 1752393546
    },
    {
        "content": "<p>Gemini disappointed me. Let's see if Claude Code is up to any good. I'm telling it to prove basic deduction rules in high school geometry. Let's see how it fares...<br>\n<a href=\"/user_uploads/3121/cp0Z1W4pYzRMO69LDoEPlGbJ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/cp0Z1W4pYzRMO69LDoEPlGbJ/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1920x1080\" src=\"/user_uploads/thumbnail/3121/cp0Z1W4pYzRMO69LDoEPlGbJ/image.png/840x560.webp\"></a></div>",
        "id": 528715152,
        "sender_full_name": "(deleted)",
        "timestamp": 1752516324
    },
    {
        "content": "<p>I'm going to bed. If everything goes decently well, I'll sing AI's praises. If not, well, I will not buy into the AI hype again.</p>",
        "id": 528715310,
        "sender_full_name": "(deleted)",
        "timestamp": 1752516384
    },
    {
        "content": "<p>Not impressed. Claude said \"the sorry hammer proved this theorem is false\". What?</p>",
        "id": 528717359,
        "sender_full_name": "(deleted)",
        "timestamp": 1752517331
    },
    {
        "content": "<p>After seeing that nonsense I decided to stop Claude Code.</p>",
        "id": 528717390,
        "sender_full_name": "(deleted)",
        "timestamp": 1752517345
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"511228\">Huỳnh Trần Khanh</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/528717359\">said</a>:</p>\n<blockquote>\n<p>Not impressed. Claude said \"the sorry hammer proved this theorem is false\". What?</p>\n</blockquote>\n<p>hmm... a recent addition to LeanTool's sorry hammer feature is that once the hammer fail to prove the goal, it will attempt to prove the negation of the statement (with the hammer). The motivation is to detect hallucinations in the proof sketch and/or the code implementation produced by the AI. </p>\n<p>Was the theorem statement Claude was attempting supposed to be true? If so, it could be potential bug in the sorry hammer implementation, or in how Claude is interpreting the output. If you send me the theorem statement I can try to look into it.</p>",
        "id": 528720984,
        "sender_full_name": "GasStationManager",
        "timestamp": 1752518942
    },
    {
        "content": "<p>It doesn't even bother to call that property checking function. It just calls the Lean check function and when the check function says \"unsolved goals\" then it claims the \"sorry hammer\" failed.</p>",
        "id": 528765771,
        "sender_full_name": "(deleted)",
        "timestamp": 1752542982
    },
    {
        "content": "<p>And crazily this isn't always reproducible because AI...</p>",
        "id": 528765820,
        "sender_full_name": "(deleted)",
        "timestamp": 1752543016
    },
    {
        "content": "<p>Alright I'll give you one theorem in the set of theorems</p>",
        "id": 528766373,
        "sender_full_name": "(deleted)",
        "timestamp": 1752543474
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">SyntheticRules</span><span class=\"bp\">.</span><span class=\"n\">r11</span><span class=\"bp\">.</span><span class=\"n\">extracted_1_1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"bp\">‖</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"o\">((</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"bp\">¬</span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 528766533,
        "sender_full_name": "(deleted)",
        "timestamp": 1752543623
    },
    {
        "content": "<p>I'm glad I only spent $20. Claude kept going back to the geometric interpretation and ended up failing to prove the theorem algebraically.</p>",
        "id": 528772607,
        "sender_full_name": "(deleted)",
        "timestamp": 1752549589
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">Norm</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Analysis</span><span class=\"bp\">.</span><span class=\"n\">SpecialFunctions</span><span class=\"bp\">.</span><span class=\"n\">Complex</span><span class=\"bp\">.</span><span class=\"n\">Arg</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">SyntheticRules</span><span class=\"bp\">.</span><span class=\"n\">extracted_1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ha</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">haa</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">haa</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">    </span><span class=\"bp\">‖</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">haa</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">      </span><span class=\"bp\">‖</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">haa</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">        </span><span class=\"bp\">‖</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">haa</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">          </span><span class=\"bp\">‖</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">haa</span><span class=\"w\"> </span><span class=\"bp\">→</span>\n<span class=\"w\">            </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">arg</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">intros</span><span class=\"w\"> </span><span class=\"n\">h_pos</span><span class=\"w\"> </span><span class=\"n\">h_A</span><span class=\"w\"> </span><span class=\"n\">h_B</span><span class=\"w\"> </span><span class=\"n\">h_C</span><span class=\"w\"> </span><span class=\"n\">h_D</span><span class=\"w\"> </span><span class=\"n\">h_im</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- This theorem states a fundamental result about cyclic quadrilaterals in the complex plane.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Given: Four points A, B, C, D lie on a circle centered at ha with radius haa &gt; 0.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Given: The quotient (A - B) / (C - D) has imaginary part 0, meaning it's real.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Conclusion: The arguments of (D - A) / (D - C) and (D - C) / (B - C) are equal.</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Geometric interpretation:</span>\n<span class=\"w\">  </span><span class=\"c1\">-- The condition ((A - B) / (C - D)).im = 0 means that the chord AB is parallel to chord CD.</span>\n<span class=\"w\">  </span><span class=\"c1\">-- The conclusion means that the directed angles ∠(DC, DA) and ∠(DC, BC) are equal.</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- This follows from the fundamental theorem about parallel chords in circles:</span>\n<span class=\"w\">  </span><span class=\"c1\">-- When two chords of a circle are parallel, they subtend equal inscribed angles.</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Mathematical foundation:</span>\n<span class=\"w\">  </span><span class=\"c1\">-- 1. All four points lie on the circle |z - ha| = haa</span>\n<span class=\"w\">  </span><span class=\"c1\">-- 2. The parallelism condition creates a symmetric configuration</span>\n<span class=\"w\">  </span><span class=\"c1\">-- 3. The inscribed angle theorem ensures that parallel chords create equal angles</span>\n<span class=\"w\">  </span><span class=\"c1\">-- 4. Complex arguments capture these geometric angles precisely</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- The proof strategy would involve:</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Step 1: Establish that A, B, C, D form a cyclic quadrilateral</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_concyclic</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">‖</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">ha</span><span class=\"bp\">‖</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">h_A</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">h_B</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h_B</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">h_C</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h_C</span><span class=\"bp\">.</span><span class=\"n\">trans</span><span class=\"w\"> </span><span class=\"n\">h_D</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"bp\">⟩</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Step 2: Use the fact that (A - B) / (C - D) being real implies AB || CD</span>\n<span class=\"w\">  </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_parallel</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h_im</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Step 3: Apply the parallel chord theorem for cyclic quadrilaterals</span>\n<span class=\"w\">  </span><span class=\"c1\">-- In a cyclic quadrilateral where opposite sides are parallel,</span>\n<span class=\"w\">  </span><span class=\"c1\">-- certain inscribed angles are equal due to arc subtension properties</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- Step 4: Translate geometric angle equality to complex argument equality</span>\n<span class=\"w\">  </span><span class=\"c1\">-- The complex argument arg(z) represents the angle that z makes with the positive real axis</span>\n<span class=\"w\">  </span><span class=\"c1\">-- Equal geometric angles correspond to equal complex arguments</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- The complete formal proof requires advanced techniques in:</span>\n<span class=\"w\">  </span><span class=\"c1\">-- - Complex analysis (argument properties and circle geometry)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- - Projective geometry (cross-ratios and harmonic division)</span>\n<span class=\"w\">  </span><span class=\"c1\">-- - Circle theorems (inscribed angles and parallel chords)</span>\n\n<span class=\"w\">  </span><span class=\"c1\">-- This is a deep result that demonstrates the elegant connection between</span>\n<span class=\"w\">  </span><span class=\"c1\">-- complex analysis and classical Euclidean geometry.</span>\n</code></pre></div>\n<p>this is what Claude did</p>",
        "id": 528772627,
        "sender_full_name": "(deleted)",
        "timestamp": 1752549610
    },
    {
        "content": "<p>anyway looks like I have job security. that's something!</p>",
        "id": 528772944,
        "sender_full_name": "(deleted)",
        "timestamp": 1752549912
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/a41NJ4YZvx2CnZXhbBJO0SbR/Screenshot_20250715_114025_com_android_chrome_SameTaskWebApkActivity.jpg\">Screenshot_20250715_114025_com_android_chrome_SameTaskWebApkActivity.jpg</a><br>\nNo, I'm not rewarding your inability to prove the theorem. Thanks.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/a41NJ4YZvx2CnZXhbBJO0SbR/Screenshot_20250715_114025_com_android_chrome_SameTaskWebApkActivity.jpg\" title=\"Screenshot_20250715_114025_com_android_chrome_SameTaskWebApkActivity.jpg\"><img data-original-content-type=\"image/jpeg\" data-original-dimensions=\"1080x2412\" src=\"/user_uploads/thumbnail/3121/a41NJ4YZvx2CnZXhbBJO0SbR/Screenshot_20250715_114025_com_android_chrome_SameTaskWebApkActivity.jpg/840x560.webp\"></a></div>",
        "id": 528778160,
        "sender_full_name": "(deleted)",
        "timestamp": 1752554490
    },
    {
        "content": "<p>This is my 2nd day playing with Claude Code for Lean. I recommend that you not waste money on this. I have an entirely provable theorem that Claude Code struggles with. Man everyone made me think I'm on the verge of unemployment :))</p>",
        "id": 528922679,
        "sender_full_name": "(deleted)",
        "timestamp": 1752605477
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">SyntheticRules</span><span class=\"bp\">.</span><span class=\"n\">extracted_1</span><span class=\"w\"> </span><span class=\"o\">{</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℂ</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">M</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">h3</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"o\">((</span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">/</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">r1</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">bd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bc</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bd0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">bc0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">cd0</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">≠</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">j1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">r1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">j2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">csq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">r1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">r1</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"bp\">*</span><span class=\"w\"> </span><span class=\"bp\">↑</span><span class=\"n\">r2</span><span class=\"o\">))</span>\n<span class=\"w\">  </span><span class=\"o\">(</span><span class=\"n\">rr</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">¬</span><span class=\"n\">r1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">r1</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"n\">r2</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n</code></pre></div>",
        "id": 528922788,
        "sender_full_name": "(deleted)",
        "timestamp": 1752605522
    },
    {
        "content": "<p>I solved it myself already.</p>",
        "id": 528922844,
        "sender_full_name": "(deleted)",
        "timestamp": 1752605546
    },
    {
        "content": "<p>I found the winning formula. Preprocess the problem statement with Gemini to generate English proof, then use Claude Code to generate the Lean 4 proof. I also need to delete the existing CLAUDE.md file so that Claude doesn't get misleading instructions. Also I have to tell Claude that the sorry hammer feature is permanently broken and it can't use the feature.</p>",
        "id": 529216573,
        "sender_full_name": "(deleted)",
        "timestamp": 1752736580
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"511228\">Huỳnh Trần Khanh</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/529216573\">said</a>:</p>\n<blockquote>\n<p>I found the winning formula. Preprocess the problem statement with Gemini to generate English proof, then use Claude Code to generate the Lean 4 proof. </p>\n</blockquote>\n<p>Yes that is a good general strategy. The tools are most useful when the model already has a good informal proof sketch, and the struggle is trying to translate it to Lean. And the informal proof sketch does not have to be from the same model. I have gotten good informal proof sketches out of o3 also.</p>\n<blockquote>\n<p>I also need to delete the existing CLAUDE.md file so that Claude doesn't get misleading instructions.</p>\n</blockquote>\n<p>Yeah, the existing CLAUDE.md file in LeanTool directory was for a coding-centric workflow. You'll want to replace it with instructions that work for your use case.</p>\n<blockquote>\n<p>Also I have to tell Claude that the sorry hammer feature is permanently broken and it can't use the feature.</p>\n</blockquote>\n<p>Yeah the sorry hammer is currently at a very experimental stage. You can  still prompt the model to try various hammer style tactics, like <code>grind</code>, <code>exact?</code>, and <code>hammer</code>.</p>\n<p>I'm finding that when <code>hammer</code> ends up calling the zipperposition solver, it will often cause the MCP tool call to time out. I've just changed the default tactic for sorry hammer to <code>hammer {disableAuto := true}</code> which at least returns in time.</p>",
        "id": 529342115,
        "sender_full_name": "GasStationManager",
        "timestamp": 1752780018
    },
    {
        "content": "<p>This is just gut feeling from proooompting Claude Code, but I feel like when writing tactic mode proofs, LLMs would really benefit from tracing through the existing steps and sort of diffing the context and goal in each step to understand what is going on.</p>",
        "id": 529350416,
        "sender_full_name": "Gavin Zhao",
        "timestamp": 1752783791
    },
    {
        "content": "<p>Or even better, when the LLM has a proof (most likely in tactic mode), it can write out the proof one step at a time, see how the context and goal changes, and then decide if it wants to keep going or if the context/goal was changed unexpectedly and it needs to change the current step and/or adjust the remaining steps.</p>",
        "id": 529350632,
        "sender_full_name": "Gavin Zhao",
        "timestamp": 1752783901
    },
    {
        "content": "<p>I don't know if achieving this is something MCP tools can help or if this is just about PhD-level prompting :P</p>",
        "id": 529350790,
        "sender_full_name": "Gavin Zhao",
        "timestamp": 1752783982
    },
    {
        "content": "<p>Right now with LeanTool, if you could get the LLM to output tactics line by line, then do a tool call after each line, it would give out the proof state after each line. That's not very efficient though; a more efficient solution might be possible via the <a href=\"https://github.com/oOo0oOo/lean-lsp-mcp\">lean-lsp-mcp</a> tool, or by making an MCP interface for Pantograph (or another repl).</p>\n<p>Although I am not sure if current LLMs have a very nuanced \"world model\" of Lean compiler to benefit from such a trace of goal states. Unless they saw a lot of goal states during training...</p>",
        "id": 529359335,
        "sender_full_name": "GasStationManager",
        "timestamp": 1752788004
    },
    {
        "content": "<p>Significantly improve Claude Code's performance with this one weird trick: Write a documentation file for mathlib lemmas and tactics that are directly related to the problem at hand. There are often many similar problems, so one file can be reused across many problems. This way, the model doesn't have to excessively call LeanExplore and can focus on the task.</p>",
        "id": 529476632,
        "sender_full_name": "(deleted)",
        "timestamp": 1752849997
    },
    {
        "content": "<p>Also I think LeanTool is weird. After a while it has to be restarted. Otherwise it won't respond to requests.</p>",
        "id": 529481136,
        "sender_full_name": "(deleted)",
        "timestamp": 1752851578
    },
    {
        "content": "<p>Sorry I interpreted Lean being slow as LeanTool not responding to requests.</p>",
        "id": 529487159,
        "sender_full_name": "(deleted)",
        "timestamp": 1752853654
    },
    {
        "content": "<p>It does feel like LeanTool tries to rebuild mathlib</p>",
        "id": 529487246,
        "sender_full_name": "(deleted)",
        "timestamp": 1752853684
    },
    {
        "content": "<p>My CPU usage is through the roof</p>",
        "id": 529487300,
        "sender_full_name": "(deleted)",
        "timestamp": 1752853700
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"511228\">Huỳnh Trần Khanh</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/529487246\">said</a>:</p>\n<blockquote>\n<p>It does feel like LeanTool tries to rebuild mathlib</p>\n</blockquote>\n<p>I do see this occasionally as well. But LeanTool is just calling lean, so it may be lean is rebuilding mathlib. You can confirm by running <code>lean testfile.lean</code> where testfile.lean contains an import Mathlib. If that also took forever, then best to resinstall Mathlib, starting from deleting .lake and lake-manifest.json</p>",
        "id": 529498361,
        "sender_full_name": "GasStationManager",
        "timestamp": 1752858251
    },
    {
        "content": "<p>Claude Code performed a translation of code from Rocq to Lean. Here is the original Rocq code:</p>\n<div class=\"codehilite\" data-code-language=\"Coq\"><pre><span></span><code><span class=\"kn\">From</span> <span class=\"n\">stdpp</span> <span class=\"kn\">Require</span> <span class=\"kn\">Import</span> <span class=\"n\">numbers</span> <span class=\"n\">list</span><span class=\"o\">.</span>\n<span class=\"kn\">From</span> <span class=\"n\">CoqCP</span> <span class=\"kn\">Require</span> <span class=\"kn\">Import</span> <span class=\"n\">Options</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Fixpoint</span> <span class=\"n\">knapsack</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"k\">match</span> <span class=\"n\">l</span> <span class=\"k\">with</span>\n  <span class=\"o\">|</span> <span class=\"bp\">[]</span> <span class=\"o\">=&gt;</span> <span class=\"mi\">0</span>\n  <span class=\"o\">|</span> <span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"n\">tail</span> <span class=\"o\">=&gt;</span>\n    <span class=\"k\">if</span> <span class=\"n\">decide</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">&lt;</span> <span class=\"n\">weight</span><span class=\"o\">)</span> <span class=\"k\">then</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"n\">limit</span>\n    <span class=\"k\">else</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"n\">limit</span> <span class=\"o\">`</span><span class=\"n\">max</span><span class=\"o\">`</span> <span class=\"o\">(</span><span class=\"n\">value</span> <span class=\"o\">+</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">-</span> <span class=\"n\">weight</span><span class=\"o\">))</span>\n  <span class=\"k\">end</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Fixpoint</span> <span class=\"n\">knapsack_elements</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"k\">match</span> <span class=\"n\">l</span> <span class=\"k\">with</span>\n  <span class=\"o\">|</span> <span class=\"bp\">[]</span> <span class=\"o\">=&gt;</span> <span class=\"bp\">[]</span>\n  <span class=\"o\">|</span> <span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"n\">tail</span> <span class=\"o\">=&gt;</span>\n    <span class=\"k\">if</span> <span class=\"n\">decide</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">&lt;</span> <span class=\"n\">weight</span><span class=\"o\">)</span> <span class=\"k\">then</span> <span class=\"n\">knapsack_elements</span> <span class=\"n\">tail</span> <span class=\"n\">limit</span>\n    <span class=\"k\">else</span>\n      <span class=\"k\">let</span> <span class=\"k\">without</span> <span class=\"o\">:=</span> <span class=\"n\">knapsack_elements</span> <span class=\"n\">tail</span> <span class=\"n\">limit</span> <span class=\"k\">in</span>\n      <span class=\"k\">let</span> <span class=\"n\">with_item</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"n\">knapsack_elements</span> <span class=\"n\">tail</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">-</span> <span class=\"n\">weight</span><span class=\"o\">)</span> <span class=\"k\">in</span>\n      <span class=\"k\">if</span> <span class=\"n\">decide</span> <span class=\"o\">((</span><span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">snd</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"k\">without</span><span class=\"o\">)</span> <span class=\"o\">&lt;</span> <span class=\"o\">(</span><span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">snd</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"n\">with_item</span><span class=\"o\">))</span>\n      <span class=\"k\">then</span> <span class=\"n\">with_item</span>\n      <span class=\"k\">else</span> <span class=\"k\">without</span>\n  <span class=\"k\">end</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Lemma</span> <span class=\"n\">knapsackElementsSublist</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">sublist</span> <span class=\"o\">(</span><span class=\"n\">knapsack_elements</span> <span class=\"n\">l</span> <span class=\"n\">limit</span><span class=\"o\">)</span> <span class=\"n\">l</span><span class=\"o\">.</span>\n<span class=\"kn\">Proof</span><span class=\"o\">.</span>\n  <span class=\"k\">revert</span> <span class=\"n\">limit</span><span class=\"o\">.</span>\n  <span class=\"k\">induction</span> <span class=\"n\">l</span> <span class=\"k\">as</span> <span class=\"o\">[|</span> <span class=\"n\">head</span> <span class=\"n\">tail</span> <span class=\"n\">IH</span><span class=\"o\">].</span> <span class=\"o\">{</span> <span class=\"n\">easy</span><span class=\"o\">.</span> <span class=\"o\">}</span>\n  <span class=\"k\">simpl</span><span class=\"o\">.</span> <span class=\"k\">intro</span> <span class=\"n\">limit</span><span class=\"o\">.</span>\n  <span class=\"k\">simpl</span><span class=\"o\">.</span>\n  <span class=\"k\">destruct</span> <span class=\"n\">head</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">weight</span> <span class=\"n\">value</span><span class=\"o\">].</span> <span class=\"n\">case_decide</span> <span class=\"k\">as</span> <span class=\"n\">h1</span><span class=\"o\">.</span>\n  <span class=\"o\">-</span> <span class=\"k\">apply</span> <span class=\"n\">sublist_cons</span><span class=\"o\">.</span> <span class=\"k\">apply</span> <span class=\"n\">IH</span><span class=\"o\">.</span>\n  <span class=\"o\">-</span> <span class=\"n\">case_decide</span> <span class=\"k\">as</span> <span class=\"n\">h2</span><span class=\"o\">.</span>\n    <span class=\"o\">+</span> <span class=\"k\">apply</span> <span class=\"n\">sublist_skip</span><span class=\"o\">.</span> <span class=\"k\">apply</span> <span class=\"n\">IH</span><span class=\"o\">.</span>\n    <span class=\"o\">+</span> <span class=\"k\">apply</span> <span class=\"n\">sublist_cons</span><span class=\"o\">.</span> <span class=\"k\">apply</span> <span class=\"n\">IH</span><span class=\"o\">.</span>\n<span class=\"kn\">Qed</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Lemma</span> <span class=\"n\">foldrSum9</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">snd</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"o\">((</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">=</span> <span class=\"n\">b</span> <span class=\"o\">+</span> <span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">snd</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"n\">l</span><span class=\"o\">.</span>\n<span class=\"kn\">Proof</span><span class=\"o\">.</span>\n  <span class=\"k\">unfold</span> <span class=\"n\">foldr</span><span class=\"o\">.</span> <span class=\"k\">simpl</span><span class=\"o\">.</span> <span class=\"kp\">reflexivity</span><span class=\"o\">.</span>\n<span class=\"kn\">Qed</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Lemma</span> <span class=\"n\">foldrSum11</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">fst</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"o\">((</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">=</span> <span class=\"n\">a</span> <span class=\"o\">+</span> <span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">fst</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"n\">l</span><span class=\"o\">.</span>\n<span class=\"kn\">Proof</span><span class=\"o\">.</span>\n  <span class=\"k\">unfold</span> <span class=\"n\">foldr</span><span class=\"o\">.</span> <span class=\"k\">simpl</span><span class=\"o\">.</span> <span class=\"kp\">reflexivity</span><span class=\"o\">.</span>\n<span class=\"kn\">Qed</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Lemma</span> <span class=\"n\">knapsackElementsSum</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">snd</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"o\">(</span><span class=\"n\">knapsack_elements</span> <span class=\"n\">l</span> <span class=\"n\">limit</span><span class=\"o\">)</span> <span class=\"o\">=</span> <span class=\"n\">knapsack</span> <span class=\"n\">l</span> <span class=\"n\">limit</span><span class=\"o\">.</span>\n<span class=\"kn\">Proof</span><span class=\"o\">.</span>\n  <span class=\"k\">revert</span> <span class=\"n\">limit</span><span class=\"o\">.</span>\n  <span class=\"k\">induction</span> <span class=\"n\">l</span> <span class=\"k\">as</span> <span class=\"o\">[|</span> <span class=\"n\">head</span> <span class=\"n\">tail</span> <span class=\"n\">IH</span><span class=\"o\">].</span> <span class=\"o\">{</span> <span class=\"n\">easy</span><span class=\"o\">.</span> <span class=\"o\">}</span>\n  <span class=\"k\">destruct</span> <span class=\"n\">head</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">weight</span> <span class=\"n\">value</span><span class=\"o\">].</span> <span class=\"k\">simpl</span><span class=\"o\">.</span>\n  <span class=\"k\">intro</span> <span class=\"n\">limit</span><span class=\"o\">.</span> <span class=\"n\">case_decide</span> <span class=\"k\">as</span> <span class=\"n\">h1</span><span class=\"o\">.</span>\n  <span class=\"o\">-</span> <span class=\"k\">apply</span> <span class=\"n\">IH</span><span class=\"o\">.</span>\n  <span class=\"o\">-</span> <span class=\"n\">case_decide</span> <span class=\"k\">as</span> <span class=\"n\">h2</span><span class=\"o\">.</span>\n    <span class=\"o\">+</span> <span class=\"k\">rewrite</span> <span class=\"o\">!</span><span class=\"n\">IH</span> <span class=\"k\">in</span> <span class=\"n\">h2</span><span class=\"o\">.</span> <span class=\"k\">rewrite</span> <span class=\"o\">(</span><span class=\"n\">ltac</span><span class=\"o\">:(</span><span class=\"kp\">lia</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"n\">limit</span> <span class=\"o\">`</span><span class=\"n\">max</span><span class=\"o\">`</span> <span class=\"o\">(</span><span class=\"n\">value</span> <span class=\"o\">+</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">-</span> <span class=\"n\">weight</span><span class=\"o\">))</span> <span class=\"o\">=</span> <span class=\"n\">value</span> <span class=\"o\">+</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">-</span> <span class=\"n\">weight</span><span class=\"o\">)),</span> <span class=\"n\">foldrSum9</span><span class=\"o\">,</span> <span class=\"n\">IH</span><span class=\"o\">.</span> <span class=\"kp\">reflexivity</span><span class=\"o\">.</span>\n    <span class=\"o\">+</span> <span class=\"k\">rewrite</span> <span class=\"o\">!</span><span class=\"n\">IH</span> <span class=\"k\">in</span> <span class=\"n\">h2</span><span class=\"o\">.</span> <span class=\"k\">rewrite</span> <span class=\"o\">(</span><span class=\"n\">ltac</span><span class=\"o\">:(</span><span class=\"kp\">lia</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"n\">limit</span> <span class=\"o\">`</span><span class=\"n\">max</span><span class=\"o\">`</span> <span class=\"o\">(</span><span class=\"n\">value</span> <span class=\"o\">+</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">-</span> <span class=\"n\">weight</span><span class=\"o\">))</span> <span class=\"o\">=</span> <span class=\"n\">knapsack</span> <span class=\"n\">tail</span> <span class=\"n\">limit</span><span class=\"o\">),</span> <span class=\"n\">IH</span><span class=\"o\">.</span> <span class=\"kp\">reflexivity</span><span class=\"o\">.</span>\n<span class=\"kn\">Qed</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Lemma</span> <span class=\"n\">knapsackElementsLimit</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">fst</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"o\">(</span><span class=\"n\">knapsack_elements</span> <span class=\"n\">l</span> <span class=\"n\">limit</span><span class=\"o\">)</span> <span class=\"o\">&lt;=</span> <span class=\"n\">limit</span><span class=\"o\">.</span>\n<span class=\"kn\">Proof</span><span class=\"o\">.</span>\n  <span class=\"k\">revert</span> <span class=\"n\">limit</span><span class=\"o\">.</span> <span class=\"k\">induction</span> <span class=\"n\">l</span> <span class=\"k\">as</span> <span class=\"o\">[|</span> <span class=\"n\">head</span> <span class=\"n\">tail</span> <span class=\"n\">IH</span><span class=\"o\">].</span>\n  <span class=\"o\">{</span> <span class=\"k\">simpl</span><span class=\"o\">.</span> <span class=\"kp\">lia</span><span class=\"o\">.</span> <span class=\"o\">}</span>\n  <span class=\"k\">intro</span> <span class=\"n\">limit</span><span class=\"o\">.</span> <span class=\"k\">destruct</span> <span class=\"n\">head</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">weight</span> <span class=\"n\">value</span><span class=\"o\">].</span>\n  <span class=\"k\">simpl</span><span class=\"o\">.</span> <span class=\"n\">case_decide</span> <span class=\"k\">as</span> <span class=\"n\">h1</span><span class=\"o\">.</span> <span class=\"o\">{</span> <span class=\"k\">apply</span> <span class=\"n\">IH</span><span class=\"o\">.</span> <span class=\"o\">}</span>\n  <span class=\"n\">case_decide</span> <span class=\"k\">as</span> <span class=\"n\">h2</span><span class=\"o\">.</span>\n  <span class=\"o\">{</span> <span class=\"k\">rewrite</span> <span class=\"n\">foldrSum11</span><span class=\"o\">.</span> <span class=\"k\">pose</span> <span class=\"n\">proof</span> <span class=\"n\">IH</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">-</span> <span class=\"n\">weight</span><span class=\"o\">).</span> <span class=\"kp\">lia</span><span class=\"o\">.</span> <span class=\"o\">}</span>\n  <span class=\"k\">pose</span> <span class=\"n\">proof</span> <span class=\"n\">IH</span> <span class=\"n\">limit</span><span class=\"o\">.</span> <span class=\"kp\">lia</span><span class=\"o\">.</span>\n<span class=\"kn\">Qed</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Definition</span> <span class=\"n\">isMaximum</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">predicate</span> <span class=\"o\">:</span> <span class=\"n\">nat</span> <span class=\"o\">-&gt;</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">predicate</span> <span class=\"n\">x</span> <span class=\"o\">/\\</span> <span class=\"o\">∀</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">predicate</span> <span class=\"n\">y</span> <span class=\"o\">→</span> <span class=\"n\">y</span> <span class=\"o\">≤</span> <span class=\"n\">x</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Lemma</span> <span class=\"n\">knapsackMax</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">nat</span> <span class=\"o\">*</span> <span class=\"n\">nat</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">isMaximum</span> <span class=\"o\">(</span><span class=\"n\">knapsack</span> <span class=\"n\">l</span> <span class=\"n\">limit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"o\">=&gt;</span> <span class=\"k\">exists</span> <span class=\"n\">choice</span><span class=\"o\">,</span> <span class=\"n\">sublist</span> <span class=\"n\">choice</span> <span class=\"n\">l</span> <span class=\"o\">/\\</span> <span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">snd</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"n\">choice</span> <span class=\"o\">=</span> <span class=\"n\">x</span> <span class=\"o\">/\\</span> <span class=\"n\">fold_right</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">x</span> <span class=\"n\">acc</span> <span class=\"o\">=&gt;</span> <span class=\"n\">fst</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">acc</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"n\">choice</span> <span class=\"o\">&lt;=</span> <span class=\"n\">limit</span><span class=\"o\">).</span>\n<span class=\"kn\">Proof</span><span class=\"o\">.</span>\n  <span class=\"k\">revert</span> <span class=\"n\">limit</span><span class=\"o\">.</span>\n  <span class=\"k\">induction</span> <span class=\"n\">l</span> <span class=\"k\">as</span> <span class=\"o\">[|</span> <span class=\"n\">head</span> <span class=\"n\">tail</span> <span class=\"n\">IH</span><span class=\"o\">].</span>\n  <span class=\"o\">{</span> <span class=\"k\">intro</span> <span class=\"n\">a</span><span class=\"o\">.</span> <span class=\"k\">constructor</span><span class=\"o\">.</span>\n    <span class=\"o\">-</span> <span class=\"k\">exists</span> <span class=\"bp\">[]</span><span class=\"o\">.</span> <span class=\"k\">simpl</span><span class=\"o\">.</span> <span class=\"k\">constructor</span><span class=\"o\">.</span> <span class=\"o\">{</span> <span class=\"n\">easy</span><span class=\"o\">.</span> <span class=\"o\">}</span> <span class=\"kp\">lia</span><span class=\"o\">.</span>\n    <span class=\"o\">-</span> <span class=\"k\">intros</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">.</span> <span class=\"k\">destruct</span> <span class=\"n\">c</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">choice</span> <span class=\"o\">[</span><span class=\"n\">h1</span> <span class=\"o\">[</span><span class=\"n\">h2</span> <span class=\"n\">h3</span><span class=\"o\">]]].</span>\n      <span class=\"k\">rewrite</span> <span class=\"n\">sublist_nil_r</span> <span class=\"k\">in</span> <span class=\"n\">h1</span><span class=\"o\">.</span> <span class=\"k\">rewrite</span> <span class=\"n\">h1</span> <span class=\"k\">in</span> <span class=\"n\">h2</span><span class=\"o\">.</span> <span class=\"k\">simpl</span> <span class=\"k\">in</span> <span class=\"n\">h2</span><span class=\"o\">.</span> <span class=\"k\">subst</span> <span class=\"n\">b</span><span class=\"o\">.</span>\n      <span class=\"k\">simpl</span><span class=\"o\">.</span> <span class=\"k\">trivial</span><span class=\"o\">.</span> <span class=\"o\">}</span>\n  <span class=\"k\">intro</span> <span class=\"n\">limit</span><span class=\"o\">.</span> <span class=\"k\">constructor</span><span class=\"o\">.</span>\n  <span class=\"o\">-</span> <span class=\"k\">exists</span> <span class=\"o\">(</span><span class=\"n\">knapsack_elements</span> <span class=\"o\">(</span><span class=\"n\">head</span> <span class=\"o\">::</span> <span class=\"n\">tail</span><span class=\"o\">)</span> <span class=\"n\">limit</span><span class=\"o\">).</span>\n    <span class=\"k\">constructor</span><span class=\"o\">;</span> <span class=\"o\">[|</span> <span class=\"k\">constructor</span><span class=\"o\">];</span> <span class=\"o\">[</span><span class=\"k\">apply</span> <span class=\"n\">knapsackElementsSublist</span> <span class=\"o\">|</span> <span class=\"k\">apply</span> <span class=\"n\">knapsackElementsSum</span> <span class=\"o\">|</span> <span class=\"k\">apply</span> <span class=\"n\">knapsackElementsLimit</span><span class=\"o\">].</span>\n  <span class=\"o\">-</span> <span class=\"k\">intros</span> <span class=\"n\">score</span> <span class=\"n\">h</span><span class=\"o\">.</span> <span class=\"k\">destruct</span> <span class=\"n\">h</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">l1</span> <span class=\"o\">[</span><span class=\"n\">hl</span> <span class=\"o\">[</span><span class=\"n\">hs</span> <span class=\"n\">hS</span><span class=\"o\">]]].</span>\n    <span class=\"k\">destruct</span> <span class=\"n\">head</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">weight</span> <span class=\"n\">value</span><span class=\"o\">].</span>\n    <span class=\"k\">simpl</span><span class=\"o\">.</span> <span class=\"n\">case_decide</span> <span class=\"k\">as</span> <span class=\"n\">h1</span><span class=\"o\">.</span>\n    <span class=\"o\">+</span> <span class=\"k\">pose</span> <span class=\"n\">proof</span> <span class=\"n\">IH</span> <span class=\"n\">limit</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">aa</span> <span class=\"n\">bb</span><span class=\"o\">].</span>\n      <span class=\"k\">rewrite</span> <span class=\"n\">sublist_cons_r</span> <span class=\"k\">in</span> <span class=\"n\">hl</span><span class=\"o\">.</span>\n      <span class=\"k\">destruct</span> <span class=\"n\">hl</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">hl</span> <span class=\"o\">|</span> <span class=\"n\">hl</span><span class=\"o\">].</span>\n      <span class=\"o\">*</span> <span class=\"kp\">exact</span> <span class=\"o\">(</span><span class=\"n\">bb</span> <span class=\"n\">score</span> <span class=\"o\">(</span><span class=\"n\">ex_intro</span> <span class=\"o\">_</span> <span class=\"n\">l1</span> <span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"n\">hl</span> <span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"n\">hs</span> <span class=\"n\">hS</span><span class=\"o\">)))).</span>\n      <span class=\"o\">*</span> <span class=\"k\">destruct</span> <span class=\"n\">hl</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">l2</span> <span class=\"o\">[</span><span class=\"n\">hl</span> <span class=\"n\">hL</span><span class=\"o\">]].</span>\n        <span class=\"k\">rewrite</span> <span class=\"n\">hl</span><span class=\"o\">,</span> <span class=\"n\">foldrSum11</span> <span class=\"k\">in</span> <span class=\"n\">hS</span><span class=\"o\">.</span>\n        <span class=\"kp\">lia</span><span class=\"o\">.</span>\n    <span class=\"o\">+</span> <span class=\"k\">rewrite</span> <span class=\"n\">sublist_cons_r</span> <span class=\"k\">in</span> <span class=\"n\">hl</span><span class=\"o\">.</span>\n      <span class=\"k\">destruct</span> <span class=\"n\">hl</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">hl</span> <span class=\"o\">|</span> <span class=\"n\">hl</span><span class=\"o\">].</span>\n      <span class=\"o\">*</span> <span class=\"k\">pose</span> <span class=\"n\">proof</span> <span class=\"n\">IH</span> <span class=\"n\">limit</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">aa</span> <span class=\"n\">bb</span><span class=\"o\">].</span>\n        <span class=\"k\">pose</span> <span class=\"n\">proof</span> <span class=\"n\">bb</span> <span class=\"n\">score</span> <span class=\"o\">(</span><span class=\"n\">ex_intro</span> <span class=\"o\">_</span> <span class=\"n\">l1</span> <span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"n\">hl</span> <span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"n\">hs</span> <span class=\"n\">hS</span><span class=\"o\">))).</span> <span class=\"kp\">lia</span><span class=\"o\">.</span>\n      <span class=\"o\">*</span> <span class=\"k\">destruct</span> <span class=\"n\">hl</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">l</span> <span class=\"o\">[</span><span class=\"n\">hl</span> <span class=\"n\">hL</span><span class=\"o\">]].</span>\n        <span class=\"k\">pose</span> <span class=\"n\">proof</span> <span class=\"n\">IH</span> <span class=\"o\">(</span><span class=\"n\">limit</span> <span class=\"o\">-</span> <span class=\"n\">weight</span><span class=\"o\">)</span> <span class=\"k\">as</span> <span class=\"o\">[</span><span class=\"n\">aa</span> <span class=\"n\">bb</span><span class=\"o\">].</span>\n        <span class=\"k\">rewrite</span> <span class=\"n\">hl</span><span class=\"o\">,</span> <span class=\"n\">foldrSum9</span> <span class=\"k\">in</span> <span class=\"n\">hs</span><span class=\"o\">.</span>\n        <span class=\"k\">rewrite</span> <span class=\"n\">hl</span><span class=\"o\">,</span> <span class=\"n\">foldrSum11</span> <span class=\"k\">in</span> <span class=\"n\">hS</span><span class=\"o\">.</span>\n        <span class=\"n\">epose</span> <span class=\"n\">proof</span> <span class=\"n\">bb</span> <span class=\"o\">(</span><span class=\"n\">score</span> <span class=\"o\">-</span> <span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ex_intro</span> <span class=\"o\">_</span> <span class=\"n\">l</span> <span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"n\">hL</span> <span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"o\">_</span> <span class=\"o\">_))).</span> <span class=\"kp\">lia</span><span class=\"o\">.</span>\n        <span class=\"kn\">Unshelve</span><span class=\"o\">.</span> <span class=\"o\">{</span> <span class=\"kp\">lia</span><span class=\"o\">.</span> <span class=\"o\">}</span> <span class=\"o\">{</span> <span class=\"kp\">lia</span><span class=\"o\">.</span> <span class=\"o\">}</span>\n<span class=\"kn\">Qed</span><span class=\"o\">.</span>\n</code></pre></div>",
        "id": 529627028,
        "sender_full_name": "(deleted)",
        "timestamp": 1752981990
    },
    {
        "content": "<p>Here is the translated code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean4\"><pre><span></span><code><span class=\"c1\">-- Knapsack problem implementation and properties in Lean 4</span>\n<span class=\"c1\">-- Translated from Coq</span>\n\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Data</span><span class=\"bp\">.</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Basic</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"n\">Mathlib</span><span class=\"bp\">.</span><span class=\"n\">Tactic</span><span class=\"bp\">.</span><span class=\"n\">Linarith</span>\n\n<span class=\"c1\">-- Basic function definitions</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">))</span>\n\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"o\">[]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">    </span><span class=\"k\">else</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">without</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">with_item</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">without</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">with_item</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">        </span><span class=\"n\">with_item</span>\n<span class=\"w\">      </span><span class=\"k\">else</span>\n<span class=\"w\">        </span><span class=\"n\">without</span>\n\n<span class=\"c1\">-- Lemma: knapsack_elements always returns a sublist of the input</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsSublist</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">),</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Sublist</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">l</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">knapsack_elements</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">head</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">weight</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Sublist</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">knapsackElementsSublist</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">without</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">with_item</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">without</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">with_item</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Choose with_item</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Sublist</span><span class=\"bp\">.</span><span class=\"n\">cons₂</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">knapsackElementsSublist</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">))</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Choose without</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Sublist</span><span class=\"bp\">.</span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">knapsackElementsSublist</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- Helper lemmas for foldr with snd and fst projections</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foldrSum9</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"o\">]</span>\n\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">foldrSum11</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">((</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- Lemma: sum of values in knapsack_elements equals knapsack value</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsSum</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">),</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">knapsack_elements</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">knapsack</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">knapsack</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">head</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">weight</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsSum</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">without</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">with_item</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih1</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsSum</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsSum</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">without</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">with_item</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foldrSum9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih1</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foldrSum9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">max_def</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_of_lt</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">)]</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih1</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">push_neg</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih1</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">foldrSum9</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">ih2</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">h2</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">max_eq_left</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"c1\">-- Lemma: sum of weights in knapsack_elements is within limit</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsLimit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">),</span>\n<span class=\"w\">  </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"o\">[],</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">knapsack_elements</span><span class=\"o\">]</span>\n<span class=\"w\">  </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">    </span><span class=\"n\">unfold</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">head</span>\n<span class=\"w\">    </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">weight</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsLimit</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">without</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">      </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">with_item</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">::</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span>\n<span class=\"w\">      </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">without</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">with_item</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foldrSum11</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsLimit</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_of_not_lt</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">        </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">Prod</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_sub</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_sub_cancel'</span><span class=\"w\"> </span><span class=\"n\">hle</span>\n<span class=\"w\">        </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">ih</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h_sub</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">h2</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsLimit</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n\n<span class=\"c1\">-- Definition of maximum with respect to a predicate</span>\n<span class=\"kn\">def</span><span class=\"w\"> </span><span class=\"n\">isMaximum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">predicate</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"kt\">Prop</span><span class=\"w\"> </span><span class=\"o\">:=</span>\n<span class=\"w\">  </span><span class=\"n\">predicate</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"bp\">∧</span><span class=\"w\"> </span><span class=\"bp\">∀</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">predicate</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">→</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">x</span>\n\n<span class=\"c1\">-- Main theorem: knapsack value is maximum among all valid choices</span>\n<span class=\"kn\">theorem</span><span class=\"w\"> </span><span class=\"n\">knapsackMax</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:</span>\n<span class=\"w\">  </span><span class=\"n\">isMaximum</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">∃</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"o\">,</span>\n<span class=\"w\">    </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">Sublist</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"bp\">∧</span>\n<span class=\"w\">    </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"bp\">∧</span>\n<span class=\"w\">    </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">  </span><span class=\"n\">constructor</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Show that knapsack value satisfies the predicate</span>\n<span class=\"w\">    </span><span class=\"n\">use</span><span class=\"w\"> </span><span class=\"n\">knapsack_elements</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsSublist</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">    </span><span class=\"n\">constructor</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsSum</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">    </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">knapsackElementsLimit</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">limit</span>\n<span class=\"w\">  </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Show that knapsack value is maximal</span>\n<span class=\"w\">    </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">choice</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hsublist</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hlimit</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h</span>\n<span class=\"w\">    </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"o\">]</span>\n<span class=\"w\">    </span><span class=\"c1\">-- Use strong induction on the list structure</span>\n<span class=\"w\">    </span><span class=\"n\">revert</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"n\">hsublist</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">    </span><span class=\"n\">induction</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"c1\">-- Base case: empty list</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"n\">hsublist</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">      </span><span class=\"c1\">-- Any sublist of [] must be []</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hchoice_nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">eq_nil_of_sublist_nil</span><span class=\"w\"> </span><span class=\"n\">hsublist</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hchoice_nil</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hsum</span>\n<span class=\"w\">      </span><span class=\"c1\">-- List.foldr on empty list is 0</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">foldr_nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">([]</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">ℕ</span><span class=\"w\"> </span><span class=\"bp\">×</span><span class=\"w\"> </span><span class=\"n\">ℕ</span><span class=\"o\">))</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foldr_nil</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hsum</span>\n<span class=\"w\">      </span><span class=\"c1\">-- So score = 0</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">score_zero</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hchoice_nil</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"c1\">-- knapsack [] limit = 0</span>\n<span class=\"w\">      </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">knapsack_nil</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span><span class=\"w\"> </span><span class=\"n\">rfl</span>\n<span class=\"w\">      </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">knapsack_nil</span><span class=\"o\">]</span><span class=\"bp\">;</span><span class=\"w\"> </span><span class=\"n\">simp</span>\n<span class=\"w\">    </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">cons</span><span class=\"w\"> </span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">      </span><span class=\"n\">intro</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"n\">hsublist</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">      </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">weight</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">head</span>\n<span class=\"w\">      </span><span class=\"n\">simp</span><span class=\"w\"> </span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">knapsack</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"n\">by_cases</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">&lt;</span><span class=\"w\"> </span><span class=\"n\">weight</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Case: limit &lt; weight, so we skip this item</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_pos</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"c1\">-- Any valid choice from head::tail either doesn't include head, or does include head</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">sublist_cons_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hsublist</span>\n<span class=\"w\">        </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hsublist</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">h_tail</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"c1\">-- Choice doesn't include head, so it's a valid choice from tail</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"n\">h_tail</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">h_head</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"c1\">-- Choice includes head</span>\n<span class=\"w\">          </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hchoice_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr_sublist</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h_head</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hchoice_eq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foldrSum9</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hsum</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foldrSum11</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">          </span><span class=\"c1\">-- But head has weight &gt; limit, so this choice violates weight constraint</span>\n<span class=\"w\">          </span><span class=\"c1\">-- hlimit says weight + List.foldr (fun x acc =&gt; x.1 + acc) 0 r ≤ limit</span>\n<span class=\"w\">          </span><span class=\"c1\">-- But we know weight &gt; limit, so weight + r_weight &gt; limit, contradiction</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">weight_too_big</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"bp\">&gt;</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_add_right</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span>\n<span class=\"w\">          </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hlimit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">weight_too_big</span><span class=\"o\">]</span>\n<span class=\"w\">      </span><span class=\"bp\">·</span><span class=\"w\"> </span><span class=\"c1\">-- Case: limit ≥ weight, so we have two choices</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">if_neg</span><span class=\"w\"> </span><span class=\"n\">h1</span><span class=\"o\">]</span>\n<span class=\"w\">        </span><span class=\"c1\">-- Apply the inductive hypothesis appropriately</span>\n<span class=\"w\">        </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">sublist_cons_iff</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hsublist</span>\n<span class=\"w\">        </span><span class=\"n\">cases</span><span class=\"w\"> </span><span class=\"n\">hsublist</span><span class=\"w\"> </span><span class=\"k\">with</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inl</span><span class=\"w\"> </span><span class=\"n\">h_tail</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"c1\">-- Choice doesn't include head</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih_applied</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"n\">h_tail</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">          </span><span class=\"c1\">-- knapsack tail limit ≤ max (knapsack tail limit) (value + knapsack tail (limit - weight))</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_trans</span><span class=\"w\"> </span><span class=\"n\">ih_applied</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_max_left</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n<span class=\"w\">        </span><span class=\"bp\">|</span><span class=\"w\"> </span><span class=\"n\">inr</span><span class=\"w\"> </span><span class=\"n\">h_head</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span>\n<span class=\"w\">          </span><span class=\"c1\">-- Choice includes head</span>\n<span class=\"w\">          </span><span class=\"k\">obtain</span><span class=\"w\"> </span><span class=\"bp\">⟨</span><span class=\"n\">r</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hchoice_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">hr_sublist</span><span class=\"bp\">⟩</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">h_head</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hchoice_eq</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hsum</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foldrSum9</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hsum</span>\n<span class=\"w\">          </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">foldrSum11</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"k\">at</span><span class=\"w\"> </span><span class=\"n\">hlimit</span>\n<span class=\"w\">          </span><span class=\"c1\">-- Now score = value + (sum of values in r)</span>\n<span class=\"w\">          </span><span class=\"c1\">-- and weight + (sum of weights in r) ≤ limit</span>\n<span class=\"w\">          </span><span class=\"c1\">-- So sum of weights in r ≤ limit - weight</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">r_weight_bound</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">            </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">hle</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_of_not_lt</span><span class=\"w\"> </span><span class=\"n\">h1</span>\n<span class=\"w\">            </span><span class=\"c1\">-- hlimit: weight + r_weight ≤ limit, so r_weight ≤ limit - weight</span>\n<span class=\"w\">            </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_add_sub</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">add_sub_cancel'</span><span class=\"w\"> </span><span class=\"n\">hle</span>\n<span class=\"w\">            </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hlimit</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">h_add_sub</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"c1\">-- Apply inductive hypothesis to r with reduced limit</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">r_foldr_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">            </span><span class=\"c1\">-- hsum: value + r_value = score, so r_value = score - value</span>\n<span class=\"w\">            </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_score_eq</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">=</span><span class=\"w\"> </span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">hsum</span>\n<span class=\"w\">            </span><span class=\"n\">omega</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">ih_applied</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">score</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"n\">hr_sublist</span><span class=\"w\"> </span><span class=\"n\">r_foldr_eq</span><span class=\"w\"> </span><span class=\"n\">r_weight_bound</span>\n<span class=\"w\">          </span><span class=\"c1\">-- Now score ≤ value + knapsack tail (limit - weight)</span>\n<span class=\"w\">          </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">score_bound</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">choice</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"k\">by</span>\n<span class=\"w\">            </span><span class=\"n\">rw</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">hchoice_eq</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"n\">foldrSum9</span><span class=\"o\">]</span>\n<span class=\"w\">            </span><span class=\"k\">have</span><span class=\"w\"> </span><span class=\"n\">h_r_bound</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">List</span><span class=\"bp\">.</span><span class=\"n\">foldr</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"k\">fun</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"w\"> </span><span class=\"bp\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"bp\">+</span><span class=\"w\"> </span><span class=\"n\">acc</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"bp\">≤</span><span class=\"w\"> </span><span class=\"n\">knapsack</span><span class=\"w\"> </span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"bp\">-</span><span class=\"w\"> </span><span class=\"n\">weight</span><span class=\"o\">)</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">ih_applied</span>\n<span class=\"w\">            </span><span class=\"n\">linarith</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">h_r_bound</span><span class=\"o\">]</span>\n<span class=\"w\">          </span><span class=\"c1\">-- value + knapsack tail (limit - weight) ≤ max (knapsack tail limit) (value + knapsack tail (limit - weight))</span>\n<span class=\"w\">          </span><span class=\"n\">exact</span><span class=\"w\"> </span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_trans</span><span class=\"w\"> </span><span class=\"n\">score_bound</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"n\">Nat</span><span class=\"bp\">.</span><span class=\"n\">le_max_right</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"w\"> </span><span class=\"bp\">_</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 529627059,
        "sender_full_name": "(deleted)",
        "timestamp": 1752982033
    },
    {
        "content": "<p>Importantly, it didn't receive any human input beyond the original Rocq code and <code>ultrathink continue</code></p>",
        "id": 529627101,
        "sender_full_name": "(deleted)",
        "timestamp": 1752982089
    },
    {
        "content": "<p>It is <strong>very important</strong> to use <code>ultrathink</code>. Otherwise, as <span class=\"user-mention\" data-user-id=\"463845\">@Alexander Heckett</span> said, Claude Code can jump between different approaches without thinking things through.</p>",
        "id": 529627202,
        "sender_full_name": "(deleted)",
        "timestamp": 1752982245
    },
    {
        "content": "<p>Cool! I didn't know about ultrathink. <br>\nWhere is the rocq source code from?</p>",
        "id": 529682058,
        "sender_full_name": "GasStationManager",
        "timestamp": 1753011249
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"511228\">Huỳnh Trần Khanh</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/529627028\">said</a>:</p>\n<blockquote>\n<p>Claude Code performed a translation of code from Rocq to Lean.</p>\n</blockquote>\n<p>Huh, that's really nice.</p>",
        "id": 529687955,
        "sender_full_name": "Justin Asher",
        "timestamp": 1753017382
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"776090\">GasStationManager</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/529682058\">said</a>:</p>\n<blockquote>\n<p>Cool! I didn't know about ultrathink. <br>\nWhere is the rocq source code from?</p>\n</blockquote>\n<p><a href=\"https://github.com/huynhtrankhanh/CoqCP\">My CoqCP project!</a></p>",
        "id": 529690590,
        "sender_full_name": "(deleted)",
        "timestamp": 1753020209
    },
    {
        "content": "<p>It is my thesis, and I will defend my thesis next Tuesday</p>",
        "id": 529690625,
        "sender_full_name": "(deleted)",
        "timestamp": 1753020251
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"511228\">Huỳnh Trần Khanh</span> <a href=\"#narrow/stream/219941-Machine-Learning-for-Theorem-Proving/topic/MCP.20Tools.20for.20LLMs.20and.20Agentic.20Mathematics/near/529690625\">said</a>:</p>\n<blockquote>\n<p>It is my thesis, and I will defend my thesis next Tuesday</p>\n</blockquote>\n<p>Good luck with the defense!</p>",
        "id": 529700309,
        "sender_full_name": "Justin Asher",
        "timestamp": 1753030546
    },
    {
        "content": "<p>Unfortunately, after a period of time playing with this setup, I figured that it is just not worth it. It's very unreliable and much slower than dedicated models.</p>",
        "id": 531772651,
        "sender_full_name": "(deleted)",
        "timestamp": 1753861900
    }
]