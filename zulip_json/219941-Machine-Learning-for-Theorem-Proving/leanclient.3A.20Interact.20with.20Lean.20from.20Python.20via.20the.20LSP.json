[
    {
        "content": "<p>I am happy to announce the initial release of <a href=\"https://github.com/oOo0oOo/leanclient\">leanclient</a>, a Python client to the Lean language server.</p>\n<p>This module is a thin wrapper around the Lean language server, allowing similar interactions as the <a href=\"https://github.com/leanprover/vscode-lean4\">VSCode extension</a>, but from Python.<br>\nYou can point leanclient at a lean project to query and update files. E.g:</p>\n<ul>\n<li>Get goals or term goal at a specific position.</li>\n<li>Update a file and get new diagnostic information (warnings, errors, ...).</li>\n<li>Extract locations of symbols (theorems/definitions) in a file.</li>\n<li>Find all callers of a theorem in mathlib.</li>\n<li>Get hover information at a specific position.</li>\n</ul>\n<p>See the <a href=\"https://leanclient.readthedocs.io/en/latest/\">documentation</a> for a full list of implemented features.</p>\n<p>leanclient also enables easy parallel processing of files using multiple language servers to get your fans spinning.</p>\n<p>This tool is designed to abstract away the complexity of interacting via the <a href=\"https://microsoft.github.io/language-server-protocol/\">LSP</a> and allow you to focus on more interesting tasks, such as automatic proof rewrites, information extraction, writing dynamic prompts, ...</p>\n<p>I hope you find this tool useful, and I look forward to any questions, feedback and contributions!</p>",
        "id": 493571145,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1736856589
    },
    {
        "content": "<p>This is a very useful tool. I'm using it to construct a dataset where all instances of <code>simp</code> are translated to the corresponding term using the <code>show_term</code> tactic. </p>\n<p>However, <code>simp</code> has many variations, such as <code>simp * at [*]</code> and <code>simp only</code>, making it difficult to determine the complete scope of <code>simp</code>. Consequently, replacing <code>simp ...</code> with the term can be challenging.  </p>\n<p>I believe this might be the job of a parser, but I'm not very familiar with the Lean parser. Do you know of any methods or tools that could accomplish this task? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 494312041,
        "sender_full_name": "John Smith",
        "timestamp": 1737104365
    },
    {
        "content": "<p>Nice! Can this tool be used to perform all code actions on a file? (Thinking of updating <code>#guard_message</code> strings in particular)</p>",
        "id": 494314527,
        "sender_full_name": "Joachim Breitner",
        "timestamp": 1737105198
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"819526\">John Smith</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/leanclient.3A.20Interact.20with.20Lean.20from.20Python.20via.20the.20LSP/near/494312041\">said</a>:</p>\n<blockquote>\n<p>I believe this might be the job of a parser, but I'm not very familiar with the Lean parser. Do you know of any methods or tools that could accomplish this task? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>I don't think there are any tools directly in the language server.<br>\nMaybe in Metaprogramming but I'm still a novice.</p>\n<p>In Python I would use multiple regex or similar to capture all cases.</p>\n<p>I'm thinking about adding support for conditional rewrites, akin to:<br>\n\"Perform this transformation at every location unless it causes certain diagnostics (errors / warnings).\"</p>\n<p>Would this be useful in your case?</p>",
        "id": 494353131,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1737118060
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"470149\">Joachim Breitner</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/leanclient.3A.20Interact.20with.20Lean.20from.20Python.20via.20the.20LSP/near/494314527\">said</a>:</p>\n<blockquote>\n<p>Nice! Can this tool be used to perform all code actions on a file? (Thinking of updating <code>#guard_message</code> strings in particular)</p>\n</blockquote>\n<p>I can add support for code actions next. If you can shortly explain your use case I can use it as a test case <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 494353325,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1737118124
    },
    {
        "content": "<p>If you're trying to build a dataset, I don't think the LSP is a sensible tool</p>",
        "id": 494357105,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1737119301
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"802311\">Oliver Dressler</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/leanclient.3A.20Interact.20with.20Lean.20from.20Python.20via.20the.20LSP/near/494353131\">said</a>:</p>\n<blockquote>\n<p>I'm thinking about adding support for conditional rewrites, akin to:<br>\n\"Perform this transformation at every location unless it causes certain diagnostics (errors / warnings).\"</p>\n</blockquote>\n<p>Yes, I think this would be very useful. Perhaps we could start with implementing a basic version of this functionality, similar to the \"apply suggestion\" feature in the Lean Client.</p>\n<p>I've noticed that in the VSCode Lean infoview, there's a section called \"Suggestions\" where you can click on blue text to apply a suggestion. This could be seen as a subset or a stepping stone towards the ultimate goal you're describing.<br>\n<a href=\"/user_uploads/3121/ujqi1xB4BK8VtTKzvML8e1w3/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ujqi1xB4BK8VtTKzvML8e1w3/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"676x482\" src=\"/user_uploads/thumbnail/3121/ujqi1xB4BK8VtTKzvML8e1w3/image.png/840x560.webp\"></a></div>",
        "id": 494998469,
        "sender_full_name": "John Smith",
        "timestamp": 1737450055
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/leanclient.3A.20Interact.20with.20Lean.20from.20Python.20via.20the.20LSP/near/494357105\">said</a>:</p>\n<blockquote>\n<p>If you're trying to build a dataset, I don't think the LSP is a sensible tool</p>\n</blockquote>\n<p>Thank you for your feedback. Could you elaborate on why you don't think the Language Server Protocol (LSP) is a suitable tool for building a dataset? </p>\n<p>And what alternative approaches or tools would you recommend for dataset construction in this context?</p>\n<p>THX!</p>",
        "id": 494998826,
        "sender_full_name": "John Smith",
        "timestamp": 1737450159
    },
    {
        "content": "<p>The LSP is really meant for human beings interacting with Lean through an editor. Did you read the discussion at <a class=\"message-link\" href=\"/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/Interacting.20with.20Lean.204/near/476545144\">#Machine Learning for Theorem Proving &gt; Interacting with Lean 4 @ üí¨</a>  for intance?</p>",
        "id": 495003760,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1737451839
    },
    {
        "content": "<p>I think, <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> and <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> are correct. The LSP is not a fitting tool for dataset creation.</p>\n<p>For that something like <a href=\"https://github.com/kim-em/lean-training-data\">lean-training-data</a> is much better suited!<br>\nSpeed is key as mathlib scales up &amp; the lsp is slow at opening files.</p>\n<p>In general, I've been planning a page in the docs about the limitations of the lsp.<br>\nWould love some feedback and additions:</p>\n<ul>\n<li>\n<p><strong>Limited interface made for humans</strong><br>\n    The LSP only allows for a few requests, many require post-processing to be useful (e.g. the highlight range).<br>\n    LSP is part of the core lean4 repo and only extensible there.</p>\n</li>\n<li>\n<p><strong>New parametrization: Line, character</strong><br>\n    Usually the user provides these parameters. You will have to write a program that does this.<br>\n    Bonus: If the LSP does not provide the position you need, you start parsing files manually...</p>\n</li>\n<li>\n<p><strong>Slow to open files.</strong></p>\n</li>\n</ul>\n<p>These limitations make it challening to do library-wide programmatic interaction with the LSP.</p>\n<p>On the other hand, I do believe that precisely due to its design for human interaction,<br>\nthe LSP could have potential for (neural) agentic interaction.</p>",
        "id": 496068883,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1737968990
    },
    {
        "content": "<p>‚ÄúLSP is part of the core lean4 repo and only extensible there‚Äù is not fully true. There are things you can do in user space like implementing a new LSP handler.</p>",
        "id": 496074734,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1737970933
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/219941-Machine-Learning-for-Theorem-Proving/topic/leanclient.3A.20Interact.20with.20Lean.20from.20Python.20via.20the.20LSP/near/496074734\">said</a>:</p>\n<blockquote>\n<p>‚ÄúLSP is part of the core lean4 repo and only extensible there‚Äù is not fully true. There are things you can do in user space like implementing a new LSP handler.</p>\n</blockquote>\n<p>This is great to know. I'll investigate and change the sentence accordingly. Thanks!</p>",
        "id": 496084064,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1737972506
    },
    {
        "content": "<p>One consideration: if the LSP is how you will setup AI to interact with Lean, you should at least spot-check that the data you use at interaction-time agrees with the sort of data data you extract, and ideal check it more thoroughly.  I found lots of weird idiosyncrasies in the Lean 3 language server.  Hopefully those have been properly addressed in Lean 4, but it is good to do this investigation before training a model. :)</p>",
        "id": 496109059,
        "sender_full_name": "Jason Rute",
        "timestamp": 1737980553
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"115715\">Jason Rute</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/leanclient.3A.20Interact.20with.20Lean.20from.20Python.20via.20the.20LSP/near/496109059\">said</a>:</p>\n<blockquote>\n<p>One consideration: if the LSP is how you will setup AI to interact with Lean, you should at least spot-check that the data you use at interaction-time agrees with the sort of data data you extract, and ideal check it more thoroughly.  I found lots of weird idiosyncrasies in the Lean 3 language server.  Hopefully those have been properly addressed in Lean 4, but it is good to do this investigation before training a model. :)</p>\n</blockquote>\n<p>Good point, I'll include a section in the limitations:<br>\n<strong>Verify LSP response</strong> ...</p>\n<p>I cannot comment on lean3 but during development and testing of leanclient I have only found 1-2 minor issues.<br>\nI'm going to submit these but I first want to check if they are relevant in the vscode extension.<br>\nOtherwise they are probably not even worth fixing.<br>\nOverall the experience has been stable even if confusing at times.</p>",
        "id": 496133627,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1737987591
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/leanclient.3A.20Interact.20with.20Lean.20from.20Python.20via.20the.20LSP/near/496074734\">said</a>:</p>\n<blockquote>\n<p>‚ÄúLSP is part of the core lean4 repo and only extensible there‚Äù is not fully true. There are things you can do in user space like implementing a new LSP handler.</p>\n</blockquote>\n<p>Just to clarify, does this mean that a user could extend the LSP Handler and include a custom method e.g. <code>$/lean/infoTree</code>?</p>",
        "id": 496133892,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1737987651
    },
    {
        "content": "<p>Yes, see the discussion at <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/User.20defined.20LSP.20extensions\">#lean4 &gt; User defined LSP extensions</a> . Unfortunately I had zero time to work on this since last summer, but the possibility is real and I had a very early experiment at <a href=\"https://github.com/PatrickMassot/LspExperiments/\">https://github.com/PatrickMassot/LspExperiments/</a></p>",
        "id": 496136900,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1737988453
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/219941-Machine-Learning-for-Theorem-Proving/topic/leanclient.3A.20Interact.20with.20Lean.20from.20Python.20via.20the.20LSP/near/496136900\">said</a>:</p>\n<blockquote>\n<p>Yes, see the discussion at <a class=\"stream-topic\" data-stream-id=\"270676\" href=\"/#narrow/channel/270676-lean4/topic/User.20defined.20LSP.20extensions\">#lean4 &gt; User defined LSP extensions</a> . Unfortunately I had zero time to work on this since last summer, but the possibility is real and I had a very early experiment at <a href=\"https://github.com/PatrickMassot/LspExperiments/\">https://github.com/PatrickMassot/LspExperiments/</a></p>\n</blockquote>\n<p>This is very helpful, thank you!</p>",
        "id": 496138730,
        "sender_full_name": "Oliver Dressler",
        "timestamp": 1737988955
    }
]